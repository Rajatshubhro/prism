import sys
import time
import numpy as np
import prism.mr_adc_overlap as mr_adc_overlap
import prism.mr_adc_rdms as mr_adc_rdms
# import prism.mr_adc_efficient_4rdm as mr_adc_efficient_4rdm

def compute_excitation_manifolds(mr_adc):

    # MR-ADC(0) and MR-ADC(1)
    mr_adc.h0.n_c = mr_adc.ncvs
    mr_adc.h0.dim = mr_adc.h0.n_c # Total dimension of h0

    mr_adc.h0.s_c = 0
    mr_adc.h0.f_c = mr_adc.h0.s_c + mr_adc.h0.n_c

    print("Dimension of h0 excitation manifold:                       %d" % mr_adc.h0.dim)

    # MR-ADC(2)
    mr_adc.h1.dim = 0
    mr_adc.h_orth.dim = mr_adc.h0.dim

    if mr_adc.method in ("mr-adc(2)", "mr-adc(2)-x"):
        mr_adc.h1.n_caa = mr_adc.ncas * mr_adc.ncas * mr_adc.ncvs
        mr_adc.h1.n_cce = mr_adc.nextern * mr_adc.ncvs * (mr_adc.ncvs - 1) // 2
        mr_adc.h1.n_cae = mr_adc.nextern * mr_adc.ncas * mr_adc.ncvs
        mr_adc.h1.n_cca = mr_adc.ncas * mr_adc.ncvs * (mr_adc.ncvs - 1) // 2
        if mr_adc.nval != 0:
            mr_adc.h1.n_cve = mr_adc.nextern * mr_adc.ncvs * mr_adc.nval
            mr_adc.h1.n_cva = mr_adc.ncas * mr_adc.ncvs * mr_adc.nval
            mr_adc.h1.dim = (mr_adc.h1.n_caa + mr_adc.h1.n_cce + mr_adc.h1.n_cve +
                             mr_adc.h1.n_cae + mr_adc.h1.n_cca + mr_adc.h1.n_cva)
        else:
            mr_adc.h1.dim = mr_adc.h1.n_caa + mr_adc.h1.n_cce + mr_adc.h1.n_cae + mr_adc.h1.n_cca

        if mr_adc.nval != 0:
            mr_adc.h1.s_caa = mr_adc.h0.f_c
            mr_adc.h1.f_caa = mr_adc.h1.s_caa + mr_adc.h1.n_caa
            mr_adc.h1.s_cce = mr_adc.h1.f_caa
            mr_adc.h1.f_cce = mr_adc.h1.s_cce + mr_adc.h1.n_cce
            mr_adc.h1.s_cve = mr_adc.h1.f_cce
            mr_adc.h1.f_cve = mr_adc.h1.s_cve + mr_adc.h1.n_cve
            mr_adc.h1.s_cae = mr_adc.h1.f_cve
            mr_adc.h1.f_cae = mr_adc.h1.s_cae + mr_adc.h1.n_cae
            mr_adc.h1.s_cca = mr_adc.h1.f_cae
            mr_adc.h1.f_cca = mr_adc.h1.s_cca + mr_adc.h1.n_cca
            mr_adc.h1.s_cva = mr_adc.h1.f_cca
            mr_adc.h1.f_cva = mr_adc.h1.s_cva + mr_adc.h1.n_cva
        else:
            mr_adc.h1.s_caa = mr_adc.h0.f_c
            mr_adc.h1.f_caa = mr_adc.h1.s_caa + mr_adc.h1.n_caa
            mr_adc.h1.s_cce = mr_adc.h1.f_caa
            mr_adc.h1.f_cce = mr_adc.h1.s_cce + mr_adc.h1.n_cce
            mr_adc.h1.s_cae = mr_adc.h1.f_cce
            mr_adc.h1.f_cae = mr_adc.h1.s_cae + mr_adc.h1.n_cae
            mr_adc.h1.s_cca = mr_adc.h1.f_cae
            mr_adc.h1.f_cca = mr_adc.h1.s_cca + mr_adc.h1.n_cca

        print("Dimension of h1 excitation manifold:                       %d" % mr_adc.h1.dim)

        # Overlap for c - caa
        mr_adc.S12.c_caa = mr_adc_overlap.compute_S12_0p_projector(mr_adc)
        mr_adc.S12.cae = mr_adc_overlap.compute_S12_m1(mr_adc)
        mr_adc.S12.cca = mr_adc_overlap.compute_S12_p1(mr_adc)

        # Determine dimensions of orthogonalized excitation spaces
        mr_adc.h_orth.n_c_caa = mr_adc.ncvs * mr_adc.S12.c_caa.shape[1]
        mr_adc.h_orth.n_cce = mr_adc.h1.n_cce
        mr_adc.h_orth.n_cae = mr_adc.nextern * mr_adc.ncvs * mr_adc.S12.cae.shape[1]
        mr_adc.h_orth.n_cca = mr_adc.S12.cca.shape[1] * mr_adc.ncvs * (mr_adc.ncvs - 1) // 2
        if mr_adc.nval != 0:
            mr_adc.h_orth.n_cve = mr_adc.h1.n_cve
            mr_adc.h_orth.n_cva = mr_adc.S12.cca.shape[1] * mr_adc.ncvs * mr_adc.nval
            mr_adc.h_orth.dim = (mr_adc.h_orth.n_c_caa + mr_adc.h_orth.n_cce + mr_adc.h_orth.n_cve +
                                 mr_adc.h_orth.n_cae + mr_adc.h_orth.n_cca + mr_adc.h_orth.n_cva)
        else:
            mr_adc.h_orth.dim = mr_adc.h_orth.n_c_caa + mr_adc.h_orth.n_cce + mr_adc.h_orth.n_cae + mr_adc.h_orth.n_cca

        if mr_adc.nval != 0:
            mr_adc.h_orth.s_c_caa = 0
            mr_adc.h_orth.f_c_caa = mr_adc.h_orth.n_c_caa
            mr_adc.h_orth.s_cce = mr_adc.h_orth.f_c_caa
            mr_adc.h_orth.f_cce = mr_adc.h_orth.s_cce + mr_adc.h_orth.n_cce
            mr_adc.h_orth.s_cve = mr_adc.h_orth.f_cce
            mr_adc.h_orth.f_cve = mr_adc.h_orth.s_cve + mr_adc.h_orth.n_cve
            mr_adc.h_orth.s_cae = mr_adc.h_orth.f_cve
            mr_adc.h_orth.f_cae = mr_adc.h_orth.s_cae + mr_adc.h_orth.n_cae
            mr_adc.h_orth.s_cca = mr_adc.h_orth.f_cae
            mr_adc.h_orth.f_cca = mr_adc.h_orth.s_cca + mr_adc.h_orth.n_cca
            mr_adc.h_orth.s_cva = mr_adc.h_orth.f_cca
            mr_adc.h_orth.f_cva = mr_adc.h_orth.s_cva + mr_adc.h_orth.n_cva
        else:
            mr_adc.h_orth.s_c_caa = 0
            mr_adc.h_orth.f_c_caa = mr_adc.h_orth.n_c_caa
            mr_adc.h_orth.s_cce = mr_adc.h_orth.f_c_caa
            mr_adc.h_orth.f_cce = mr_adc.h_orth.s_cce + mr_adc.h_orth.n_cce
            mr_adc.h_orth.s_cae = mr_adc.h_orth.f_cce
            mr_adc.h_orth.f_cae = mr_adc.h_orth.s_cae + mr_adc.h_orth.n_cae
            mr_adc.h_orth.s_cca = mr_adc.h_orth.f_cae
            mr_adc.h_orth.f_cca = mr_adc.h_orth.s_cca + mr_adc.h_orth.n_cca

    print("Total dimension of the excitation manifold:                %d" % (mr_adc.h0.dim + mr_adc.h1.dim))
    print("Dimension of the orthogonalized excitation manifold:       %d\n" % (mr_adc.h_orth.dim))
    sys.stdout.flush()

    if (mr_adc.h_orth.dim < mr_adc.nroots):
        mr_adc.nroots = mr_adc.h_orth.dim

    return mr_adc

def compute_M_00(mr_adc):

    start_time = time.time()

    print("Computing M(h0-h0) block...")
    sys.stdout.flush()

    # Einsum definition from kernel
    einsum = mr_adc.interface.einsum
    einsum_type = mr_adc.interface.einsum_type

    # Dimensions
    ncvs = mr_adc.ncvs

    s_c = mr_adc.h0.s_c
    f_c = mr_adc.h0.f_c
    dim = mr_adc.h0.dim

    e_cvs = mr_adc.mo_energy.x
    e_core = mr_adc.mo_energy.c
    e_extern = mr_adc.mo_energy.e

    M = np.zeros((dim, dim))

    # Zeroth-order terms
    # C - C
    M[s_c:f_c, s_c:f_c]  = einsum('J,IJ->IJ', e_ncvs, np.identity(ncvs), optimize = einsum_type)

    # Second-order terms
    if mr_adc.method in ("mr-adc(2)", "mr-adc(2)-x"):
        # Amplitudes
        t1_ce = mr_adc.t1.ce
        t1_ca = mr_adc.t1.ca
        t1_ae = mr_adc.t1.ae
        t1_caea = mr_adc.t1.caea
        t1_caae = mr_adc.t1.caae
        t1_caaa = mr_adc.t1.caaa
        t1_aaea = mr_adc.t1.aaea

        t1_xe = mr_adc.t1.xe
        t1_xa = mr_adc.t1.xa
        t1_xaea = mr_adc.t1.xaea
        t1_xaae = mr_adc.t1.xaae
        t1_xaaa = mr_adc.t1.xaaa
        t1_xcee = mr_adc.t1.xcee
        t1_xcea = mr_adc.t1.xcea
        t1_cxea = mr_adc.t1.cxea
        t1_xaee = mr_adc.t1.xaee
        t1_xcaa = mr_adc.t1.xcaa

        # One-electron integrals
        h_aa = mr_adc.h1eff.aa

        h_xa = mr_adc.h1eff.xa
        h_xe = mr_adc.h1eff.xe

        # Two-electrons integrals
        v_aaaa = mr_adc.v2e.aaaa

        v_xaaa = mr_adc.v2e.xaaa
        v_xcaa = mr_adc.v2e.xcaa
        v_xcee = mr_adc.v2e.xcee
        v_xaea = mr_adc.v2e.xaea
        v_xaae = mr_adc.v2e.xaae
        v_xcae = mr_adc.v2e.xcae
        v_cxae = mr_adc.v2e.cxae
        v_xaee = mr_adc.v2e.xaee
        v_xcxa = mr_adc.v2e.xcxa
        v_cxxa = mr_adc.v2e.cxxa
        v_xcxe = mr_adc.v2e.xcxe
        v_cxxe = mr_adc.v2e.cxxe
        v_xaxe = mr_adc.v2e.xaxe
        v_xaex = mr_adc.v2e.xaex

        # Reduced Density Matrices
        rdm_ca = mr_adc.rdm.ca
        rdm_ccaa = mr_adc.rdm.ccaa
        rdm_cccaaa = mr_adc.rdm.cccaaa

        # C - C
        M[s_c:f_c, s_c:f_c] += einsum('Ix,Jx->IJ', h_xa, t1_xa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Ia,Ja->IJ', h_xe, t1_xe, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Jx,Ix->IJ', h_xa, t1_xa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Ja,Ia->IJ', h_xe, t1_xe, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('Iixy,Jixy->IJ', t1_xcaa, v_xcaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('Iixy,Jiyx->IJ', t1_xcaa, v_xcaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('Iiax,iJxa->IJ', t1_xcea, v_cxae, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('Iiax,Jixa->IJ', t1_xcea, v_xcae, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('Iiab,Jiab->IJ', t1_xcee, v_xcee, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('Iiab,Jiba->IJ', t1_xcee, v_xcee, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('Jixy,Iixy->IJ', t1_xcaa, v_xcaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('Jixy,Iiyx->IJ', t1_xcaa, v_xcaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('Jiax,iIxa->IJ', t1_xcea, v_cxae, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('Jiax,Iixa->IJ', t1_xcea, v_xcae, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('Jiab,Iiab->IJ', t1_xcee, v_xcee, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('Jiab,Iiba->IJ', t1_xcee, v_xcee, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('ix,JiIx->IJ', t1_ca, v_xcxa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('ix,iJIx->IJ', t1_ca, v_cxxa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('iIax,iJxa->IJ', t1_cxea, v_cxae, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('iIax,Jixa->IJ', t1_cxea, v_xcae, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('iJax,iIxa->IJ', t1_cxea, v_cxae, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('iJax,Iixa->IJ', t1_cxea, v_xcae, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('ix,IiJx->IJ', t1_ca, v_xcxa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('ix,iIJx->IJ', t1_ca, v_cxxa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('ia,IiJa->IJ', t1_ce, v_xcxe, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('ia,iIJa->IJ', t1_ce, v_cxxe, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('ia,JiIa->IJ', t1_ce, v_xcxe, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('ia,iJIa->IJ', t1_ce, v_cxxe, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('I,Ix,Jx->IJ', e_cvs, t1_xa, t1_xa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('I,Iixy,Jixy->IJ', e_cvs, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('I,Iixy,Jiyx->IJ', e_cvs, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('I,Iiax,Jiax->IJ', e_cvs, t1_xcea, t1_xcea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('I,Iiax,iJax->IJ', e_cvs, t1_xcea, t1_cxea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('I,Iiab,Jiab->IJ', e_cvs, t1_xcee, t1_xcee, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('I,Iiab,Jiba->IJ', e_cvs, t1_xcee, t1_xcee, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('I,Ia,Ja->IJ', e_cvs, t1_xe, t1_xe, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('I,Jiax,iIax->IJ', e_cvs, t1_xcea, t1_cxea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('I,iIax,iJax->IJ', e_cvs, t1_cxea, t1_cxea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('J,Ix,Jx->IJ', e_cvs, t1_xa, t1_xa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('J,Iixy,Jixy->IJ', e_cvs, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('J,Iixy,Jiyx->IJ', e_cvs, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('J,Iiax,Jiax->IJ', e_cvs, t1_xcea, t1_xcea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('J,Iiax,iJax->IJ', e_cvs, t1_xcea, t1_cxea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('J,Iiab,Jiab->IJ', e_cvs, t1_xcee, t1_xcee, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('J,Iiab,Jiba->IJ', e_cvs, t1_xcee, t1_xcee, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('J,Ia,Ja->IJ', e_cvs, t1_xe, t1_xe, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('J,Jiax,iIax->IJ', e_cvs, t1_xcea, t1_cxea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('J,iIax,iJax->IJ', e_cvs, t1_cxea, t1_cxea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('i,Iixy,Jixy->IJ', e_core, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('i,Iixy,Jiyx->IJ', e_core, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('i,Iiax,Jiax->IJ', e_core, t1_xcea, t1_xcea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('i,Iiax,iJax->IJ', e_core, t1_xcea, t1_cxea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('i,Iiab,Jiab->IJ', e_core, t1_xcee, t1_xcee, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('i,Iiab,Jiba->IJ', e_core, t1_xcee, t1_xcee, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('i,Jixy,Iixy->IJ', e_core, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('i,Jixy,Iiyx->IJ', e_core, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('i,Jiax,Iiax->IJ', e_core, t1_xcea, t1_xcea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('i,Jiax,iIax->IJ', e_core, t1_xcea, t1_cxea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('i,Jiab,Iiab->IJ', e_core, t1_xcee, t1_xcee, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('i,Jiab,Iiba->IJ', e_core, t1_xcee, t1_xcee, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('i,iIax,Jiax->IJ', e_core, t1_cxea, t1_xcea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('i,iIax,iJax->IJ', e_core, t1_cxea, t1_cxea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('i,iJax,Iiax->IJ', e_core, t1_cxea, t1_xcea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('i,iJax,iIax->IJ', e_core, t1_cxea, t1_cxea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('a,Ia,Ja->IJ', e_extern, t1_xe, t1_xe, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('a,Iiax,Jiax->IJ', e_extern, t1_xcea, t1_xcea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('a,Iiax,iJax->IJ', e_extern, t1_xcea, t1_cxea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('a,Iiab,Jiab->IJ', e_extern, t1_xcee, t1_xcee, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('a,Iiab,Jiba->IJ', e_extern, t1_xcee, t1_xcee, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('a,Iiba,Jiab->IJ', e_extern, t1_xcee, t1_xcee, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('a,Iiba,Jiba->IJ', e_extern, t1_xcee, t1_xcee, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('a,iIax,Jiax->IJ', e_extern, t1_cxea, t1_xcea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('a,iIax,iJax->IJ', e_extern, t1_cxea, t1_cxea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Ix,Jyxz,zy->IJ', h_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Ix,Jyzx,zy->IJ', h_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Ia,Jxay,yx->IJ', h_xe, t1_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Ia,Jxya,yx->IJ', h_xe, t1_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Jx,Iyxz,yz->IJ', h_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Jx,Iyzx,yz->IJ', h_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Ja,Ixay,xy->IJ', h_xe, t1_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Ja,Ixya,xy->IJ', h_xe, t1_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xy,Ix,Jy->IJ', h_aa, t1_xa, t1_xa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('xy,Iixz,Jiyz->IJ', h_aa, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('xy,Iixz,Jizy->IJ', h_aa, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('xy,Iizx,Jiyz->IJ', h_aa, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('xy,Iizx,Jizy->IJ', h_aa, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('xy,Iiax,Jiay->IJ', h_aa, t1_xcea, t1_xcea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('xy,Iiax,iJay->IJ', h_aa, t1_xcea, t1_cxea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('xy,Jiax,iIay->IJ', h_aa, t1_xcea, t1_cxea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('xy,iIax,iJay->IJ', h_aa, t1_cxea, t1_cxea, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Ix,Jyxz,zy->IJ', t1_xa, v_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Ix,Jyzx,zy->IJ', t1_xa, v_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('Ixyz,Jxwu,yzwu->IJ', t1_xaaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Ixyz,Jwyz,xw->IJ', t1_xaaa, v_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Ixyz,Jwyu,xuzw->IJ', t1_xaaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Ixyz,Jwzy,xw->IJ', t1_xaaa, v_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Ixyz,Jwzu,xuyw->IJ', t1_xaaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Ixyz,Jwuy,xuzw->IJ', t1_xaaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Ixyz,Jwuz,xuwy->IJ', t1_xaaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Ixya,Jzya,xz->IJ', t1_xaae, v_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Ixya,Jzay,xz->IJ', t1_xaae, v_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Ixya,Jzaw,xwyz->IJ', t1_xaae, v_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Ixya,Jzwa,xwzy->IJ', t1_xaae, v_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Ixay,Jzay,xz->IJ', t1_xaea, v_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Ixay,Jzaw,xwyz->IJ', t1_xaea, v_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Ixay,Jzya,xz->IJ', t1_xaea, v_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Ixay,Jzwa,xwyz->IJ', t1_xaea, v_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Ixab,Jyab,xy->IJ', t1_xaee, v_xaee, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Ixab,Jyba,xy->IJ', t1_xaee, v_xaee, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('Iixy,Jixz,zy->IJ', t1_xcaa, v_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('Iixy,Jiyz,zx->IJ', t1_xcaa, v_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('Iixy,Jizx,zy->IJ', t1_xcaa, v_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('Iixy,Jizy,zx->IJ', t1_xcaa, v_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('Iixy,Jizw,xyzw->IJ', t1_xcaa, v_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('Iiax,iJya,yx->IJ', t1_xcea, v_cxae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('Iiax,Jiya,yx->IJ', t1_xcea, v_xcae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Ia,Jxay,yx->IJ', t1_xe, v_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Ia,Jxya,yx->IJ', t1_xe, v_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Jx,Iyxz,yz->IJ', t1_xa, v_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Jx,Iyzx,yz->IJ', t1_xa, v_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('Jxyz,Ixwu,yzwu->IJ', t1_xaaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Jxyz,Iwyz,wx->IJ', t1_xaaa, v_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Jxyz,Iwyu,xuzw->IJ', t1_xaaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Jxyz,Iwzy,wx->IJ', t1_xaaa, v_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Jxyz,Iwzu,xuyw->IJ', t1_xaaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Jxyz,Iwuy,xuzw->IJ', t1_xaaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Jxyz,Iwuz,xuwy->IJ', t1_xaaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Jxya,Izya,zx->IJ', t1_xaae, v_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Jxya,Izay,zx->IJ', t1_xaae, v_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Jxya,Izaw,xwyz->IJ', t1_xaae, v_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Jxya,Izwa,xwzy->IJ', t1_xaae, v_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Jxay,Izay,zx->IJ', t1_xaea, v_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Jxay,Izaw,xwyz->IJ', t1_xaea, v_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Jxay,Izya,zx->IJ', t1_xaea, v_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Jxay,Izwa,xwyz->IJ', t1_xaea, v_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Jxab,Iyab,yx->IJ', t1_xaee, v_xaee, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Jxab,Iyba,yx->IJ', t1_xaee, v_xaee, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('Jixy,Iixz,yz->IJ', t1_xcaa, v_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('Jixy,Iiyz,xz->IJ', t1_xcaa, v_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('Jixy,Iizx,yz->IJ', t1_xcaa, v_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('Jixy,Iizy,xz->IJ', t1_xcaa, v_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('Jixy,Iizw,xyzw->IJ', t1_xcaa, v_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('Jiax,iIya,xy->IJ', t1_xcea, v_cxae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('Jiax,Iiya,xy->IJ', t1_xcea, v_xcae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('Ja,Ixay,xy->IJ', t1_xe, v_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('Ja,Ixya,xy->IJ', t1_xe, v_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('ixyz,JiIy,xz->IJ', t1_caaa, v_xcxa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('ixyz,iJIy,xz->IJ', t1_caaa, v_cxxa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('ixyz,JiIz,xy->IJ', t1_caaa, v_xcxa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('ixyz,iJIz,xy->IJ', t1_caaa, v_cxxa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('iIax,iJya,yx->IJ', t1_cxea, v_cxae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('iIax,Jiya,yx->IJ', t1_cxea, v_xcae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('iJax,iIya,xy->IJ', t1_cxea, v_cxae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('iJax,Iiya,xy->IJ', t1_cxea, v_xcae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('ix,IiJy,xy->IJ', t1_ca, v_xcxa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('ix,iIJy,xy->IJ', t1_ca, v_cxxa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('ix,JiIy,yx->IJ', t1_ca, v_xcxa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('ix,iJIy,yx->IJ', t1_ca, v_cxxa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('ixyz,IiJy,zx->IJ', t1_caaa, v_xcxa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('ixyz,IiJz,yx->IJ', t1_caaa, v_xcxa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('ixyz,IiJw,xwzy->IJ', t1_caaa, v_xcxa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('ixyz,iIJy,zx->IJ', t1_caaa, v_cxxa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('ixyz,iIJz,yx->IJ', t1_caaa, v_cxxa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('ixyz,iIJw,xwzy->IJ', t1_caaa, v_cxxa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('ixyz,JiIw,xwzy->IJ', t1_caaa, v_xcxa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('ixyz,iJIw,xwzy->IJ', t1_caaa, v_cxxa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('ixya,IiJa,yx->IJ', t1_caae, v_xcxe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('ixya,iIJa,yx->IJ', t1_caae, v_cxxe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('ixya,JiIa,xy->IJ', t1_caae, v_xcxe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('ixya,iJIa,xy->IJ', t1_caae, v_cxxe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('ixay,IiJa,yx->IJ', t1_caea, v_xcxe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('ixay,iIJa,yx->IJ', t1_caea, v_cxxe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('ixay,JiIa,xy->IJ', t1_caea, v_xcxe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('ixay,iJIa,xy->IJ', t1_caea, v_cxxe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xa,JyIa,xy->IJ', t1_ae, v_xaxe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xa,JyaI,xy->IJ', t1_ae, v_xaex, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xa,IyJa,yx->IJ', t1_ae, v_xaxe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xa,IyaJ,yx->IJ', t1_ae, v_xaex, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xyaz,JwIa,zwyx->IJ', t1_aaea, v_xaxe, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyaz,JwaI,zwyx->IJ', t1_aaea, v_xaex, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xyaz,IwJa,zwyx->IJ', t1_aaea, v_xaxe, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyaz,IwaJ,zwyx->IJ', t1_aaea, v_xaex, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('xyzw,Iixy,Jizw->IJ', v_aaaa, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('xyzw,Iixy,Jiwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('I,Ix,Jyxz,zy->IJ', e_cvs, t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('I,Ix,Jyzx,zy->IJ', e_cvs, t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('I,Ixyz,Jxwu,yzwu->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('I,Ixyz,Jy,xz->IJ', e_cvs, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('I,Ixyz,Jz,xy->IJ', e_cvs, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('I,Ixyz,Jwyz,xw->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('I,Ixyz,Jwyu,xuzw->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('I,Ixyz,Jwzy,xw->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('I,Ixyz,Jwzu,xuyw->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('I,Ixyz,Jwuy,xuzw->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('I,Ixyz,Jwuz,xuwy->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('I,Ixya,Ja,xy->IJ', e_cvs, t1_xaae, t1_xe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('I,Ixya,Jzya,xz->IJ', e_cvs, t1_xaae, t1_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('I,Ixya,Jzay,xz->IJ', e_cvs, t1_xaae, t1_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('I,Ixya,Jzaw,xwyz->IJ', e_cvs, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('I,Ixya,Jzwa,xwzy->IJ', e_cvs, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('I,Ixay,Ja,xy->IJ', e_cvs, t1_xaea, t1_xe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('I,Ixay,Jzay,xz->IJ', e_cvs, t1_xaea, t1_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('I,Ixay,Jzaw,xwyz->IJ', e_cvs, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('I,Ixay,Jzya,xz->IJ', e_cvs, t1_xaea, t1_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('I,Ixay,Jzwa,xwyz->IJ', e_cvs, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('I,Ixab,Jyab,xy->IJ', e_cvs, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('I,Ixab,Jyba,xy->IJ', e_cvs, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('I,Iixy,Jixz,zy->IJ', e_cvs, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('I,Iixy,Jiyz,zx->IJ', e_cvs, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('I,Iixy,Jizx,zy->IJ', e_cvs, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('I,Iixy,Jizy,zx->IJ', e_cvs, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('I,Iixy,Jizw,xyzw->IJ', e_cvs, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('I,Iiax,Jiay,yx->IJ', e_cvs, t1_xcea, t1_xcea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('I,Iiax,iJay,yx->IJ', e_cvs, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('I,Ia,Jxay,yx->IJ', e_cvs, t1_xe, t1_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('I,Ia,Jxya,yx->IJ', e_cvs, t1_xe, t1_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('I,Jiax,iIay,xy->IJ', e_cvs, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('I,iIax,iJay,yx->IJ', e_cvs, t1_cxea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('J,Ix,Jyxz,zy->IJ', e_cvs, t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('J,Ix,Jyzx,zy->IJ', e_cvs, t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('J,Ixyz,Jxwu,yzwu->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('J,Ixyz,Jy,xz->IJ', e_cvs, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('J,Ixyz,Jz,xy->IJ', e_cvs, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('J,Ixyz,Jwyz,xw->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('J,Ixyz,Jwyu,xuzw->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('J,Ixyz,Jwzy,xw->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('J,Ixyz,Jwzu,xuyw->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('J,Ixyz,Jwuy,xuzw->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('J,Ixyz,Jwuz,xuwy->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('J,Ixya,Ja,xy->IJ', e_cvs, t1_xaae, t1_xe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('J,Ixya,Jzya,xz->IJ', e_cvs, t1_xaae, t1_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('J,Ixya,Jzay,xz->IJ', e_cvs, t1_xaae, t1_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('J,Ixya,Jzaw,xwyz->IJ', e_cvs, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('J,Ixya,Jzwa,xwzy->IJ', e_cvs, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('J,Ixay,Ja,xy->IJ', e_cvs, t1_xaea, t1_xe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('J,Ixay,Jzay,xz->IJ', e_cvs, t1_xaea, t1_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('J,Ixay,Jzaw,xwyz->IJ', e_cvs, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('J,Ixay,Jzya,xz->IJ', e_cvs, t1_xaea, t1_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('J,Ixay,Jzwa,xwyz->IJ', e_cvs, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('J,Ixab,Jyab,xy->IJ', e_cvs, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('J,Ixab,Jyba,xy->IJ', e_cvs, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('J,Iixy,Jixz,zy->IJ', e_cvs, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('J,Iixy,Jiyz,zx->IJ', e_cvs, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('J,Iixy,Jizx,zy->IJ', e_cvs, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('J,Iixy,Jizy,zx->IJ', e_cvs, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('J,Iixy,Jizw,xyzw->IJ', e_cvs, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('J,Iiax,Jiay,yx->IJ', e_cvs, t1_xcea, t1_xcea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('J,Iiax,iJay,yx->IJ', e_cvs, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('J,Ia,Jxay,yx->IJ', e_cvs, t1_xe, t1_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('J,Ia,Jxya,yx->IJ', e_cvs, t1_xe, t1_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('J,Jiax,iIay,xy->IJ', e_cvs, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('J,iIax,iJay,yx->IJ', e_cvs, t1_cxea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('i,Iixy,Jixz,zy->IJ', e_core, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('i,Iixy,Jiyz,zx->IJ', e_core, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('i,Iixy,Jizx,zy->IJ', e_core, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('i,Iixy,Jizy,zx->IJ', e_core, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('i,Iiax,Jiay,yx->IJ', e_core, t1_xcea, t1_xcea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('i,Iiax,iJay,yx->IJ', e_core, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('i,Jixy,Iixz,yz->IJ', e_core, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('i,Jixy,Iiyz,xz->IJ', e_core, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('i,Jixy,Iizx,yz->IJ', e_core, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('i,Jixy,Iizy,xz->IJ', e_core, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('i,Jixy,Iizw,xyzw->IJ', e_core, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('i,Jiax,Iiay,xy->IJ', e_core, t1_xcea, t1_xcea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('i,Jiax,iIay,xy->IJ', e_core, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('i,iIax,Jiay,yx->IJ', e_core, t1_cxea, t1_xcea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('i,iIax,iJay,yx->IJ', e_core, t1_cxea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('i,iJax,Iiay,xy->IJ', e_core, t1_cxea, t1_xcea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('i,iJax,iIay,xy->IJ', e_core, t1_cxea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('a,Ia,Jxay,yx->IJ', e_extern, t1_xe, t1_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('a,Ia,Jxya,yx->IJ', e_extern, t1_xe, t1_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('a,Ixay,Ja,xy->IJ', e_extern, t1_xaea, t1_xe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('a,Ixay,Jzay,xz->IJ', e_extern, t1_xaea, t1_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('a,Ixay,Jzaw,xwyz->IJ', e_extern, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('a,Ixay,Jzya,xz->IJ', e_extern, t1_xaea, t1_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('a,Ixay,Jzwa,xwyz->IJ', e_extern, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('a,Ixab,Jyab,xy->IJ', e_extern, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('a,Ixab,Jyba,xy->IJ', e_extern, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('a,Ixya,Ja,xy->IJ', e_extern, t1_xaae, t1_xe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('a,Ixya,Jzay,xz->IJ', e_extern, t1_xaae, t1_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('a,Ixya,Jzaw,xwyz->IJ', e_extern, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('a,Ixya,Jzya,xz->IJ', e_extern, t1_xaae, t1_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('a,Ixya,Jzwa,xwzy->IJ', e_extern, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('a,Ixba,Jyab,xy->IJ', e_extern, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('a,Ixba,Jyba,xy->IJ', e_extern, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('a,Iiax,Jiay,yx->IJ', e_extern, t1_xcea, t1_xcea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('a,Iiax,iJay,yx->IJ', e_extern, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('a,iIax,Jiay,yx->IJ', e_extern, t1_cxea, t1_xcea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('a,iIax,iJay,yx->IJ', e_extern, t1_cxea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xy,Ix,Jzyw,wz->IJ', h_aa, t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Ix,Jzwy,wz->IJ', h_aa, t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Ixzw,Jyuv,zwuv->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Ixzw,Jz,yw->IJ', h_aa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Ixzw,Jw,yz->IJ', h_aa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Ixzw,Juzw,yu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Ixzw,Juzv,yvwu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Ixzw,Juwz,yu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Ixzw,Juwv,yvzu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Ixzw,Juvz,yvwu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Ixzw,Juvw,yvuz->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Ixza,Ja,yz->IJ', h_aa, t1_xaae, t1_xe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Ixza,Jwza,yw->IJ', h_aa, t1_xaae, t1_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Ixza,Jwaz,yw->IJ', h_aa, t1_xaae, t1_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Ixza,Jwau,yuzw->IJ', h_aa, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Ixza,Jwua,yuwz->IJ', h_aa, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Ixaz,Ja,yz->IJ', h_aa, t1_xaea, t1_xe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Ixaz,Jwaz,yw->IJ', h_aa, t1_xaea, t1_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Ixaz,Jwau,yuzw->IJ', h_aa, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Ixaz,Jwza,yw->IJ', h_aa, t1_xaea, t1_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Ixaz,Jwua,yuzw->IJ', h_aa, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Ixab,Jzab,yz->IJ', h_aa, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Ixab,Jzba,yz->IJ', h_aa, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xy,Izxw,Jy,zw->IJ', h_aa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Izxw,Jzuv,ywuv->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('xy,Izxw,Jw,zy->IJ', h_aa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xy,Izxw,Juyw,zu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xy,Izxw,Juyv,zvwu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Izxw,Juwy,zu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('xy,Izxw,Juwv,yuzv->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Izxw,Juvy,zvwu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('xy,Izxw,Juvw,yuvz->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('xy,Izxa,Ja,zy->IJ', h_aa, t1_xaae, t1_xe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xy,Izxa,Jwya,zw->IJ', h_aa, t1_xaae, t1_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Izxa,Jway,zw->IJ', h_aa, t1_xaae, t1_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('xy,Izxa,Jwau,ywzu->IJ', h_aa, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('xy,Izxa,Jwua,ywuz->IJ', h_aa, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Izwx,Jy,zw->IJ', h_aa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Izwx,Jzuv,ywvu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xy,Izwx,Jw,zy->IJ', h_aa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Izwx,Juyw,zu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Izwx,Juyv,zvwu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xy,Izwx,Juwy,zu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xy,Izwx,Juwv,yuzv->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Izwx,Juvy,zvuw->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('xy,Izwx,Juvw,yuzv->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xy,Izax,Ja,zy->IJ', h_aa, t1_xaea, t1_xe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Izax,Jwya,zw->IJ', h_aa, t1_xaea, t1_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xy,Izax,Jway,zw->IJ', h_aa, t1_xaea, t1_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xy,Izax,Jwau,ywzu->IJ', h_aa, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('xy,Izax,Jwua,ywzu->IJ', h_aa, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('xy,Iixz,Jiyw,wz->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Iixz,Jizw,wy->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xy,Iixz,Jiwy,wz->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Iixz,Jiwz,wy->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Iixz,Jiwu,yzwu->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xy,Iizx,Jiyw,wz->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Iizx,Jizw,wy->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('xy,Iizx,Jiwy,wz->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Iizx,Jiwz,wy->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Iizx,Jiwu,yzuw->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Iiax,Jiaz,zy->IJ', h_aa, t1_xcea, t1_xcea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Iiax,iJaz,zy->IJ', h_aa, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Jxzw,Iz,wy->IJ', h_aa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Jxzw,Iw,zy->IJ', h_aa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Jxzw,Iuzw,uy->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Jxzw,Iuzv,yvwu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Jxzw,Iuwz,uy->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Jxzw,Iuwv,yvzu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Jxzw,Iuvz,yvwu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Jxzw,Iuvw,yvuz->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Jxza,Ia,zy->IJ', h_aa, t1_xaae, t1_xe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Jxza,Iwza,wy->IJ', h_aa, t1_xaae, t1_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Jxza,Iwaz,wy->IJ', h_aa, t1_xaae, t1_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Jxza,Iwau,yuzw->IJ', h_aa, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Jxza,Iwua,yuwz->IJ', h_aa, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Jxaz,Ia,zy->IJ', h_aa, t1_xaea, t1_xe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Jxaz,Iwaz,wy->IJ', h_aa, t1_xaea, t1_xaea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Jxaz,Iwau,yuzw->IJ', h_aa, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Jxaz,Iwza,wy->IJ', h_aa, t1_xaea, t1_xaae, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Jxaz,Iwua,yuzw->IJ', h_aa, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Jxab,Izab,zy->IJ', h_aa, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Jxab,Izba,zy->IJ', h_aa, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Jzxw,Izuv,ywuv->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('xy,Jzxw,Iw,yz->IJ', h_aa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('xy,Jzxw,Iuwv,yuzv->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('xy,Jzxw,Iuvw,yuvz->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('xy,Jzxa,Ia,yz->IJ', h_aa, t1_xaae, t1_xe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('xy,Jzxa,Iwau,ywzu->IJ', h_aa, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('xy,Jzxa,Iwua,ywuz->IJ', h_aa, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Jzwx,Izuv,ywvu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xy,Jzwx,Iw,yz->IJ', h_aa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xy,Jzwx,Iuwv,yuzv->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('xy,Jzwx,Iuvw,yuzv->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xy,Jzax,Ia,yz->IJ', h_aa, t1_xaea, t1_xe, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xy,Jzax,Iwau,ywzu->IJ', h_aa, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('xy,Jzax,Iwua,ywzu->IJ', h_aa, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Jixz,Iizw,yw->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Jixz,Iiwz,yw->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Jixz,Iiwu,yzwu->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Jizx,Iizw,yw->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Jizx,Iiwz,yw->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Jizx,Iiwu,yzuw->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,Jiax,Iiaz,yz->IJ', h_aa, t1_xcea, t1_xcea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,Jiax,iIaz,yz->IJ', h_aa, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,iIax,Jiaz,zy->IJ', h_aa, t1_cxea, t1_xcea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,iIax,iJaz,zy->IJ', h_aa, t1_cxea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xy,iJax,Iiaz,yz->IJ', h_aa, t1_cxea, t1_xcea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xy,iJax,iIaz,yz->IJ', h_aa, t1_cxea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xyzw,Ix,Jyuv,zwuv->IJ', v_aaaa, t1_xa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xyzw,Ix,Jz,yw->IJ', v_aaaa, t1_xa, t1_xa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Ix,Jw,yz->IJ', v_aaaa, t1_xa, t1_xa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xyzw,Ix,Juzw,yu->IJ', v_aaaa, t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xyzw,Ix,Juzv,yvwu->IJ', v_aaaa, t1_xa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Ix,Juwz,yu->IJ', v_aaaa, t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Ix,Juwv,yvzu->IJ', v_aaaa, t1_xa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Ix,Juvz,yvwu->IJ', v_aaaa, t1_xa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Ix,Juvw,yvuz->IJ', v_aaaa, t1_xa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xyzw,Ixuv,Jy,zwvu->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 5/12 * einsum('xyzw,Ixuv,Jzst,wstyuv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Ixuv,Jzst,wstyvu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Ixuv,Jzst,wstuyv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Ixuv,Jzst,wstuvy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Ixuv,Jzst,wstvyu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Ixuv,Jzst,wstvuy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Ixuv,Jwst,zstyuv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Ixuv,Jwst,zstyvu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Ixuv,Jwst,zstuyv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Ixuv,Jwst,zstuvy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Ixuv,Jwst,zstvyu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 5/12 * einsum('xyzw,Ixuv,Jwst,zstvuy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Ixuv,Ju,yvwz->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Ixuv,Jv,yuwz->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Ixuv,Jsyu,zwvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Ixuv,Jsyv,zwsu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Ixuv,Jsyt,zwtuvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Ixuv,Jsyt,zwtusv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/12 * einsum('xyzw,Ixuv,Jsyt,zwtvus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Ixuv,Jsyt,zwtvsu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Ixuv,Jsyt,zwtsuv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Ixuv,Jsyt,zwtsvu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Ixuv,Jsuy,zwvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Ixuv,Jsuv,yswz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Ixuv,Jsut,zwtyvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Ixuv,Jsut,zwtysv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 5/12 * einsum('xyzw,Ixuv,Jsut,zwtvys->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Ixuv,Jsut,zwtvsy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Ixuv,Jsut,zwtsyv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Ixuv,Jsut,zwtsvy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Ixuv,Jsvy,zwus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Ixuv,Jsvu,yswz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixuv,Jsvt,zwtyus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixuv,Jsvt,zwtysu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/24 * einsum('xyzw,Ixuv,Jsvt,zwtuys->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixuv,Jsvt,zwtusy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixuv,Jsvt,zwtsyu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixuv,Jsvt,zwtsuy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Ixuv,Jsty,zwtuvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Ixuv,Jsty,zwtusv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Ixuv,Jsty,zwtvus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/12 * einsum('xyzw,Ixuv,Jsty,zwtvsu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Ixuv,Jsty,zwtsuv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Ixuv,Jsty,zwtsvu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixuv,Jstu,zwtyvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixuv,Jstu,zwtysv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/24 * einsum('xyzw,Ixuv,Jstu,zwtvys->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixuv,Jstu,zwtvsy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixuv,Jstu,zwtsyv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixuv,Jstu,zwtsvy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixuv,Jstv,zwtyus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixuv,Jstv,zwtysu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixuv,Jstv,zwtuys->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixuv,Jstv,zwtusy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/24 * einsum('xyzw,Ixuv,Jstv,zwtsyu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixuv,Jstv,zwtsuy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Ixua,Ja,yuwz->IJ', v_aaaa, t1_xaae, t1_xe, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Ixua,Jvya,zwvu->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Ixua,Jvua,yvwz->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Ixua,Jvay,zwuv->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Ixua,Jvau,yvwz->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixua,Jvas,zwsyuv->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixua,Jvas,zwsyvu->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/24 * einsum('xyzw,Ixua,Jvas,zwsuyv->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixua,Jvas,zwsuvy->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixua,Jvas,zwsvyu->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixua,Jvas,zwsvuy->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixua,Jvsa,zwsyuv->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixua,Jvsa,zwsyvu->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixua,Jvsa,zwsuyv->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixua,Jvsa,zwsuvy->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/24 * einsum('xyzw,Ixua,Jvsa,zwsvyu->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixua,Jvsa,zwsvuy->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Ixau,Ja,yuwz->IJ', v_aaaa, t1_xaea, t1_xe, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Ixau,Jvya,zwuv->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Ixau,Jvay,zwuv->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Ixau,Jvau,yvwz->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Ixau,Jvas,zwsyuv->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Ixau,Jvas,zwsyvu->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 5/12 * einsum('xyzw,Ixau,Jvas,zwsuyv->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Ixau,Jvas,zwsuvy->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Ixau,Jvas,zwsvyu->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Ixau,Jvas,zwsvuy->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Ixau,Jvua,yvwz->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixau,Jvsa,zwsyuv->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixau,Jvsa,zwsyvu->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/24 * einsum('xyzw,Ixau,Jvsa,zwsuyv->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixau,Jvsa,zwsuvy->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixau,Jvsa,zwsvyu->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Ixau,Jvsa,zwsvuy->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Ixab,Juab,yuwz->IJ', v_aaaa, t1_xaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Ixab,Juba,yuwz->IJ', v_aaaa, t1_xaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xyzw,Iuxy,Jz,uw->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuxy,Jw,uz->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Iuxy,Juvs,zwvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xyzw,Iuxy,Jvzw,uv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xyzw,Iuxy,Jvzs,wvus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuxy,Jvwz,uv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuxy,Jvws,zvus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuxy,Jvsz,wvus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuxy,Jvsw,zvsu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Iuxv,Jyvs,zwus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Iuxv,Jysv,zwsu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Iuxv,Jyst,ustzwv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Iuxv,Jyst,ustzvw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Iuxv,Jyst,ustwzv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Iuxv,Jyst,ustwvz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/12 * einsum('xyzw,Iuxv,Jyst,ustvzw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Iuxv,Jyst,ustvwz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xyzw,Iuxv,Jz,yuwv->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuxv,Jw,yuzv->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Iuxv,Just,ystzwv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Iuxv,Just,ystzvw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/24 * einsum('xyzw,Iuxv,Just,ystwzv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Iuxv,Just,ystwvz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Iuxv,Just,ystvzw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Iuxv,Just,ystvwz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('xyzw,Iuxv,Jv,yuwz->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xyzw,Iuxv,Jszw,yusv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xyzw,Iuxv,Jszv,yuws->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xyzw,Iuxv,Jszt,yutwvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuxv,Jswz,yusv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuxv,Jswv,yuzs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuxv,Jswt,yutzvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuxv,Jsvz,yuws->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuxv,Jsvw,yusz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuxv,Jsvt,yutzws->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuxv,Jsvt,yutzsw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 5/24 * einsum('xyzw,Iuxv,Jsvt,yutwzs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuxv,Jsvt,yutwsz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuxv,Jsvt,yutszw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuxv,Jsvt,yutswz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuxv,Jstz,yutwvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/6 * einsum('xyzw,Iuxv,Jstw,yutzvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/6 * einsum('xyzw,Iuxv,Jstw,yutzsv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/6 * einsum('xyzw,Iuxv,Jstw,yutvzs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/6 * einsum('xyzw,Iuxv,Jstw,yutvsz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/6 * einsum('xyzw,Iuxv,Jstw,yutszv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/3 * einsum('xyzw,Iuxv,Jstw,yutsvz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuxv,Jstv,yutzws->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuxv,Jstv,yutzsw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuxv,Jstv,yutwzs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 5/24 * einsum('xyzw,Iuxv,Jstv,yutwsz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuxv,Jstv,yutszw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuxv,Jstv,yutswz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Iuxa,Jyav,zwuv->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Iuxa,Jyva,zwvu->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('xyzw,Iuxa,Ja,yuwz->IJ', v_aaaa, t1_xaae, t1_xe, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xyzw,Iuxa,Jvza,yuwv->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuxa,Jvwa,yuzv->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuxa,Jvaz,yuwv->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuxa,Jvaw,yuvz->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuxa,Jvas,yuszwv->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuxa,Jvas,yuszvw->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 5/24 * einsum('xyzw,Iuxa,Jvas,yuswzv->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuxa,Jvas,yuswvz->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuxa,Jvas,yusvzw->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuxa,Jvas,yusvwz->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuxa,Jvsa,yuszwv->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuxa,Jvsa,yuszvw->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuxa,Jvsa,yuswzv->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 5/24 * einsum('xyzw,Iuxa,Jvsa,yuswvz->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuxa,Jvsa,yusvzw->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuxa,Jvsa,yusvwz->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuvx,Jyvs,zwus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Iuvx,Jysv,zwus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Iuvx,Jyst,ustzwv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/12 * einsum('xyzw,Iuvx,Jyst,ustzvw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Iuvx,Jyst,ustwzv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Iuvx,Jyst,ustwvz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Iuvx,Jyst,ustvzw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Iuvx,Jyst,ustvwz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuvx,Jz,yuwv->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuvx,Jw,yuvz->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Iuvx,Just,ystzwv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Iuvx,Just,ystzvw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Iuvx,Just,ystwzv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/24 * einsum('xyzw,Iuvx,Just,ystwvz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Iuvx,Just,ystvzw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Iuvx,Just,ystvwz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xyzw,Iuvx,Jv,yuwz->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuvx,Jszw,yusv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuvx,Jszv,yuws->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuvx,Jszt,yutwvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuvx,Jswz,yuvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuvx,Jswv,yusz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/6 * einsum('xyzw,Iuvx,Jswt,yutzvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/6 * einsum('xyzw,Iuvx,Jswt,yutzsv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/3 * einsum('xyzw,Iuvx,Jswt,yutvzs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/6 * einsum('xyzw,Iuvx,Jswt,yutvsz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/6 * einsum('xyzw,Iuvx,Jswt,yutszv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/6 * einsum('xyzw,Iuvx,Jswt,yutsvz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xyzw,Iuvx,Jsvz,yuws->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xyzw,Iuvx,Jsvw,yusz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Iuvx,Jsvt,yutzws->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Iuvx,Jsvt,yutzsw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/12 * einsum('xyzw,Iuvx,Jsvt,yutwzs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Iuvx,Jsvt,yutwsz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Iuvx,Jsvt,yutszw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Iuvx,Jsvt,yutswz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/6 * einsum('xyzw,Iuvx,Jstz,yutwvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/3 * einsum('xyzw,Iuvx,Jstz,yutwsv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/6 * einsum('xyzw,Iuvx,Jstz,yutvws->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/6 * einsum('xyzw,Iuvx,Jstz,yutvsw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/6 * einsum('xyzw,Iuvx,Jstz,yutswv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/6 * einsum('xyzw,Iuvx,Jstz,yutsvw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuvx,Jstw,yutszv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuvx,Jstv,yutzws->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuvx,Jstv,yutzsw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 5/24 * einsum('xyzw,Iuvx,Jstv,yutwzs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuvx,Jstv,yutwsz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuvx,Jstv,yutszw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuvx,Jstv,yutswz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuax,Jyav,zwuv->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Iuax,Jyva,zwuv->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xyzw,Iuax,Ja,yuwz->IJ', v_aaaa, t1_xaea, t1_xe, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuax,Jvza,yuwv->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iuax,Jvwa,yuvz->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xyzw,Iuax,Jvaz,yuwv->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += einsum('xyzw,Iuax,Jvaw,yuvz->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Iuax,Jvas,yuszwv->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Iuax,Jvas,yuszvw->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/12 * einsum('xyzw,Iuax,Jvas,yuswzv->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Iuax,Jvas,yuswvz->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Iuax,Jvas,yusvzw->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Iuax,Jvas,yusvwz->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuax,Jvsa,yuszwv->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuax,Jvsa,yuszvw->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 5/24 * einsum('xyzw,Iuax,Jvsa,yuswzv->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuax,Jvsa,yuswvz->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuax,Jvsa,yusvzw->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Iuax,Jvsa,yusvwz->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('xyzw,Iixy,Jizu,uw->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xyzw,Iixy,Jiwu,uz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xyzw,Iixy,Jiuz,uw->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('xyzw,Iixy,Jiuw,uz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Iixy,Jiuv,zwuv->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('xyzw,Iixu,Jizw,yu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('xyzw,Iixu,Jizu,yw->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('xyzw,Iixu,Jizv,yvwu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xyzw,Iixu,Jiwz,yu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('xyzw,Iixu,Jiwu,yz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xyzw,Iixu,Jiwv,yvzu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('xyzw,Iixu,Jiuz,yw->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xyzw,Iixu,Jiuw,yz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Iixu,Jiuv,yvwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xyzw,Iixu,Jivz,yvwu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xyzw,Iixu,Jivw,yvuz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iixu,Jivu,yvwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Iixu,Jivs,yvszwu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Iixu,Jivs,yvszuw->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/24 * einsum('xyzw,Iixu,Jivs,yvswzu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Iixu,Jivs,yvswuz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Iixu,Jivs,yvsuzw->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Iixu,Jivs,yvsuwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xyzw,Iiux,Jizw,yu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('xyzw,Iiux,Jizu,yw->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xyzw,Iiux,Jizv,yvwu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('xyzw,Iiux,Jiwz,yu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xyzw,Iiux,Jiwu,yz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xyzw,Iiux,Jiwv,yvuz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('xyzw,Iiux,Jiuz,yw->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('xyzw,Iiux,Jiuw,yz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iiux,Jiuv,yvwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('xyzw,Iiux,Jivz,yvwu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xyzw,Iiux,Jivw,yvzu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Iiux,Jivu,yvwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Iiux,Jivs,yvszwu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Iiux,Jivs,yvszuw->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Iiux,Jivs,yvswzu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/24 * einsum('xyzw,Iiux,Jivs,yvswuz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Iiux,Jivs,yvsuzw->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Iiux,Jivs,yvsuwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('xyzw,Iiax,Jiaz,yw->IJ', v_aaaa, t1_xcea, t1_xcea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('xyzw,Iiax,Jiaw,yz->IJ', v_aaaa, t1_xcea, t1_xcea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Iiax,Jiau,yuwz->IJ', v_aaaa, t1_xcea, t1_xcea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('xyzw,Iiax,iJaz,yw->IJ', v_aaaa, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xyzw,Iiax,iJaw,yz->IJ', v_aaaa, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Iiax,iJau,yuwz->IJ', v_aaaa, t1_xcea, t1_cxea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Jxuv,Iu,yvwz->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Jxuv,Iv,yuwz->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Jxuv,Isuv,yswz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Jxuv,Isut,yvszwt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Jxuv,Isut,yvsztw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 5/12 * einsum('xyzw,Jxuv,Isut,yvswzt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Jxuv,Isut,yvswtz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Jxuv,Isut,yvstzw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Jxuv,Isut,yvstwz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Jxuv,Isvu,yswz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxuv,Isvt,yuszwt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxuv,Isvt,yusztw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/24 * einsum('xyzw,Jxuv,Isvt,yuswzt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxuv,Isvt,yuswtz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxuv,Isvt,yustzw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxuv,Isvt,yustwz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxuv,Istu,yvszwt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxuv,Istu,yvsztw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/24 * einsum('xyzw,Jxuv,Istu,yvswzt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxuv,Istu,yvswtz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxuv,Istu,yvstzw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxuv,Istu,yvstwz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxuv,Istv,yuszwt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxuv,Istv,yusztw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxuv,Istv,yuswzt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/24 * einsum('xyzw,Jxuv,Istv,yuswtz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxuv,Istv,yustzw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxuv,Istv,yustwz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Jxua,Ia,yuwz->IJ', v_aaaa, t1_xaae, t1_xe, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Jxua,Ivua,yvwz->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Jxua,Ivau,yvwz->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxua,Ivas,yuvzws->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxua,Ivas,yuvzsw->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/24 * einsum('xyzw,Jxua,Ivas,yuvwzs->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxua,Ivas,yuvwsz->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxua,Ivas,yuvszw->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxua,Ivas,yuvswz->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxua,Ivsa,yuvzws->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxua,Ivsa,yuvzsw->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxua,Ivsa,yuvwzs->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/24 * einsum('xyzw,Jxua,Ivsa,yuvwsz->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxua,Ivsa,yuvszw->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxua,Ivsa,yuvswz->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Jxau,Ia,yuwz->IJ', v_aaaa, t1_xaea, t1_xe, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Jxau,Ivau,yvwz->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Jxau,Ivas,yuvzws->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Jxau,Ivas,yuvzsw->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 5/12 * einsum('xyzw,Jxau,Ivas,yuvwzs->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Jxau,Ivas,yuvwsz->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Jxau,Ivas,yuvszw->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/12 * einsum('xyzw,Jxau,Ivas,yuvswz->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Jxau,Ivua,yvwz->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxau,Ivsa,yuvzws->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxau,Ivsa,yuvzsw->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/24 * einsum('xyzw,Jxau,Ivsa,yuvwzs->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxau,Ivsa,yuvwsz->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxau,Ivsa,yuvszw->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jxau,Ivsa,yuvswz->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Jxab,Iuab,yuwz->IJ', v_aaaa, t1_xaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Jxab,Iuba,yuwz->IJ', v_aaaa, t1_xaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Juxy,Iuvs,zwvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Juxv,Iust,zwvyst->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Juxv,Iust,zwvyts->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/24 * einsum('xyzw,Juxv,Iust,zwvsyt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Juxv,Iust,zwvsty->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Juxv,Iust,zwvtys->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Juxv,Iust,zwvtsy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('xyzw,Juxv,Iv,yuwz->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juxv,Isvt,zwsyut->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juxv,Isvt,zwsytu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 5/24 * einsum('xyzw,Juxv,Isvt,zwsuyt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juxv,Isvt,zwsuty->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juxv,Isvt,zwstyu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juxv,Isvt,zwstuy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juxv,Istv,zwsyut->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juxv,Istv,zwsytu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juxv,Istv,zwsuyt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juxv,Istv,zwsuty->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 5/24 * einsum('xyzw,Juxv,Istv,zwstyu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juxv,Istv,zwstuy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/4 * einsum('xyzw,Juxa,Ia,yuwz->IJ', v_aaaa, t1_xaae, t1_xe, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juxa,Ivas,zwvyus->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juxa,Ivas,zwvysu->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 5/24 * einsum('xyzw,Juxa,Ivas,zwvuys->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juxa,Ivas,zwvusy->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juxa,Ivas,zwvsyu->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juxa,Ivas,zwvsuy->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juxa,Ivsa,zwvyus->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juxa,Ivsa,zwvysu->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juxa,Ivsa,zwvuys->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juxa,Ivsa,zwvusy->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 5/24 * einsum('xyzw,Juxa,Ivsa,zwvsyu->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juxa,Ivsa,zwvsuy->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Juvx,Iust,zwvyst->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Juvx,Iust,zwvyts->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Juvx,Iust,zwvsyt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Juvx,Iust,zwvsty->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/24 * einsum('xyzw,Juvx,Iust,zwvtys->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Juvx,Iust,zwvtsy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xyzw,Juvx,Iv,yuwz->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Juvx,Isvt,zwsyut->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Juvx,Isvt,zwsytu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/12 * einsum('xyzw,Juvx,Isvt,zwsuyt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Juvx,Isvt,zwsuty->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Juvx,Isvt,zwstyu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Juvx,Isvt,zwstuy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juvx,Istv,zwsyut->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juvx,Istv,zwsytu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 5/24 * einsum('xyzw,Juvx,Istv,zwsuyt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juvx,Istv,zwsuty->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juvx,Istv,zwstyu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juvx,Istv,zwstuy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xyzw,Juax,Ia,yuwz->IJ', v_aaaa, t1_xaea, t1_xe, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Juax,Ivas,zwvyus->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Juax,Ivas,zwvysu->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/12 * einsum('xyzw,Juax,Ivas,zwvuys->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Juax,Ivas,zwvusy->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Juax,Ivas,zwvsyu->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/12 * einsum('xyzw,Juax,Ivas,zwvsuy->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juax,Ivsa,zwvyus->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juax,Ivsa,zwvysu->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 5/24 * einsum('xyzw,Juax,Ivsa,zwvuys->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juax,Ivsa,zwvusy->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juax,Ivsa,zwvsyu->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/24 * einsum('xyzw,Juax,Ivsa,zwvsuy->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Jixy,Iiuv,zwuv->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Jixu,Iiuv,yvwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Jixu,Iivu,yvwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jixu,Iivs,zwuyvs->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jixu,Iivs,zwuysv->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/24 * einsum('xyzw,Jixu,Iivs,zwuvys->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jixu,Iivs,zwuvsy->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jixu,Iivs,zwusyv->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jixu,Iivs,zwusvy->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Jiux,Iiuv,yvwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Jiux,Iivu,yvwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jiux,Iivs,zwuyvs->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jiux,Iivs,zwuysv->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jiux,Iivs,zwuvys->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jiux,Iivs,zwuvsy->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 5/24 * einsum('xyzw,Jiux,Iivs,zwusyv->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/24 * einsum('xyzw,Jiux,Iivs,zwusvy->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,Jiax,Iiau,yuwz->IJ', v_aaaa, t1_xcea, t1_xcea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('xyzw,Jiax,iIaz,wy->IJ', v_aaaa, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/2 * einsum('xyzw,Jiax,iIaw,zy->IJ', v_aaaa, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,Jiax,iIau,yuwz->IJ', v_aaaa, t1_xcea, t1_cxea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,iIax,Jiau,yuwz->IJ', v_aaaa, t1_cxea, t1_xcea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 2 * einsum('xyzw,iIax,iJaz,yw->IJ', v_aaaa, t1_cxea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= einsum('xyzw,iIax,iJaw,yz->IJ', v_aaaa, t1_cxea, t1_cxea, rdm_ca, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,iIax,iJau,yuwz->IJ', v_aaaa, t1_cxea, t1_cxea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] += 1/4 * einsum('xyzw,iJax,Iiau,yuwz->IJ', v_aaaa, t1_cxea, t1_xcea, rdm_ccaa, optimize = einsum_type)
        M[s_c:f_c, s_c:f_c] -= 1/2 * einsum('xyzw,iJax,iIau,yuwz->IJ', v_aaaa, t1_cxea, t1_cxea, rdm_ccaa, optimize = einsum_type)

    print("Time for computing M(h0-h0) block:                %f sec\n" % (time.time() - start_time))
    sys.stdout.flush()

    return M
