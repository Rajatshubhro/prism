# Copyright 2023 Prism Developers. All Rights Reserved.
#
# Licensed under the GNU General Public License v3.0;
# you may not use this file except in compliance with the License.
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
# either express or implied.
#
# See the License file for the specific language governing
# permissions and limitations.
#
# Available at https://github.com/sokolov-group/prism
#
# Authors: Alexander Yu. Sokolov <alexander.y.sokolov@gmail.com>
#          Carlos E. V. de Moura <carlosevmoura@gmail.com>
#

import sys
import time
import numpy as np
import prism.mr_adc_overlap as mr_adc_overlap

def compute_excitation_manifolds(mr_adc):

    # MR-ADC(0) and MR-ADC(1)
    mr_adc.h0.n_c = mr_adc.ncvs

    ## Total dimension of h0
    mr_adc.h0.dim = mr_adc.h0.n_c

    mr_adc.h0.s_c = 0
    mr_adc.h0.f_c = mr_adc.h0.s_c + mr_adc.h0.n_c

    print("Dimension of h0 excitation manifold:                       %d" % mr_adc.h0.dim)

    # MR-ADC(2)
    mr_adc.h1.dim = 0
    mr_adc.h_orth.dim = mr_adc.h0.dim

    if mr_adc.method in ("mr-adc(2)", "mr-adc(2)-x"):
        mr_adc.h1.n_caa      = mr_adc.ncvs * mr_adc.ncas * mr_adc.ncas
        mr_adc.h1.n_cce      = mr_adc.ncvs * mr_adc.ncvs * mr_adc.nextern
        mr_adc.h1.n_cce_tril = mr_adc.ncvs * (mr_adc.ncvs - 1) * mr_adc.nextern // 2
        mr_adc.h1.n_cae      = mr_adc.ncvs * mr_adc.ncas * mr_adc.nextern
        mr_adc.h1.n_cca      = mr_adc.ncvs * mr_adc.ncvs * mr_adc.ncas
        mr_adc.h1.n_cca_tril = mr_adc.ncvs * (mr_adc.ncvs - 1) * mr_adc.ncas // 2

        mr_adc.h1.dim_caa = 3 * mr_adc.h1.n_caa
        mr_adc.h1.dim_cce = mr_adc.h1.n_cce + mr_adc.h1.n_cce_tril
        mr_adc.h1.dim_cae = 3 * mr_adc.h1.n_cae
        mr_adc.h1.dim_cca = mr_adc.h1.n_cca + mr_adc.h1.n_cca_tril

        if mr_adc.nval > 0:
            mr_adc.h1.n_cve = mr_adc.ncvs * mr_adc.nval * mr_adc.nextern
            mr_adc.h1.n_cva = mr_adc.ncvs * mr_adc.nval * mr_adc.ncas

            mr_adc.h1.dim_cve = 3 * mr_adc.h1.n_cve
            mr_adc.h1.dim_cva = 3 * mr_adc.h1.n_cva

            mr_adc.h1.dim = (mr_adc.h1.dim_caa + mr_adc.h1.dim_cce + mr_adc.h1.dim_cve +
                             mr_adc.h1.dim_cae + mr_adc.h1.dim_cca + mr_adc.h1.dim_cva)
        else:
            mr_adc.h1.dim = (mr_adc.h1.dim_caa + mr_adc.h1.dim_cce +
                             mr_adc.h1.dim_cae + mr_adc.h1.dim_cca)

        if mr_adc.nval > 0:
            mr_adc.h1.s_caa = mr_adc.h0.f_c
            mr_adc.h1.f_caa = mr_adc.h1.s_caa + mr_adc.h1.dim_caa
            mr_adc.h1.s_cce = mr_adc.h1.f_caa
            mr_adc.h1.f_cce = mr_adc.h1.s_cce + mr_adc.h1.dim_cce
            mr_adc.h1.s_cve = mr_adc.h1.f_cce
            mr_adc.h1.f_cve = mr_adc.h1.s_cve + mr_adc.h1.dim_cve
            mr_adc.h1.s_cae = mr_adc.h1.f_cve
            mr_adc.h1.f_cae = mr_adc.h1.s_cae + mr_adc.h1.dim_cae
            mr_adc.h1.s_cca = mr_adc.h1.f_cae
            mr_adc.h1.f_cca = mr_adc.h1.s_cca + mr_adc.h1.dim_cca
            mr_adc.h1.s_cva = mr_adc.h1.f_cca
            mr_adc.h1.f_cva = mr_adc.h1.s_cva + mr_adc.h1.dim_cva

            # Spin-cases slices
            mr_adc.h1.s_caa__aaa = mr_adc.h1.s_caa
            mr_adc.h1.f_caa__aaa = mr_adc.h1.s_caa__aaa + mr_adc.h1.n_caa
            mr_adc.h1.s_caa__abb = mr_adc.h1.f_caa__aaa
            mr_adc.h1.f_caa__abb = mr_adc.h1.s_caa__abb + mr_adc.h1.n_caa
            mr_adc.h1.s_caa__bab = mr_adc.h1.f_caa__abb
            mr_adc.h1.f_caa__bab = mr_adc.h1.s_caa__bab + mr_adc.h1.n_caa

            mr_adc.h1.s_cce__aaa = mr_adc.h1.s_cce
            mr_adc.h1.f_cce__aaa = mr_adc.h1.s_cce__aaa + mr_adc.h1.n_cce_tril
            mr_adc.h1.s_cce__abb = mr_adc.h1.f_cce__aaa
            mr_adc.h1.f_cce__abb = mr_adc.h1.s_cce__abb + mr_adc.h1.n_cce

            mr_adc.h1.s_cve__aaa = mr_adc.h1.s_cve
            mr_adc.h1.f_cve__aaa = mr_adc.h1.s_cve__aaa + mr_adc.h1.n_cve
            mr_adc.h1.s_cve__abb = mr_adc.h1.f_cve__aaa
            mr_adc.h1.f_cve__abb = mr_adc.h1.s_cve__abb + mr_adc.h1.n_cve
            mr_adc.h1.s_cve__bab = mr_adc.h1.f_cve__abb
            mr_adc.h1.f_cve__bab = mr_adc.h1.s_cve__bab + mr_adc.h1.n_cve

            mr_adc.h1.s_cae__aaa = mr_adc.h1.s_cae
            mr_adc.h1.f_cae__aaa = mr_adc.h1.s_cae__aaa + mr_adc.h1.n_cae
            mr_adc.h1.s_cae__abb = mr_adc.h1.f_cae__aaa
            mr_adc.h1.f_cae__abb = mr_adc.h1.s_cae__abb + mr_adc.h1.n_cae
            mr_adc.h1.s_cae__bab = mr_adc.h1.f_cae__abb
            mr_adc.h1.f_cae__bab = mr_adc.h1.s_cae__bab + mr_adc.h1.n_cae

            mr_adc.h1.s_cca__aaa = mr_adc.h1.s_cca
            mr_adc.h1.f_cca__aaa = mr_adc.h1.s_cca__aaa + mr_adc.h1.n_cca_tril
            mr_adc.h1.s_cca__abb = mr_adc.h1.f_cca__aaa
            mr_adc.h1.f_cca__abb = mr_adc.h1.s_cca__abb + mr_adc.h1.n_cca

            mr_adc.h1.s_cva__aaa = mr_adc.h1.s_cva
            mr_adc.h1.f_cva__aaa = mr_adc.h1.s_cva__aaa + mr_adc.h1.n_cva
            mr_adc.h1.s_cva__abb = mr_adc.h1.f_cva__aaa
            mr_adc.h1.f_cva__abb = mr_adc.h1.s_cva__abb + mr_adc.h1.n_cva
            mr_adc.h1.s_cva__bab = mr_adc.h1.f_cva__abb
            mr_adc.h1.f_cva__bab = mr_adc.h1.s_cva__bab + mr_adc.h1.n_cva

        else:
            mr_adc.h1.s_caa = mr_adc.h0.f_c
            mr_adc.h1.f_caa = mr_adc.h1.s_caa + mr_adc.h1.dim_caa
            mr_adc.h1.s_cce = mr_adc.h1.f_caa
            mr_adc.h1.f_cce = mr_adc.h1.s_cce + mr_adc.h1.dim_cce
            mr_adc.h1.s_cae = mr_adc.h1.f_cce
            mr_adc.h1.f_cae = mr_adc.h1.s_cae + mr_adc.h1.dim_cae
            mr_adc.h1.s_cca = mr_adc.h1.f_cae
            mr_adc.h1.f_cca = mr_adc.h1.s_cca + mr_adc.h1.dim_cca

            #Spin-cases_ slices
            mr_adc.h1.s_caa__aaa = mr_adc.h1.s_caa
            mr_adc.h1.f_caa__aaa = mr_adc.h1.s_caa__aaa + mr_adc.h1.n_caa
            mr_adc.h1.s_caa__abb = mr_adc.h1.f_caa__aaa
            mr_adc.h1.f_caa__abb = mr_adc.h1.s_caa__abb + mr_adc.h1.n_caa
            mr_adc.h1.s_caa__bab = mr_adc.h1.f_caa__abb
            mr_adc.h1.f_caa__bab = mr_adc.h1.s_caa__bab + mr_adc.h1.n_caa

            mr_adc.h1.s_cce__aaa = mr_adc.h1.s_cce
            mr_adc.h1.f_cce__aaa = mr_adc.h1.s_cce__aaa + mr_adc.h1.n_cce_tril
            mr_adc.h1.s_cce__abb = mr_adc.h1.f_cce__aaa
            mr_adc.h1.f_cce__abb = mr_adc.h1.s_cce__abb + mr_adc.h1.n_cce

            mr_adc.h1.s_cae__aaa = mr_adc.h1.s_cae
            mr_adc.h1.f_cae__aaa = mr_adc.h1.s_cae__aaa + mr_adc.h1.n_cae
            mr_adc.h1.s_cae__abb = mr_adc.h1.f_cae__aaa
            mr_adc.h1.f_cae__abb = mr_adc.h1.s_cae__abb + mr_adc.h1.n_cae
            mr_adc.h1.s_cae__bab = mr_adc.h1.f_cae__abb
            mr_adc.h1.f_cae__bab = mr_adc.h1.s_cae__bab + mr_adc.h1.n_cae

            mr_adc.h1.s_cca__aaa = mr_adc.h1.s_cca
            mr_adc.h1.f_cca__aaa = mr_adc.h1.s_cca__aaa + mr_adc.h1.n_cca_tril
            mr_adc.h1.s_cca__abb = mr_adc.h1.f_cca__aaa
            mr_adc.h1.f_cca__abb = mr_adc.h1.s_cca__abb + mr_adc.h1.n_cca

        print("Dimension of h1 excitation manifold:                       %d" % mr_adc.h1.dim)

        # Overlap for c-caa
        mr_adc.S12.c_caa = mr_adc_overlap.compute_S12_0p_projector(mr_adc)
        if not hasattr(mr_adc.S12, "cae"):
            mr_adc.S12.cae = mr_adc_overlap.compute_S12_m1(mr_adc, ignore_print = True)
        if not hasattr(mr_adc.S12, "cca"):
            mr_adc.S12.cca = mr_adc_overlap.compute_S12_p1(mr_adc, ignore_print = True)

        # Determine dimensions of orthogonalized excitation spaces
        mr_adc.h_orth.n_c_caa    = mr_adc.ncvs * mr_adc.S12.c_caa.shape[1]
        mr_adc.h_orth.n_cce      = mr_adc.h1.n_cce
        mr_adc.h_orth.n_cce_tril = mr_adc.h1.n_cce_tril
        mr_adc.h_orth.n_cae      = mr_adc.ncvs * mr_adc.S12.cae.shape[1] * mr_adc.nextern
        mr_adc.h_orth.n_cca      = mr_adc.ncvs * mr_adc.ncvs * mr_adc.S12.cca.shape[1]
        mr_adc.h_orth.n_cca_tril = mr_adc.ncvs * (mr_adc.ncvs - 1) * mr_adc.S12.cca.shape[1] // 2

        mr_adc.h_orth.dim_c_caa = mr_adc.h_orth.n_c_caa
        mr_adc.h_orth.dim_cce   = mr_adc.h1.dim_cce
        mr_adc.h_orth.dim_cae   = 3 * mr_adc.h_orth.n_cae
        mr_adc.h_orth.dim_cca   = mr_adc.h_orth.n_cca_tril + mr_adc.h_orth.n_cca

        if mr_adc.nval > 0:
            mr_adc.h_orth.n_cve = mr_adc.h1.n_cve
            mr_adc.h_orth.n_cva = mr_adc.ncvs * mr_adc.nval * mr_adc.S12.cca.shape[1]

            mr_adc.h_orth.dim_cve = mr_adc.h1.dim_cve
            mr_adc.h_orth.dim_cva = 3 * mr_adc.h_orth.n_cva

            mr_adc.h_orth.dim = (mr_adc.h_orth.dim_c_caa + mr_adc.h_orth.dim_cce + mr_adc.h_orth.dim_cve +
                                 mr_adc.h_orth.dim_cae + mr_adc.h_orth.dim_cca + mr_adc.h_orth.dim_cva)
        else:
            mr_adc.h_orth.dim = (mr_adc.h_orth.dim_c_caa + mr_adc.h_orth.dim_cce +
                                 mr_adc.h_orth.dim_cae + mr_adc.h_orth.dim_cca)

        if mr_adc.nval > 0:
            mr_adc.h_orth.s_c_caa = 0
            mr_adc.h_orth.f_c_caa = mr_adc.h_orth.s_c_caa + mr_adc.h_orth.dim_c_caa
            mr_adc.h_orth.s_cce = mr_adc.h_orth.f_c_caa
            mr_adc.h_orth.f_cce = mr_adc.h_orth.s_cce + mr_adc.h_orth.dim_cce
            mr_adc.h_orth.s_cve = mr_adc.h_orth.f_cce
            mr_adc.h_orth.f_cve = mr_adc.h_orth.s_cve + mr_adc.h_orth.dim_cve
            mr_adc.h_orth.s_cae = mr_adc.h_orth.f_cve
            mr_adc.h_orth.f_cae = mr_adc.h_orth.s_cae + mr_adc.h_orth.dim_cae
            mr_adc.h_orth.s_cca = mr_adc.h_orth.f_cae
            mr_adc.h_orth.f_cca = mr_adc.h_orth.s_cca + mr_adc.h_orth.dim_cca
            mr_adc.h_orth.s_cva = mr_adc.h_orth.f_cca
            mr_adc.h_orth.f_cva = mr_adc.h_orth.s_cva + mr_adc.h_orth.dim_cva

            # Spin-cases slices
            mr_adc.h_orth.s_cce__aaa = mr_adc.h_orth.s_cce
            mr_adc.h_orth.f_cce__aaa = mr_adc.h_orth.s_cce__aaa + mr_adc.h_orth.n_cce_tril
            mr_adc.h_orth.s_cce__abb = mr_adc.h_orth.f_cce__aaa
            mr_adc.h_orth.f_cce__abb = mr_adc.h_orth.s_cce__abb + mr_adc.h_orth.n_cce

            mr_adc.h_orth.s_cve__aaa = mr_adc.h_orth.s_cve
            mr_adc.h_orth.f_cve__aaa = mr_adc.h_orth.s_cve__aaa + mr_adc.h_orth.n_cve
            mr_adc.h_orth.s_cve__abb = mr_adc.h_orth.f_cve__aaa
            mr_adc.h_orth.f_cve__abb = mr_adc.h_orth.s_cve__abb + mr_adc.h_orth.n_cve
            mr_adc.h_orth.s_cve__bab = mr_adc.h_orth.f_cve__abb
            mr_adc.h_orth.f_cve__bab = mr_adc.h_orth.s_cve__bab + mr_adc.h_orth.n_cve

            mr_adc.h_orth.s_cae__aaa = mr_adc.h_orth.s_cae
            mr_adc.h_orth.f_cae__aaa = mr_adc.h_orth.s_cae__aaa + mr_adc.h_orth.n_cae
            mr_adc.h_orth.s_cae__abb = mr_adc.h_orth.f_cae__aaa
            mr_adc.h_orth.f_cae__abb = mr_adc.h_orth.s_cae__abb + mr_adc.h_orth.n_cae
            mr_adc.h_orth.s_cae__bab = mr_adc.h_orth.f_cae__abb
            mr_adc.h_orth.f_cae__bab = mr_adc.h_orth.s_cae__bab + mr_adc.h_orth.n_cae

            mr_adc.h_orth.s_cca__aaa = mr_adc.h_orth.s_cca
            mr_adc.h_orth.f_cca__aaa = mr_adc.h_orth.s_cca__aaa + mr_adc.h_orth.n_cca_tril
            mr_adc.h_orth.s_cca__abb = mr_adc.h_orth.f_cca__aaa
            mr_adc.h_orth.f_cca__abb = mr_adc.h_orth.s_cca__abb + mr_adc.h_orth.n_cca

            mr_adc.h_orth.s_cva__aaa = mr_adc.h_orth.s_cva
            mr_adc.h_orth.f_cva__aaa = mr_adc.h_orth.s_cva__aaa + mr_adc.h_orth.n_cva
            mr_adc.h_orth.s_cva__abb = mr_adc.h_orth.f_cva__aaa
            mr_adc.h_orth.f_cva__abb = mr_adc.h_orth.s_cva__abb + mr_adc.h_orth.n_cva
            mr_adc.h_orth.s_cva__bab = mr_adc.h_orth.f_cva__abb
            mr_adc.h_orth.f_cva__bab = mr_adc.h_orth.s_cva__bab + mr_adc.h_orth.n_cva

        else:
            mr_adc.h_orth.s_c_caa = 0
            mr_adc.h_orth.f_c_caa = mr_adc.h_orth.s_c_caa + mr_adc.h_orth.dim_c_caa
            mr_adc.h_orth.s_cce = mr_adc.h_orth.f_c_caa
            mr_adc.h_orth.f_cce = mr_adc.h_orth.s_cce + mr_adc.h_orth.dim_cce
            mr_adc.h_orth.s_cae = mr_adc.h_orth.f_cce
            mr_adc.h_orth.f_cae = mr_adc.h_orth.s_cae + mr_adc.h_orth.dim_cae
            mr_adc.h_orth.s_cca = mr_adc.h_orth.f_cae
            mr_adc.h_orth.f_cca = mr_adc.h_orth.s_cca + mr_adc.h_orth.dim_cca

            # Spin-cases slices
            mr_adc.h_orth.s_cce__aaa = mr_adc.h_orth.s_cce
            mr_adc.h_orth.f_cce__aaa = mr_adc.h_orth.s_cce__aaa + mr_adc.h_orth.n_cce_tril
            mr_adc.h_orth.s_cce__abb = mr_adc.h_orth.f_cce__aaa
            mr_adc.h_orth.f_cce__abb = mr_adc.h_orth.s_cce__abb + mr_adc.h_orth.n_cce

            mr_adc.h_orth.s_cae__aaa = mr_adc.h_orth.s_cae
            mr_adc.h_orth.f_cae__aaa = mr_adc.h_orth.s_cae__aaa + mr_adc.h_orth.n_cae
            mr_adc.h_orth.s_cae__abb = mr_adc.h_orth.f_cae__aaa
            mr_adc.h_orth.f_cae__abb = mr_adc.h_orth.s_cae__abb + mr_adc.h_orth.n_cae
            mr_adc.h_orth.s_cae__bab = mr_adc.h_orth.f_cae__abb
            mr_adc.h_orth.f_cae__bab = mr_adc.h_orth.s_cae__bab + mr_adc.h_orth.n_cae

            mr_adc.h_orth.s_cca__aaa = mr_adc.h_orth.s_cca
            mr_adc.h_orth.f_cca__aaa = mr_adc.h_orth.s_cca__aaa + mr_adc.h_orth.n_cca_tril
            mr_adc.h_orth.s_cca__abb = mr_adc.h_orth.f_cca__aaa
            mr_adc.h_orth.f_cca__abb = mr_adc.h_orth.s_cca__abb + mr_adc.h_orth.n_cca

    print("Total dimension of the excitation manifold:                %d" % (mr_adc.h0.dim + mr_adc.h1.dim))
    print("Dimension of the orthogonalized excitation manifold:       %d\n" % (mr_adc.h_orth.dim))
    sys.stdout.flush()

    if (mr_adc.h_orth.dim < mr_adc.nroots):
        mr_adc.nroots = mr_adc.h_orth.dim

    return mr_adc

def compute_M_00(mr_adc):

    start_time = time.time()

    print("Computing M(h0-h0) block...")
    sys.stdout.flush()

    # Einsum definition from kernel
    einsum = mr_adc.interface.einsum
    einsum_type = mr_adc.interface.einsum_type

    # Variables from kernel
    ncvs = mr_adc.ncvs
    nval = mr_adc.nval

    ## Molecular Orbitals Energies
    e_core = mr_adc.mo_energy.c
    e_cvs = mr_adc.mo_energy.x
    e_extern = mr_adc.mo_energy.e

    if nval > 0:
        e_val = mr_adc.mo_energy.v

    # M_00 Matrix
    # Compute 0th-order terms
    M_00  = einsum('J,IJ->IJ', e_cvs, np.identity(ncvs), optimize = einsum_type).copy()

    if mr_adc.method in ("mr-adc(2)", "mr-adc(2)-x"):

        ## One-electron integrals
        h_aa = mr_adc.h1eff.aa

        h_xa = mr_adc.h1eff.xa
        h_xe = mr_adc.h1eff.xe

        ## Two-electron integrals
        v_aaaa = mr_adc.v2e.aaaa

        v_xaaa = mr_adc.v2e.xaaa
        v_xaae = mr_adc.v2e.xaae
        v_xaea = mr_adc.v2e.xaea

        v_xcee = mr_adc.v2e.xcee
        v_xcae = mr_adc.v2e.xcae
        v_cxae = mr_adc.v2e.cxae
        v_xcaa = mr_adc.v2e.xcaa
        v_xaee = mr_adc.v2e.xaee
        v_xaxe = mr_adc.v2e.xaxe
        v_xaex = mr_adc.v2e.xaex
        v_xcxa = mr_adc.v2e.xcxa
        v_cxxa = mr_adc.v2e.cxxa
        v_xcxe = mr_adc.v2e.xcxe
        v_cxxe = mr_adc.v2e.cxxe

        ## Amplitudes
        t1_ce = mr_adc.t1.ce
        t1_caea = mr_adc.t1.caea
        t1_caae = mr_adc.t1.caae

        t1_ca = mr_adc.t1.ca
        t1_caaa = mr_adc.t1.caaa
        t1_aaea = mr_adc.t1.aaea

        t1_ae   = mr_adc.t1.ae
        t1_aaea = mr_adc.t1.aaea

        t1_xe   = mr_adc.t1.xe
        t1_xaea = mr_adc.t1.xaea
        t1_xaae = mr_adc.t1.xaae
        t1_xa   = mr_adc.t1.xa
        t1_xaaa = mr_adc.t1.xaaa

        t1_xcee = mr_adc.t1.xcee
        t1_xcea = mr_adc.t1.xcea
        t1_cxea = mr_adc.t1.cxea
        t1_xaee = mr_adc.t1.xaee
        t1_xcaa = mr_adc.t1.xcaa

        # Reduced Density Matrices
        rdm_ca = mr_adc.rdm.ca
        rdm_ccaa = mr_adc.rdm.ccaa
        rdm_cccaaa = mr_adc.rdm.cccaaa

        # Compute 2nd-order terms
        M_00 += einsum('Ix,Jx->IJ', h_xa, t1_xa, optimize = einsum_type)
        M_00 += einsum('Ia,Ja->IJ', h_xe, t1_xe, optimize = einsum_type)
        M_00 += einsum('Jx,Ix->IJ', h_xa, t1_xa, optimize = einsum_type)
        M_00 += einsum('Ja,Ia->IJ', h_xe, t1_xe, optimize = einsum_type)
        M_00 += 2 * einsum('Iixy,Jixy->IJ', t1_xcaa, v_xcaa, optimize = einsum_type)
        M_00 -= einsum('Iixy,Jiyx->IJ', t1_xcaa, v_xcaa, optimize = einsum_type)
        M_00 += 2 * einsum('Iiax,iJxa->IJ', t1_xcea, v_cxae, optimize = einsum_type)
        M_00 -= einsum('Iiax,Jixa->IJ', t1_xcea, v_xcae, optimize = einsum_type)
        M_00 += 2 * einsum('Iiab,Jiab->IJ', t1_xcee, v_xcee, optimize = einsum_type)
        M_00 -= einsum('Iiab,Jiba->IJ', t1_xcee, v_xcee, optimize = einsum_type)
        M_00 += 2 * einsum('Jixy,Iixy->IJ', t1_xcaa, v_xcaa, optimize = einsum_type)
        M_00 -= einsum('Jixy,Iiyx->IJ', t1_xcaa, v_xcaa, optimize = einsum_type)
        M_00 += 2 * einsum('Jiax,iIxa->IJ', t1_xcea, v_cxae, optimize = einsum_type)
        M_00 -= einsum('Jiax,Iixa->IJ', t1_xcea, v_xcae, optimize = einsum_type)
        M_00 += 2 * einsum('Jiab,Iiab->IJ', t1_xcee, v_xcee, optimize = einsum_type)
        M_00 -= einsum('Jiab,Iiba->IJ', t1_xcee, v_xcee, optimize = einsum_type)
        M_00 += 2 * einsum('ix,JiIx->IJ', t1_ca, v_xcxa, optimize = einsum_type)
        M_00 -= einsum('ix,iJIx->IJ', t1_ca, v_cxxa, optimize = einsum_type)
        M_00 -= einsum('iIax,iJxa->IJ', t1_cxea, v_cxae, optimize = einsum_type)
        M_00 += 2 * einsum('iIax,Jixa->IJ', t1_cxea, v_xcae, optimize = einsum_type)
        M_00 -= einsum('iJax,iIxa->IJ', t1_cxea, v_cxae, optimize = einsum_type)
        M_00 += 2 * einsum('iJax,Iixa->IJ', t1_cxea, v_xcae, optimize = einsum_type)
        M_00 += 2 * einsum('ix,IiJx->IJ', t1_ca, v_xcxa, optimize = einsum_type)
        M_00 -= einsum('ix,iIJx->IJ', t1_ca, v_cxxa, optimize = einsum_type)
        M_00 += 2 * einsum('ia,IiJa->IJ', t1_ce, v_xcxe, optimize = einsum_type)
        M_00 -= einsum('ia,iIJa->IJ', t1_ce, v_cxxe, optimize = einsum_type)
        M_00 += 2 * einsum('ia,JiIa->IJ', t1_ce, v_xcxe, optimize = einsum_type)
        M_00 -= einsum('ia,iJIa->IJ', t1_ce, v_cxxe, optimize = einsum_type)
        M_00 -= 1/2 * einsum('I,Ix,Jx->IJ', e_cvs, t1_xa, t1_xa, optimize = einsum_type)
        M_00 -= einsum('I,Iixy,Jixy->IJ', e_cvs, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('I,Iixy,Jiyx->IJ', e_cvs, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M_00 -= einsum('I,Iiax,Jiax->IJ', e_cvs, t1_xcea, t1_xcea, optimize = einsum_type)
        M_00 += 1/2 * einsum('I,Iiax,iJax->IJ', e_cvs, t1_xcea, t1_cxea, optimize = einsum_type)
        M_00 -= einsum('I,Iiab,Jiab->IJ', e_cvs, t1_xcee, t1_xcee, optimize = einsum_type)
        M_00 += 1/2 * einsum('I,Iiab,Jiba->IJ', e_cvs, t1_xcee, t1_xcee, optimize = einsum_type)
        M_00 -= 1/2 * einsum('I,Ia,Ja->IJ', e_cvs, t1_xe, t1_xe, optimize = einsum_type)
        M_00 += 1/2 * einsum('I,Jiax,iIax->IJ', e_cvs, t1_xcea, t1_cxea, optimize = einsum_type)
        M_00 -= einsum('I,iIax,iJax->IJ', e_cvs, t1_cxea, t1_cxea, optimize = einsum_type)
        M_00 -= 1/2 * einsum('J,Ix,Jx->IJ', e_cvs, t1_xa, t1_xa, optimize = einsum_type)
        M_00 -= einsum('J,Iixy,Jixy->IJ', e_cvs, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('J,Iixy,Jiyx->IJ', e_cvs, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M_00 -= einsum('J,Iiax,Jiax->IJ', e_cvs, t1_xcea, t1_xcea, optimize = einsum_type)
        M_00 += 1/2 * einsum('J,Iiax,iJax->IJ', e_cvs, t1_xcea, t1_cxea, optimize = einsum_type)
        M_00 -= einsum('J,Iiab,Jiab->IJ', e_cvs, t1_xcee, t1_xcee, optimize = einsum_type)
        M_00 += 1/2 * einsum('J,Iiab,Jiba->IJ', e_cvs, t1_xcee, t1_xcee, optimize = einsum_type)
        M_00 -= 1/2 * einsum('J,Ia,Ja->IJ', e_cvs, t1_xe, t1_xe, optimize = einsum_type)
        M_00 += 1/2 * einsum('J,Jiax,iIax->IJ', e_cvs, t1_xcea, t1_cxea, optimize = einsum_type)
        M_00 -= einsum('J,iIax,iJax->IJ', e_cvs, t1_cxea, t1_cxea, optimize = einsum_type)
        M_00 -= einsum('i,Iixy,Jixy->IJ', e_core, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('i,Iixy,Jiyx->IJ', e_core, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M_00 -= einsum('i,Iiax,Jiax->IJ', e_core, t1_xcea, t1_xcea, optimize = einsum_type)
        M_00 += 1/2 * einsum('i,Iiax,iJax->IJ', e_core, t1_xcea, t1_cxea, optimize = einsum_type)
        M_00 -= einsum('i,Iiab,Jiab->IJ', e_core, t1_xcee, t1_xcee, optimize = einsum_type)
        M_00 += 1/2 * einsum('i,Iiab,Jiba->IJ', e_core, t1_xcee, t1_xcee, optimize = einsum_type)
        M_00 -= einsum('i,Jixy,Iixy->IJ', e_core, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('i,Jixy,Iiyx->IJ', e_core, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M_00 -= einsum('i,Jiax,Iiax->IJ', e_core, t1_xcea, t1_xcea, optimize = einsum_type)
        M_00 += 1/2 * einsum('i,Jiax,iIax->IJ', e_core, t1_xcea, t1_cxea, optimize = einsum_type)
        M_00 -= einsum('i,Jiab,Iiab->IJ', e_core, t1_xcee, t1_xcee, optimize = einsum_type)
        M_00 += 1/2 * einsum('i,Jiab,Iiba->IJ', e_core, t1_xcee, t1_xcee, optimize = einsum_type)
        M_00 += 1/2 * einsum('i,iIax,Jiax->IJ', e_core, t1_cxea, t1_xcea, optimize = einsum_type)
        M_00 -= einsum('i,iIax,iJax->IJ', e_core, t1_cxea, t1_cxea, optimize = einsum_type)
        M_00 += 1/2 * einsum('i,iJax,Iiax->IJ', e_core, t1_cxea, t1_xcea, optimize = einsum_type)
        M_00 -= einsum('i,iJax,iIax->IJ', e_core, t1_cxea, t1_cxea, optimize = einsum_type)
        M_00 += einsum('a,Ia,Ja->IJ', e_extern, t1_xe, t1_xe, optimize = einsum_type)
        M_00 += 2 * einsum('a,Iiax,Jiax->IJ', e_extern, t1_xcea, t1_xcea, optimize = einsum_type)
        M_00 -= einsum('a,Iiax,iJax->IJ', e_extern, t1_xcea, t1_cxea, optimize = einsum_type)
        M_00 += 2 * einsum('a,Iiab,Jiab->IJ', e_extern, t1_xcee, t1_xcee, optimize = einsum_type)
        M_00 -= einsum('a,Iiab,Jiba->IJ', e_extern, t1_xcee, t1_xcee, optimize = einsum_type)
        M_00 -= einsum('a,Iiba,Jiab->IJ', e_extern, t1_xcee, t1_xcee, optimize = einsum_type)
        M_00 += 2 * einsum('a,Iiba,Jiba->IJ', e_extern, t1_xcee, t1_xcee, optimize = einsum_type)
        M_00 -= einsum('a,iIax,Jiax->IJ', e_extern, t1_cxea, t1_xcea, optimize = einsum_type)
        M_00 += 2 * einsum('a,iIax,iJax->IJ', e_extern, t1_cxea, t1_cxea, optimize = einsum_type)
        M_00 += einsum('Ix,Jyxz,zy->IJ', h_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Ix,Jyzx,zy->IJ', h_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 += einsum('Ia,Jxay,yx->IJ', h_xe, t1_xaea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Ia,Jxya,yx->IJ', h_xe, t1_xaae, rdm_ca, optimize = einsum_type)
        M_00 += einsum('Jx,Iyxz,yz->IJ', h_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Jx,Iyzx,yz->IJ', h_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 += einsum('Ja,Ixay,xy->IJ', h_xe, t1_xaea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Ja,Ixya,xy->IJ', h_xe, t1_xaae, rdm_ca, optimize = einsum_type)
        M_00 += einsum('xy,Ix,Jy->IJ', h_aa, t1_xa, t1_xa, optimize = einsum_type)
        M_00 += 2 * einsum('xy,Iixz,Jiyz->IJ', h_aa, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M_00 -= einsum('xy,Iixz,Jizy->IJ', h_aa, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M_00 -= einsum('xy,Iizx,Jiyz->IJ', h_aa, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M_00 += 2 * einsum('xy,Iizx,Jizy->IJ', h_aa, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M_00 += 2 * einsum('xy,Iiax,Jiay->IJ', h_aa, t1_xcea, t1_xcea, optimize = einsum_type)
        M_00 -= einsum('xy,Iiax,iJay->IJ', h_aa, t1_xcea, t1_cxea, optimize = einsum_type)
        M_00 -= einsum('xy,Jiax,iIay->IJ', h_aa, t1_xcea, t1_cxea, optimize = einsum_type)
        M_00 += 2 * einsum('xy,iIax,iJay->IJ', h_aa, t1_cxea, t1_cxea, optimize = einsum_type)
        M_00 += einsum('Ix,Jyxz,zy->IJ', t1_xa, v_xaaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Ix,Jyzx,zy->IJ', t1_xa, v_xaaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('Ixyz,Jxwu,yzwu->IJ', t1_xaaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('Ixyz,Jwyz,xw->IJ', t1_xaaa, v_xaaa, rdm_ca, optimize = einsum_type)
        M_00 += einsum('Ixyz,Jwyu,xuzw->IJ', t1_xaaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Ixyz,Jwzy,xw->IJ', t1_xaaa, v_xaaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Ixyz,Jwzu,xuyw->IJ', t1_xaaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Ixyz,Jwuy,xuzw->IJ', t1_xaaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Ixyz,Jwuz,xuwy->IJ', t1_xaaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('Ixya,Jzya,xz->IJ', t1_xaae, v_xaae, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Ixya,Jzay,xz->IJ', t1_xaae, v_xaea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Ixya,Jzaw,xwyz->IJ', t1_xaae, v_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Ixya,Jzwa,xwzy->IJ', t1_xaae, v_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('Ixay,Jzay,xz->IJ', t1_xaea, v_xaea, rdm_ca, optimize = einsum_type)
        M_00 += einsum('Ixay,Jzaw,xwyz->IJ', t1_xaea, v_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Ixay,Jzya,xz->IJ', t1_xaea, v_xaae, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Ixay,Jzwa,xwyz->IJ', t1_xaea, v_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('Ixab,Jyab,xy->IJ', t1_xaee, v_xaee, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Ixab,Jyba,xy->IJ', t1_xaee, v_xaee, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('Iixy,Jixz,zy->IJ', t1_xcaa, v_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('Iixy,Jiyz,zx->IJ', t1_xcaa, v_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('Iixy,Jizx,zy->IJ', t1_xcaa, v_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('Iixy,Jizy,zx->IJ', t1_xcaa, v_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('Iixy,Jizw,xyzw->IJ', t1_xcaa, v_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= einsum('Iiax,iJya,yx->IJ', t1_xcea, v_cxae, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('Iiax,Jiya,yx->IJ', t1_xcea, v_xcae, rdm_ca, optimize = einsum_type)
        M_00 += einsum('Ia,Jxay,yx->IJ', t1_xe, v_xaea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Ia,Jxya,yx->IJ', t1_xe, v_xaae, rdm_ca, optimize = einsum_type)
        M_00 += einsum('Jx,Iyxz,yz->IJ', t1_xa, v_xaaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Jx,Iyzx,yz->IJ', t1_xa, v_xaaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('Jxyz,Ixwu,yzwu->IJ', t1_xaaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('Jxyz,Iwyz,wx->IJ', t1_xaaa, v_xaaa, rdm_ca, optimize = einsum_type)
        M_00 += einsum('Jxyz,Iwyu,xuzw->IJ', t1_xaaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Jxyz,Iwzy,wx->IJ', t1_xaaa, v_xaaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Jxyz,Iwzu,xuyw->IJ', t1_xaaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Jxyz,Iwuy,xuzw->IJ', t1_xaaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Jxyz,Iwuz,xuwy->IJ', t1_xaaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('Jxya,Izya,zx->IJ', t1_xaae, v_xaae, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Jxya,Izay,zx->IJ', t1_xaae, v_xaea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Jxya,Izaw,xwyz->IJ', t1_xaae, v_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Jxya,Izwa,xwzy->IJ', t1_xaae, v_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('Jxay,Izay,zx->IJ', t1_xaea, v_xaea, rdm_ca, optimize = einsum_type)
        M_00 += einsum('Jxay,Izaw,xwyz->IJ', t1_xaea, v_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Jxay,Izya,zx->IJ', t1_xaea, v_xaae, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Jxay,Izwa,xwyz->IJ', t1_xaea, v_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('Jxab,Iyab,yx->IJ', t1_xaee, v_xaee, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Jxab,Iyba,yx->IJ', t1_xaee, v_xaee, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('Jixy,Iixz,yz->IJ', t1_xcaa, v_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('Jixy,Iiyz,xz->IJ', t1_xcaa, v_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('Jixy,Iizx,yz->IJ', t1_xcaa, v_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('Jixy,Iizy,xz->IJ', t1_xcaa, v_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('Jixy,Iizw,xyzw->IJ', t1_xcaa, v_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= einsum('Jiax,iIya,xy->IJ', t1_xcea, v_cxae, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('Jiax,Iiya,xy->IJ', t1_xcea, v_xcae, rdm_ca, optimize = einsum_type)
        M_00 += einsum('Ja,Ixay,xy->IJ', t1_xe, v_xaea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('Ja,Ixya,xy->IJ', t1_xe, v_xaae, rdm_ca, optimize = einsum_type)
        M_00 += 2 * einsum('ixyz,JiIy,xz->IJ', t1_caaa, v_xcxa, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('ixyz,iJIy,xz->IJ', t1_caaa, v_cxxa, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('ixyz,JiIz,xy->IJ', t1_caaa, v_xcxa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('ixyz,iJIz,xy->IJ', t1_caaa, v_cxxa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('iIax,iJya,yx->IJ', t1_cxea, v_cxae, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('iIax,Jiya,yx->IJ', t1_cxea, v_xcae, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('iJax,iIya,xy->IJ', t1_cxea, v_cxae, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('iJax,Iiya,xy->IJ', t1_cxea, v_xcae, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('ix,IiJy,xy->IJ', t1_ca, v_xcxa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('ix,iIJy,xy->IJ', t1_ca, v_cxxa, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('ix,JiIy,yx->IJ', t1_ca, v_xcxa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('ix,iJIy,yx->IJ', t1_ca, v_cxxa, rdm_ca, optimize = einsum_type)
        M_00 += 2 * einsum('ixyz,IiJy,zx->IJ', t1_caaa, v_xcxa, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('ixyz,IiJz,yx->IJ', t1_caaa, v_xcxa, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('ixyz,IiJw,xwzy->IJ', t1_caaa, v_xcxa, rdm_ccaa, optimize = einsum_type)
        M_00 -= einsum('ixyz,iIJy,zx->IJ', t1_caaa, v_cxxa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('ixyz,iIJz,yx->IJ', t1_caaa, v_cxxa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('ixyz,iIJw,xwzy->IJ', t1_caaa, v_cxxa, rdm_ccaa, optimize = einsum_type)
        M_00 -= einsum('ixyz,JiIw,xwzy->IJ', t1_caaa, v_xcxa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('ixyz,iJIw,xwzy->IJ', t1_caaa, v_cxxa, rdm_ccaa, optimize = einsum_type)
        M_00 -= einsum('ixya,IiJa,yx->IJ', t1_caae, v_xcxe, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('ixya,iIJa,yx->IJ', t1_caae, v_cxxe, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('ixya,JiIa,xy->IJ', t1_caae, v_xcxe, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('ixya,iJIa,xy->IJ', t1_caae, v_cxxe, rdm_ca, optimize = einsum_type)
        M_00 += 2 * einsum('ixay,IiJa,yx->IJ', t1_caea, v_xcxe, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('ixay,iIJa,yx->IJ', t1_caea, v_cxxe, rdm_ca, optimize = einsum_type)
        M_00 += 2 * einsum('ixay,JiIa,xy->IJ', t1_caea, v_xcxe, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('ixay,iJIa,xy->IJ', t1_caea, v_cxxe, rdm_ca, optimize = einsum_type)
        M_00 += einsum('xa,JyIa,xy->IJ', t1_ae, v_xaxe, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xa,JyaI,xy->IJ', t1_ae, v_xaex, rdm_ca, optimize = einsum_type)
        M_00 += einsum('xa,IyJa,yx->IJ', t1_ae, v_xaxe, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xa,IyaJ,yx->IJ', t1_ae, v_xaex, rdm_ca, optimize = einsum_type)
        M_00 += einsum('xyaz,JwIa,zwyx->IJ', t1_aaea, v_xaxe, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyaz,JwaI,zwyx->IJ', t1_aaea, v_xaex, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('xyaz,IwJa,zwyx->IJ', t1_aaea, v_xaxe, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyaz,IwaJ,zwyx->IJ', t1_aaea, v_xaex, rdm_ccaa, optimize = einsum_type)
        M_00 += 2 * einsum('xyzw,Iixy,Jizw->IJ', v_aaaa, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M_00 -= einsum('xyzw,Iixy,Jiwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('I,Ix,Jyxz,zy->IJ', e_cvs, t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('I,Ix,Jyzx,zy->IJ', e_cvs, t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('I,Ixyz,Jxwu,yzwu->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('I,Ixyz,Jy,xz->IJ', e_cvs, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('I,Ixyz,Jz,xy->IJ', e_cvs, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('I,Ixyz,Jwyz,xw->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('I,Ixyz,Jwyu,xuzw->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('I,Ixyz,Jwzy,xw->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('I,Ixyz,Jwzu,xuyw->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('I,Ixyz,Jwuy,xuzw->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('I,Ixyz,Jwuz,xuwy->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('I,Ixya,Ja,xy->IJ', e_cvs, t1_xaae, t1_xe, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('I,Ixya,Jzya,xz->IJ', e_cvs, t1_xaae, t1_xaae, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('I,Ixya,Jzay,xz->IJ', e_cvs, t1_xaae, t1_xaea, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('I,Ixya,Jzaw,xwyz->IJ', e_cvs, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('I,Ixya,Jzwa,xwzy->IJ', e_cvs, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('I,Ixay,Ja,xy->IJ', e_cvs, t1_xaea, t1_xe, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('I,Ixay,Jzay,xz->IJ', e_cvs, t1_xaea, t1_xaea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('I,Ixay,Jzaw,xwyz->IJ', e_cvs, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('I,Ixay,Jzya,xz->IJ', e_cvs, t1_xaea, t1_xaae, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('I,Ixay,Jzwa,xwyz->IJ', e_cvs, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('I,Ixab,Jyab,xy->IJ', e_cvs, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('I,Ixab,Jyba,xy->IJ', e_cvs, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('I,Iixy,Jixz,zy->IJ', e_cvs, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('I,Iixy,Jiyz,zx->IJ', e_cvs, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('I,Iixy,Jizx,zy->IJ', e_cvs, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('I,Iixy,Jizy,zx->IJ', e_cvs, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('I,Iixy,Jizw,xyzw->IJ', e_cvs, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('I,Iiax,Jiay,yx->IJ', e_cvs, t1_xcea, t1_xcea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('I,Iiax,iJay,yx->IJ', e_cvs, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('I,Ia,Jxay,yx->IJ', e_cvs, t1_xe, t1_xaea, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('I,Ia,Jxya,yx->IJ', e_cvs, t1_xe, t1_xaae, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('I,Jiax,iIay,xy->IJ', e_cvs, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('I,iIax,iJay,yx->IJ', e_cvs, t1_cxea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('J,Ix,Jyxz,zy->IJ', e_cvs, t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('J,Ix,Jyzx,zy->IJ', e_cvs, t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('J,Ixyz,Jxwu,yzwu->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('J,Ixyz,Jy,xz->IJ', e_cvs, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('J,Ixyz,Jz,xy->IJ', e_cvs, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('J,Ixyz,Jwyz,xw->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('J,Ixyz,Jwyu,xuzw->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('J,Ixyz,Jwzy,xw->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('J,Ixyz,Jwzu,xuyw->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('J,Ixyz,Jwuy,xuzw->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('J,Ixyz,Jwuz,xuwy->IJ', e_cvs, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('J,Ixya,Ja,xy->IJ', e_cvs, t1_xaae, t1_xe, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('J,Ixya,Jzya,xz->IJ', e_cvs, t1_xaae, t1_xaae, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('J,Ixya,Jzay,xz->IJ', e_cvs, t1_xaae, t1_xaea, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('J,Ixya,Jzaw,xwyz->IJ', e_cvs, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('J,Ixya,Jzwa,xwzy->IJ', e_cvs, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('J,Ixay,Ja,xy->IJ', e_cvs, t1_xaea, t1_xe, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('J,Ixay,Jzay,xz->IJ', e_cvs, t1_xaea, t1_xaea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('J,Ixay,Jzaw,xwyz->IJ', e_cvs, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('J,Ixay,Jzya,xz->IJ', e_cvs, t1_xaea, t1_xaae, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('J,Ixay,Jzwa,xwyz->IJ', e_cvs, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('J,Ixab,Jyab,xy->IJ', e_cvs, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('J,Ixab,Jyba,xy->IJ', e_cvs, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('J,Iixy,Jixz,zy->IJ', e_cvs, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('J,Iixy,Jiyz,zx->IJ', e_cvs, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('J,Iixy,Jizx,zy->IJ', e_cvs, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('J,Iixy,Jizy,zx->IJ', e_cvs, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('J,Iixy,Jizw,xyzw->IJ', e_cvs, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('J,Iiax,Jiay,yx->IJ', e_cvs, t1_xcea, t1_xcea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('J,Iiax,iJay,yx->IJ', e_cvs, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('J,Ia,Jxay,yx->IJ', e_cvs, t1_xe, t1_xaea, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('J,Ia,Jxya,yx->IJ', e_cvs, t1_xe, t1_xaae, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('J,Jiax,iIay,xy->IJ', e_cvs, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('J,iIax,iJay,yx->IJ', e_cvs, t1_cxea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('i,Iixy,Jixz,zy->IJ', e_core, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('i,Iixy,Jiyz,zx->IJ', e_core, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('i,Iixy,Jizx,zy->IJ', e_core, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('i,Iixy,Jizy,zx->IJ', e_core, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('i,Iiax,Jiay,yx->IJ', e_core, t1_xcea, t1_xcea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('i,Iiax,iJay,yx->IJ', e_core, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('i,Jixy,Iixz,yz->IJ', e_core, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('i,Jixy,Iiyz,xz->IJ', e_core, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('i,Jixy,Iizx,yz->IJ', e_core, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('i,Jixy,Iizy,xz->IJ', e_core, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('i,Jixy,Iizw,xyzw->IJ', e_core, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('i,Jiax,Iiay,xy->IJ', e_core, t1_xcea, t1_xcea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('i,Jiax,iIay,xy->IJ', e_core, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('i,iIax,Jiay,yx->IJ', e_core, t1_cxea, t1_xcea, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('i,iIax,iJay,yx->IJ', e_core, t1_cxea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('i,iJax,Iiay,xy->IJ', e_core, t1_cxea, t1_xcea, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('i,iJax,iIay,xy->IJ', e_core, t1_cxea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 += einsum('a,Ia,Jxay,yx->IJ', e_extern, t1_xe, t1_xaea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('a,Ia,Jxya,yx->IJ', e_extern, t1_xe, t1_xaae, rdm_ca, optimize = einsum_type)
        M_00 += einsum('a,Ixay,Ja,xy->IJ', e_extern, t1_xaea, t1_xe, rdm_ca, optimize = einsum_type)
        M_00 += einsum('a,Ixay,Jzay,xz->IJ', e_extern, t1_xaea, t1_xaea, rdm_ca, optimize = einsum_type)
        M_00 += einsum('a,Ixay,Jzaw,xwyz->IJ', e_extern, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('a,Ixay,Jzya,xz->IJ', e_extern, t1_xaea, t1_xaae, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('a,Ixay,Jzwa,xwyz->IJ', e_extern, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('a,Ixab,Jyab,xy->IJ', e_extern, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('a,Ixab,Jyba,xy->IJ', e_extern, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('a,Ixya,Ja,xy->IJ', e_extern, t1_xaae, t1_xe, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('a,Ixya,Jzay,xz->IJ', e_extern, t1_xaae, t1_xaea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('a,Ixya,Jzaw,xwyz->IJ', e_extern, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('a,Ixya,Jzya,xz->IJ', e_extern, t1_xaae, t1_xaae, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('a,Ixya,Jzwa,xwzy->IJ', e_extern, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('a,Ixba,Jyab,xy->IJ', e_extern, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M_00 += einsum('a,Ixba,Jyba,xy->IJ', e_extern, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('a,Iiax,Jiay,yx->IJ', e_extern, t1_xcea, t1_xcea, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('a,Iiax,iJay,yx->IJ', e_extern, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('a,iIax,Jiay,yx->IJ', e_extern, t1_cxea, t1_xcea, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('a,iIax,iJay,yx->IJ', e_extern, t1_cxea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 += einsum('xy,Ix,Jzyw,wz->IJ', h_aa, t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Ix,Jzwy,wz->IJ', h_aa, t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Ixzw,Jyuv,zwuv->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Ixzw,Jz,yw->IJ', h_aa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Ixzw,Jw,yz->IJ', h_aa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Ixzw,Juzw,yu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Ixzw,Juzv,yvwu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Ixzw,Juwz,yu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Ixzw,Juwv,yvzu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Ixzw,Juvz,yvwu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Ixzw,Juvw,yvuz->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Ixza,Ja,yz->IJ', h_aa, t1_xaae, t1_xe, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Ixza,Jwza,yw->IJ', h_aa, t1_xaae, t1_xaae, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Ixza,Jwaz,yw->IJ', h_aa, t1_xaae, t1_xaea, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Ixza,Jwau,yuzw->IJ', h_aa, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Ixza,Jwua,yuwz->IJ', h_aa, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Ixaz,Ja,yz->IJ', h_aa, t1_xaea, t1_xe, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Ixaz,Jwaz,yw->IJ', h_aa, t1_xaea, t1_xaea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Ixaz,Jwau,yuzw->IJ', h_aa, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Ixaz,Jwza,yw->IJ', h_aa, t1_xaea, t1_xaae, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Ixaz,Jwua,yuzw->IJ', h_aa, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Ixab,Jzab,yz->IJ', h_aa, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Ixab,Jzba,yz->IJ', h_aa, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M_00 += einsum('xy,Izxw,Jy,zw->IJ', h_aa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Izxw,Jzuv,ywuv->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/4 * einsum('xy,Izxw,Jw,zy->IJ', h_aa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M_00 += einsum('xy,Izxw,Juyw,zu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 += einsum('xy,Izxw,Juyv,zvwu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Izxw,Juwy,zu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('xy,Izxw,Juwv,yuzv->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Izxw,Juvy,zvwu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/4 * einsum('xy,Izxw,Juvw,yuvz->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/4 * einsum('xy,Izxa,Ja,zy->IJ', h_aa, t1_xaae, t1_xe, rdm_ca, optimize = einsum_type)
        M_00 += einsum('xy,Izxa,Jwya,zw->IJ', h_aa, t1_xaae, t1_xaae, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Izxa,Jway,zw->IJ', h_aa, t1_xaae, t1_xaea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('xy,Izxa,Jwau,ywzu->IJ', h_aa, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/4 * einsum('xy,Izxa,Jwua,ywuz->IJ', h_aa, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Izwx,Jy,zw->IJ', h_aa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Izwx,Jzuv,ywvu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('xy,Izwx,Jw,zy->IJ', h_aa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Izwx,Juyw,zu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Izwx,Juyv,zvwu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('xy,Izwx,Juwy,zu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('xy,Izwx,Juwv,yuzv->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Izwx,Juvy,zvuw->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/4 * einsum('xy,Izwx,Juvw,yuzv->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('xy,Izax,Ja,zy->IJ', h_aa, t1_xaea, t1_xe, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Izax,Jwya,zw->IJ', h_aa, t1_xaea, t1_xaae, rdm_ca, optimize = einsum_type)
        M_00 += einsum('xy,Izax,Jway,zw->IJ', h_aa, t1_xaea, t1_xaea, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('xy,Izax,Jwau,ywzu->IJ', h_aa, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/4 * einsum('xy,Izax,Jwua,ywzu->IJ', h_aa, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 -= einsum('xy,Iixz,Jiyw,wz->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Iixz,Jizw,wy->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('xy,Iixz,Jiwy,wz->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Iixz,Jiwz,wy->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Iixz,Jiwu,yzwu->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('xy,Iizx,Jiyw,wz->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Iizx,Jizw,wy->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('xy,Iizx,Jiwy,wz->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Iizx,Jiwz,wy->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Iizx,Jiwu,yzuw->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Iiax,Jiaz,zy->IJ', h_aa, t1_xcea, t1_xcea, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Iiax,iJaz,zy->IJ', h_aa, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Jxzw,Iz,wy->IJ', h_aa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Jxzw,Iw,zy->IJ', h_aa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Jxzw,Iuzw,uy->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Jxzw,Iuzv,yvwu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Jxzw,Iuwz,uy->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Jxzw,Iuwv,yvzu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Jxzw,Iuvz,yvwu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Jxzw,Iuvw,yvuz->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Jxza,Ia,zy->IJ', h_aa, t1_xaae, t1_xe, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Jxza,Iwza,wy->IJ', h_aa, t1_xaae, t1_xaae, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Jxza,Iwaz,wy->IJ', h_aa, t1_xaae, t1_xaea, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Jxza,Iwau,yuzw->IJ', h_aa, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Jxza,Iwua,yuwz->IJ', h_aa, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Jxaz,Ia,zy->IJ', h_aa, t1_xaea, t1_xe, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Jxaz,Iwaz,wy->IJ', h_aa, t1_xaea, t1_xaea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Jxaz,Iwau,yuzw->IJ', h_aa, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Jxaz,Iwza,wy->IJ', h_aa, t1_xaea, t1_xaae, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Jxaz,Iwua,yuzw->IJ', h_aa, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Jxab,Izab,zy->IJ', h_aa, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Jxab,Izba,zy->IJ', h_aa, t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Jzxw,Izuv,ywuv->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/4 * einsum('xy,Jzxw,Iw,yz->IJ', h_aa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('xy,Jzxw,Iuwv,yuzv->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/4 * einsum('xy,Jzxw,Iuvw,yuvz->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/4 * einsum('xy,Jzxa,Ia,yz->IJ', h_aa, t1_xaae, t1_xe, rdm_ca, optimize = einsum_type)
        M_00 -= 1/4 * einsum('xy,Jzxa,Iwau,ywzu->IJ', h_aa, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/4 * einsum('xy,Jzxa,Iwua,ywuz->IJ', h_aa, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Jzwx,Izuv,ywvu->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('xy,Jzwx,Iw,yz->IJ', h_aa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('xy,Jzwx,Iuwv,yuzv->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/4 * einsum('xy,Jzwx,Iuvw,yuzv->IJ', h_aa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('xy,Jzax,Ia,yz->IJ', h_aa, t1_xaea, t1_xe, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('xy,Jzax,Iwau,ywzu->IJ', h_aa, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/4 * einsum('xy,Jzax,Iwua,ywzu->IJ', h_aa, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Jixz,Iizw,yw->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Jixz,Iiwz,yw->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Jixz,Iiwu,yzwu->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Jizx,Iizw,yw->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Jizx,Iiwz,yw->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Jizx,Iiwu,yzuw->IJ', h_aa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,Jiax,Iiaz,yz->IJ', h_aa, t1_xcea, t1_xcea, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,Jiax,iIaz,yz->IJ', h_aa, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,iIax,Jiaz,zy->IJ', h_aa, t1_cxea, t1_xcea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,iIax,iJaz,zy->IJ', h_aa, t1_cxea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xy,iJax,Iiaz,yz->IJ', h_aa, t1_cxea, t1_xcea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xy,iJax,iIaz,yz->IJ', h_aa, t1_cxea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('xyzw,Ix,Jyuv,zwuv->IJ', v_aaaa, t1_xa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('xyzw,Ix,Jz,yw->IJ', v_aaaa, t1_xa, t1_xa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Ix,Jw,yz->IJ', v_aaaa, t1_xa, t1_xa, rdm_ca, optimize = einsum_type)
        M_00 += einsum('xyzw,Ix,Juzw,yu->IJ', v_aaaa, t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 += einsum('xyzw,Ix,Juzv,yvwu->IJ', v_aaaa, t1_xa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Ix,Juwz,yu->IJ', v_aaaa, t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Ix,Juwv,yvzu->IJ', v_aaaa, t1_xa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Ix,Juvz,yvwu->IJ', v_aaaa, t1_xa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Ix,Juvw,yvuz->IJ', v_aaaa, t1_xa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('xyzw,Ixuv,Jy,zwvu->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 5/12 * einsum('xyzw,Ixuv,Jzst,wstyuv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Ixuv,Jzst,wstyvu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Ixuv,Jzst,wstuyv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Ixuv,Jzst,wstuvy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Ixuv,Jzst,wstvyu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Ixuv,Jzst,wstvuy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Ixuv,Jwst,zstyuv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Ixuv,Jwst,zstyvu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Ixuv,Jwst,zstuyv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Ixuv,Jwst,zstuvy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Ixuv,Jwst,zstvyu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 5/12 * einsum('xyzw,Ixuv,Jwst,zstvuy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Ixuv,Ju,yvwz->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Ixuv,Jv,yuwz->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Ixuv,Jsyu,zwvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Ixuv,Jsyv,zwsu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Ixuv,Jsyt,zwtuvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Ixuv,Jsyt,zwtusv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/12 * einsum('xyzw,Ixuv,Jsyt,zwtvus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Ixuv,Jsyt,zwtvsu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Ixuv,Jsyt,zwtsuv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Ixuv,Jsyt,zwtsvu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Ixuv,Jsuy,zwvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Ixuv,Jsuv,yswz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Ixuv,Jsut,zwtyvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Ixuv,Jsut,zwtysv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 5/12 * einsum('xyzw,Ixuv,Jsut,zwtvys->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Ixuv,Jsut,zwtvsy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Ixuv,Jsut,zwtsyv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Ixuv,Jsut,zwtsvy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Ixuv,Jsvy,zwus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Ixuv,Jsvu,yswz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixuv,Jsvt,zwtyus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixuv,Jsvt,zwtysu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/24 * einsum('xyzw,Ixuv,Jsvt,zwtuys->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixuv,Jsvt,zwtusy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixuv,Jsvt,zwtsyu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixuv,Jsvt,zwtsuy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Ixuv,Jsty,zwtuvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Ixuv,Jsty,zwtusv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Ixuv,Jsty,zwtvus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/12 * einsum('xyzw,Ixuv,Jsty,zwtvsu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Ixuv,Jsty,zwtsuv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Ixuv,Jsty,zwtsvu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixuv,Jstu,zwtyvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixuv,Jstu,zwtysv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/24 * einsum('xyzw,Ixuv,Jstu,zwtvys->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixuv,Jstu,zwtvsy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixuv,Jstu,zwtsyv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixuv,Jstu,zwtsvy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixuv,Jstv,zwtyus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixuv,Jstv,zwtysu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixuv,Jstv,zwtuys->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixuv,Jstv,zwtusy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/24 * einsum('xyzw,Ixuv,Jstv,zwtsyu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixuv,Jstv,zwtsuy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Ixua,Ja,yuwz->IJ', v_aaaa, t1_xaae, t1_xe, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Ixua,Jvya,zwvu->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Ixua,Jvua,yvwz->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Ixua,Jvay,zwuv->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Ixua,Jvau,yvwz->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixua,Jvas,zwsyuv->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixua,Jvas,zwsyvu->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/24 * einsum('xyzw,Ixua,Jvas,zwsuyv->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixua,Jvas,zwsuvy->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixua,Jvas,zwsvyu->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixua,Jvas,zwsvuy->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixua,Jvsa,zwsyuv->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixua,Jvsa,zwsyvu->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixua,Jvsa,zwsuyv->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixua,Jvsa,zwsuvy->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/24 * einsum('xyzw,Ixua,Jvsa,zwsvyu->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixua,Jvsa,zwsvuy->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Ixau,Ja,yuwz->IJ', v_aaaa, t1_xaea, t1_xe, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Ixau,Jvya,zwuv->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Ixau,Jvay,zwuv->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Ixau,Jvau,yvwz->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Ixau,Jvas,zwsyuv->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Ixau,Jvas,zwsyvu->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 5/12 * einsum('xyzw,Ixau,Jvas,zwsuyv->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Ixau,Jvas,zwsuvy->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Ixau,Jvas,zwsvyu->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Ixau,Jvas,zwsvuy->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Ixau,Jvua,yvwz->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixau,Jvsa,zwsyuv->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixau,Jvsa,zwsyvu->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/24 * einsum('xyzw,Ixau,Jvsa,zwsuyv->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixau,Jvsa,zwsuvy->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixau,Jvsa,zwsvyu->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Ixau,Jvsa,zwsvuy->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Ixab,Juab,yuwz->IJ', v_aaaa, t1_xaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Ixab,Juba,yuwz->IJ', v_aaaa, t1_xaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('xyzw,Iuxy,Jz,uw->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuxy,Jw,uz->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Iuxy,Juvs,zwvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('xyzw,Iuxy,Jvzw,uv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 += einsum('xyzw,Iuxy,Jvzs,wvus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuxy,Jvwz,uv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuxy,Jvws,zvus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuxy,Jvsz,wvus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuxy,Jvsw,zvsu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Iuxv,Jyvs,zwus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Iuxv,Jysv,zwsu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Iuxv,Jyst,ustzwv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Iuxv,Jyst,ustzvw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Iuxv,Jyst,ustwzv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Iuxv,Jyst,ustwvz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/12 * einsum('xyzw,Iuxv,Jyst,ustvzw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Iuxv,Jyst,ustvwz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += einsum('xyzw,Iuxv,Jz,yuwv->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuxv,Jw,yuzv->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Iuxv,Just,ystzwv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Iuxv,Just,ystzvw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/24 * einsum('xyzw,Iuxv,Just,ystwzv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Iuxv,Just,ystwvz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Iuxv,Just,ystvzw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Iuxv,Just,ystvwz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/4 * einsum('xyzw,Iuxv,Jv,yuwz->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('xyzw,Iuxv,Jszw,yusv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('xyzw,Iuxv,Jszv,yuws->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('xyzw,Iuxv,Jszt,yutwvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuxv,Jswz,yusv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuxv,Jswv,yuzs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuxv,Jswt,yutzvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuxv,Jsvz,yuws->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuxv,Jsvw,yusz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuxv,Jsvt,yutzws->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuxv,Jsvt,yutzsw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 5/24 * einsum('xyzw,Iuxv,Jsvt,yutwzs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuxv,Jsvt,yutwsz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuxv,Jsvt,yutszw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuxv,Jsvt,yutswz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuxv,Jstz,yutwvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/6 * einsum('xyzw,Iuxv,Jstw,yutzvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/6 * einsum('xyzw,Iuxv,Jstw,yutzsv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/6 * einsum('xyzw,Iuxv,Jstw,yutvzs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/6 * einsum('xyzw,Iuxv,Jstw,yutvsz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/6 * einsum('xyzw,Iuxv,Jstw,yutszv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/3 * einsum('xyzw,Iuxv,Jstw,yutsvz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuxv,Jstv,yutzws->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuxv,Jstv,yutzsw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuxv,Jstv,yutwzs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 5/24 * einsum('xyzw,Iuxv,Jstv,yutwsz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuxv,Jstv,yutszw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuxv,Jstv,yutswz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Iuxa,Jyav,zwuv->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Iuxa,Jyva,zwvu->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/4 * einsum('xyzw,Iuxa,Ja,yuwz->IJ', v_aaaa, t1_xaae, t1_xe, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('xyzw,Iuxa,Jvza,yuwv->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuxa,Jvwa,yuzv->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuxa,Jvaz,yuwv->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuxa,Jvaw,yuvz->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuxa,Jvas,yuszwv->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuxa,Jvas,yuszvw->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 5/24 * einsum('xyzw,Iuxa,Jvas,yuswzv->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuxa,Jvas,yuswvz->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuxa,Jvas,yusvzw->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuxa,Jvas,yusvwz->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuxa,Jvsa,yuszwv->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuxa,Jvsa,yuszvw->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuxa,Jvsa,yuswzv->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 5/24 * einsum('xyzw,Iuxa,Jvsa,yuswvz->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuxa,Jvsa,yusvzw->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuxa,Jvsa,yusvwz->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuvx,Jyvs,zwus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Iuvx,Jysv,zwus->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Iuvx,Jyst,ustzwv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/12 * einsum('xyzw,Iuvx,Jyst,ustzvw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Iuvx,Jyst,ustwzv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Iuvx,Jyst,ustwvz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Iuvx,Jyst,ustvzw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Iuvx,Jyst,ustvwz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuvx,Jz,yuwv->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuvx,Jw,yuvz->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Iuvx,Just,ystzwv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Iuvx,Just,ystzvw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Iuvx,Just,ystwzv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/24 * einsum('xyzw,Iuvx,Just,ystwvz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Iuvx,Just,ystvzw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Iuvx,Just,ystvwz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('xyzw,Iuvx,Jv,yuwz->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuvx,Jszw,yusv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuvx,Jszv,yuws->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuvx,Jszt,yutwvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuvx,Jswz,yuvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuvx,Jswv,yusz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/6 * einsum('xyzw,Iuvx,Jswt,yutzvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/6 * einsum('xyzw,Iuvx,Jswt,yutzsv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/3 * einsum('xyzw,Iuvx,Jswt,yutvzs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/6 * einsum('xyzw,Iuvx,Jswt,yutvsz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/6 * einsum('xyzw,Iuvx,Jswt,yutszv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/6 * einsum('xyzw,Iuvx,Jswt,yutsvz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += einsum('xyzw,Iuvx,Jsvz,yuws->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('xyzw,Iuvx,Jsvw,yusz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Iuvx,Jsvt,yutzws->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Iuvx,Jsvt,yutzsw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/12 * einsum('xyzw,Iuvx,Jsvt,yutwzs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Iuvx,Jsvt,yutwsz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Iuvx,Jsvt,yutszw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Iuvx,Jsvt,yutswz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/6 * einsum('xyzw,Iuvx,Jstz,yutwvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/3 * einsum('xyzw,Iuvx,Jstz,yutwsv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/6 * einsum('xyzw,Iuvx,Jstz,yutvws->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/6 * einsum('xyzw,Iuvx,Jstz,yutvsw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/6 * einsum('xyzw,Iuvx,Jstz,yutswv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/6 * einsum('xyzw,Iuvx,Jstz,yutsvw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuvx,Jstw,yutszv->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuvx,Jstv,yutzws->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuvx,Jstv,yutzsw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 5/24 * einsum('xyzw,Iuvx,Jstv,yutwzs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuvx,Jstv,yutwsz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuvx,Jstv,yutszw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuvx,Jstv,yutswz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuax,Jyav,zwuv->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Iuax,Jyva,zwuv->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('xyzw,Iuax,Ja,yuwz->IJ', v_aaaa, t1_xaea, t1_xe, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuax,Jvza,yuwv->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iuax,Jvwa,yuvz->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('xyzw,Iuax,Jvaz,yuwv->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 += einsum('xyzw,Iuax,Jvaw,yuvz->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Iuax,Jvas,yuszwv->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Iuax,Jvas,yuszvw->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/12 * einsum('xyzw,Iuax,Jvas,yuswzv->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Iuax,Jvas,yuswvz->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Iuax,Jvas,yusvzw->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Iuax,Jvas,yusvwz->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuax,Jvsa,yuszwv->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuax,Jvsa,yuszvw->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 5/24 * einsum('xyzw,Iuax,Jvsa,yuswzv->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuax,Jvsa,yuswvz->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuax,Jvsa,yusvzw->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Iuax,Jvsa,yusvwz->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= einsum('xyzw,Iixy,Jizu,uw->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('xyzw,Iixy,Jiwu,uz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('xyzw,Iixy,Jiuz,uw->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('xyzw,Iixy,Jiuw,uz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Iixy,Jiuv,zwuv->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= einsum('xyzw,Iixu,Jizw,yu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 2 * einsum('xyzw,Iixu,Jizu,yw->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('xyzw,Iixu,Jizv,yvwu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('xyzw,Iixu,Jiwz,yu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('xyzw,Iixu,Jiwu,yz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('xyzw,Iixu,Jiwv,yvzu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= einsum('xyzw,Iixu,Jiuz,yw->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('xyzw,Iixu,Jiuw,yz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Iixu,Jiuv,yvwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('xyzw,Iixu,Jivz,yvwu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('xyzw,Iixu,Jivw,yvuz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iixu,Jivu,yvwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Iixu,Jivs,yvszwu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Iixu,Jivs,yvszuw->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/24 * einsum('xyzw,Iixu,Jivs,yvswzu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Iixu,Jivs,yvswuz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Iixu,Jivs,yvsuzw->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Iixu,Jivs,yvsuwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('xyzw,Iiux,Jizw,yu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('xyzw,Iiux,Jizu,yw->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('xyzw,Iiux,Jizv,yvwu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= einsum('xyzw,Iiux,Jiwz,yu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('xyzw,Iiux,Jiwu,yz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('xyzw,Iiux,Jiwv,yvuz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 2 * einsum('xyzw,Iiux,Jiuz,yw->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('xyzw,Iiux,Jiuw,yz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iiux,Jiuv,yvwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= einsum('xyzw,Iiux,Jivz,yvwu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('xyzw,Iiux,Jivw,yvzu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Iiux,Jivu,yvwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Iiux,Jivs,yvszwu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Iiux,Jivs,yvszuw->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Iiux,Jivs,yvswzu->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/24 * einsum('xyzw,Iiux,Jivs,yvswuz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Iiux,Jivs,yvsuzw->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Iiux,Jivs,yvsuwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 2 * einsum('xyzw,Iiax,Jiaz,yw->IJ', v_aaaa, t1_xcea, t1_xcea, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('xyzw,Iiax,Jiaw,yz->IJ', v_aaaa, t1_xcea, t1_xcea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Iiax,Jiau,yuwz->IJ', v_aaaa, t1_xcea, t1_xcea, rdm_ccaa, optimize = einsum_type)
        M_00 -= einsum('xyzw,Iiax,iJaz,yw->IJ', v_aaaa, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('xyzw,Iiax,iJaw,yz->IJ', v_aaaa, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Iiax,iJau,yuwz->IJ', v_aaaa, t1_xcea, t1_cxea, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Jxuv,Iu,yvwz->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Jxuv,Iv,yuwz->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Jxuv,Isuv,yswz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Jxuv,Isut,yvszwt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Jxuv,Isut,yvsztw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 5/12 * einsum('xyzw,Jxuv,Isut,yvswzt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Jxuv,Isut,yvswtz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Jxuv,Isut,yvstzw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Jxuv,Isut,yvstwz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Jxuv,Isvu,yswz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxuv,Isvt,yuszwt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxuv,Isvt,yusztw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/24 * einsum('xyzw,Jxuv,Isvt,yuswzt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxuv,Isvt,yuswtz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxuv,Isvt,yustzw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxuv,Isvt,yustwz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxuv,Istu,yvszwt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxuv,Istu,yvsztw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/24 * einsum('xyzw,Jxuv,Istu,yvswzt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxuv,Istu,yvswtz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxuv,Istu,yvstzw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxuv,Istu,yvstwz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxuv,Istv,yuszwt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxuv,Istv,yusztw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxuv,Istv,yuswzt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/24 * einsum('xyzw,Jxuv,Istv,yuswtz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxuv,Istv,yustzw->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxuv,Istv,yustwz->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Jxua,Ia,yuwz->IJ', v_aaaa, t1_xaae, t1_xe, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Jxua,Ivua,yvwz->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Jxua,Ivau,yvwz->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxua,Ivas,yuvzws->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxua,Ivas,yuvzsw->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/24 * einsum('xyzw,Jxua,Ivas,yuvwzs->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxua,Ivas,yuvwsz->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxua,Ivas,yuvszw->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxua,Ivas,yuvswz->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxua,Ivsa,yuvzws->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxua,Ivsa,yuvzsw->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxua,Ivsa,yuvwzs->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/24 * einsum('xyzw,Jxua,Ivsa,yuvwsz->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxua,Ivsa,yuvszw->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxua,Ivsa,yuvswz->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Jxau,Ia,yuwz->IJ', v_aaaa, t1_xaea, t1_xe, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Jxau,Ivau,yvwz->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Jxau,Ivas,yuvzws->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Jxau,Ivas,yuvzsw->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 5/12 * einsum('xyzw,Jxau,Ivas,yuvwzs->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Jxau,Ivas,yuvwsz->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Jxau,Ivas,yuvszw->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/12 * einsum('xyzw,Jxau,Ivas,yuvswz->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Jxau,Ivua,yvwz->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxau,Ivsa,yuvzws->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxau,Ivsa,yuvzsw->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/24 * einsum('xyzw,Jxau,Ivsa,yuvwzs->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxau,Ivsa,yuvwsz->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxau,Ivsa,yuvszw->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jxau,Ivsa,yuvswz->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Jxab,Iuab,yuwz->IJ', v_aaaa, t1_xaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Jxab,Iuba,yuwz->IJ', v_aaaa, t1_xaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Juxy,Iuvs,zwvs->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Juxv,Iust,zwvyst->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Juxv,Iust,zwvyts->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/24 * einsum('xyzw,Juxv,Iust,zwvsyt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Juxv,Iust,zwvsty->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Juxv,Iust,zwvtys->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Juxv,Iust,zwvtsy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/4 * einsum('xyzw,Juxv,Iv,yuwz->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juxv,Isvt,zwsyut->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juxv,Isvt,zwsytu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 5/24 * einsum('xyzw,Juxv,Isvt,zwsuyt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juxv,Isvt,zwsuty->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juxv,Isvt,zwstyu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juxv,Isvt,zwstuy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juxv,Istv,zwsyut->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juxv,Istv,zwsytu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juxv,Istv,zwsuyt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juxv,Istv,zwsuty->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 5/24 * einsum('xyzw,Juxv,Istv,zwstyu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juxv,Istv,zwstuy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/4 * einsum('xyzw,Juxa,Ia,yuwz->IJ', v_aaaa, t1_xaae, t1_xe, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juxa,Ivas,zwvyus->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juxa,Ivas,zwvysu->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 5/24 * einsum('xyzw,Juxa,Ivas,zwvuys->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juxa,Ivas,zwvusy->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juxa,Ivas,zwvsyu->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juxa,Ivas,zwvsuy->IJ', v_aaaa, t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juxa,Ivsa,zwvyus->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juxa,Ivsa,zwvysu->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juxa,Ivsa,zwvuys->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juxa,Ivsa,zwvusy->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 5/24 * einsum('xyzw,Juxa,Ivsa,zwvsyu->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juxa,Ivsa,zwvsuy->IJ', v_aaaa, t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Juvx,Iust,zwvyst->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Juvx,Iust,zwvyts->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Juvx,Iust,zwvsyt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Juvx,Iust,zwvsty->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/24 * einsum('xyzw,Juvx,Iust,zwvtys->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Juvx,Iust,zwvtsy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('xyzw,Juvx,Iv,yuwz->IJ', v_aaaa, t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Juvx,Isvt,zwsyut->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Juvx,Isvt,zwsytu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/12 * einsum('xyzw,Juvx,Isvt,zwsuyt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Juvx,Isvt,zwsuty->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Juvx,Isvt,zwstyu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Juvx,Isvt,zwstuy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juvx,Istv,zwsyut->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juvx,Istv,zwsytu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 5/24 * einsum('xyzw,Juvx,Istv,zwsuyt->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juvx,Istv,zwsuty->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juvx,Istv,zwstyu->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juvx,Istv,zwstuy->IJ', v_aaaa, t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/2 * einsum('xyzw,Juax,Ia,yuwz->IJ', v_aaaa, t1_xaea, t1_xe, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Juax,Ivas,zwvyus->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Juax,Ivas,zwvysu->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/12 * einsum('xyzw,Juax,Ivas,zwvuys->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Juax,Ivas,zwvusy->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Juax,Ivas,zwvsyu->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/12 * einsum('xyzw,Juax,Ivas,zwvsuy->IJ', v_aaaa, t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juax,Ivsa,zwvyus->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juax,Ivsa,zwvysu->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 5/24 * einsum('xyzw,Juax,Ivsa,zwvuys->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juax,Ivsa,zwvusy->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juax,Ivsa,zwvsyu->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/24 * einsum('xyzw,Juax,Ivsa,zwvsuy->IJ', v_aaaa, t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Jixy,Iiuv,zwuv->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Jixu,Iiuv,yvwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Jixu,Iivu,yvwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jixu,Iivs,zwuyvs->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jixu,Iivs,zwuysv->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/24 * einsum('xyzw,Jixu,Iivs,zwuvys->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jixu,Iivs,zwuvsy->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jixu,Iivs,zwusyv->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jixu,Iivs,zwusvy->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Jiux,Iiuv,yvwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Jiux,Iivu,yvwz->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jiux,Iivs,zwuyvs->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jiux,Iivs,zwuysv->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jiux,Iivs,zwuvys->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jiux,Iivs,zwuvsy->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 += 5/24 * einsum('xyzw,Jiux,Iivs,zwusyv->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/24 * einsum('xyzw,Jiux,Iivs,zwusvy->IJ', v_aaaa, t1_xcaa, t1_xcaa, rdm_cccaaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,Jiax,Iiau,yuwz->IJ', v_aaaa, t1_xcea, t1_xcea, rdm_ccaa, optimize = einsum_type)
        M_00 -= einsum('xyzw,Jiax,iIaz,wy->IJ', v_aaaa, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 += 1/2 * einsum('xyzw,Jiax,iIaw,zy->IJ', v_aaaa, t1_xcea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,Jiax,iIau,yuwz->IJ', v_aaaa, t1_xcea, t1_cxea, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,iIax,Jiau,yuwz->IJ', v_aaaa, t1_cxea, t1_xcea, rdm_ccaa, optimize = einsum_type)
        M_00 += 2 * einsum('xyzw,iIax,iJaz,yw->IJ', v_aaaa, t1_cxea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 -= einsum('xyzw,iIax,iJaw,yz->IJ', v_aaaa, t1_cxea, t1_cxea, rdm_ca, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,iIax,iJau,yuwz->IJ', v_aaaa, t1_cxea, t1_cxea, rdm_ccaa, optimize = einsum_type)
        M_00 += 1/4 * einsum('xyzw,iJax,Iiau,yuwz->IJ', v_aaaa, t1_cxea, t1_xcea, rdm_ccaa, optimize = einsum_type)
        M_00 -= 1/2 * einsum('xyzw,iJax,iIau,yuwz->IJ', v_aaaa, t1_cxea, t1_cxea, rdm_ccaa, optimize = einsum_type)

    mr_adc.M_00 = M_00.copy()

    print("Time for computing M(h0-h0) block:                 %f sec\n" % (time.time() - start_time))
    sys.stdout.flush()

def compute_M_01(mr_adc):

    start_time = time.time()

    print ("Computing M(h0-h1) blocks...")
    sys.stdout.flush()

    # Einsum definition from kernel
    einsum = mr_adc.interface.einsum
    einsum_type = mr_adc.interface.einsum_type

    # Variables from kernel
    ncvs = mr_adc.ncvs
    nval = mr_adc.nval

    ## Molecular Orbitals Energies
    e_cvs = mr_adc.mo_energy.x
    e_extern = mr_adc.mo_energy.e

    if nval > 0:
        e_val = mr_adc.mo_energy.v

    ## One-electron integrals
    h_aa = mr_adc.h1eff.aa
    h_ae = mr_adc.h1eff.ae

    h_xa = mr_adc.h1eff.xa
    h_xe = mr_adc.h1eff.xe

    if nval > 0:
        h_va = mr_adc.h1eff.va
        h_ve = mr_adc.h1eff.ve

    ## Two-electron integrals
    v_aaaa = mr_adc.v2e.aaaa

    v_aaae = mr_adc.v2e.aaae

    v_xaaa = mr_adc.v2e.xaaa
    v_xaae = mr_adc.v2e.xaae
    v_xaea = mr_adc.v2e.xaea
    v_xaxa = mr_adc.v2e.xaxa
    v_xaax = mr_adc.v2e.xaax

    v_xaxe = mr_adc.v2e.xaxe
    v_xaex = mr_adc.v2e.xaex
    v_xxxa = mr_adc.v2e.xxxa
    v_xxxe = mr_adc.v2e.xxxe

    if nval > 0:
        v_vaaa = mr_adc.v2e.vaaa
        v_vaae = mr_adc.v2e.vaae
        v_vaea = mr_adc.v2e.vaea

        v_vxxa = mr_adc.v2e.vxxa
        v_xvxa = mr_adc.v2e.xvxa

        v_vxxe = mr_adc.v2e.vxxe
        v_xvxe = mr_adc.v2e.xvxe

    ## Amplitudes
    t1_ae   = mr_adc.t1.ae
    t1_aaae = mr_adc.t1.aaae

    t1_xe   = mr_adc.t1.xe
    t1_xaea = mr_adc.t1.xaea
    t1_xaae = mr_adc.t1.xaae
    t1_xa   = mr_adc.t1.xa
    t1_xaaa = mr_adc.t1.xaaa

    if nval > 0:
        t1_ve   = mr_adc.t1.ve
        t1_vaea = mr_adc.t1.vaea
        t1_vaae = mr_adc.t1.vaae
        t1_va   = mr_adc.t1.va
        t1_vaaa = mr_adc.t1.vaaa

    ## Reduced density matrices
    rdm_ca = mr_adc.rdm.ca
    rdm_ccaa = mr_adc.rdm.ccaa
    rdm_cccaaa = mr_adc.rdm.cccaaa

    ## Excitation Manifolds
    n_caa = mr_adc.h1.n_caa
    n_cce = mr_adc.h1.n_cce
    n_cce_tril = mr_adc.h1.n_cce_tril
    n_cae = mr_adc.h1.n_cae
    n_cca = mr_adc.h1.n_cca
    n_cca_tril = mr_adc.h1.n_cca_tril

    dim_caa = mr_adc.h1.dim_caa
    dim_cce = mr_adc.h1.dim_cce
    dim_cae = mr_adc.h1.dim_cae
    dim_cca = mr_adc.h1.dim_cca

    if nval > 0:
        n_cve = mr_adc.h1.n_cve
        n_cva = mr_adc.h1.n_cva

        dim_cve = mr_adc.h1.dim_cve
        dim_cva = mr_adc.h1.dim_cva

    ## Indices
    cvs_tril_ind = np.tril_indices(ncvs, k=-1)

    # Compute M_01 Matrices
    # C-CAA Block
    ## Oth-order
    M_c_caa__a_aaa  = 1/2 * einsum('J,IJ,WZ->IJWZ', e_cvs, np.identity(ncvs), rdm_ca, optimize = einsum_type)
    M_c_caa__a_aaa += 1/2 * einsum('Wx,IJ,xZ->IJWZ', h_aa, np.identity(ncvs), rdm_ca, optimize = einsum_type)
    M_c_caa__a_aaa -= 1/2 * einsum('Zx,IJ,Wx->IJWZ', h_aa, np.identity(ncvs), rdm_ca, optimize = einsum_type)
    M_c_caa__a_aaa += 1/2 * einsum('IJ,Wxyz,Zxyz->IJWZ', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    M_c_caa__a_aaa -= 1/2 * einsum('IJ,Zxyz,Wxyz->IJWZ', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)

    M_c_caa__a_abb  = 1/2 * einsum('J,IJ,WZ->IJWZ', e_cvs, np.identity(ncvs), rdm_ca, optimize = einsum_type)
    M_c_caa__a_abb += 1/2 * einsum('Wx,IJ,xZ->IJWZ', h_aa, np.identity(ncvs), rdm_ca, optimize = einsum_type)
    M_c_caa__a_abb -= 1/2 * einsum('Zx,IJ,Wx->IJWZ', h_aa, np.identity(ncvs), rdm_ca, optimize = einsum_type)
    M_c_caa__a_abb += 1/2 * einsum('IJ,Wxyz,Zxyz->IJWZ', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    M_c_caa__a_abb -= 1/2 * einsum('IJ,Zxyz,Wxyz->IJWZ', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)

    ## 1st-order
    M_c_caa__a_aaa += 1/2 * einsum('IZJx,Wx->IJWZ', v_xaxa, rdm_ca, optimize = einsum_type)
    M_c_caa__a_aaa -= 1/2 * einsum('IZxJ,Wx->IJWZ', v_xaax, rdm_ca, optimize = einsum_type)
    M_c_caa__a_aaa += 1/2 * einsum('IxJy,WxZy->IJWZ', v_xaxa, rdm_ccaa, optimize = einsum_type)
    M_c_caa__a_aaa -= 1/6 * einsum('IxyJ,WxZy->IJWZ', v_xaax, rdm_ccaa, optimize = einsum_type)
    M_c_caa__a_aaa += 1/6 * einsum('IxyJ,WxyZ->IJWZ', v_xaax, rdm_ccaa, optimize = einsum_type)
    M_c_caa__a_aaa -= 1/2 * einsum('IxJy,yx,WZ->IJWZ', v_xaxa, rdm_ca, rdm_ca, optimize = einsum_type)
    M_c_caa__a_aaa += 1/4 * einsum('IxyJ,yx,WZ->IJWZ', v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)

    M_c_caa__a_abb += 1/2 * einsum('IZJx,Wx->IJWZ', v_xaxa, rdm_ca, optimize = einsum_type)
    M_c_caa__a_abb += 1/2 * einsum('IxJy,WxZy->IJWZ', v_xaxa, rdm_ccaa, optimize = einsum_type)
    M_c_caa__a_abb -= 1/3 * einsum('IxyJ,WxZy->IJWZ', v_xaax, rdm_ccaa, optimize = einsum_type)
    M_c_caa__a_abb -= 1/6 * einsum('IxyJ,WxyZ->IJWZ', v_xaax, rdm_ccaa, optimize = einsum_type)
    M_c_caa__a_abb -= 1/2 * einsum('IxJy,yx,WZ->IJWZ', v_xaxa, rdm_ca, rdm_ca, optimize = einsum_type)
    M_c_caa__a_abb += 1/4 * einsum('IxyJ,yx,WZ->IJWZ', v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)

    M_c_caa__a_bab =- 1/2 * einsum('IZxJ,Wx->IJWZ', v_xaax, rdm_ca, optimize = einsum_type)
    M_c_caa__a_bab += 1/6 * einsum('IxyJ,WxZy->IJWZ', v_xaax, rdm_ccaa, optimize = einsum_type)
    M_c_caa__a_bab += 1/3 * einsum('IxyJ,WxyZ->IJWZ', v_xaax, rdm_ccaa, optimize = einsum_type)

    M_c_caa__a_aaa = M_c_caa__a_aaa.reshape(ncvs, -1)
    M_c_caa__a_abb = M_c_caa__a_abb.reshape(ncvs, -1)
    M_c_caa__a_bab = M_c_caa__a_bab.reshape(ncvs, -1)

    ## Building C-CAA matrix
    s_aaa = 0
    f_aaa = s_aaa + n_caa
    s_abb = f_aaa
    f_abb = s_abb + n_caa
    s_bab = f_abb
    f_bab = s_bab + n_caa

    M_c_caa = np.zeros((ncvs, dim_caa))
    M_c_caa[:, s_aaa:f_aaa] = M_c_caa__a_aaa.copy()
    M_c_caa[:, s_abb:f_abb] = M_c_caa__a_abb.copy()
    M_c_caa[:, s_bab:f_bab] = M_c_caa__a_bab.copy()

    mr_adc.M_01.c_caa = M_c_caa

    # C-CCE Block
    M_c_cce__a_abb  = einsum('KLIB->IKLB', v_xxxe, optimize = einsum_type).copy()
    M_c_cce__a_abb -= einsum('LB,IK->IKLB', h_xe, np.identity(ncvs), optimize = einsum_type)
    M_c_cce__a_abb -= einsum('B,IK,LB->IKLB', e_extern, np.identity(ncvs), t1_xe, optimize = einsum_type)
    M_c_cce__a_abb += einsum('L,IK,LB->IKLB', e_cvs, np.identity(ncvs), t1_xe, optimize = einsum_type)
    M_c_cce__a_abb -= einsum('IK,LxBy,yx->IKLB', np.identity(ncvs), v_xaea, rdm_ca, optimize = einsum_type)
    M_c_cce__a_abb += 1/2 * einsum('IK,LxyB,yx->IKLB', np.identity(ncvs), v_xaae, rdm_ca, optimize = einsum_type)
    M_c_cce__a_abb -= einsum('B,IK,LxBy,yx->IKLB', e_extern, np.identity(ncvs), t1_xaea, rdm_ca, optimize = einsum_type)
    M_c_cce__a_abb += 1/2 * einsum('B,IK,LxyB,yx->IKLB', e_extern, np.identity(ncvs), t1_xaae, rdm_ca, optimize = einsum_type)
    M_c_cce__a_abb += einsum('L,IK,LxBy,yx->IKLB', e_cvs, np.identity(ncvs), t1_xaea, rdm_ca, optimize = einsum_type)
    M_c_cce__a_abb -= 1/2 * einsum('L,IK,LxyB,yx->IKLB', e_cvs, np.identity(ncvs), t1_xaae, rdm_ca, optimize = einsum_type)
    M_c_cce__a_abb += einsum('xy,IK,LxBz,zy->IKLB', h_aa, np.identity(ncvs), t1_xaea, rdm_ca, optimize = einsum_type)
    M_c_cce__a_abb -= 1/2 * einsum('xy,IK,LxzB,zy->IKLB', h_aa, np.identity(ncvs), t1_xaae, rdm_ca, optimize = einsum_type)
    M_c_cce__a_abb -= einsum('xy,IK,LzBx,yz->IKLB', h_aa, np.identity(ncvs), t1_xaea, rdm_ca, optimize = einsum_type)
    M_c_cce__a_abb += 1/2 * einsum('xy,IK,LzxB,yz->IKLB', h_aa, np.identity(ncvs), t1_xaae, rdm_ca, optimize = einsum_type)
    M_c_cce__a_abb += einsum('IK,LxBy,xzwu,yzwu->IKLB', np.identity(ncvs), t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cce__a_abb -= einsum('IK,LxBy,yzwu,xzwu->IKLB', np.identity(ncvs), t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cce__a_abb -= 1/2 * einsum('IK,LxyB,xzwu,yzwu->IKLB', np.identity(ncvs), t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cce__a_abb += 1/2 * einsum('IK,LxyB,yzwu,xzwu->IKLB', np.identity(ncvs), t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)

    M_c_cce__a_aaa = M_c_cce__a_abb - M_c_cce__a_abb.transpose(0,2,1,3)

    ## Reshape tensors to matrix form
    M_c_cce__a_aaa = M_c_cce__a_aaa[:, cvs_tril_ind[0], cvs_tril_ind[1]]

    M_c_cce__a_aaa = M_c_cce__a_aaa.reshape(ncvs, -1)
    M_c_cce__a_abb = M_c_cce__a_abb.reshape(ncvs, -1)

    ## Building C-CCE matrix
    s_aaa = 0
    f_aaa = s_aaa + n_cce_tril
    s_abb = f_aaa
    f_abb = s_abb + n_cce

    M_c_cce = np.zeros((ncvs, dim_cce))
    M_c_cce[:, s_aaa:f_aaa] = M_c_cce__a_aaa.copy()
    M_c_cce[:, s_abb:f_abb] = M_c_cce__a_abb.copy()

    mr_adc.M_01.c_cce = M_c_cce

    if nval > 0:
        # C-CVE Block
        M_c_cve__a_abb  = einsum('KLIB->IKLB', v_xvxe, optimize = einsum_type).copy()
        M_c_cve__a_abb -= einsum('LB,IK->IKLB', h_ve, np.identity(ncvs), optimize = einsum_type)
        M_c_cve__a_abb -= einsum('B,IK,LB->IKLB', e_extern, np.identity(ncvs), t1_ve, optimize = einsum_type)
        M_c_cve__a_abb += einsum('L,IK,LB->IKLB', e_val, np.identity(ncvs), t1_ve, optimize = einsum_type)
        M_c_cve__a_abb -= einsum('IK,LxBy,yx->IKLB', np.identity(ncvs), v_vaea, rdm_ca, optimize = einsum_type)
        M_c_cve__a_abb += 1/2 * einsum('IK,LxyB,yx->IKLB', np.identity(ncvs), v_vaae, rdm_ca, optimize = einsum_type)
        M_c_cve__a_abb -= einsum('B,IK,LxBy,yx->IKLB', e_extern, np.identity(ncvs), t1_vaea, rdm_ca, optimize = einsum_type)
        M_c_cve__a_abb += 1/2 * einsum('B,IK,LxyB,yx->IKLB', e_extern, np.identity(ncvs), t1_vaae, rdm_ca, optimize = einsum_type)
        M_c_cve__a_abb += einsum('L,IK,LxBy,yx->IKLB', e_val, np.identity(ncvs), t1_vaea, rdm_ca, optimize = einsum_type)
        M_c_cve__a_abb -= 1/2 * einsum('L,IK,LxyB,yx->IKLB', e_val, np.identity(ncvs), t1_vaae, rdm_ca, optimize = einsum_type)
        M_c_cve__a_abb += einsum('xy,IK,LxBz,zy->IKLB', h_aa, np.identity(ncvs), t1_vaea, rdm_ca, optimize = einsum_type)
        M_c_cve__a_abb -= 1/2 * einsum('xy,IK,LxzB,zy->IKLB', h_aa, np.identity(ncvs), t1_vaae, rdm_ca, optimize = einsum_type)
        M_c_cve__a_abb -= einsum('xy,IK,LzBx,yz->IKLB', h_aa, np.identity(ncvs), t1_vaea, rdm_ca, optimize = einsum_type)
        M_c_cve__a_abb += 1/2 * einsum('xy,IK,LzxB,yz->IKLB', h_aa, np.identity(ncvs), t1_vaae, rdm_ca, optimize = einsum_type)
        M_c_cve__a_abb += einsum('IK,LxBy,xzwu,yzwu->IKLB', np.identity(ncvs), t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
        M_c_cve__a_abb -= einsum('IK,LxBy,yzwu,xzwu->IKLB', np.identity(ncvs), t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
        M_c_cve__a_abb -= 1/2 * einsum('IK,LxyB,xzwu,yzwu->IKLB', np.identity(ncvs), t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
        M_c_cve__a_abb += 1/2 * einsum('IK,LxyB,yzwu,xzwu->IKLB', np.identity(ncvs), t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)

        M_c_cve__a_bab =- einsum('LKIB->IKLB', v_vxxe, optimize = einsum_type).copy()

        M_c_cve__a_aaa = np.ascontiguousarray(M_c_cve__a_abb + M_c_cve__a_bab)

        ## Reshape tensors to matrix form
        M_c_cve__a_aaa = M_c_cve__a_aaa.reshape(ncvs, -1)
        M_c_cve__a_abb = M_c_cve__a_abb.reshape(ncvs, -1)
        M_c_cve__a_bab = M_c_cve__a_bab.reshape(ncvs, -1)

        ## Building C-CVE matrix
        s_aaa = 0
        f_aaa = s_aaa + n_cve
        s_abb = f_aaa
        f_abb = s_abb + n_cve
        s_bab = f_abb
        f_bab = s_bab + n_cve

        M_c_cve = np.zeros((ncvs, dim_cve))
        M_c_cve[:, s_aaa:f_aaa] = M_c_cve__a_aaa.copy()
        M_c_cve[:, s_abb:f_abb] = M_c_cve__a_abb.copy()
        M_c_cve[:, s_bab:f_bab] = M_c_cve__a_bab.copy()

        mr_adc.M_01.c_cve = M_c_cve

    # C-CAE Block
    M_c_cae__a_aaa =- 1/2 * einsum('KxBI,Yx->IKYB', v_xaex, rdm_ca, optimize = einsum_type)
    M_c_cae__a_aaa += 1/2 * einsum('KxIB,Yx->IKYB', v_xaxe, rdm_ca, optimize = einsum_type)
    M_c_cae__a_aaa -= 1/2 * einsum('xB,IK,Yx->IKYB', h_ae, np.identity(ncvs), rdm_ca, optimize = einsum_type)
    M_c_cae__a_aaa -= 1/2 * einsum('IK,xyzB,Yzyx->IKYB', np.identity(ncvs), v_aaae, rdm_ccaa, optimize = einsum_type)
    M_c_cae__a_aaa -= 1/2 * einsum('B,IK,xB,Yx->IKYB', e_extern, np.identity(ncvs), t1_ae, rdm_ca, optimize = einsum_type)
    M_c_cae__a_aaa -= 1/2 * einsum('B,IK,xyzB,Yzyx->IKYB', e_extern, np.identity(ncvs), t1_aaae, rdm_ccaa, optimize = einsum_type)
    M_c_cae__a_aaa += 1/2 * einsum('xy,IK,xB,Yy->IKYB', h_aa, np.identity(ncvs), t1_ae, rdm_ca, optimize = einsum_type)
    M_c_cae__a_aaa -= 1/2 * einsum('xy,IK,zwxB,Yywz->IKYB', h_aa, np.identity(ncvs), t1_aaae, rdm_ccaa, optimize = einsum_type)
    M_c_cae__a_aaa += 1/2 * einsum('xy,IK,xzwB,Ywzy->IKYB', h_aa, np.identity(ncvs), t1_aaae, rdm_ccaa, optimize = einsum_type)
    M_c_cae__a_aaa += 1/2 * einsum('xy,IK,zxwB,Ywyz->IKYB', h_aa, np.identity(ncvs), t1_aaae, rdm_ccaa, optimize = einsum_type)
    M_c_cae__a_aaa += 1/2 * einsum('IK,xB,xyzw,Yyzw->IKYB', np.identity(ncvs), t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cae__a_aaa += 1/12 * einsum('IK,xyzB,zwuv,Yuvxyw->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_aaa += 1/12 * einsum('IK,xyzB,zwuv,Yuvxwy->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_aaa -= 5/12 * einsum('IK,xyzB,zwuv,Yuvyxw->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_aaa += 1/12 * einsum('IK,xyzB,zwuv,Yuvywx->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_aaa += 1/12 * einsum('IK,xyzB,zwuv,Yuvwxy->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_aaa += 1/12 * einsum('IK,xyzB,zwuv,Yuvwyx->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_aaa += 1/2 * einsum('IK,xyzB,xywu,Yzuw->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cae__a_aaa += 5/12 * einsum('IK,xyzB,xwuv,Yzwyuv->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_aaa -= 1/12 * einsum('IK,xyzB,xwuv,Yzwyvu->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_aaa -= 1/12 * einsum('IK,xyzB,xwuv,Yzwuyv->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_aaa -= 1/12 * einsum('IK,xyzB,xwuv,Yzwuvy->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_aaa -= 1/12 * einsum('IK,xyzB,xwuv,Yzwvyu->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_aaa -= 1/12 * einsum('IK,xyzB,xwuv,Yzwvuy->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_aaa -= 1/12 * einsum('IK,xyzB,ywuv,Yzwxuv->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_aaa -= 1/12 * einsum('IK,xyzB,ywuv,Yzwxvu->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_aaa += 5/12 * einsum('IK,xyzB,ywuv,Yzwuxv->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_aaa -= 1/12 * einsum('IK,xyzB,ywuv,Yzwuvx->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_aaa -= 1/12 * einsum('IK,xyzB,ywuv,Yzwvxu->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_aaa -= 1/12 * einsum('IK,xyzB,ywuv,Yzwvux->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)

    M_c_cae__a_abb  = 1/2 * einsum('KxIB,Yx->IKYB', v_xaxe, rdm_ca, optimize = einsum_type)
    M_c_cae__a_abb -= 1/2 * einsum('xB,IK,Yx->IKYB', h_ae, np.identity(ncvs), rdm_ca, optimize = einsum_type)
    M_c_cae__a_abb -= 1/2 * einsum('IK,xyzB,Yzyx->IKYB', np.identity(ncvs), v_aaae, rdm_ccaa, optimize = einsum_type)
    M_c_cae__a_abb -= 1/2 * einsum('B,IK,xB,Yx->IKYB', e_extern, np.identity(ncvs), t1_ae, rdm_ca, optimize = einsum_type)
    M_c_cae__a_abb -= 1/2 * einsum('B,IK,xyzB,Yzyx->IKYB', e_extern, np.identity(ncvs), t1_aaae, rdm_ccaa, optimize = einsum_type)
    M_c_cae__a_abb += 1/2 * einsum('xy,IK,xB,Yy->IKYB', h_aa, np.identity(ncvs), t1_ae, rdm_ca, optimize = einsum_type)
    M_c_cae__a_abb -= 1/2 * einsum('xy,IK,zwxB,Yywz->IKYB', h_aa, np.identity(ncvs), t1_aaae, rdm_ccaa, optimize = einsum_type)
    M_c_cae__a_abb += 1/2 * einsum('xy,IK,xzwB,Ywzy->IKYB', h_aa, np.identity(ncvs), t1_aaae, rdm_ccaa, optimize = einsum_type)
    M_c_cae__a_abb += 1/2 * einsum('xy,IK,zxwB,Ywyz->IKYB', h_aa, np.identity(ncvs), t1_aaae, rdm_ccaa, optimize = einsum_type)
    M_c_cae__a_abb += 1/2 * einsum('IK,xB,xyzw,Yyzw->IKYB', np.identity(ncvs), t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cae__a_abb += 1/12 * einsum('IK,xyzB,zwuv,Yuvxyw->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_abb += 1/12 * einsum('IK,xyzB,zwuv,Yuvxwy->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_abb -= 5/12 * einsum('IK,xyzB,zwuv,Yuvyxw->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_abb += 1/12 * einsum('IK,xyzB,zwuv,Yuvywx->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_abb += 1/12 * einsum('IK,xyzB,zwuv,Yuvwxy->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_abb += 1/12 * einsum('IK,xyzB,zwuv,Yuvwyx->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_abb += 1/2 * einsum('IK,xyzB,xywu,Yzuw->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cae__a_abb += 5/12 * einsum('IK,xyzB,xwuv,Yzwyuv->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_abb -= 1/12 * einsum('IK,xyzB,xwuv,Yzwyvu->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_abb -= 1/12 * einsum('IK,xyzB,xwuv,Yzwuyv->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_abb -= 1/12 * einsum('IK,xyzB,xwuv,Yzwuvy->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_abb -= 1/12 * einsum('IK,xyzB,xwuv,Yzwvyu->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_abb -= 1/12 * einsum('IK,xyzB,xwuv,Yzwvuy->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_abb -= 1/12 * einsum('IK,xyzB,ywuv,Yzwxuv->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_abb -= 1/12 * einsum('IK,xyzB,ywuv,Yzwxvu->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_abb += 5/12 * einsum('IK,xyzB,ywuv,Yzwuxv->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_abb -= 1/12 * einsum('IK,xyzB,ywuv,Yzwuvx->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_abb -= 1/12 * einsum('IK,xyzB,ywuv,Yzwvxu->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cae__a_abb -= 1/12 * einsum('IK,xyzB,ywuv,Yzwvux->IKYB', np.identity(ncvs), t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)

    M_c_cae__a_bab = M_c_cae__a_aaa - M_c_cae__a_abb

    ## Reshape tensors to matrix form
    M_c_cae__a_aaa = M_c_cae__a_aaa.reshape(ncvs, -1)
    M_c_cae__a_abb = M_c_cae__a_abb.reshape(ncvs, -1)
    M_c_cae__a_bab = M_c_cae__a_bab.reshape(ncvs, -1)

    ## Building C-CAE matrix
    s_aaa = 0
    f_aaa = s_aaa + n_cae
    s_abb = f_aaa
    f_abb = s_abb + n_cae
    s_bab = f_abb
    f_bab = s_bab + n_cae

    M_c_cae = np.zeros((ncvs, dim_cae))
    M_c_cae[:, s_aaa:f_aaa] = M_c_cae__a_aaa.copy()
    M_c_cae[:, s_abb:f_abb] = M_c_cae__a_abb.copy()
    M_c_cae[:, s_bab:f_bab] = M_c_cae__a_bab.copy()

    mr_adc.M_01.c_cae = M_c_cae

    # C-CCA Block
    M_c_cca__a_abb  = einsum('KLIY->IKLY', v_xxxa, optimize = einsum_type).copy()
    M_c_cca__a_abb -= einsum('LY,IK->IKLY', h_xa, np.identity(ncvs), optimize = einsum_type)
    M_c_cca__a_abb -= 1/2 * einsum('KLIx,xY->IKLY', v_xxxa, rdm_ca, optimize = einsum_type)
    M_c_cca__a_abb += einsum('L,IK,LY->IKLY', e_cvs, np.identity(ncvs), t1_xa, optimize = einsum_type)
    M_c_cca__a_abb += 1/2 * einsum('Lx,IK,xY->IKLY', h_xa, np.identity(ncvs), rdm_ca, optimize = einsum_type)
    M_c_cca__a_abb -= einsum('Yx,IK,Lx->IKLY', h_aa, np.identity(ncvs), t1_xa, optimize = einsum_type)
    M_c_cca__a_abb -= einsum('IK,LxYy,yx->IKLY', np.identity(ncvs), v_xaaa, rdm_ca, optimize = einsum_type)
    M_c_cca__a_abb += 1/2 * einsum('IK,LxyY,yx->IKLY', np.identity(ncvs), v_xaaa, rdm_ca, optimize = einsum_type)
    M_c_cca__a_abb += 1/2 * einsum('IK,Lxyz,Yxyz->IKLY', np.identity(ncvs), v_xaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cca__a_abb -= 1/2 * einsum('L,IK,Lx,xY->IKLY', e_cvs, np.identity(ncvs), t1_xa, rdm_ca, optimize = einsum_type)
    M_c_cca__a_abb += einsum('L,IK,LxYy,yx->IKLY', e_cvs, np.identity(ncvs), t1_xaaa, rdm_ca, optimize = einsum_type)
    M_c_cca__a_abb -= 1/2 * einsum('L,IK,LxyY,yx->IKLY', e_cvs, np.identity(ncvs), t1_xaaa, rdm_ca, optimize = einsum_type)
    M_c_cca__a_abb -= 1/2 * einsum('L,IK,Lxyz,Yxyz->IKLY', e_cvs, np.identity(ncvs), t1_xaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cca__a_abb -= einsum('Yx,IK,Lyxz,zy->IKLY', h_aa, np.identity(ncvs), t1_xaaa, rdm_ca, optimize = einsum_type)
    M_c_cca__a_abb += 1/2 * einsum('Yx,IK,Lyzx,zy->IKLY', h_aa, np.identity(ncvs), t1_xaaa, rdm_ca, optimize = einsum_type)
    M_c_cca__a_abb += 1/2 * einsum('xy,IK,Lx,yY->IKLY', h_aa, np.identity(ncvs), t1_xa, rdm_ca, optimize = einsum_type)
    M_c_cca__a_abb += einsum('xy,IK,LxYz,zy->IKLY', h_aa, np.identity(ncvs), t1_xaaa, rdm_ca, optimize = einsum_type)
    M_c_cca__a_abb -= 1/2 * einsum('xy,IK,LxzY,zy->IKLY', h_aa, np.identity(ncvs), t1_xaaa, rdm_ca, optimize = einsum_type)
    M_c_cca__a_abb -= 1/2 * einsum('xy,IK,Lxzw,Yyzw->IKLY', h_aa, np.identity(ncvs), t1_xaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cca__a_abb -= einsum('xy,IK,LzYx,yz->IKLY', h_aa, np.identity(ncvs), t1_xaaa, rdm_ca, optimize = einsum_type)
    M_c_cca__a_abb += 1/2 * einsum('xy,IK,LzxY,yz->IKLY', h_aa, np.identity(ncvs), t1_xaaa, rdm_ca, optimize = einsum_type)
    M_c_cca__a_abb += 1/2 * einsum('xy,IK,Lzxw,Yzyw->IKLY', h_aa, np.identity(ncvs), t1_xaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cca__a_abb += 1/2 * einsum('xy,IK,Lzwx,Yzwy->IKLY', h_aa, np.identity(ncvs), t1_xaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cca__a_abb -= einsum('IK,Lx,Yyxz,yz->IKLY', np.identity(ncvs), t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
    M_c_cca__a_abb += 1/2 * einsum('IK,Lx,Yyzx,yz->IKLY', np.identity(ncvs), t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
    M_c_cca__a_abb += 1/2 * einsum('IK,Lx,xyzw,Yyzw->IKLY', np.identity(ncvs), t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cca__a_abb += einsum('IK,LxYy,xzwu,yzwu->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cca__a_abb -= einsum('IK,LxYy,yzwu,xzwu->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cca__a_abb -= 1/2 * einsum('IK,LxyY,xzwu,yzwu->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cca__a_abb += 1/2 * einsum('IK,LxyY,yzwu,xzwu->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cca__a_abb -= 1/2 * einsum('IK,Lxyz,Yxwu,yzwu->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cca__a_abb -= einsum('IK,Lxyz,Ywyz,wx->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    M_c_cca__a_abb -= einsum('IK,Lxyz,Ywyu,xuzw->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cca__a_abb += 1/2 * einsum('IK,Lxyz,Ywzy,wx->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    M_c_cca__a_abb += 1/2 * einsum('IK,Lxyz,Ywzu,xuyw->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cca__a_abb += 1/2 * einsum('IK,Lxyz,Ywuy,xuzw->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cca__a_abb += 1/2 * einsum('IK,Lxyz,Ywuz,xuwy->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cca__a_abb -= 5/12 * einsum('IK,Lxyz,xwuv,yzwYuv->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cca__a_abb += 1/12 * einsum('IK,Lxyz,xwuv,yzwYvu->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cca__a_abb += 1/12 * einsum('IK,Lxyz,xwuv,yzwuYv->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cca__a_abb += 1/12 * einsum('IK,Lxyz,xwuv,yzwuvY->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cca__a_abb += 1/12 * einsum('IK,Lxyz,xwuv,yzwvYu->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cca__a_abb += 1/12 * einsum('IK,Lxyz,xwuv,yzwvuY->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cca__a_abb += 1/2 * einsum('IK,Lxyz,yzwu,Yxwu->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    M_c_cca__a_abb -= 1/12 * einsum('IK,Lxyz,ywuv,zuvYxw->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cca__a_abb -= 1/12 * einsum('IK,Lxyz,ywuv,zuvYwx->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cca__a_abb += 5/12 * einsum('IK,Lxyz,ywuv,zuvxYw->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cca__a_abb -= 1/12 * einsum('IK,Lxyz,ywuv,zuvxwY->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cca__a_abb -= 1/12 * einsum('IK,Lxyz,ywuv,zuvwYx->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cca__a_abb -= 1/12 * einsum('IK,Lxyz,ywuv,zuvwxY->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cca__a_abb += 5/12 * einsum('IK,Lxyz,zwuv,yuvYxw->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cca__a_abb -= 1/12 * einsum('IK,Lxyz,zwuv,yuvYwx->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cca__a_abb -= 1/12 * einsum('IK,Lxyz,zwuv,yuvxYw->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cca__a_abb -= 1/12 * einsum('IK,Lxyz,zwuv,yuvxwY->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cca__a_abb -= 1/12 * einsum('IK,Lxyz,zwuv,yuvwYx->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    M_c_cca__a_abb -= 1/12 * einsum('IK,Lxyz,zwuv,yuvwxY->IKLY', np.identity(ncvs), t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)

    M_c_cca__a_aaa = M_c_cca__a_abb - M_c_cca__a_abb.transpose(0,2,1,3)

    ## Reshape tensors to matrix form
    M_c_cca__a_aaa = M_c_cca__a_aaa[:, cvs_tril_ind[0], cvs_tril_ind[1]]

    M_c_cca__a_aaa = M_c_cca__a_aaa.reshape(ncvs, -1)
    M_c_cca__a_abb = M_c_cca__a_abb.reshape(ncvs, -1)

    ## Building C-CCA matrix
    s_aaa = 0
    f_aaa = s_aaa + n_cca_tril
    s_abb = f_aaa
    f_abb = s_abb + n_cca

    M_c_cca = np.zeros((ncvs, dim_cca))
    M_c_cca[:, s_aaa:f_aaa] = M_c_cca__a_aaa.copy()
    M_c_cca[:, s_abb:f_abb] = M_c_cca__a_abb.copy()

    mr_adc.M_01.c_cca = M_c_cca

    if nval > 0:
        # C-CVA Block
        M_c_cva__a_abb  = einsum('KLIY->IKLY', v_xvxa, optimize = einsum_type).copy()
        M_c_cva__a_abb -= einsum('LY,IK->IKLY', h_va, np.identity(ncvs), optimize = einsum_type)
        M_c_cva__a_abb -= 1/2 * einsum('KLIx,xY->IKLY', v_xvxa, rdm_ca, optimize = einsum_type)
        M_c_cva__a_abb += einsum('L,IK,LY->IKLY', e_val, np.identity(ncvs), t1_va, optimize = einsum_type)
        M_c_cva__a_abb += 1/2 * einsum('Lx,IK,xY->IKLY', h_va, np.identity(ncvs), rdm_ca, optimize = einsum_type)
        M_c_cva__a_abb -= einsum('Yx,IK,Lx->IKLY', h_aa, np.identity(ncvs), t1_va, optimize = einsum_type)
        M_c_cva__a_abb -= einsum('IK,LxYy,yx->IKLY', np.identity(ncvs), v_vaaa, rdm_ca, optimize = einsum_type)
        M_c_cva__a_abb += 1/2 * einsum('IK,LxyY,yx->IKLY', np.identity(ncvs), v_vaaa, rdm_ca, optimize = einsum_type)
        M_c_cva__a_abb += 1/2 * einsum('IK,Lxyz,Yxyz->IKLY', np.identity(ncvs), v_vaaa, rdm_ccaa, optimize = einsum_type)
        M_c_cva__a_abb -= 1/2 * einsum('L,IK,Lx,xY->IKLY', e_val, np.identity(ncvs), t1_va, rdm_ca, optimize = einsum_type)
        M_c_cva__a_abb += einsum('L,IK,LxYy,yx->IKLY', e_val, np.identity(ncvs), t1_vaaa, rdm_ca, optimize = einsum_type)
        M_c_cva__a_abb -= 1/2 * einsum('L,IK,LxyY,yx->IKLY', e_val, np.identity(ncvs), t1_vaaa, rdm_ca, optimize = einsum_type)
        M_c_cva__a_abb -= 1/2 * einsum('L,IK,Lxyz,Yxyz->IKLY', e_val, np.identity(ncvs), t1_vaaa, rdm_ccaa, optimize = einsum_type)
        M_c_cva__a_abb -= einsum('Yx,IK,Lyxz,zy->IKLY', h_aa, np.identity(ncvs), t1_vaaa, rdm_ca, optimize = einsum_type)
        M_c_cva__a_abb += 1/2 * einsum('Yx,IK,Lyzx,zy->IKLY', h_aa, np.identity(ncvs), t1_vaaa, rdm_ca, optimize = einsum_type)
        M_c_cva__a_abb += 1/2 * einsum('xy,IK,Lx,yY->IKLY', h_aa, np.identity(ncvs), t1_va, rdm_ca, optimize = einsum_type)
        M_c_cva__a_abb += einsum('xy,IK,LxYz,zy->IKLY', h_aa, np.identity(ncvs), t1_vaaa, rdm_ca, optimize = einsum_type)
        M_c_cva__a_abb -= 1/2 * einsum('xy,IK,LxzY,zy->IKLY', h_aa, np.identity(ncvs), t1_vaaa, rdm_ca, optimize = einsum_type)
        M_c_cva__a_abb -= 1/2 * einsum('xy,IK,Lxzw,Yyzw->IKLY', h_aa, np.identity(ncvs), t1_vaaa, rdm_ccaa, optimize = einsum_type)
        M_c_cva__a_abb -= einsum('xy,IK,LzYx,yz->IKLY', h_aa, np.identity(ncvs), t1_vaaa, rdm_ca, optimize = einsum_type)
        M_c_cva__a_abb += 1/2 * einsum('xy,IK,LzxY,yz->IKLY', h_aa, np.identity(ncvs), t1_vaaa, rdm_ca, optimize = einsum_type)
        M_c_cva__a_abb += 1/2 * einsum('xy,IK,Lzxw,Yzyw->IKLY', h_aa, np.identity(ncvs), t1_vaaa, rdm_ccaa, optimize = einsum_type)
        M_c_cva__a_abb += 1/2 * einsum('xy,IK,Lzwx,Yzwy->IKLY', h_aa, np.identity(ncvs), t1_vaaa, rdm_ccaa, optimize = einsum_type)
        M_c_cva__a_abb -= einsum('IK,Lx,Yyxz,yz->IKLY', np.identity(ncvs), t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
        M_c_cva__a_abb += 1/2 * einsum('IK,Lx,Yyzx,yz->IKLY', np.identity(ncvs), t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
        M_c_cva__a_abb += 1/2 * einsum('IK,Lx,xyzw,Yyzw->IKLY', np.identity(ncvs), t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
        M_c_cva__a_abb += einsum('IK,LxYy,xzwu,yzwu->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        M_c_cva__a_abb -= einsum('IK,LxYy,yzwu,xzwu->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        M_c_cva__a_abb -= 1/2 * einsum('IK,LxyY,xzwu,yzwu->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        M_c_cva__a_abb += 1/2 * einsum('IK,LxyY,yzwu,xzwu->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        M_c_cva__a_abb -= 1/2 * einsum('IK,Lxyz,Yxwu,yzwu->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        M_c_cva__a_abb -= einsum('IK,Lxyz,Ywyz,wx->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        M_c_cva__a_abb -= einsum('IK,Lxyz,Ywyu,xuzw->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        M_c_cva__a_abb += 1/2 * einsum('IK,Lxyz,Ywzy,wx->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        M_c_cva__a_abb += 1/2 * einsum('IK,Lxyz,Ywzu,xuyw->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        M_c_cva__a_abb += 1/2 * einsum('IK,Lxyz,Ywuy,xuzw->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        M_c_cva__a_abb += 1/2 * einsum('IK,Lxyz,Ywuz,xuwy->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        M_c_cva__a_abb -= 5/12 * einsum('IK,Lxyz,xwuv,yzwYuv->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        M_c_cva__a_abb += 1/12 * einsum('IK,Lxyz,xwuv,yzwYvu->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        M_c_cva__a_abb += 1/12 * einsum('IK,Lxyz,xwuv,yzwuYv->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        M_c_cva__a_abb += 1/12 * einsum('IK,Lxyz,xwuv,yzwuvY->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        M_c_cva__a_abb += 1/12 * einsum('IK,Lxyz,xwuv,yzwvYu->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        M_c_cva__a_abb += 1/12 * einsum('IK,Lxyz,xwuv,yzwvuY->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        M_c_cva__a_abb += 1/2 * einsum('IK,Lxyz,yzwu,Yxwu->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        M_c_cva__a_abb -= 1/12 * einsum('IK,Lxyz,ywuv,zuvYxw->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        M_c_cva__a_abb -= 1/12 * einsum('IK,Lxyz,ywuv,zuvYwx->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        M_c_cva__a_abb += 5/12 * einsum('IK,Lxyz,ywuv,zuvxYw->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        M_c_cva__a_abb -= 1/12 * einsum('IK,Lxyz,ywuv,zuvxwY->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        M_c_cva__a_abb -= 1/12 * einsum('IK,Lxyz,ywuv,zuvwYx->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        M_c_cva__a_abb -= 1/12 * einsum('IK,Lxyz,ywuv,zuvwxY->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        M_c_cva__a_abb += 5/12 * einsum('IK,Lxyz,zwuv,yuvYxw->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        M_c_cva__a_abb -= 1/12 * einsum('IK,Lxyz,zwuv,yuvYwx->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        M_c_cva__a_abb -= 1/12 * einsum('IK,Lxyz,zwuv,yuvxYw->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        M_c_cva__a_abb -= 1/12 * einsum('IK,Lxyz,zwuv,yuvxwY->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        M_c_cva__a_abb -= 1/12 * einsum('IK,Lxyz,zwuv,yuvwYx->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        M_c_cva__a_abb -= 1/12 * einsum('IK,Lxyz,zwuv,yuvwxY->IKLY', np.identity(ncvs), t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)

        M_c_cva__a_bab =- einsum('LKIY->IKLY', v_vxxa, optimize = einsum_type).copy()
        M_c_cva__a_bab += 1/2 * einsum('LKIx,xY->IKLY', v_vxxa, rdm_ca, optimize = einsum_type)

        M_c_cva__a_aaa = M_c_cva__a_abb + M_c_cva__a_bab

        M_c_cva__a_aaa = M_c_cva__a_aaa.reshape(ncvs, -1)
        M_c_cva__a_abb = M_c_cva__a_abb.reshape(ncvs, -1)
        M_c_cva__a_bab = M_c_cva__a_bab.reshape(ncvs, -1)

        ## Building C-CVA matrix
        s_aaa = 0
        f_aaa = s_aaa + n_cva
        s_abb = f_aaa
        f_abb = s_abb + n_cva
        s_bab = f_abb
        f_bab = s_bab + n_cva

        M_c_cva = np.zeros((ncvs, dim_cva))
        M_c_cva[:, s_aaa:f_aaa] = M_c_cva__a_aaa.copy()
        M_c_cva[:, s_abb:f_abb] = M_c_cva__a_abb.copy()
        M_c_cva[:, s_bab:f_bab] = M_c_cva__a_bab.copy()

        mr_adc.M_01.c_cva = M_c_cva

    print("Time for computing M(h0-h1) blocks:                %f sec\n" % (time.time() - start_time))
    sys.stdout.flush()

def define_effective_hamiltonian(mr_adc):

    apply_M = None

    if mr_adc.method in ("mr-adc(0)", "mr-adc(1)"):
        # Effective Hamiltonian for MR-ADC(0) and MR-ADC(1)
        def apply_M(X):
            M_00 = mr_adc.M_00

            sigma = np.dot(M_00, X)

            ## Multiply by -1.0, since we are solving for -M C = -S C E
            sigma *= -1.0

            return sigma

    else:
        # Effective Hamiltonian for MR-ADC(2) and MR-ADC(2)-X
        def apply_M(X):
            ## Xt = S_12 X
            Xt = apply_S_12(mr_adc, X)

            ## Apply M: Sigma = M Xt
            sigma = compute_sigma_vector(mr_adc, Xt)

            ## Multiply by -1.0, since we are solving for -M C = -S C E
            sigma *= -1.0

            ## X_new = S_12.T Sigma
            X_new = apply_S_12(mr_adc, sigma, transpose = True)

            return X_new

    return apply_M

def compute_preconditioner(mr_adc):

    start_time = time.time()

    # Einsum definition from kernel
    einsum = mr_adc.interface.einsum
    einsum_type = mr_adc.interface.einsum_type

    # Matrix Blocks
    M_00 = mr_adc.M_00

    if mr_adc.method in ("mr-adc(0)", "mr-adc(1)"):
        # Multiply by -1.0, since we are solving for -M C = -S C E
        return (-1.0 * np.diag(M_00))

    # Variables from kernel
    ncvs = mr_adc.ncvs
    nval = mr_adc.nval
    ncas = mr_adc.ncas
    nextern = mr_adc.nextern

    ## Molecular Orbitals Energies
    e_cvs = mr_adc.mo_energy.x
    e_extern = mr_adc.mo_energy.e

    if nval > 0:
        e_val = mr_adc.mo_energy.v

    ## One-electron integrals
    h_aa = mr_adc.h1eff.aa

    ## Two-electron integrals
    v_aaaa = mr_adc.v2e.aaaa

    v_xaxa = mr_adc.v2e.xaxa
    v_xaax = mr_adc.v2e.xaax

    ## Reduced density matrices
    rdm_ca = mr_adc.rdm.ca
    rdm_ccaa = mr_adc.rdm.ccaa
    rdm_cccaaa = mr_adc.rdm.cccaaa

    ## Overlap Matrices
    S12_c_caa = mr_adc.S12.c_caa
    S12_cae = mr_adc.S12.cae
    S12_cca = mr_adc.S12.cca

    ## Excitation Manifolds
    s_c = mr_adc.h0.s_c
    f_c = mr_adc.h0.f_c

    ho_s_c_caa = mr_adc.h_orth.s_c_caa
    ho_f_c_caa = mr_adc.h_orth.f_c_caa

    ho_s_cce__aaa = mr_adc.h_orth.s_cce__aaa
    ho_f_cce__aaa = mr_adc.h_orth.f_cce__aaa
    ho_s_cce__abb = mr_adc.h_orth.s_cce__abb
    ho_f_cce__abb = mr_adc.h_orth.f_cce__abb

    ho_s_cae__aaa = mr_adc.h_orth.s_cae__aaa
    ho_f_cae__aaa = mr_adc.h_orth.f_cae__aaa
    ho_s_cae__abb = mr_adc.h_orth.s_cae__abb
    ho_f_cae__abb = mr_adc.h_orth.f_cae__abb
    ho_s_cae__bab = mr_adc.h_orth.s_cae__bab
    ho_f_cae__bab = mr_adc.h_orth.f_cae__bab

    ho_s_cca__aaa = mr_adc.h_orth.s_cca__aaa
    ho_f_cca__aaa = mr_adc.h_orth.f_cca__aaa
    ho_s_cca__abb = mr_adc.h_orth.s_cca__abb
    ho_f_cca__abb = mr_adc.h_orth.f_cca__abb

    if nval > 0:
        ho_s_cve__aaa = mr_adc.h_orth.s_cve__aaa
        ho_f_cve__aaa = mr_adc.h_orth.f_cve__aaa
        ho_s_cve__abb = mr_adc.h_orth.s_cve__abb
        ho_f_cve__abb = mr_adc.h_orth.f_cve__abb
        ho_s_cve__bab = mr_adc.h_orth.s_cve__bab
        ho_f_cve__bab = mr_adc.h_orth.f_cve__bab

        ho_s_cva__aaa = mr_adc.h_orth.s_cva__aaa
        ho_f_cva__aaa = mr_adc.h_orth.f_cva__aaa
        ho_s_cva__abb = mr_adc.h_orth.s_cva__abb
        ho_f_cva__abb = mr_adc.h_orth.f_cva__abb
        ho_s_cva__bab = mr_adc.h_orth.s_cva__bab
        ho_f_cva__bab = mr_adc.h_orth.f_cva__bab

    ## Indices
    cvs_tril_ind = np.tril_indices(ncvs, k=-1)

    # Build the preconditioner
    precond = np.zeros(mr_adc.h_orth.dim)

    # C and CAA
    # 0th-order
    precond_c_caa__a_aaa  = 1/2 * einsum('I,II,XY->IXY', e_cvs, np.identity(ncvs), rdm_ca, optimize = einsum_type)
    precond_c_caa__a_abb  = 1/2 * einsum('I,II,XY->IXY', e_cvs, np.identity(ncvs), rdm_ca, optimize = einsum_type)

    # 1st-order
    precond_c_caa__a_aaa += 1/2 * einsum('IxIY,Xx->IXY', v_xaxa, rdm_ca, optimize = einsum_type)
    precond_c_caa__a_aaa += 1/2 * einsum('IxIy,XyYx->IXY', v_xaxa, rdm_ccaa, optimize = einsum_type)
    precond_c_caa__a_aaa -= 1/2 * einsum('IxYI,Xx->IXY', v_xaax, rdm_ca, optimize = einsum_type)
    precond_c_caa__a_aaa -= 1/6 * einsum('IxyI,XyYx->IXY', v_xaax, rdm_ccaa, optimize = einsum_type)
    precond_c_caa__a_aaa += 1/6 * einsum('IxyI,XyxY->IXY', v_xaax, rdm_ccaa, optimize = einsum_type)
    precond_c_caa__a_aaa -= 1/2 * einsum('IxIy,xy,XY->IXY', v_xaxa, rdm_ca, rdm_ca, optimize = einsum_type)
    precond_c_caa__a_aaa += 1/4 * einsum('IxyI,xy,XY->IXY', v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)

    precond_c_caa__a_abb += 1/2 * einsum('IxIY,Xx->IXY', v_xaxa, rdm_ca, optimize = einsum_type)
    precond_c_caa__a_abb += 1/2 * einsum('IxIy,XyYx->IXY', v_xaxa, rdm_ccaa, optimize = einsum_type)
    precond_c_caa__a_abb -= 1/3 * einsum('IxyI,XyYx->IXY', v_xaax, rdm_ccaa, optimize = einsum_type)
    precond_c_caa__a_abb -= 1/6 * einsum('IxyI,XyxY->IXY', v_xaax, rdm_ccaa, optimize = einsum_type)
    precond_c_caa__a_abb -= 1/2 * einsum('IxIy,xy,XY->IXY', v_xaxa, rdm_ca, rdm_ca, optimize = einsum_type)
    precond_c_caa__a_abb += 1/4 * einsum('IxyI,xy,XY->IXY', v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)

    #TODO: Check if those blocks are different
    precond_caa__aaa =- 1/6 * einsum('I,II,WYXZ->IWZXY', e_cvs, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__aaa += 1/6 * einsum('I,II,WYZX->IWZXY', e_cvs, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__aaa += 1/6 * einsum('Xx,II,WYZx->IWZXY', h_aa, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__aaa -= 1/6 * einsum('Xx,II,WYxZ->IWZXY', h_aa, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__aaa -= 1/2 * einsum('YZ,II,XW->IWZXY', h_aa, np.identity(ncvs), rdm_ca, optimize = einsum_type)
    precond_caa__aaa += 1/6 * einsum('Yx,II,WxXZ->IWZXY', h_aa, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__aaa -= 1/6 * einsum('Yx,II,WxZX->IWZXY', h_aa, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__aaa -= 1/6 * einsum('II,XZxy,WYxy->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__aaa += 1/6 * einsum('II,XZxy,WYyx->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__aaa += 1/6 * einsum('II,Xxyz,ZyzWYx->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__aaa -= 1/6 * einsum('II,Xxyz,ZyzYWx->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__aaa -= 1/2 * einsum('II,YxZy,WyXx->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__aaa += 1/6 * einsum('II,YxyZ,WyXx->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__aaa -= 1/6 * einsum('II,YxyZ,WyxX->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__aaa += 1/6 * einsum('II,Yxyz,XZxWyz->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__aaa -= 1/6 * einsum('II,Yxyz,XZxyWz->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__aaa += 1/2 * einsum('I,II,YZ,XW->IWZXY', e_cvs, np.identity(ncvs), np.identity(ncas), rdm_ca, optimize = einsum_type)
    precond_caa__aaa += 1/2 * einsum('Xx,II,YZ,xW->IWZXY', h_aa, np.identity(ncvs), np.identity(ncas), rdm_ca, optimize = einsum_type)
    precond_caa__aaa += 1/2 * einsum('Xxyz,II,YZ,Wxyz->IWZXY', v_aaaa, np.identity(ncvs), np.identity(ncas), rdm_ccaa, optimize = einsum_type)

    precond_caa__abb =- 1/6 * einsum('I,II,WYXZ->IWZXY', e_cvs, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__abb += 1/6 * einsum('I,II,WYZX->IWZXY', e_cvs, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__abb += 1/6 * einsum('Xx,II,WYZx->IWZXY', h_aa, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__abb -= 1/6 * einsum('Xx,II,WYxZ->IWZXY', h_aa, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__abb -= 1/2 * einsum('YZ,II,XW->IWZXY', h_aa, np.identity(ncvs), rdm_ca, optimize = einsum_type)
    precond_caa__abb += 1/6 * einsum('Yx,II,WxXZ->IWZXY', h_aa, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__abb -= 1/6 * einsum('Yx,II,WxZX->IWZXY', h_aa, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__abb -= 1/6 * einsum('II,XZxy,WYxy->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__abb += 1/6 * einsum('II,XZxy,WYyx->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__abb += 1/6 * einsum('II,Xxyz,ZyzWYx->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__abb -= 1/6 * einsum('II,Xxyz,ZyzYWx->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__abb -= 1/2 * einsum('II,YxZy,WyXx->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__abb += 1/6 * einsum('II,YxyZ,WyXx->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__abb -= 1/6 * einsum('II,YxyZ,WyxX->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__abb += 1/6 * einsum('II,Yxyz,XZxWyz->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__abb -= 1/6 * einsum('II,Yxyz,XZxyWz->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__abb += 1/2 * einsum('I,II,YZ,XW->IWZXY', e_cvs, np.identity(ncvs), np.identity(ncas), rdm_ca, optimize = einsum_type)
    precond_caa__abb += 1/2 * einsum('Xx,II,YZ,xW->IWZXY', h_aa, np.identity(ncvs), np.identity(ncas), rdm_ca, optimize = einsum_type)
    precond_caa__abb += 1/2 * einsum('Xxyz,II,YZ,Wxyz->IWZXY', v_aaaa, np.identity(ncvs), np.identity(ncas), rdm_ccaa, optimize = einsum_type)

    precond_caa__bab =- 1/3 * einsum('I,II,WYXZ->IWZXY', e_cvs, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__bab -= 1/6 * einsum('I,II,WYZX->IWZXY', e_cvs, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__bab -= 1/6 * einsum('Xx,II,WYZx->IWZXY', h_aa, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__bab -= 1/3 * einsum('Xx,II,WYxZ->IWZXY', h_aa, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__bab -= 1/2 * einsum('YZ,II,XW->IWZXY', h_aa, np.identity(ncvs), rdm_ca, optimize = einsum_type)
    precond_caa__bab += 1/3 * einsum('Yx,II,WxXZ->IWZXY', h_aa, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__bab += 1/6 * einsum('Yx,II,WxZX->IWZXY', h_aa, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__bab -= 1/3 * einsum('II,XZxy,WYxy->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__bab -= 1/6 * einsum('II,XZxy,WYyx->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__bab -= 1/12 * einsum('II,Xxyz,ZyzWYx->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__bab += 1/12 * einsum('II,Xxyz,ZyzWxY->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__bab -= 1/4 * einsum('II,Xxyz,ZyzYWx->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__bab += 1/12 * einsum('II,Xxyz,ZyzYxW->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__bab += 1/12 * einsum('II,Xxyz,ZyzxWY->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__bab += 1/12 * einsum('II,Xxyz,ZyzxYW->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__bab -= 1/2 * einsum('II,YxZy,WyXx->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__bab += 1/3 * einsum('II,YxyZ,WyXx->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__bab += 1/6 * einsum('II,YxyZ,WyxX->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__bab += 1/4 * einsum('II,Yxyz,XZxWyz->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__bab -= 1/12 * einsum('II,Yxyz,XZxWzy->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__bab += 1/12 * einsum('II,Yxyz,XZxyWz->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__bab -= 1/12 * einsum('II,Yxyz,XZxyzW->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__bab -= 1/12 * einsum('II,Yxyz,XZxzWy->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__bab -= 1/12 * einsum('II,Yxyz,XZxzyW->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__bab += 1/2 * einsum('I,II,YZ,XW->IWZXY', e_cvs, np.identity(ncvs), np.identity(ncas), rdm_ca, optimize = einsum_type)
    precond_caa__bab += 1/2 * einsum('Xx,II,YZ,xW->IWZXY', h_aa, np.identity(ncvs), np.identity(ncas), rdm_ca, optimize = einsum_type)
    precond_caa__bab += 1/2 * einsum('Xxyz,II,YZ,Wxyz->IWZXY', v_aaaa, np.identity(ncvs), np.identity(ncas), rdm_ccaa, optimize = einsum_type)

    # Off-diagonal terms
    precond_caa__aaa_abb  = 1/6 * einsum('I,II,WYXZ->IWZXY', e_cvs, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__aaa_abb += 1/3 * einsum('I,II,WYZX->IWZXY', e_cvs, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__aaa_abb += 1/3 * einsum('Xx,II,WYZx->IWZXY', h_aa, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__aaa_abb += 1/6 * einsum('Xx,II,WYxZ->IWZXY', h_aa, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__aaa_abb -= 1/6 * einsum('Yx,II,WxXZ->IWZXY', h_aa, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__aaa_abb -= 1/3 * einsum('Yx,II,WxZX->IWZXY', h_aa, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__aaa_abb += 1/6 * einsum('II,XZxy,WYxy->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__aaa_abb += 1/3 * einsum('II,XZxy,WYyx->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__aaa_abb += 1/4 * einsum('II,Xxyz,ZyzWYx->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__aaa_abb -= 1/12 * einsum('II,Xxyz,ZyzWxY->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__aaa_abb += 1/12 * einsum('II,Xxyz,ZyzYWx->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__aaa_abb -= 1/12 * einsum('II,Xxyz,ZyzYxW->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__aaa_abb -= 1/12 * einsum('II,Xxyz,ZyzxWY->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__aaa_abb -= 1/12 * einsum('II,Xxyz,ZyzxYW->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__aaa_abb -= 1/6 * einsum('II,YxyZ,WyXx->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__aaa_abb -= 1/3 * einsum('II,YxyZ,WyxX->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__aaa_abb -= 1/12 * einsum('II,Yxyz,XZxWyz->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__aaa_abb += 1/12 * einsum('II,Yxyz,XZxWzy->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__aaa_abb -= 1/4 * einsum('II,Yxyz,XZxyWz->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__aaa_abb += 1/12 * einsum('II,Yxyz,XZxyzW->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__aaa_abb += 1/12 * einsum('II,Yxyz,XZxzWy->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__aaa_abb += 1/12 * einsum('II,Yxyz,XZxzyW->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)

    precond_caa__abb_aaa  = 1/6 * einsum('I,II,WYXZ->IWZXY', e_cvs, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__abb_aaa += 1/3 * einsum('I,II,WYZX->IWZXY', e_cvs, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__abb_aaa += 1/3 * einsum('Xx,II,WYZx->IWZXY', h_aa, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__abb_aaa += 1/6 * einsum('Xx,II,WYxZ->IWZXY', h_aa, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__abb_aaa -= 1/6 * einsum('Yx,II,WxXZ->IWZXY', h_aa, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__abb_aaa -= 1/3 * einsum('Yx,II,WxZX->IWZXY', h_aa, np.identity(ncvs), rdm_ccaa, optimize = einsum_type)
    precond_caa__abb_aaa += 1/6 * einsum('II,XZxy,WYxy->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__abb_aaa += 1/3 * einsum('II,XZxy,WYyx->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__abb_aaa += 1/4 * einsum('II,Xxyz,ZyzWYx->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__abb_aaa -= 1/12 * einsum('II,Xxyz,ZyzWxY->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__abb_aaa += 1/12 * einsum('II,Xxyz,ZyzYWx->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__abb_aaa -= 1/12 * einsum('II,Xxyz,ZyzYxW->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__abb_aaa -= 1/12 * einsum('II,Xxyz,ZyzxWY->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__abb_aaa -= 1/12 * einsum('II,Xxyz,ZyzxYW->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__abb_aaa -= 1/6 * einsum('II,YxyZ,WyXx->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__abb_aaa -= 1/3 * einsum('II,YxyZ,WyxX->IWZXY', np.identity(ncvs), v_aaaa, rdm_ccaa, optimize = einsum_type)
    precond_caa__abb_aaa -= 1/12 * einsum('II,Yxyz,XZxWyz->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__abb_aaa += 1/12 * einsum('II,Yxyz,XZxWzy->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__abb_aaa -= 1/4 * einsum('II,Yxyz,XZxyWz->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__abb_aaa += 1/12 * einsum('II,Yxyz,XZxyzW->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__abb_aaa += 1/12 * einsum('II,Yxyz,XZxzWy->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)
    precond_caa__abb_aaa += 1/12 * einsum('II,Yxyz,XZxzyW->IWZXY', np.identity(ncvs), v_aaaa, rdm_cccaaa, optimize = einsum_type)

    ## Building C-CAA matrix
    dim_xy = ncas * ncas
    dim_c_caa = 3 * dim_xy

    s_aa = 1
    f_aa = s_aa + dim_xy
    s_bb = f_aa
    f_bb = s_bb + dim_xy
    s_ab = f_bb
    f_ab = s_ab + dim_xy

    precond_caa = np.zeros((ncvs, (1 + dim_c_caa), (1 + dim_c_caa)))
    precond_caa[:, 0, 0] = np.diag(M_00[s_c:f_c, s_c:f_c]).copy()

    precond_caa[:, 0, s_aa:f_aa] = precond_c_caa__a_aaa.reshape(ncvs, ncas * ncas).copy()
    precond_caa[:, 0, s_bb:f_bb] = precond_c_caa__a_abb.reshape(ncvs, ncas * ncas).copy()
    precond_caa[:, s_aa:f_ab, 0] = precond_caa[:, 0, s_aa:f_ab].copy()

    precond_caa[:, s_aa:f_aa, s_aa:f_aa] = precond_caa__aaa.reshape(ncvs, ncas * ncas, ncas * ncas).copy()
    precond_caa[:, s_aa:f_aa, s_bb:f_bb] = precond_caa__aaa_abb.reshape(ncvs, ncas * ncas, ncas * ncas).copy()

    precond_caa[:, s_bb:f_bb, s_bb:f_bb] = precond_caa__abb.reshape(ncvs, ncas * ncas, ncas * ncas).copy()
    precond_caa[:, s_bb:f_bb, s_aa:f_aa] = precond_caa__abb_aaa.reshape(ncvs, ncas * ncas, ncas * ncas).copy()

    precond_caa[:, s_ab:f_ab, s_ab:f_ab] = precond_caa__bab.reshape(ncvs, ncas * ncas, ncas * ncas).copy()

    precond_caa = einsum('IXY,XP,YP->IP', precond_caa, S12_c_caa, S12_c_caa, optimize = einsum_type)

    precond[ho_s_c_caa:ho_f_c_caa] = precond_caa.reshape(-1)

    # CCE
    precond_cce =- einsum('A,AA,II,JJ->IJA', e_extern, np.identity(nextern), np.identity(ncvs), np.identity(ncvs), optimize = einsum_type)
    precond_cce += einsum('I,AA,II,JJ->IJA', e_cvs, np.identity(nextern), np.identity(ncvs), np.identity(ncvs), optimize = einsum_type)
    precond_cce += einsum('J,AA,II,JJ->IJA', e_cvs, np.identity(nextern), np.identity(ncvs), np.identity(ncvs), optimize = einsum_type)
    precond[ho_s_cce__aaa:ho_f_cce__aaa] = precond_cce[cvs_tril_ind[0], cvs_tril_ind[1]].reshape(-1).copy()
    precond[ho_s_cce__abb:ho_f_cce__abb] = precond_cce.reshape(-1).copy()

    if nval > 0:
        # CVE
        precond_cve =- einsum('A,AA,II,JJ->IJA', e_extern, np.identity(nextern), np.identity(ncvs), np.identity(nval), optimize = einsum_type)
        precond_cve += einsum('I,AA,II,JJ->IJA', e_cvs, np.identity(nextern), np.identity(ncvs), np.identity(nval), optimize = einsum_type)
        precond_cve += einsum('J,AA,II,JJ->IJA', e_val, np.identity(nextern), np.identity(ncvs), np.identity(nval), optimize = einsum_type)

        precond[ho_s_cve__aaa:ho_f_cve__aaa] = precond_cve.reshape(-1).copy()
        precond[ho_s_cve__abb:ho_f_cve__abb] = precond_cve.reshape(-1).copy()
        precond[ho_s_cve__bab:ho_f_cve__bab] = precond_cve.reshape(-1).copy()

    # CAE
    precond_cae =- 1/2 * einsum('A,AA,II,XY->IAXY', e_extern, np.identity(nextern), np.identity(ncvs), rdm_ca, optimize = einsum_type)
    precond_cae += 1/2 * einsum('I,AA,II,XY->IAXY', e_cvs, np.identity(nextern), np.identity(ncvs), rdm_ca, optimize = einsum_type)
    precond_cae += 1/2 * einsum('Xx,AA,II,xY->IAXY', h_aa, np.identity(nextern), np.identity(ncvs), rdm_ca, optimize = einsum_type)
    precond_cae += 1/2 * einsum('Xxyz,AA,II,Yxyz->IAXY', v_aaaa, np.identity(nextern), np.identity(ncvs), rdm_ccaa, optimize = einsum_type)

    precond_cae = einsum("IAXY,XP,YP->IPA", precond_cae, S12_cae, S12_cae, optimize = einsum_type)
    precond[ho_s_cae__aaa:ho_f_cae__aaa] = precond_cae.reshape(-1).copy()
    precond[ho_s_cae__abb:ho_f_cae__abb] = precond_cae.reshape(-1).copy()
    precond[ho_s_cae__bab:ho_f_cae__bab] = precond_cae.reshape(-1).copy()

    # CCA
    precond_cca =- einsum('XY,II,JJ->IJXY', h_aa, np.identity(ncvs), np.identity(ncvs), optimize = einsum_type)
    precond_cca += einsum('I,II,JJ,XY->IJXY', e_cvs, np.identity(ncvs), np.identity(ncvs), np.identity(ncas), optimize = einsum_type)
    precond_cca += einsum('J,II,JJ,XY->IJXY', e_cvs, np.identity(ncvs), np.identity(ncvs), np.identity(ncas), optimize = einsum_type)
    precond_cca -= 1/2 * einsum('I,II,JJ,YX->IJXY', e_cvs, np.identity(ncvs), np.identity(ncvs), rdm_ca, optimize = einsum_type)
    precond_cca -= 1/2 * einsum('J,II,JJ,YX->IJXY', e_cvs, np.identity(ncvs), np.identity(ncvs), rdm_ca, optimize = einsum_type)
    precond_cca += 1/2 * einsum('Xx,II,JJ,Yx->IJXY', h_aa, np.identity(ncvs), np.identity(ncvs), rdm_ca, optimize = einsum_type)
    precond_cca -= einsum('XxYy,II,JJ,xy->IJXY', v_aaaa, np.identity(ncvs), np.identity(ncvs), rdm_ca, optimize = einsum_type)
    precond_cca += 1/2 * einsum('XxyY,II,JJ,xy->IJXY', v_aaaa, np.identity(ncvs), np.identity(ncvs), rdm_ca, optimize = einsum_type)
    precond_cca += 1/2 * einsum('Xxyz,II,JJ,Yxyz->IJXY', v_aaaa, np.identity(ncvs), np.identity(ncvs), rdm_ccaa, optimize = einsum_type)

    precond_cca = einsum("IJXY,XP,YP->IJP", precond_cca, S12_cca, S12_cca, optimize = einsum_type)
    precond[ho_s_cca__aaa:ho_f_cca__aaa] = precond_cca[cvs_tril_ind[0], cvs_tril_ind[1]].reshape(-1).copy()
    precond[ho_s_cca__abb:ho_f_cca__abb] = precond_cca.reshape(-1).copy()

    if nval > 0:
        # CVA
        precond_cva =- einsum('XY,II,JJ->IJXY', h_aa, np.identity(ncvs), np.identity(nval), optimize = einsum_type)
        precond_cva += einsum('I,II,JJ,XY->IJXY', e_cvs, np.identity(ncvs), np.identity(nval), np.identity(ncas), optimize = einsum_type)
        precond_cva += einsum('J,II,JJ,XY->IJXY', e_val, np.identity(ncvs), np.identity(nval), np.identity(ncas), optimize = einsum_type)
        precond_cva -= 1/2 * einsum('I,II,JJ,YX->IJXY', e_cvs, np.identity(ncvs), np.identity(nval), rdm_ca, optimize = einsum_type)
        precond_cva -= 1/2 * einsum('J,II,JJ,YX->IJXY', e_val, np.identity(ncvs), np.identity(nval), rdm_ca, optimize = einsum_type)
        precond_cva += 1/2 * einsum('Xx,II,JJ,Yx->IJXY', h_aa, np.identity(ncvs), np.identity(nval), rdm_ca, optimize = einsum_type)
        precond_cva -= einsum('XxYy,II,JJ,xy->IJXY', v_aaaa, np.identity(ncvs), np.identity(nval), rdm_ca, optimize = einsum_type)
        precond_cva += 1/2 * einsum('XxyY,II,JJ,xy->IJXY', v_aaaa, np.identity(ncvs), np.identity(nval), rdm_ca, optimize = einsum_type)
        precond_cva += 1/2 * einsum('Xxyz,II,JJ,Yxyz->IJXY', v_aaaa, np.identity(ncvs), np.identity(nval), rdm_ccaa, optimize = einsum_type)

        precond_cva = einsum("IJXY,XP,YP->IJP", precond_cva, S12_cca, S12_cca, optimize = einsum_type)
        precond[ho_s_cva__aaa:ho_f_cva__aaa] = precond_cva.reshape(-1).copy()
        precond[ho_s_cva__abb:ho_f_cva__abb] = precond_cva.reshape(-1).copy()
        precond[ho_s_cva__bab:ho_f_cva__bab] = precond_cva.reshape(-1).copy()

    # Multiply by -1.0, since we are solving for -M C = -S C E
    precond *= (-1.0)

    print ("Time for computing preconditioner:                 %f sec\n" % (time.time() - start_time))
    sys.stdout.flush()

    return precond

def apply_S_12(mr_adc, X, transpose = False):

    # Einsum definition from kernel
    einsum = mr_adc.interface.einsum
    einsum_type = mr_adc.interface.einsum_type

    # Variables from kernel
    ncvs = mr_adc.ncvs
    nval = mr_adc.nval
    ncas = mr_adc.ncas
    nextern = mr_adc.nextern

    ## Overlap Matrices
    S12_c_caa = mr_adc.S12.c_caa
    S12_cae = mr_adc.S12.cae
    S12_cca = mr_adc.S12.cca

    ## Excitation Manifolds
    s_c = mr_adc.h0.s_c
    f_c = mr_adc.h0.f_c

    s_cce = mr_adc.h1.s_cce
    f_cce = mr_adc.h1.f_cce
    s_cca = mr_adc.h1.s_cca
    f_cca = mr_adc.h1.f_cca

    s_caa__aaa = mr_adc.h1.s_caa__aaa
    f_caa__aaa = mr_adc.h1.f_caa__aaa
    s_caa__abb = mr_adc.h1.s_caa__abb
    f_caa__abb = mr_adc.h1.f_caa__abb
    s_caa__bab = mr_adc.h1.s_caa__bab
    f_caa__bab = mr_adc.h1.f_caa__bab

    s_cae__aaa = mr_adc.h1.s_cae__aaa
    f_cae__aaa = mr_adc.h1.f_cae__aaa
    s_cae__abb = mr_adc.h1.s_cae__abb
    f_cae__abb = mr_adc.h1.f_cae__abb
    s_cae__bab = mr_adc.h1.s_cae__bab
    f_cae__bab = mr_adc.h1.f_cae__bab

    if nval > 0:
        s_cve = mr_adc.h1.s_cve
        f_cve = mr_adc.h1.f_cve

        s_cva = mr_adc.h1.s_cva
        f_cva = mr_adc.h1.f_cva

    ho_s_c_caa = mr_adc.h_orth.s_c_caa
    ho_f_c_caa = mr_adc.h_orth.f_c_caa

    ho_s_cce = mr_adc.h_orth.s_cce
    ho_f_cce = mr_adc.h_orth.f_cce
    ho_s_cca = mr_adc.h_orth.s_cca
    ho_f_cca = mr_adc.h_orth.f_cca

    ho_s_cae__aaa = mr_adc.h_orth.s_cae__aaa
    ho_f_cae__aaa = mr_adc.h_orth.f_cae__aaa
    ho_s_cae__abb = mr_adc.h_orth.s_cae__abb
    ho_f_cae__abb = mr_adc.h_orth.f_cae__abb
    ho_s_cae__bab = mr_adc.h_orth.s_cae__bab
    ho_f_cae__bab = mr_adc.h_orth.f_cae__bab

    if nval > 0:
        ho_s_cve = mr_adc.h_orth.s_cve
        ho_f_cve = mr_adc.h_orth.f_cve

        ho_s_cva = mr_adc.h_orth.s_cva
        ho_f_cva = mr_adc.h_orth.f_cva

    # Active indices manifolds
    n_aa = ncas * ncas

    s_aa = 1
    f_aa = s_aa + n_aa
    s_bb = f_aa
    f_bb = s_bb + n_aa
    s_ab = f_bb
    f_ab = s_ab + n_aa

    Xt = None

    if transpose:
        if (X.shape[0] != (mr_adc.h0.dim + mr_adc.h1.dim)):
            raise Exception("Dimensions do not match when applying S_12 transpose")

        Xt = np.zeros(mr_adc.h_orth.dim)

        # C and CAA -> C_CAA
        temp = np.zeros((ncvs, S12_c_caa.shape[0]))
        temp[:, 0] = X[s_c:f_c].copy()
        temp[:, s_aa:f_aa] = X[s_caa__aaa:f_caa__aaa].reshape(ncvs, -1).copy()
        temp[:, s_bb:f_bb] = X[s_caa__abb:f_caa__abb].reshape(ncvs, -1).copy()
        temp[:, s_ab:f_ab] = X[s_caa__bab:f_caa__bab].reshape(ncvs, -1).copy()

        Xt[ho_s_c_caa:ho_f_c_caa] = np.dot(temp, S12_c_caa).reshape(-1).copy()

        # CCE
        Xt[ho_s_cce:ho_f_cce] = X[s_cce:f_cce].copy()

        if nval > 0:
            # CVE
            Xt[ho_s_cve:ho_f_cve] = X[s_cve:f_cve].copy()

        # CAE
        temp = X[s_cae__aaa:f_cae__aaa].reshape(ncvs, S12_cae.shape[0], nextern).copy()
        Xt[ho_s_cae__aaa:ho_f_cae__aaa] = einsum("IXA,XP->IPA", temp, S12_cae, optimize = einsum_type).reshape(-1).copy()

        temp = X[s_cae__abb:f_cae__abb].reshape(ncvs, S12_cae.shape[0], nextern).copy()
        Xt[ho_s_cae__abb:ho_f_cae__abb] = einsum("IXA,XP->IPA", temp, S12_cae, optimize = einsum_type).reshape(-1).copy()

        temp = X[s_cae__bab:f_cae__bab].reshape(ncvs, S12_cae.shape[0], nextern).copy()
        Xt[ho_s_cae__bab:ho_f_cae__bab] = einsum("IXA,XP->IPA", temp, S12_cae, optimize = einsum_type).reshape(-1).copy()

        # CCA
        temp = X[s_cca:f_cca].reshape(-1, S12_cca.shape[0]).copy()
        Xt[ho_s_cca:ho_f_cca] = einsum("IX,XP->IP", temp, S12_cca, optimize = einsum_type).reshape(-1).copy()

        if nval > 0:
            # CVA
            temp = X[s_cva:f_cva].reshape(-1, S12_cca.shape[0]).copy()
            Xt[ho_s_cva:ho_f_cva] = einsum("IX,XP->IP", temp, S12_cca, optimize = einsum_type).reshape(-1).copy()

    else:
        if (X.shape[0] != (mr_adc.h_orth.dim)):
            raise Exception("Dimensions do not match when applying S_12")

        Xt = np.zeros(mr_adc.h0.dim + mr_adc.h1.dim)

        # C_CAA -> C and CAA
        temp = X[ho_s_c_caa:ho_f_c_caa].reshape(ncvs, S12_c_caa.shape[1]).copy()
        temp = np.dot(temp, S12_c_caa.T)
        Xt[s_c:f_c] = temp[:,0].copy()

        Xt[s_caa__aaa:f_caa__aaa] = temp[:, s_aa:f_aa].reshape(-1).copy()
        Xt[s_caa__abb:f_caa__abb] = temp[:, s_bb:f_bb].reshape(-1).copy()
        Xt[s_caa__bab:f_caa__bab] = temp[:, s_ab:f_ab].reshape(-1).copy()

        # CCE
        Xt[s_cce:f_cce] = X[ho_s_cce:ho_f_cce].copy()

        if nval > 0:
            # CVE
            Xt[s_cve:f_cve] = X[ho_s_cve:ho_f_cve].copy()

        # CAE
        temp = X[ho_s_cae__aaa:ho_f_cae__aaa].reshape(ncvs, S12_cae.shape[1], nextern).copy()
        Xt[s_cae__aaa:f_cae__aaa] = einsum("IPA,XP->IXA", temp, S12_cae, optimize = einsum_type).reshape(-1).copy()

        temp = X[ho_s_cae__abb:ho_f_cae__abb].reshape(ncvs, S12_cae.shape[1], nextern).copy()
        Xt[s_cae__abb:f_cae__abb] = einsum("IPA,XP->IXA", temp, S12_cae, optimize = einsum_type).reshape(-1).copy()

        temp = X[ho_s_cae__bab:ho_f_cae__bab].reshape(ncvs, S12_cae.shape[1], nextern).copy()
        Xt[s_cae__bab:f_cae__bab] = einsum("IPA,XP->IXA", temp, S12_cae, optimize = einsum_type).reshape(-1).copy()

        # CCA
        temp = X[ho_s_cca:ho_f_cca].reshape(-1, S12_cca.shape[1]).copy()
        Xt[s_cca:f_cca] = einsum("IP,XP->IX", temp, S12_cca, optimize = einsum_type).reshape(-1).copy()

        if nval > 0:
            # CVA
            temp = X[ho_s_cva:ho_f_cva].reshape(-1, S12_cca.shape[1]).copy()
            Xt[s_cva:f_cva] = einsum("IP,XP->IX", temp, S12_cca, optimize = einsum_type).reshape(-1).copy()

    return Xt

def compute_sigma_vector(mr_adc, Xt):

    # Einsum definition from kernel
    einsum = mr_adc.interface.einsum
    einsum_type = mr_adc.interface.einsum_type

    # Variables from kernel
    ncvs = mr_adc.ncvs
    nval = mr_adc.nval
    ncas = mr_adc.ncas
    nextern = mr_adc.nextern

    ## Molecular Orbitals Energies
    e_cvs = mr_adc.mo_energy.x
    e_extern = mr_adc.mo_energy.e

    if nval > 0:
        e_val = mr_adc.mo_energy.v

    ## One-electron integrals
    h_aa = mr_adc.h1eff.aa

    ## Two-electron integrals
    v_aaaa = mr_adc.v2e.aaaa

    ## Reduced density matrices
    rdm_ca = mr_adc.rdm.ca
    rdm_ccaa = mr_adc.rdm.ccaa
    rdm_cccaaa = mr_adc.rdm.cccaaa

    ## Excitation Manifolds
    s_c = mr_adc.h0.s_c
    f_c = mr_adc.h0.f_c

    s_caa = mr_adc.h1.s_caa
    f_caa = mr_adc.h1.f_caa
    s_cce = mr_adc.h1.s_cce
    f_cce = mr_adc.h1.f_cce
    s_cae = mr_adc.h1.s_cae
    f_cae = mr_adc.h1.f_cae
    s_cca = mr_adc.h1.s_cca
    f_cca = mr_adc.h1.f_cca

    if nval > 0:
        s_cve = mr_adc.h1.s_cve
        f_cve = mr_adc.h1.f_cve

        s_cva = mr_adc.h1.s_cva
        f_cva = mr_adc.h1.f_cva

    s_caa__aaa = mr_adc.h1.s_caa__aaa
    f_caa__aaa = mr_adc.h1.f_caa__aaa
    s_caa__abb = mr_adc.h1.s_caa__abb
    f_caa__abb = mr_adc.h1.f_caa__abb
    s_caa__bab = mr_adc.h1.s_caa__bab
    f_caa__bab = mr_adc.h1.f_caa__bab

    s_cce__aaa = mr_adc.h1.s_cce__aaa
    f_cce__aaa = mr_adc.h1.f_cce__aaa
    s_cce__abb = mr_adc.h1.s_cce__abb
    f_cce__abb = mr_adc.h1.f_cce__abb

    s_cae__aaa = mr_adc.h1.s_cae__aaa
    f_cae__aaa = mr_adc.h1.f_cae__aaa
    s_cae__abb = mr_adc.h1.s_cae__abb
    f_cae__abb = mr_adc.h1.f_cae__abb
    s_cae__bab = mr_adc.h1.s_cae__bab
    f_cae__bab = mr_adc.h1.f_cae__bab

    s_cca__aaa = mr_adc.h1.s_cca__aaa
    f_cca__aaa = mr_adc.h1.f_cca__aaa
    s_cca__abb = mr_adc.h1.s_cca__abb
    f_cca__abb = mr_adc.h1.f_cca__abb

    if nval > 0:
        s_cve__aaa = mr_adc.h1.s_cve__aaa
        f_cve__aaa = mr_adc.h1.f_cve__aaa
        s_cve__abb = mr_adc.h1.s_cve__abb
        f_cve__abb = mr_adc.h1.f_cve__abb
        s_cve__bab = mr_adc.h1.s_cve__bab
        f_cve__bab = mr_adc.h1.f_cve__bab

        s_cva__aaa = mr_adc.h1.s_cva__aaa
        f_cva__aaa = mr_adc.h1.f_cva__aaa
        s_cva__abb = mr_adc.h1.s_cva__abb
        f_cva__abb = mr_adc.h1.f_cva__abb
        s_cva__bab = mr_adc.h1.s_cva__bab
        f_cva__bab = mr_adc.h1.f_cva__bab

    ## Indices
    cvs_tril_ind = np.tril_indices(ncvs, k=-1)

    # Matrix Blocks
    M_00 = mr_adc.M_00

    M_01_c_caa = mr_adc.M_01.c_caa
    M_01_c_cce = mr_adc.M_01.c_cce
    M_01_c_cae = mr_adc.M_01.c_cae
    M_01_c_cca = mr_adc.M_01.c_cca

    if nval > 0:
        M_01_c_cve = mr_adc.M_01.c_cve
        M_01_c_cva = mr_adc.M_01.c_cva

    # (CASCI + C) -> (CASCI + C)
    sigma = np.zeros_like(Xt)

    # h0-h0 contributions
    sigma[:mr_adc.h0.dim] = np.dot(M_00, Xt[:mr_adc.h0.dim])

    # h0-h1 and h1-h0 contributions
    # C <-> CAA
    sigma[s_c:f_c] += np.dot(M_01_c_caa, Xt[s_caa:f_caa])
    sigma[s_caa:f_caa] += np.dot(M_01_c_caa.T, Xt[s_c:f_c])

    # C <-> CCE
    sigma[s_c:f_c] += np.dot(M_01_c_cce, Xt[s_cce:f_cce])
    sigma[s_cce:f_cce] += np.dot(M_01_c_cce.T, Xt[s_c:f_c])

    # C <-> CVE
    if nval > 0:
        sigma[s_c:f_c] += np.dot(M_01_c_cve, Xt[s_cve:f_cve])
        sigma[s_cve:f_cve] += np.dot(M_01_c_cve.T, Xt[s_c:f_c])

    # C <-> CAE
    sigma[s_c:f_c] += np.dot(M_01_c_cae, Xt[s_cae:f_cae])
    sigma[s_cae:f_cae] += np.dot(M_01_c_cae.T, Xt[s_c:f_c])

    # C <-> CCA
    sigma[s_c:f_c] += np.dot(M_01_c_cca, Xt[s_cca:f_cca])
    sigma[s_cca:f_cca] += np.dot(M_01_c_cca.T, Xt[s_c:f_c])

    # C <-> CVA
    if nval > 0:
        sigma[s_c:f_c] += np.dot(M_01_c_cva, Xt[s_cva:f_cva])
        sigma[s_cva:f_cva] += np.dot(M_01_c_cva.T, Xt[s_c:f_c])

    # h1-h1 contributions
    # CAA <- CAA
    X_aaa = Xt[s_caa__aaa:f_caa__aaa].reshape(ncvs, ncas, ncas).copy()
    X_abb = Xt[s_caa__abb:f_caa__abb].reshape(ncvs, ncas, ncas).copy()
    X_bab = Xt[s_caa__bab:f_caa__bab].reshape(ncvs, ncas, ncas).copy()

    sigma_caa  = 1/2 * einsum('KxZ,K,xW->KWZ', X_aaa, e_cvs, rdm_ca, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,K,WyZx->KWZ', X_aaa, e_cvs, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/6 * einsum('Kxy,K,WyxZ->KWZ', X_aaa, e_cvs, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/2 * einsum('KxZ,xy,yW->KWZ', X_aaa, h_aa, rdm_ca, optimize = einsum_type)
    sigma_caa -= 1/2 * einsum('Kxy,Zy,xW->KWZ', X_aaa, h_aa, rdm_ca, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,xz,WyZz->KWZ', X_aaa, h_aa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/6 * einsum('Kxy,xz,WyzZ->KWZ', X_aaa, h_aa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/6 * einsum('Kxy,yz,WzZx->KWZ', X_aaa, h_aa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,yz,WzxZ->KWZ', X_aaa, h_aa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/2 * einsum('KxZ,xyzw,Wyzw->KWZ', X_aaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,Zxzw,Wyzw->KWZ', X_aaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/6 * einsum('Kxy,Zxzw,Wywz->KWZ', X_aaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/2 * einsum('Kxy,Zzyw,Wzxw->KWZ', X_aaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,Zzwy,Wzxw->KWZ', X_aaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/6 * einsum('Kxy,Zzwy,Wzwx->KWZ', X_aaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,xzwu,ZwuWyz->KWZ', X_aaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa -= 1/6 * einsum('Kxy,xzwu,ZwuyWz->KWZ', X_aaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa -= 1/6 * einsum('Kxy,yzwu,ZxzWwu->KWZ', X_aaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,yzwu,ZxzwWu->KWZ', X_aaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa += 1/3 * einsum('Kxy,K,WyZx->KWZ', X_abb, e_cvs, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,K,WyxZ->KWZ', X_abb, e_cvs, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/3 * einsum('Kxy,xz,WyZz->KWZ', X_abb, h_aa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,xz,WyzZ->KWZ', X_abb, h_aa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/3 * einsum('Kxy,yz,WzZx->KWZ', X_abb, h_aa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/6 * einsum('Kxy,yz,WzxZ->KWZ', X_abb, h_aa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/3 * einsum('Kxy,Zxzw,Wyzw->KWZ', X_abb, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,Zxzw,Wywz->KWZ', X_abb, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/6 * einsum('Kxy,Zzwy,Wzxw->KWZ', X_abb, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/3 * einsum('Kxy,Zzwy,Wzwx->KWZ', X_abb, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/4 * einsum('Kxy,xzwu,ZwuWyz->KWZ', X_abb, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa -= 1/12 * einsum('Kxy,xzwu,ZwuWzy->KWZ', X_abb, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa += 1/12 * einsum('Kxy,xzwu,ZwuyWz->KWZ', X_abb, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa -= 1/12 * einsum('Kxy,xzwu,ZwuyzW->KWZ', X_abb, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa -= 1/12 * einsum('Kxy,xzwu,ZwuzWy->KWZ', X_abb, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa -= 1/12 * einsum('Kxy,xzwu,ZwuzyW->KWZ', X_abb, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa -= 1/4 * einsum('Kxy,yzwu,ZxzWwu->KWZ', X_abb, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa += 1/12 * einsum('Kxy,yzwu,ZxzWuw->KWZ', X_abb, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa -= 1/12 * einsum('Kxy,yzwu,ZxzwWu->KWZ', X_abb, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa += 1/12 * einsum('Kxy,yzwu,ZxzwuW->KWZ', X_abb, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa += 1/12 * einsum('Kxy,yzwu,ZxzuWw->KWZ', X_abb, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa += 1/12 * einsum('Kxy,yzwu,ZxzuwW->KWZ', X_abb, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma[s_caa__aaa:f_caa__aaa] += sigma_caa.reshape(-1).copy()

    sigma_caa  = 1/3 * einsum('Kxy,K,WyZx->KWZ', X_aaa, e_cvs, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,K,WyxZ->KWZ', X_aaa, e_cvs, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/3 * einsum('Kxy,xz,WyZz->KWZ', X_aaa, h_aa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,xz,WyzZ->KWZ', X_aaa, h_aa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/3 * einsum('Kxy,yz,WzZx->KWZ', X_aaa, h_aa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/6 * einsum('Kxy,yz,WzxZ->KWZ', X_aaa, h_aa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/3 * einsum('Kxy,Zxzw,Wyzw->KWZ', X_aaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,Zxzw,Wywz->KWZ', X_aaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/6 * einsum('Kxy,Zzwy,Wzxw->KWZ', X_aaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/3 * einsum('Kxy,Zzwy,Wzwx->KWZ', X_aaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/4 * einsum('Kxy,xzwu,ZwuWyz->KWZ', X_aaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa -= 1/12 * einsum('Kxy,xzwu,ZwuWzy->KWZ', X_aaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa += 1/12 * einsum('Kxy,xzwu,ZwuyWz->KWZ', X_aaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa -= 1/12 * einsum('Kxy,xzwu,ZwuyzW->KWZ', X_aaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa -= 1/12 * einsum('Kxy,xzwu,ZwuzWy->KWZ', X_aaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa -= 1/12 * einsum('Kxy,xzwu,ZwuzyW->KWZ', X_aaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa -= 1/4 * einsum('Kxy,yzwu,ZxzWwu->KWZ', X_aaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa += 1/12 * einsum('Kxy,yzwu,ZxzWuw->KWZ', X_aaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa -= 1/12 * einsum('Kxy,yzwu,ZxzwWu->KWZ', X_aaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa += 1/12 * einsum('Kxy,yzwu,ZxzwuW->KWZ', X_aaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa += 1/12 * einsum('Kxy,yzwu,ZxzuWw->KWZ', X_aaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa += 1/12 * einsum('Kxy,yzwu,ZxzuwW->KWZ', X_aaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa += 1/2 * einsum('KxZ,K,xW->KWZ', X_abb, e_cvs, rdm_ca, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,K,WyZx->KWZ', X_abb, e_cvs, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/6 * einsum('Kxy,K,WyxZ->KWZ', X_abb, e_cvs, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/2 * einsum('KxZ,xy,yW->KWZ', X_abb, h_aa, rdm_ca, optimize = einsum_type)
    sigma_caa -= 1/2 * einsum('Kxy,Zy,xW->KWZ', X_abb, h_aa, rdm_ca, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,xz,WyZz->KWZ', X_abb, h_aa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/6 * einsum('Kxy,xz,WyzZ->KWZ', X_abb, h_aa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/6 * einsum('Kxy,yz,WzZx->KWZ', X_abb, h_aa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,yz,WzxZ->KWZ', X_abb, h_aa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/2 * einsum('KxZ,xyzw,Wyzw->KWZ', X_abb, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,Zxzw,Wyzw->KWZ', X_abb, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/6 * einsum('Kxy,Zxzw,Wywz->KWZ', X_abb, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/2 * einsum('Kxy,Zzyw,Wzxw->KWZ', X_abb, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,Zzwy,Wzxw->KWZ', X_abb, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/6 * einsum('Kxy,Zzwy,Wzwx->KWZ', X_abb, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,xzwu,ZwuWyz->KWZ', X_abb, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa -= 1/6 * einsum('Kxy,xzwu,ZwuyWz->KWZ', X_abb, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa -= 1/6 * einsum('Kxy,yzwu,ZxzWwu->KWZ', X_abb, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,yzwu,ZxzwWu->KWZ', X_abb, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma[s_caa__abb:f_caa__abb] += sigma_caa.reshape(-1).copy()

    sigma_caa  = 1/2 * einsum('KxZ,K,xW->KWZ', X_bab, e_cvs, rdm_ca, optimize = einsum_type)
    sigma_caa -= 1/6 * einsum('Kxy,K,WyZx->KWZ', X_bab, e_cvs, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/3 * einsum('Kxy,K,WyxZ->KWZ', X_bab, e_cvs, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/2 * einsum('KxZ,xy,yW->KWZ', X_bab, h_aa, rdm_ca, optimize = einsum_type)
    sigma_caa -= 1/2 * einsum('Kxy,Zy,xW->KWZ', X_bab, h_aa, rdm_ca, optimize = einsum_type)
    sigma_caa -= 1/6 * einsum('Kxy,xz,WyZz->KWZ', X_bab, h_aa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/3 * einsum('Kxy,xz,WyzZ->KWZ', X_bab, h_aa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,yz,WzZx->KWZ', X_bab, h_aa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/3 * einsum('Kxy,yz,WzxZ->KWZ', X_bab, h_aa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/2 * einsum('KxZ,xyzw,Wyzw->KWZ', X_bab, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/6 * einsum('Kxy,Zxzw,Wyzw->KWZ', X_bab, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/3 * einsum('Kxy,Zxzw,Wywz->KWZ', X_bab, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/2 * einsum('Kxy,Zzyw,Wzxw->KWZ', X_bab, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/3 * einsum('Kxy,Zzwy,Wzxw->KWZ', X_bab, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa += 1/6 * einsum('Kxy,Zzwy,Wzwx->KWZ', X_bab, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_caa -= 1/12 * einsum('Kxy,xzwu,ZwuWyz->KWZ', X_bab, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa += 1/12 * einsum('Kxy,xzwu,ZwuWzy->KWZ', X_bab, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa -= 1/4 * einsum('Kxy,xzwu,ZwuyWz->KWZ', X_bab, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa += 1/12 * einsum('Kxy,xzwu,ZwuyzW->KWZ', X_bab, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa += 1/12 * einsum('Kxy,xzwu,ZwuzWy->KWZ', X_bab, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa += 1/12 * einsum('Kxy,xzwu,ZwuzyW->KWZ', X_bab, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa += 1/12 * einsum('Kxy,yzwu,ZxzWwu->KWZ', X_bab, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa -= 1/12 * einsum('Kxy,yzwu,ZxzWuw->KWZ', X_bab, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa += 1/4 * einsum('Kxy,yzwu,ZxzwWu->KWZ', X_bab, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa -= 1/12 * einsum('Kxy,yzwu,ZxzwuW->KWZ', X_bab, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa -= 1/12 * einsum('Kxy,yzwu,ZxzuWw->KWZ', X_bab, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_caa -= 1/12 * einsum('Kxy,yzwu,ZxzuwW->KWZ', X_bab, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma[s_caa__bab:f_caa__bab] += sigma_caa.reshape(-1).copy()

    # CCE <- CCE
    X_aaa = np.zeros((ncvs, ncvs, nextern))
    X_aaa[cvs_tril_ind[0], cvs_tril_ind[1]] =  Xt[s_cce__aaa:f_cce__aaa].reshape(-1, nextern).copy()
    X_aaa[cvs_tril_ind[1], cvs_tril_ind[0]] =- Xt[s_cce__aaa:f_cce__aaa].reshape(-1, nextern).copy()

    X_abb = Xt[s_cce__abb:f_cce__abb].reshape(ncvs, ncvs, nextern).copy()
    X_bab =- X_abb.transpose(1,0,2)

    sigma_cce =- 1/2 * einsum('KLB,B->KLB', X_aaa, e_extern, optimize = einsum_type)
    sigma_cce += 1/2 * einsum('KLB,K->KLB', X_aaa, e_cvs, optimize = einsum_type)
    sigma_cce += 1/2 * einsum('KLB,L->KLB', X_aaa, e_cvs, optimize = einsum_type)
    sigma_cce += 1/2 * einsum('LKB,B->KLB', X_aaa, e_extern, optimize = einsum_type)
    sigma_cce -= 1/2 * einsum('LKB,K->KLB', X_aaa, e_cvs, optimize = einsum_type)
    sigma_cce -= 1/2 * einsum('LKB,L->KLB', X_aaa, e_cvs, optimize = einsum_type)
    sigma[s_cce__aaa:f_cce__aaa] += sigma_cce[cvs_tril_ind[0], cvs_tril_ind[1]].reshape(-1).copy()

    sigma_cce =- 1/2 * einsum('KLB,B->KLB', X_abb, e_extern, optimize = einsum_type)
    sigma_cce += 1/2 * einsum('KLB,K->KLB', X_abb, e_cvs, optimize = einsum_type)
    sigma_cce += 1/2 * einsum('KLB,L->KLB', X_abb, e_cvs, optimize = einsum_type)
    sigma_cce += 1/2 * einsum('LKB,B->KLB', X_bab, e_extern, optimize = einsum_type)
    sigma_cce -= 1/2 * einsum('LKB,K->KLB', X_bab, e_cvs, optimize = einsum_type)
    sigma_cce -= 1/2 * einsum('LKB,L->KLB', X_bab, e_cvs, optimize = einsum_type)
    sigma[s_cce__abb:f_cce__abb] += sigma_cce.reshape(-1).copy()

    if nval > 0:
        # CVE <- CVE
        X_aaa = Xt[s_cve__aaa:f_cve__aaa].reshape(ncvs, nval, nextern).copy()
        X_abb = Xt[s_cve__abb:f_cve__abb].reshape(ncvs, nval, nextern).copy()
        X_bab = Xt[s_cve__bab:f_cve__bab].reshape(ncvs, nval, nextern).copy()

        sigma_cve =- einsum('KLB,B->KLB', X_aaa, e_extern, optimize = einsum_type)
        sigma_cve += einsum('KLB,K->KLB', X_aaa, e_cvs, optimize = einsum_type)
        sigma_cve += einsum('KLB,L->KLB', X_aaa, e_val, optimize = einsum_type)
        sigma[s_cve__aaa:f_cve__aaa] += sigma_cve.reshape(-1).copy()

        sigma_cve =- einsum('KLB,B->KLB', X_abb, e_extern, optimize = einsum_type)
        sigma_cve += einsum('KLB,K->KLB', X_abb, e_cvs, optimize = einsum_type)
        sigma_cve += einsum('KLB,L->KLB', X_abb, e_val, optimize = einsum_type)
        sigma[s_cve__abb:f_cve__abb] += sigma_cve.reshape(-1).copy()

        sigma_cve =- einsum('KLB,B->KLB', X_bab, e_extern, optimize = einsum_type)
        sigma_cve += einsum('KLB,K->KLB', X_bab, e_cvs, optimize = einsum_type)
        sigma_cve += einsum('KLB,L->KLB', X_bab, e_val, optimize = einsum_type)
        sigma[s_cve__bab:f_cve__bab] += sigma_cve.reshape(-1).copy()

    # CAE <- CAE
    X_aaa = Xt[s_cae__aaa:f_cae__aaa].reshape(ncvs, ncas, nextern).copy()
    X_abb = Xt[s_cae__abb:f_cae__abb].reshape(ncvs, ncas, nextern).copy()
    X_bab = Xt[s_cae__bab:f_cae__bab].reshape(ncvs, ncas, nextern).copy()

    sigma_cae =- 1/2 * einsum('KxB,B,xZ->KZB', X_aaa, e_extern, rdm_ca, optimize = einsum_type)
    sigma_cae += 1/2 * einsum('KxB,K,xZ->KZB', X_aaa, e_cvs, rdm_ca, optimize = einsum_type)
    sigma_cae += 1/2 * einsum('KxB,xy,yZ->KZB', X_aaa, h_aa, rdm_ca, optimize = einsum_type)
    sigma_cae += 1/2 * einsum('KxB,xyzw,Zyzw->KZB', X_aaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma[s_cae__aaa:f_cae__aaa] += sigma_cae.reshape(-1).copy()

    sigma_cae =- 1/2 * einsum('KxB,B,xZ->KZB', X_abb, e_extern, rdm_ca, optimize = einsum_type)
    sigma_cae += 1/2 * einsum('KxB,K,xZ->KZB', X_abb, e_cvs, rdm_ca, optimize = einsum_type)
    sigma_cae += 1/2 * einsum('KxB,xy,yZ->KZB', X_abb, h_aa, rdm_ca, optimize = einsum_type)
    sigma_cae += 1/2 * einsum('KxB,xyzw,Zyzw->KZB', X_abb, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma[s_cae__abb:f_cae__abb] += sigma_cae.reshape(-1).copy()

    sigma_cae =- 1/2 * einsum('KxB,B,xZ->KZB', X_bab, e_extern, rdm_ca, optimize = einsum_type)
    sigma_cae += 1/2 * einsum('KxB,K,xZ->KZB', X_bab, e_cvs, rdm_ca, optimize = einsum_type)
    sigma_cae += 1/2 * einsum('KxB,xy,yZ->KZB', X_bab, h_aa, rdm_ca, optimize = einsum_type)
    sigma_cae += 1/2 * einsum('KxB,xyzw,Zyzw->KZB', X_bab, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma[s_cae__bab:f_cae__bab] += sigma_cae.reshape(-1).copy()

    # CCA <- CCA
    X_aaa = np.zeros((ncvs, ncvs, ncas))
    X_aaa[cvs_tril_ind[0], cvs_tril_ind[1]] =  Xt[s_cca__aaa:f_cca__aaa].reshape(-1, ncas).copy()
    X_aaa[cvs_tril_ind[1], cvs_tril_ind[0]] =- Xt[s_cca__aaa:f_cca__aaa].reshape(-1, ncas).copy()

    X_abb = Xt[s_cca__abb:f_cca__abb].reshape(ncvs, ncvs, ncas).copy()

    sigma_cca  = einsum('KLW,K->KLW', X_aaa, e_cvs, optimize = einsum_type)
    sigma_cca += einsum('KLW,L->KLW', X_aaa, e_cvs, optimize = einsum_type)
    sigma_cca -= einsum('KLx,Wx->KLW', X_aaa, h_aa, optimize = einsum_type)
    sigma_cca -= 1/2 * einsum('KLx,K,Wx->KLW', X_aaa, e_cvs, rdm_ca, optimize = einsum_type)
    sigma_cca -= 1/2 * einsum('KLx,L,Wx->KLW', X_aaa, e_cvs, rdm_ca, optimize = einsum_type)
    sigma_cca += 1/2 * einsum('KLx,xy,Wy->KLW', X_aaa, h_aa, rdm_ca, optimize = einsum_type)
    sigma_cca -= einsum('KLx,Wyxz,zy->KLW', X_aaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_cca += 1/2 * einsum('KLx,Wyzx,zy->KLW', X_aaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_cca += 1/2 * einsum('KLx,xyzw,Wyzw->KLW', X_aaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma[s_cca__aaa:f_cca__aaa] += sigma_cca[cvs_tril_ind[0], cvs_tril_ind[1]].reshape(-1).copy()

    sigma_cca  = einsum('KLW,K->KLW', X_abb, e_cvs, optimize = einsum_type)
    sigma_cca += einsum('KLW,L->KLW', X_abb, e_cvs, optimize = einsum_type)
    sigma_cca -= einsum('KLx,Wx->KLW', X_abb, h_aa, optimize = einsum_type)
    sigma_cca -= 1/2 * einsum('KLx,K,Wx->KLW', X_abb, e_cvs, rdm_ca, optimize = einsum_type)
    sigma_cca -= 1/2 * einsum('KLx,L,Wx->KLW', X_abb, e_cvs, rdm_ca, optimize = einsum_type)
    sigma_cca += 1/2 * einsum('KLx,xy,Wy->KLW', X_abb, h_aa, rdm_ca, optimize = einsum_type)
    sigma_cca -= einsum('KLx,Wyxz,zy->KLW', X_abb, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_cca += 1/2 * einsum('KLx,Wyzx,zy->KLW', X_abb, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_cca += 1/2 * einsum('KLx,xyzw,Wyzw->KLW', X_abb, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma[s_cca__abb:f_cca__abb] += sigma_cca.reshape(-1).copy()

    if nval > 0:
        # CVA <- CVA
        X_aaa = Xt[s_cva__aaa:f_cva__aaa].reshape(ncvs, nval, ncas).copy()
        X_abb = Xt[s_cva__abb:f_cva__abb].reshape(ncvs, nval, ncas).copy()
        X_bab = Xt[s_cva__bab:f_cva__bab].reshape(ncvs, nval, ncas).copy()

        sigma_cva  = einsum('KLW,K->KLW', X_aaa, e_cvs, optimize = einsum_type)
        sigma_cva += einsum('KLW,L->KLW', X_aaa, e_val, optimize = einsum_type)
        sigma_cva -= einsum('KLx,Wx->KLW', X_aaa, h_aa, optimize = einsum_type)
        sigma_cva -= 1/2 * einsum('KLx,K,Wx->KLW', X_aaa, e_cvs, rdm_ca, optimize = einsum_type)
        sigma_cva -= 1/2 * einsum('KLx,L,Wx->KLW', X_aaa, e_val, rdm_ca, optimize = einsum_type)
        sigma_cva += 1/2 * einsum('KLx,xy,Wy->KLW', X_aaa, h_aa, rdm_ca, optimize = einsum_type)
        sigma_cva -= einsum('KLx,Wyxz,zy->KLW', X_aaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cva += 1/2 * einsum('KLx,Wyzx,zy->KLW', X_aaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cva += 1/2 * einsum('KLx,xyzw,Wyzw->KLW', X_aaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma[s_cva__aaa:f_cva__aaa] += sigma_cva.reshape(-1).copy()

        sigma_cva  = einsum('KLW,K->KLW', X_abb, e_cvs, optimize = einsum_type)
        sigma_cva += einsum('KLW,L->KLW', X_abb, e_val, optimize = einsum_type)
        sigma_cva -= einsum('KLx,Wx->KLW', X_abb, h_aa, optimize = einsum_type)
        sigma_cva -= 1/2 * einsum('KLx,K,Wx->KLW', X_abb, e_cvs, rdm_ca, optimize = einsum_type)
        sigma_cva -= 1/2 * einsum('KLx,L,Wx->KLW', X_abb, e_val, rdm_ca, optimize = einsum_type)
        sigma_cva += 1/2 * einsum('KLx,xy,Wy->KLW', X_abb, h_aa, rdm_ca, optimize = einsum_type)
        sigma_cva -= einsum('KLx,Wyxz,zy->KLW', X_abb, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cva += 1/2 * einsum('KLx,Wyzx,zy->KLW', X_abb, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cva += 1/2 * einsum('KLx,xyzw,Wyzw->KLW', X_abb, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma[s_cva__abb:f_cva__abb] += sigma_cva.reshape(-1).copy()

        sigma_cva  = einsum('KLW,K->KLW', X_bab, e_cvs, optimize = einsum_type)
        sigma_cva += einsum('KLW,L->KLW', X_bab, e_val, optimize = einsum_type)
        sigma_cva -= einsum('KLx,Wx->KLW', X_bab, h_aa, optimize = einsum_type)
        sigma_cva -= 1/2 * einsum('KLx,K,Wx->KLW', X_bab, e_cvs, rdm_ca, optimize = einsum_type)
        sigma_cva -= 1/2 * einsum('KLx,L,Wx->KLW', X_bab, e_val, rdm_ca, optimize = einsum_type)
        sigma_cva += 1/2 * einsum('KLx,xy,Wy->KLW', X_bab, h_aa, rdm_ca, optimize = einsum_type)
        sigma_cva -= einsum('KLx,Wyxz,zy->KLW', X_bab, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cva += 1/2 * einsum('KLx,Wyzx,zy->KLW', X_bab, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cva += 1/2 * einsum('KLx,xyzw,Wyzw->KLW', X_bab, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma[s_cva__bab:f_cva__bab] += sigma_cva.reshape(-1).copy()

    # MR-ADC(2)-X
    # First-order corrections to h1-h1 block
    if mr_adc.method == "mr-adc(2)-x":
        #TODO: organize this
        # Einsum definition from kernel
        einsum = mr_adc.interface.einsum
        einsum_type = mr_adc.interface.einsum_type

        # Variables from kernel
        nmo = mr_adc.nmo
        nocc = mr_adc.nocc

        ncore = mr_adc.ncore
        ncvs = mr_adc.ncvs
        nval = mr_adc.nval
        ncas = mr_adc.ncas
        nextern = mr_adc.nextern

        ## One-electron integrals
        h_ae = mr_adc.h1eff.ae

        h_xa = mr_adc.h1eff.xa
        h_xe = mr_adc.h1eff.xe

        if nval > 0:
            h_va = mr_adc.h1eff.va
            h_ve = mr_adc.h1eff.ve

        ## Two-electron integrals
        v_aaaa = mr_adc.v2e.aaaa

        v_aaae = mr_adc.v2e.aaae

        v_xaaa = mr_adc.v2e.xaaa
        v_xaae = mr_adc.v2e.xaae
        v_xaea = mr_adc.v2e.xaea
        v_xaxa = mr_adc.v2e.xaxa
        v_xaax = mr_adc.v2e.xaax

        v_xaca = mr_adc.v2e.xaca
        v_xaac = mr_adc.v2e.xaac

        if nval > 0:
            v_vaaa = mr_adc.v2e.vaaa
            v_vaae = mr_adc.v2e.vaae
            v_vaea = mr_adc.v2e.vaea

        v_aeae =  mr_adc.v2e.aeae
        v_aeea =  mr_adc.v2e.aeea

        v_xaxe = mr_adc.v2e.xaxe
        v_xaex = mr_adc.v2e.xaex
        v_xxxa = mr_adc.v2e.xxxa
        v_xxxe = mr_adc.v2e.xxxe

        v_xexe = mr_adc.v2e.xexe
        v_xeex = mr_adc.v2e.xeex

        v_cexe = mr_adc.v2e.cexe
        v_ceex = mr_adc.v2e.ceex

        v_xeae = mr_adc.v2e.xeae
        v_xeea = mr_adc.v2e.xeea

        v_xeaa = mr_adc.v2e.xeaa

        v_xxxx = mr_adc.v2e.xxxx

        if nval > 0:
            v_vxxa = mr_adc.v2e.vxxa
            v_xvxa = mr_adc.v2e.xvxa

            v_vxxe = mr_adc.v2e.vxxe
            v_xvxe = mr_adc.v2e.xvxe

            v_xave = mr_adc.v2e.xave
            v_xaev = mr_adc.v2e.xaev

            v_vave = mr_adc.v2e.vave
            v_vaev = mr_adc.v2e.vaev

            v_xeve = mr_adc.v2e.xeve
            v_xeev = mr_adc.v2e.xeev

            v_vexe = mr_adc.v2e.vexe
            v_veex = mr_adc.v2e.veex

            v_veve = mr_adc.v2e.veve
            v_veev = mr_adc.v2e.veev

            v_xvxx = mr_adc.v2e.xvxx

            v_xxvx = mr_adc.v2e.xxvx
            v_xxxv = mr_adc.v2e.xxxv

            v_xvxv = mr_adc.v2e.xvxv
            v_xvvx = mr_adc.v2e.xvvx

            v_vaav = mr_adc.v2e.vaav
            v_vava = mr_adc.v2e.vava

            v_vaax = mr_adc.v2e.vaax
            v_vaxa = mr_adc.v2e.vaxa

            v_xaav = mr_adc.v2e.xaav
            v_xava = mr_adc.v2e.xava

            v_vaxe = mr_adc.v2e.vaxe
            v_vaex = mr_adc.v2e.vaex

            v_veaa = mr_adc.v2e.veaa

            v_veae = mr_adc.v2e.veae
            v_veea = mr_adc.v2e.veea

        ## Amplitudes
        t1_ce = mr_adc.t1.ce
        t1_caea = mr_adc.t1.caea
        t1_caae = mr_adc.t1.caae

        t1_ca = mr_adc.t1.ca
        t1_caaa = mr_adc.t1.caaa

        t1_ae   = mr_adc.t1.ae
        t1_aaea = mr_adc.t1.aaea

        t1_xe   = mr_adc.t1.xe
        t1_xaea = mr_adc.t1.xaea
        t1_xaae = mr_adc.t1.xaae
        t1_xa   = mr_adc.t1.xa
        t1_xaaa = mr_adc.t1.xaaa

        t1_ccee = mr_adc.t1.ccee
        t1_ccea = mr_adc.t1.ccea
        t1_caee = mr_adc.t1.caee
        t1_ccaa = mr_adc.t1.ccaa
        t1_aaee = mr_adc.t1.aaee

        t1_xcee = mr_adc.t1.xcee
        t1_xcea = mr_adc.t1.xcea
        t1_cxea = mr_adc.t1.cxea
        t1_xaee = mr_adc.t1.xaee
        t1_xcaa = mr_adc.t1.xcaa

        t2_xe = mr_adc.t2.xe

        if nval > 0:
            t1_vaea = mr_adc.t1.vaea
            t1_vaae = mr_adc.t1.vaae

            t1_va   = mr_adc.t1.va
            t1_vaaa = mr_adc.t1.vaaa

            t1_vxee = mr_adc.t1.vxee
            t1_vxea = mr_adc.t1.vxea
            t1_xvea = mr_adc.t1.xvea

            t1_xvee = mr_adc.t1.xvee
            t1_xvaa = mr_adc.t1.xvaa

            t1_ve   = mr_adc.t1.ve

        ## Reduced density matrices
        rdm_ca = mr_adc.rdm.ca
        rdm_ccaa = mr_adc.rdm.ccaa
        rdm_cccaaa = mr_adc.rdm.cccaaa
        rdm_ccccaaaa = mr_adc.rdm.ccccaaaa

        # * <- CAA
        X_aaa = Xt[s_caa__aaa:f_caa__aaa].reshape(ncvs, ncas, ncas).copy()
        X_abb = Xt[s_caa__abb:f_caa__abb].reshape(ncvs, ncas, ncas).copy()
        X_bab = Xt[s_caa__bab:f_caa__bab].reshape(ncvs, ncas, ncas).copy()

        # CAA <- CAA
        sigma_caa  = 1/2 * einsum('ixZ,Kyiz,Wzxy->KWZ', X_aaa, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixZ,Kyzi,Wzxy->KWZ', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixZ,Kyzi,Wzyx->KWZ', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('ixy,KyZi,Wx->KWZ', X_aaa, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('ixy,KyiZ,Wx->KWZ', X_aaa, v_xaxa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,Kyiz,WzZx->KWZ', X_aaa, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,Kyiz,WzxZ->KWZ', X_aaa, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,Kyzi,WzZx->KWZ', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,Kyzi,WzxZ->KWZ', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,KzZi,Wyxz->KWZ', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,KzZi,Wyzx->KWZ', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,KziZ,Wyxz->KWZ', X_aaa, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,KziZ,Wyzx->KWZ', X_aaa, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kziw,ZxzWwy->KWZ', X_aaa, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kziw,ZxzWyw->KWZ', X_aaa, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kziw,ZxzwWy->KWZ', X_aaa, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kziw,ZxzwyW->KWZ', X_aaa, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('ixy,Kziw,ZxzyWw->KWZ', X_aaa, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kziw,ZxzywW->KWZ', X_aaa, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kzwi,ZxzWwy->KWZ', X_aaa, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kzwi,ZxzwyW->KWZ', X_aaa, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kzwi,ZxzyWw->KWZ', X_aaa, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('ixy,Kyiz,WzZx->KWZ', X_abb, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,Kyiz,WzxZ->KWZ', X_abb, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,KzZi,Wyxz->KWZ', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/3 * einsum('ixy,KzZi,Wyzx->KWZ', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,KziZ,Wyxz->KWZ', X_abb, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('ixy,KziZ,Wyzx->KWZ', X_abb, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kziw,ZxzWwy->KWZ', X_abb, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('ixy,Kziw,ZxzWyw->KWZ', X_abb, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kziw,ZxzwWy->KWZ', X_abb, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kziw,ZxzwyW->KWZ', X_abb, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kziw,ZxzyWw->KWZ', X_abb, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kziw,ZxzywW->KWZ', X_abb, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kzwi,ZxzWyw->KWZ', X_abb, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kzwi,ZxzwWy->KWZ', X_abb, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,Kzwi,ZxzwyW->KWZ', X_abb, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kzwi,ZxzywW->KWZ', X_abb, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('ixy,KyZi,Wx->KWZ', X_bab, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,Kyzi,WzZx->KWZ', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,Kyzi,WzxZ->KWZ', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('ixy,KzZi,Wyxz->KWZ', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,KzZi,Wyzx->KWZ', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kzwi,ZxzWwy->KWZ', X_bab, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,Kzwi,ZxzwWy->KWZ', X_bab, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kzwi,ZxzwyW->KWZ', X_bab, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kzwi,ZxzyWw->KWZ', X_bab, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('ixZ,Kyiz,yz,Wx->KWZ', X_aaa, v_xaxa, rdm_ca, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('ixZ,Kyzi,yz,Wx->KWZ', X_aaa, v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,Kziw,zw,WyZx->KWZ', X_aaa, v_xaxa, rdm_ca, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,Kziw,zw,WyxZ->KWZ', X_aaa, v_xaxa, rdm_ca, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kzwi,zw,WyZx->KWZ', X_aaa, v_xaax, rdm_ca, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kzwi,zw,WyxZ->KWZ', X_aaa, v_xaax, rdm_ca, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/3 * einsum('ixy,Kziw,zw,WyZx->KWZ', X_abb, v_xaxa, rdm_ca, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,Kziw,zw,WyxZ->KWZ', X_abb, v_xaxa, rdm_ca, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,Kzwi,zw,WyZx->KWZ', X_abb, v_xaax, rdm_ca, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kzwi,zw,WyxZ->KWZ', X_abb, v_xaax, rdm_ca, rdm_ccaa, optimize = einsum_type)
        sigma[s_caa__aaa:f_caa__aaa] += sigma_caa.reshape(-1).copy()

        sigma_caa  = 1/3 * einsum('ixy,Kyiz,WzZx->KWZ', X_aaa, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,Kyiz,WzxZ->KWZ', X_aaa, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/3 * einsum('ixy,Kyzi,WzZx->KWZ', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,Kyzi,WzxZ->KWZ', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,KziZ,Wyxz->KWZ', X_aaa, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('ixy,KziZ,Wyzx->KWZ', X_aaa, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kziw,ZxzWwy->KWZ', X_aaa, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('ixy,Kziw,ZxzWyw->KWZ', X_aaa, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kziw,ZxzwWy->KWZ', X_aaa, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kziw,ZxzwyW->KWZ', X_aaa, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kziw,ZxzyWw->KWZ', X_aaa, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kziw,ZxzywW->KWZ', X_aaa, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kzwi,ZxzWwy->KWZ', X_aaa, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,Kzwi,ZxzWyw->KWZ', X_aaa, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kzwi,ZxzwyW->KWZ', X_aaa, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kzwi,ZxzyWw->KWZ', X_aaa, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('ixZ,Kyiz,Wzxy->KWZ', X_abb, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/3 * einsum('ixZ,Kyzi,Wzxy->KWZ', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixZ,Kyzi,Wzyx->KWZ', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('ixy,KyiZ,Wx->KWZ', X_abb, v_xaxa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,Kyiz,WzZx->KWZ', X_abb, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,Kyiz,WzxZ->KWZ', X_abb, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,KziZ,Wyxz->KWZ', X_abb, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,KziZ,Wyzx->KWZ', X_abb, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kziw,ZxzWwy->KWZ', X_abb, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kziw,ZxzWyw->KWZ', X_abb, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kziw,ZxzwWy->KWZ', X_abb, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kziw,ZxzwyW->KWZ', X_abb, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('ixy,Kziw,ZxzyWw->KWZ', X_abb, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kziw,ZxzywW->KWZ', X_abb, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kzwi,ZxzWyw->KWZ', X_abb, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kzwi,ZxzwWy->KWZ', X_abb, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,Kzwi,ZxzyWw->KWZ', X_abb, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kzwi,ZxzywW->KWZ', X_abb, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixZ,Kyzi,Wzxy->KWZ', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('ixZ,Kyzi,Wzyx->KWZ', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/3 * einsum('ixy,Kyzi,WzZx->KWZ', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,Kyzi,WzxZ->KWZ', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kzwi,ZxzWwy->KWZ', X_bab, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kzwi,ZxzwyW->KWZ', X_bab, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kzwi,ZxzyWw->KWZ', X_bab, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,Kzwi,ZxzywW->KWZ', X_bab, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/3 * einsum('ixy,Kziw,zw,WyZx->KWZ', X_aaa, v_xaxa, rdm_ca, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,Kziw,zw,WyxZ->KWZ', X_aaa, v_xaxa, rdm_ca, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,Kzwi,zw,WyZx->KWZ', X_aaa, v_xaax, rdm_ca, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kzwi,zw,WyxZ->KWZ', X_aaa, v_xaax, rdm_ca, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('ixZ,Kyiz,yz,Wx->KWZ', X_abb, v_xaxa, rdm_ca, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('ixZ,Kyzi,yz,Wx->KWZ', X_abb, v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,Kziw,zw,WyZx->KWZ', X_abb, v_xaxa, rdm_ca, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,Kziw,zw,WyxZ->KWZ', X_abb, v_xaxa, rdm_ca, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kzwi,zw,WyZx->KWZ', X_abb, v_xaax, rdm_ca, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kzwi,zw,WyxZ->KWZ', X_abb, v_xaax, rdm_ca, rdm_ccaa, optimize = einsum_type)
        sigma[s_caa__abb:f_caa__abb] += sigma_caa.reshape(-1).copy()
        sigma_caa =- 1/2 * einsum('ixy,KyZi,Wx->KWZ', X_aaa, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,Kyzi,WzZx->KWZ', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('ixy,Kyzi,WzxZ->KWZ', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,KzZi,Wyxz->KWZ', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,KzZi,Wyzx->KWZ', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kzwi,ZxzWwy->KWZ', X_aaa, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,Kzwi,ZxzwWy->KWZ', X_aaa, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kzwi,ZxzwyW->KWZ', X_aaa, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kzwi,ZxzyWw->KWZ', X_aaa, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixZ,Kyzi,Wzxy->KWZ', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('ixZ,Kyzi,Wzyx->KWZ', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,KzZi,Wyxz->KWZ', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/3 * einsum('ixy,KzZi,Wyzx->KWZ', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kzwi,ZxzWyw->KWZ', X_abb, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kzwi,ZxzwWy->KWZ', X_abb, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,Kzwi,ZxzwyW->KWZ', X_abb, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kzwi,ZxzywW->KWZ', X_abb, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('ixZ,Kyiz,Wzxy->KWZ', X_bab, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/3 * einsum('ixZ,Kyzi,Wzxy->KWZ', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixZ,Kyzi,Wzyx->KWZ', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('ixy,KyZi,Wx->KWZ', X_bab, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('ixy,KyiZ,Wx->KWZ', X_bab, v_xaxa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,Kyiz,WzZx->KWZ', X_bab, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/3 * einsum('ixy,Kyiz,WzxZ->KWZ', X_bab, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,Kyzi,WzZx->KWZ', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('ixy,Kyzi,WzxZ->KWZ', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('ixy,KzZi,Wyxz->KWZ', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,KzZi,Wyzx->KWZ', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/3 * einsum('ixy,KziZ,Wyxz->KWZ', X_bab, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,KziZ,Wyzx->KWZ', X_bab, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kziw,ZxzWwy->KWZ', X_bab, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kziw,ZxzWyw->KWZ', X_bab, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kziw,ZxzwWy->KWZ', X_bab, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kziw,ZxzwyW->KWZ', X_bab, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('ixy,Kziw,ZxzyWw->KWZ', X_bab, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kziw,ZxzywW->KWZ', X_bab, v_xaxa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kzwi,ZxzWwy->KWZ', X_bab, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,Kzwi,ZxzwWy->KWZ', X_bab, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kzwi,ZxzwyW->KWZ', X_bab, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ixy,Kzwi,ZxzyWw->KWZ', X_bab, v_xaax, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('ixZ,Kyiz,yz,Wx->KWZ', X_bab, v_xaxa, rdm_ca, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('ixZ,Kyzi,yz,Wx->KWZ', X_bab, v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ixy,Kziw,zw,WyZx->KWZ', X_bab, v_xaxa, rdm_ca, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('ixy,Kziw,zw,WyxZ->KWZ', X_bab, v_xaxa, rdm_ca, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ixy,Kzwi,zw,WyZx->KWZ', X_bab, v_xaax, rdm_ca, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ixy,Kzwi,zw,WyxZ->KWZ', X_bab, v_xaax, rdm_ca, rdm_ccaa, optimize = einsum_type)
        sigma[s_caa__bab:f_caa__bab] += sigma_caa.reshape(-1).copy()

        # CCA <- CAA
        sigma_cca  = einsum('KxW,Lx->KLW', X_aaa, h_xa, optimize = einsum_type)
        sigma_cca -= einsum('LxW,Kx->KLW', X_aaa, h_xa, optimize = einsum_type)
        sigma_cca -= einsum('KxW,L,Lx->KLW', X_aaa, e_cvs, t1_xa, optimize = einsum_type)
        sigma_cca += einsum('LxW,K,Kx->KLW', X_aaa, e_cvs, t1_xa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lx,Wy->KLW', X_aaa, h_xa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kx,Wy->KLW', X_aaa, h_xa, rdm_ca, optimize = einsum_type)
        sigma_cca += einsum('KxW,xy,Ly->KLW', X_aaa, h_aa, t1_xa, optimize = einsum_type)
        sigma_cca -= einsum('LxW,xy,Ky->KLW', X_aaa, h_aa, t1_xa, optimize = einsum_type)
        sigma_cca += einsum('KxW,Lyxz,yz->KLW', X_aaa, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('KxW,Lyzx,yz->KLW', X_aaa, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LyWz,xz->KLW', X_aaa, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LyzW,xz->KLW', X_aaa, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lyzw,Wxwz->KLW', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lyzw,Wxzw->KLW', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzWx,yz->KLW', X_aaa, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwx,Wzwy->KLW', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwx,Wzyw->KLW', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LzxW,yz->KLW', X_aaa, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzxw,Wzyw->KLW', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= einsum('LxW,Kyxz,yz->KLW', X_aaa, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('LxW,Kyzx,yz->KLW', X_aaa, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,KyWz,xz->KLW', X_aaa, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,KyzW,xz->KLW', X_aaa, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kyzw,Wxwz->KLW', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kyzw,Wxzw->KLW', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,KzWx,yz->KLW', X_aaa, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwx,Wzwy->KLW', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwx,Wzyw->KLW', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,KzxW,yz->KLW', X_aaa, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kzxw,Wzyw->KLW', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('ixW,KLiy,xy->KLW', X_aaa, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('ixW,LKiy,xy->KLW', X_aaa, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('ixy,KLiW,xy->KLW', X_aaa, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('ixy,KLiz,Wxyz->KLW', X_aaa, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('ixy,KLiz,Wxzy->KLW', X_aaa, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('ixy,LKiW,xy->KLW', X_aaa, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('ixy,LKiz,Wxyz->KLW', X_aaa, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('ixy,LKiz,Wxzy->KLW', X_aaa, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LyWz,xz->KLW', X_abb, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lyzw,Wxwz->KLW', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,Lyzw,Wxzw->KLW', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzWx,yz->KLW', X_abb, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,Lzwx,Wzwy->KLW', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwx,Wzyw->KLW', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,KyWz,xz->KLW', X_abb, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kyzw,Wxwz->KLW', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,Kyzw,Wxzw->KLW', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,KzWx,yz->KLW', X_abb, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,Kzwx,Wzwy->KLW', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwx,Wzyw->KLW', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('ixy,KLiW,xy->KLW', X_abb, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('ixy,KLiz,Wxyz->KLW', X_abb, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('ixy,KLiz,Wxzy->KLW', X_abb, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('ixy,LKiW,xy->KLW', X_abb, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('ixy,LKiz,Wxyz->KLW', X_abb, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('ixy,LKiz,Wxzy->KLW', X_abb, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= einsum('KxW,L,Lyxz,yz->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('KxW,L,Lyzx,yz->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,L,Lx,Wy->KLW', X_aaa, e_cvs, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,L,LyWz,xz->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,L,LyzW,xz->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,L,Lyzw,Wxwz->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,L,Lyzw,Wxzw->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,L,LzWx,yz->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,L,Lzwx,Wzwy->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,L,Lzwx,Wzyw->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,L,LzxW,yz->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,L,Lzxw,Wzyw->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += einsum('LxW,K,Kyxz,yz->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('LxW,K,Kyzx,yz->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,K,Kx,Wy->KLW', X_aaa, e_cvs, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,K,KyWz,xz->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,K,KyzW,xz->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,K,Kyzw,Wxwz->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,K,Kyzw,Wxzw->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,K,KzWx,yz->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,K,Kzwx,Wzwy->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,K,Kzwx,Wzyw->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,K,KzxW,yz->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,K,Kzxw,Wzyw->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('KxW,xy,Lzwy,zw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += einsum('KxW,xy,Lzyw,zw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += einsum('KxW,yz,Lwxy,zw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('KxW,yz,Lwyx,zw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('KxW,yz,Lywx,zw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= einsum('KxW,yz,Lyxw,zw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Wz,Lwxz,yw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Wz,Lwzx,yw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Wz,Lywz,xw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Wz,Lyzw,xw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,xz,LwWz,yw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,xz,Lwuz,Wwuy->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,xz,Lwuz,Wwyu->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,xz,LwzW,yw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,xz,Lwzu,Wwyu->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,xz,Lz,Wy->KLW', X_aaa, h_aa, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,yz,LzWw,xw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,yz,LzwW,xw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,yz,Lzwu,Wxuw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,yz,Lzwu,Wxwu->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,zw,Luxz,Wuyw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,zw,Luzx,Wuwy->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,zw,Luzx,Wuyw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,zw,LyWz,xw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,zw,Lyuz,Wxuw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,zw,Lyuz,Wxwu->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,zw,LyzW,xw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,zw,Lyzu,Wxuw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,zw,Lyzu,Wxwu->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,zw,LzWx,yw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,zw,Lzux,Wwuy->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,zw,Lzux,Wwyu->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,zw,LzxW,yw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,zw,Lzxu,Wwyu->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('LxW,xy,Kzwy,zw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= einsum('LxW,xy,Kzyw,zw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= einsum('LxW,yz,Kwxy,zw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('LxW,yz,Kwyx,zw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('LxW,yz,Kywx,zw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += einsum('LxW,yz,Kyxw,zw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Wz,Kwxz,yw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Wz,Kwzx,yw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Wz,Kywz,xw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Wz,Kyzw,xw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,xz,KwWz,yw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,xz,Kwuz,Wwuy->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,xz,Kwuz,Wwyu->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,xz,KwzW,yw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,xz,Kwzu,Wwyu->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,xz,Kz,Wy->KLW', X_aaa, h_aa, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,yz,KzWw,xw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,yz,KzwW,xw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,yz,Kzwu,Wxuw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,yz,Kzwu,Wxwu->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,zw,Kuxz,Wuyw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,zw,Kuzx,Wuwy->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,zw,Kuzx,Wuyw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,zw,KyWz,xw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,zw,Kyuz,Wxuw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,zw,Kyuz,Wxwu->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,zw,KyzW,xw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,zw,Kyzu,Wxuw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,zw,Kyzu,Wxwu->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,zw,KzWx,yw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,zw,Kzux,Wwuy->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,zw,Kzux,Wwyu->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,zw,KzxW,yw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,zw,Kzxu,Wwyu->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('KxW,Ly,xzwy,zw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += einsum('KxW,Ly,xzyw,zw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= einsum('KxW,Lyxz,ywuv,zwuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += einsum('KxW,Lyxz,zwuv,ywuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('KxW,Lyzw,xuvw,yvuz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('KxW,Lyzw,xuvz,yvwu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('KxW,Lyzw,xuwv,yvzu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('KxW,Lyzw,xuwz,yu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += einsum('KxW,Lyzw,xuzv,yvwu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += einsum('KxW,Lyzw,xuzw,yu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('KxW,Lyzw,xyuv,zwuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('KxW,Lyzx,ywuv,zwuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('KxW,Lyzx,zwuv,ywuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LyWz,zwuv,xwuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LyzW,zwuv,xwuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lyzw,Wuvw,xvuz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lyzw,Wuvw,xvzu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lyzw,Wuvz,xvuw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lyzw,Wuvz,xvwu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lyzw,Wuwv,xvzu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lyzw,Wuwz,xu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lyzw,Wuzv,xvwu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lyzw,Wuzw,xu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lyzw,wuvs,Wxusvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuszv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuvsz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Kxy,Lyzw,wuvs,Wxuvzs->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuzsv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 5/24 * einsum('Kxy,Lyzw,wuvs,Wxuzvs->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lyzw,zuvs,Wxusvw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lyzw,zuvs,Wxuswv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lyzw,zuvs,Wxuvsw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lyzw,zuvs,Wxuvws->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lyzw,zuvs,Wxuwsv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 5/24 * einsum('Kxy,Lyzw,zuvs,Wxuwvs->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lyzw,zwuv,Wxuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lyzw,zwuv,Wxvu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lz,Wwyz,xw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lz,Wwzy,xw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lz,Wxwz,yw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lz,Wxzw,yw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lz,xwuz,Wuwy->KLW', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lz,xwuz,Wuyw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lz,xwzu,Wuyw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lz,yzwu,Wxuw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lz,yzwu,Wxwu->KLW', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzWw,xuvw,yuvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzWw,xuwv,yuzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LzWw,xzuv,ywuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzWw,yuvz,xuvw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzWw,yuzv,xuwv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LzWw,ywuv,xzuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LzWx,zwuv,ywuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,LzwW,xuvw,yuvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,LzwW,xuvw,yuzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LzwW,xuwv,yuzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,LzwW,xzuv,ywuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,LzwW,xzuv,ywvu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,LzwW,yuvz,xuvw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,LzwW,yuvz,xuwv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LzwW,yuzv,xuwv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,LzwW,ywuv,xzuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,LzwW,ywuv,xzvu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,Wvuy,xzvw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,Wvuy,xzwv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzwu,Wvwy,xzvu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lzwu,Wvyu,xzwv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lzwu,Wvyw,xzvu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,Wxuv,ywvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,Wxuv,ywzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzwu,Wxuw,yz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,Wxvu,ywvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,Wxvu,ywzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzwu,Wxvw,yuvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lzwu,Wxwu,yz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lzwu,Wxwv,yuvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,Wzvy,xvuw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,Wzvy,xvwu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzwu,Wzyv,xvwu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsvwy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsvyw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,xvsu,Wzswvy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzswyv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('Kxy,Lzwu,xvsu,Wzsyvw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsywv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,xvsw,Wzsvuy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,xvsw,Wzsyuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,xvus,Wzswyv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,xvus,Wzsywv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,xvuw,Wzvy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,xvuw,Wzyv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzwu,xvws,Wzsyuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzwu,xvwu,Wzyv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,xzvs,Wvsuwy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,xzvs,Wvsuyw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,xzvs,Wvswuy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lzwu,xzvs,Wvswyu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,xzvs,Wvsyuw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 5/24 * einsum('Kxy,Lzwu,xzvs,Wvsywu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzsvw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzswv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzvsw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Kxy,Lzwu,yuvs,Wxzvws->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzwsv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 5/24 * einsum('Kxy,Lzwu,yuvs,Wxzwvs->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvsuw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lzwu,yvsz,Wxvswu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvusw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvuws->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 5/24 * einsum('Kxy,Lzwu,yvsz,Wxvwsu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvwus->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,yvzs,Wxvuws->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,yvzs,Wxvwus->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,ywvs,Wxzsvu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,ywvs,Wxzvsu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwx,Wuvw,yuvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwx,Wuvw,yuzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lzwx,Wuwv,yuzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwx,Wzuv,ywuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwx,Wzuv,ywvu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lzwx,wuvs,Wzusvy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lzwx,wuvs,Wzusyv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lzwx,wuvs,Wzuvsy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Kxy,Lzwx,wuvs,Wzuvys->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lzwx,wuvs,Wzuysv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 5/24 * einsum('Kxy,Lzwx,wuvs,Wzuyvs->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsuwy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsuyw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvswuy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lzwx,zuvs,Wvswyu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsyuw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 5/24 * einsum('Kxy,Lzwx,zuvs,Wvsywu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzxW,zwuv,ywuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzxw,Wuvw,yuvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzxw,Wuwv,yuzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lzxw,Wzuv,ywuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzxw,wuvs,Wzuyvs->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lzxw,zuvs,Wvsywu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('LxW,Ky,xzwy,zw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= einsum('LxW,Ky,xzyw,zw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += einsum('LxW,Kyxz,ywuv,zwuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= einsum('LxW,Kyxz,zwuv,ywuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('LxW,Kyzw,xuvw,yvuz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('LxW,Kyzw,xuvz,yvwu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('LxW,Kyzw,xuwv,yvzu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('LxW,Kyzw,xuwz,yu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= einsum('LxW,Kyzw,xuzv,yvwu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= einsum('LxW,Kyzw,xuzw,yu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('LxW,Kyzw,xyuv,zwuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('LxW,Kyzx,ywuv,zwuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('LxW,Kyzx,zwuv,ywuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,KyWz,zwuv,xwuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,KyzW,zwuv,xwuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kyzw,Wuvw,xvuz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kyzw,Wuvw,xvzu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kyzw,Wuvz,xvuw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kyzw,Wuvz,xvwu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kyzw,Wuwv,xvzu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kyzw,Wuwz,xu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kyzw,Wuzv,xvwu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kyzw,Wuzw,xu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kyzw,wuvs,Wxusvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kyzw,wuvs,Wxuszv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kyzw,wuvs,Wxuvsz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Lxy,Kyzw,wuvs,Wxuvzs->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kyzw,wuvs,Wxuzsv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 5/24 * einsum('Lxy,Kyzw,wuvs,Wxuzvs->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kyzw,zuvs,Wxusvw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kyzw,zuvs,Wxuswv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kyzw,zuvs,Wxuvsw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Lxy,Kyzw,zuvs,Wxuvws->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kyzw,zuvs,Wxuwsv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 5/24 * einsum('Lxy,Kyzw,zuvs,Wxuwvs->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kyzw,zwuv,Wxuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kyzw,zwuv,Wxvu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kz,Wwyz,xw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kz,Wwzy,xw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kz,Wxwz,yw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kz,Wxzw,yw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kz,xwuz,Wuwy->KLW', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kz,xwuz,Wuyw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kz,xwzu,Wuyw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kz,yzwu,Wxuw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kz,yzwu,Wxwu->KLW', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,KzWw,xuvw,yuvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,KzWw,xuwv,yuzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,KzWw,xzuv,ywuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,KzWw,yuvz,xuvw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,KzWw,yuzv,xuwv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,KzWw,ywuv,xzuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,KzWx,zwuv,ywuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,KzwW,xuvw,yuvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,KzwW,xuvw,yuzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,KzwW,xuwv,yuzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,KzwW,xzuv,ywuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,KzwW,xzuv,ywvu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,KzwW,yuvz,xuvw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,KzwW,yuvz,xuwv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,KzwW,yuzv,xuwv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,KzwW,ywuv,xzuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,KzwW,ywuv,xzvu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwu,Wvuy,xzvw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwu,Wvuy,xzwv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kzwu,Wvwy,xzvu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kzwu,Wvyu,xzwv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kzwu,Wvyw,xzvu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwu,Wxuv,ywvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwu,Wxuv,ywzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kzwu,Wxuw,yz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwu,Wxvu,ywvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwu,Wxvu,ywzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kzwu,Wxvw,yuvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kzwu,Wxwu,yz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kzwu,Wxwv,yuvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwu,Wzvy,xvuw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwu,Wzvy,xvwu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kzwu,Wzyv,xvwu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Lxy,Kzwu,xvsu,Wzsvwy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Lxy,Kzwu,xvsu,Wzsvyw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Lxy,Kzwu,xvsu,Wzswvy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Lxy,Kzwu,xvsu,Wzswyv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('Lxy,Kzwu,xvsu,Wzsyvw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Lxy,Kzwu,xvsu,Wzsywv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwu,xvsw,Wzsvuy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwu,xvsw,Wzsyuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwu,xvus,Wzswyv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwu,xvus,Wzsywv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwu,xvuw,Wzvy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwu,xvuw,Wzyv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kzwu,xvws,Wzsyuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kzwu,xvwu,Wzyv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwu,xzvs,Wvsuwy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwu,xzvs,Wvsuyw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwu,xzvs,Wvswuy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Lxy,Kzwu,xzvs,Wvswyu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwu,xzvs,Wvsyuw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 5/24 * einsum('Lxy,Kzwu,xzvs,Wvsywu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwu,yuvs,Wxzsvw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwu,yuvs,Wxzswv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwu,yuvs,Wxzvsw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Lxy,Kzwu,yuvs,Wxzvws->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwu,yuvs,Wxzwsv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 5/24 * einsum('Lxy,Kzwu,yuvs,Wxzwvs->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwu,yvsz,Wxvsuw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Lxy,Kzwu,yvsz,Wxvswu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwu,yvsz,Wxvusw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwu,yvsz,Wxvuws->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 5/24 * einsum('Lxy,Kzwu,yvsz,Wxvwsu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwu,yvsz,Wxvwus->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwu,yvzs,Wxvuws->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwu,yvzs,Wxvwus->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwu,ywvs,Wxzsvu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwu,ywvs,Wxzvsu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwx,Wuvw,yuvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwx,Wuvw,yuzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kzwx,Wuwv,yuzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwx,Wzuv,ywuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwx,Wzuv,ywvu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwx,wuvs,Wzusvy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwx,wuvs,Wzusyv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwx,wuvs,Wzuvsy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Lxy,Kzwx,wuvs,Wzuvys->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwx,wuvs,Wzuysv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 5/24 * einsum('Lxy,Kzwx,wuvs,Wzuyvs->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwx,zuvs,Wvsuwy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwx,zuvs,Wvsuyw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwx,zuvs,Wvswuy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Lxy,Kzwx,zuvs,Wvswyu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwx,zuvs,Wvsyuw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 5/24 * einsum('Lxy,Kzwx,zuvs,Wvsywu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,KzxW,zwuv,ywuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kzxw,Wuvw,yuvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kzxw,Wuwv,yuzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kzxw,Wzuv,ywuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kzxw,wuvs,Wzuyvs->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kzxw,zuvs,Wvsywu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,L,LyWz,xz->KLW', X_abb, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,L,Lyzw,Wxwz->KLW', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,L,Lyzw,Wxzw->KLW', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,L,LzWx,yz->KLW', X_abb, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,L,Lzwx,Wzwy->KLW', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,L,Lzwx,Wzyw->KLW', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,K,KyWz,xz->KLW', X_abb, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,K,Kyzw,Wxwz->KLW', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,K,Kyzw,Wxzw->KLW', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,K,KzWx,yz->KLW', X_abb, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,K,Kzwx,Wzwy->KLW', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,K,Kzwx,Wzyw->KLW', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Wz,Lwzx,yw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Wz,Lyzw,xw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,xz,LwWz,yw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,xz,Lwuz,Wwuy->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,xz,Lwuz,Wwyu->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,yz,LzWw,xw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,yz,Lzwu,Wxuw->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,yz,Lzwu,Wxwu->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,zw,Luzx,Wuwy->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,zw,Luzx,Wuyw->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,zw,LyWz,xw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,zw,Lyuz,Wxuw->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,zw,Lyuz,Wxwu->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,zw,Lyzu,Wxuw->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,zw,Lyzu,Wxwu->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,zw,LzWx,yw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,zw,Lzux,Wwuy->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,zw,Lzux,Wwyu->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Wz,Kwzx,yw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Wz,Kyzw,xw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,xz,KwWz,yw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,xz,Kwuz,Wwuy->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,xz,Kwuz,Wwyu->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,yz,KzWw,xw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,yz,Kzwu,Wxuw->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,yz,Kzwu,Wxwu->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,zw,Kuzx,Wuwy->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,zw,Kuzx,Wuyw->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,zw,KyWz,xw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,zw,Kyuz,Wxuw->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,zw,Kyuz,Wxwu->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,zw,Kyzu,Wxuw->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,zw,Kyzu,Wxwu->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,zw,KzWx,yw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,zw,Kzux,Wwuy->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,zw,Kzux,Wwyu->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LyWz,zwuv,xwuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,Lyzw,Wuvw,xvuz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lyzw,Wuvw,xvzu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lyzw,Wuvz,xvuw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,Lyzw,Wuvz,xvwu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lyzw,Wuzv,xvwu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lyzw,Wuzw,xu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lyzw,wuvs,Wxusvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuszv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuvsz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lyzw,wuvs,Wxuvzs->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuzsv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 7/24 * einsum('Kxy,Lyzw,wuvs,Wxuzvs->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Kxy,Lyzw,zuvs,Wxusvw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Kxy,Lyzw,zuvs,Wxuswv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Kxy,Lyzw,zuvs,Wxuvsw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 5/24 * einsum('Kxy,Lyzw,zuvs,Wxuvws->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Kxy,Lyzw,zuvs,Wxuwsv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lyzw,zuvs,Wxuwvs->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,Lyzw,zwuv,Wxuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lyzw,zwuv,Wxvu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lz,Wwzy,xw->KLW', X_abb, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lz,Wxzw,yw->KLW', X_abb, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,Lz,xwuz,Wuwy->KLW', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lz,xwuz,Wuyw->KLW', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,Lz,yzwu,Wxuw->KLW', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lz,yzwu,Wxwu->KLW', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzWw,xuvw,yuvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzWw,xuwv,yuzv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LzWw,xzuv,ywuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzWw,yuvz,xuvw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzWw,yuzv,xuwv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LzWw,ywuv,xzuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LzWx,zwuv,ywuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,LzwW,xuvw,yuvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,LzwW,xuvw,yuzv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,LzwW,xzuv,ywuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,LzwW,xzuv,ywvu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,LzwW,yuvz,xuvw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,LzwW,yuvz,xuwv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,LzwW,ywuv,xzuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,LzwW,ywuv,xzvu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,Lzwu,Wvuy,xzvw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,Wvuy,xzwv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzwu,Wvwy,xzvu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,Lzwu,Wxuv,ywvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,Wxuv,ywzv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,Wxvu,ywvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,Lzwu,Wxvu,ywzv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lzwu,Wxwu,yz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lzwu,Wxwv,yuvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,Lzwu,Wzvy,xvuw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,Wzvy,xvwu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsvwy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsvyw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('Kxy,Lzwu,xvsu,Wzswvy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzswyv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsyvw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsywv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,Lzwu,xvsw,Wzsvuy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,xvsw,Wzsyuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,xvus,Wzsvwy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,xvus,Wzsvyw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,xvus,Wzswvy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,xvus,Wzswyv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,xvus,Wzsyvw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,Lzwu,xvuw,Wzvy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,xvuw,Wzyv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,xzvs,Wvsuwy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,xzvs,Wvsuyw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,xzvs,Wvswuy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('Kxy,Lzwu,xzvs,Wvswyu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,xzvs,Wvsyuw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,xzvs,Wvsywu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzsvw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzswv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzvsw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lzwu,yuvs,Wxzvws->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzwsv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 7/24 * einsum('Kxy,Lzwu,yuvs,Wxzwvs->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvsuw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Kxy,Lzwu,yvsz,Wxvswu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvusw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvuws->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 7/24 * einsum('Kxy,Lzwu,yvsz,Wxvwsu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvwus->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvsuw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvswu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvusw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvuws->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvwsu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('Kxy,Lzwu,yvzs,Wxvwus->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzsuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('Kxy,Lzwu,ywvs,Wxzsvu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzusv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzuvs->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzvsu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzvus->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwx,Wuvw,yuvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,Lzwx,Wuvw,yuzv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lzwx,Wuwv,yuzv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwx,Wzuv,ywuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,Lzwx,Wzuv,ywvu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lzwx,wuvs,Wzusvy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lzwx,wuvs,Wzusyv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lzwx,wuvs,Wzuvsy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 5/24 * einsum('Kxy,Lzwx,wuvs,Wzuvys->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lzwx,wuvs,Wzuysv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwx,wuvs,Wzuyvs->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsuwy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsuyw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvswuy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 7/24 * einsum('Kxy,Lzwx,zuvs,Wvswyu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsyuw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lzwx,zuvs,Wvsywu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,KyWz,zwuv,xwuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,Kyzw,Wuvw,xvuz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kyzw,Wuvw,xvzu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kyzw,Wuvz,xvuw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,Kyzw,Wuvz,xvwu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kyzw,Wuzv,xvwu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kyzw,Wuzw,xu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kyzw,wuvs,Wxusvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kyzw,wuvs,Wxuszv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kyzw,wuvs,Wxuvsz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Lxy,Kyzw,wuvs,Wxuvzs->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kyzw,wuvs,Wxuzsv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 7/24 * einsum('Lxy,Kyzw,wuvs,Wxuzvs->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Lxy,Kyzw,zuvs,Wxusvw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Lxy,Kyzw,zuvs,Wxuswv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Lxy,Kyzw,zuvs,Wxuvsw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 5/24 * einsum('Lxy,Kyzw,zuvs,Wxuvws->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Lxy,Kyzw,zuvs,Wxuwsv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kyzw,zuvs,Wxuwvs->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,Kyzw,zwuv,Wxuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kyzw,zwuv,Wxvu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kz,Wwzy,xw->KLW', X_abb, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kz,Wxzw,yw->KLW', X_abb, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,Kz,xwuz,Wuwy->KLW', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kz,xwuz,Wuyw->KLW', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,Kz,yzwu,Wxuw->KLW', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kz,yzwu,Wxwu->KLW', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,KzWw,xuvw,yuvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,KzWw,xuwv,yuzv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,KzWw,xzuv,ywuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,KzWw,yuvz,xuvw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,KzWw,yuzv,xuwv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,KzWw,ywuv,xzuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,KzWx,zwuv,ywuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,KzwW,xuvw,yuvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,KzwW,xuvw,yuzv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,KzwW,xzuv,ywuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,KzwW,xzuv,ywvu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,KzwW,yuvz,xuvw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,KzwW,yuvz,xuwv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,KzwW,ywuv,xzuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,KzwW,ywuv,xzvu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,Kzwu,Wvuy,xzvw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwu,Wvuy,xzwv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kzwu,Wvwy,xzvu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,Kzwu,Wxuv,ywvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwu,Wxuv,ywzv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwu,Wxvu,ywvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,Kzwu,Wxvu,ywzv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kzwu,Wxwu,yz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kzwu,Wxwv,yuvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,Kzwu,Wzvy,xvuw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwu,Wzvy,xvwu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Lxy,Kzwu,xvsu,Wzsvwy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Lxy,Kzwu,xvsu,Wzsvyw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('Lxy,Kzwu,xvsu,Wzswvy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Lxy,Kzwu,xvsu,Wzswyv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Lxy,Kzwu,xvsu,Wzsyvw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Lxy,Kzwu,xvsu,Wzsywv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,Kzwu,xvsw,Wzsvuy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwu,xvsw,Wzsyuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwu,xvus,Wzsvwy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwu,xvus,Wzsvyw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwu,xvus,Wzswvy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwu,xvus,Wzswyv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwu,xvus,Wzsyvw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,Kzwu,xvuw,Wzvy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwu,xvuw,Wzyv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Lxy,Kzwu,xzvs,Wvsuwy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Lxy,Kzwu,xzvs,Wvsuyw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Lxy,Kzwu,xzvs,Wvswuy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('Lxy,Kzwu,xzvs,Wvswyu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Lxy,Kzwu,xzvs,Wvsyuw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Lxy,Kzwu,xzvs,Wvsywu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwu,yuvs,Wxzsvw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwu,yuvs,Wxzswv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwu,yuvs,Wxzvsw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Lxy,Kzwu,yuvs,Wxzvws->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwu,yuvs,Wxzwsv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 7/24 * einsum('Lxy,Kzwu,yuvs,Wxzwvs->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwu,yvsz,Wxvsuw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Lxy,Kzwu,yvsz,Wxvswu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwu,yvsz,Wxvusw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwu,yvsz,Wxvuws->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 7/24 * einsum('Lxy,Kzwu,yvsz,Wxvwsu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwu,yvsz,Wxvwus->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Lxy,Kzwu,yvzs,Wxvsuw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Lxy,Kzwu,yvzs,Wxvswu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Lxy,Kzwu,yvzs,Wxvusw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Lxy,Kzwu,yvzs,Wxvuws->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Lxy,Kzwu,yvzs,Wxvwsu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('Lxy,Kzwu,yvzs,Wxvwus->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Lxy,Kzwu,ywvs,Wxzsuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('Lxy,Kzwu,ywvs,Wxzsvu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Lxy,Kzwu,ywvs,Wxzusv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Lxy,Kzwu,ywvs,Wxzuvs->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Lxy,Kzwu,ywvs,Wxzvsu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Lxy,Kzwu,ywvs,Wxzvus->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwx,Wuvw,yuvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,Kzwx,Wuvw,yuzv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kzwx,Wuwv,yuzv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwx,Wzuv,ywuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,Kzwx,Wzuv,ywvu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Lxy,Kzwx,wuvs,Wzusvy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Lxy,Kzwx,wuvs,Wzusyv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Lxy,Kzwx,wuvs,Wzuvsy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 5/24 * einsum('Lxy,Kzwx,wuvs,Wzuvys->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Lxy,Kzwx,wuvs,Wzuysv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwx,wuvs,Wzuyvs->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwx,zuvs,Wvsuwy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwx,zuvs,Wvsuyw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwx,zuvs,Wvswuy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 7/24 * einsum('Lxy,Kzwx,zuvs,Wvswyu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwx,zuvs,Wvsyuw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Lxy,Kzwx,zuvs,Wvsywu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma[s_cca__aaa:f_cca__aaa] += sigma_cca[cvs_tril_ind[0], cvs_tril_ind[1]].reshape(-1).copy()

        sigma_cca  = einsum('KxW,Lx->KLW', X_abb, h_xa, optimize = einsum_type)
        sigma_cca -= einsum('LxW,Kx->KLW', X_bab, h_xa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LyWz,xz->KLW', X_aaa, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lyzw,Wxwz->KLW', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,Lyzw,Wxzw->KLW', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzWx,yz->KLW', X_aaa, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,Lzwx,Wzwy->KLW', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwx,Wzyw->KLW', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('ixy,KLiW,xy->KLW', X_aaa, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('ixy,KLiz,Wxyz->KLW', X_aaa, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('ixy,KLiz,Wxzy->KLW', X_aaa, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= einsum('KxW,L,Lx->KLW', X_abb, e_cvs, t1_xa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lx,Wy->KLW', X_abb, h_xa, rdm_ca, optimize = einsum_type)
        sigma_cca += einsum('KxW,xy,Ly->KLW', X_abb, h_aa, t1_xa, optimize = einsum_type)
        sigma_cca += einsum('KxW,Lyxz,yz->KLW', X_abb, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('KxW,Lyzx,yz->KLW', X_abb, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LyWz,xz->KLW', X_abb, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LyzW,xz->KLW', X_abb, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lyzw,Wxwz->KLW', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lyzw,Wxzw->KLW', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzWx,yz->KLW', X_abb, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwx,Wzwy->KLW', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwx,Wzyw->KLW', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LzxW,yz->KLW', X_abb, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzxw,Wzyw->KLW', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('ixW,KLiy,xy->KLW', X_abb, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('ixy,KLiW,xy->KLW', X_abb, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('ixy,KLiz,Wxyz->KLW', X_abb, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('ixy,KLiz,Wxzy->KLW', X_abb, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += einsum('LxW,K,Kx->KLW', X_bab, e_cvs, t1_xa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kx,Wy->KLW', X_bab, h_xa, rdm_ca, optimize = einsum_type)
        sigma_cca -= einsum('LxW,xy,Ky->KLW', X_bab, h_aa, t1_xa, optimize = einsum_type)
        sigma_cca -= einsum('LxW,Kyxz,yz->KLW', X_bab, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('LxW,Kyzx,yz->KLW', X_bab, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,KyzW,xz->KLW', X_bab, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,Kyzw,Wxwz->KLW', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kyzw,Wxzw->KLW', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwx,Wzwy->KLW', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,Kzwx,Wzyw->KLW', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,KzxW,yz->KLW', X_bab, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kzxw,Wzyw->KLW', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('ixW,LKiy,xy->KLW', X_bab, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('ixy,LKiz,Wxyz->KLW', X_bab, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('ixy,LKiz,Wxzy->KLW', X_bab, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,L,LyWz,xz->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,L,Lyzw,Wxwz->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,L,Lyzw,Wxzw->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,L,LzWx,yz->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,L,Lzwx,Wzwy->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,L,Lzwx,Wzyw->KLW', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Wz,Lwzx,yw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Wz,Lyzw,xw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,xz,LwWz,yw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,xz,Lwuz,Wwuy->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,xz,Lwuz,Wwyu->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,yz,LzWw,xw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,yz,Lzwu,Wxuw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,yz,Lzwu,Wxwu->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,zw,Luzx,Wuwy->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,zw,Luzx,Wuyw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,zw,LyWz,xw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,zw,Lyuz,Wxuw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,zw,Lyuz,Wxwu->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,zw,Lyzu,Wxuw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,zw,Lyzu,Wxwu->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,zw,LzWx,yw->KLW', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,zw,Lzux,Wwuy->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,zw,Lzux,Wwyu->KLW', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LyWz,zwuv,xwuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,Lyzw,Wuvw,xvuz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lyzw,Wuvw,xvzu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lyzw,Wuvz,xvuw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,Lyzw,Wuvz,xvwu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lyzw,Wuzv,xvwu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lyzw,Wuzw,xu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lyzw,wuvs,Wxusvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuszv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuvsz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lyzw,wuvs,Wxuvzs->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuzsv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 7/24 * einsum('Kxy,Lyzw,wuvs,Wxuzvs->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Kxy,Lyzw,zuvs,Wxusvw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Kxy,Lyzw,zuvs,Wxuswv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Kxy,Lyzw,zuvs,Wxuvsw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 5/24 * einsum('Kxy,Lyzw,zuvs,Wxuvws->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Kxy,Lyzw,zuvs,Wxuwsv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lyzw,zuvs,Wxuwvs->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,Lyzw,zwuv,Wxuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lyzw,zwuv,Wxvu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lz,Wwzy,xw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lz,Wxzw,yw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,Lz,xwuz,Wuwy->KLW', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lz,xwuz,Wuyw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,Lz,yzwu,Wxuw->KLW', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lz,yzwu,Wxwu->KLW', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzWw,xuvw,yuvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzWw,xuwv,yuzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LzWw,xzuv,ywuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzWw,yuvz,xuvw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzWw,yuzv,xuwv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LzWw,ywuv,xzuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LzWx,zwuv,ywuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,LzwW,xuvw,yuvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,LzwW,xuvw,yuzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,LzwW,xzuv,ywuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,LzwW,xzuv,ywvu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,LzwW,yuvz,xuvw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,LzwW,yuvz,xuwv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,LzwW,ywuv,xzuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,LzwW,ywuv,xzvu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,Lzwu,Wvuy,xzvw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,Wvuy,xzwv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzwu,Wvwy,xzvu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,Lzwu,Wxuv,ywvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,Wxuv,ywzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,Wxvu,ywvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,Lzwu,Wxvu,ywzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lzwu,Wxwu,yz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lzwu,Wxwv,yuvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,Lzwu,Wzvy,xvuw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,Wzvy,xvwu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsvwy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsvyw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('Kxy,Lzwu,xvsu,Wzswvy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzswyv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsyvw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsywv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,Lzwu,xvsw,Wzsvuy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,xvsw,Wzsyuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,xvus,Wzsvwy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,xvus,Wzsvyw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,xvus,Wzswvy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,xvus,Wzswyv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,xvus,Wzsyvw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,Lzwu,xvuw,Wzvy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,xvuw,Wzyv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,xzvs,Wvsuwy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,xzvs,Wvsuyw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,xzvs,Wvswuy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('Kxy,Lzwu,xzvs,Wvswyu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,xzvs,Wvsyuw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,xzvs,Wvsywu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Kxy,Lzwu,yuvs,Wxzsvw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Kxy,Lzwu,yuvs,Wxzswv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Kxy,Lzwu,yuvs,Wxzvsw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzvws->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Kxy,Lzwu,yuvs,Wxzwsv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 5/24 * einsum('Kxy,Lzwu,yuvs,Wxzwvs->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvsuw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Kxy,Lzwu,yvsz,Wxvswu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvusw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvuws->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 7/24 * einsum('Kxy,Lzwu,yvsz,Wxvwsu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvwus->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvsuw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvswu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvusw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvuws->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvwsu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('Kxy,Lzwu,yvzs,Wxvwus->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzsuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('Kxy,Lzwu,ywvs,Wxzsvu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzusv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzuvs->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzvsu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzvus->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwx,Wuvw,yuvz->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kxy,Lzwx,Wuvw,yuzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lzwx,Wuwv,yuzv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwx,Wzuv,ywuv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Kxy,Lzwx,Wzuv,ywvu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lzwx,wuvs,Wzusvy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lzwx,wuvs,Wzusyv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lzwx,wuvs,Wzuvsy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 5/24 * einsum('Kxy,Lzwx,wuvs,Wzuvys->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lzwx,wuvs,Wzuysv->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwx,wuvs,Wzuyvs->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsuwy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsuyw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvswuy->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 7/24 * einsum('Kxy,Lzwx,zuvs,Wvswyu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsyuw->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lzwx,zuvs,Wvsywu->KLW', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= einsum('KxW,L,Lyxz,yz->KLW', X_abb, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('KxW,L,Lyzx,yz->KLW', X_abb, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,L,Lx,Wy->KLW', X_abb, e_cvs, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,L,LyWz,xz->KLW', X_abb, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,L,LyzW,xz->KLW', X_abb, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,L,Lyzw,Wxwz->KLW', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,L,Lyzw,Wxzw->KLW', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,L,LzWx,yz->KLW', X_abb, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,L,Lzwx,Wzwy->KLW', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,L,Lzwx,Wzyw->KLW', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,L,LzxW,yz->KLW', X_abb, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,L,Lzxw,Wzyw->KLW', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('KxW,xy,Lzwy,zw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += einsum('KxW,xy,Lzyw,zw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += einsum('KxW,yz,Lwxy,zw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('KxW,yz,Lwyx,zw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('KxW,yz,Lywx,zw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= einsum('KxW,yz,Lyxw,zw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Wz,Lwxz,yw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Wz,Lwzx,yw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Wz,Lywz,xw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Wz,Lyzw,xw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,xz,LwWz,yw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,xz,Lwuz,Wwuy->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,xz,Lwuz,Wwyu->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,xz,LwzW,yw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,xz,Lwzu,Wwyu->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,xz,Lz,Wy->KLW', X_abb, h_aa, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,yz,LzWw,xw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,yz,LzwW,xw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,yz,Lzwu,Wxuw->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,yz,Lzwu,Wxwu->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,zw,Luxz,Wuyw->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,zw,Luzx,Wuwy->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,zw,Luzx,Wuyw->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,zw,LyWz,xw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,zw,Lyuz,Wxuw->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,zw,Lyuz,Wxwu->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,zw,LyzW,xw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,zw,Lyzu,Wxuw->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,zw,Lyzu,Wxwu->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,zw,LzWx,yw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,zw,Lzux,Wwuy->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,zw,Lzux,Wwyu->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,zw,LzxW,yw->KLW', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,zw,Lzxu,Wwyu->KLW', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('KxW,Ly,xzwy,zw->KLW', X_abb, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += einsum('KxW,Ly,xzyw,zw->KLW', X_abb, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= einsum('KxW,Lyxz,ywuv,zwuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += einsum('KxW,Lyxz,zwuv,ywuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('KxW,Lyzw,xuvw,yvuz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('KxW,Lyzw,xuvz,yvwu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('KxW,Lyzw,xuwv,yvzu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('KxW,Lyzw,xuwz,yu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += einsum('KxW,Lyzw,xuzv,yvwu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += einsum('KxW,Lyzw,xuzw,yu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('KxW,Lyzw,xyuv,zwuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('KxW,Lyzx,ywuv,zwuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('KxW,Lyzx,zwuv,ywuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LyWz,zwuv,xwuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LyzW,zwuv,xwuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lyzw,Wuvw,xvuz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lyzw,Wuvw,xvzu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lyzw,Wuvz,xvuw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lyzw,Wuvz,xvwu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lyzw,Wuwv,xvzu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lyzw,Wuwz,xu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lyzw,Wuzv,xvwu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lyzw,Wuzw,xu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lyzw,wuvs,Wxusvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuszv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuvsz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Kxy,Lyzw,wuvs,Wxuvzs->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuzsv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 5/24 * einsum('Kxy,Lyzw,wuvs,Wxuzvs->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lyzw,zuvs,Wxusvw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lyzw,zuvs,Wxuswv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lyzw,zuvs,Wxuvsw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lyzw,zuvs,Wxuvws->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lyzw,zuvs,Wxuwsv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 5/24 * einsum('Kxy,Lyzw,zuvs,Wxuwvs->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lyzw,zwuv,Wxuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lyzw,zwuv,Wxvu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lz,Wwyz,xw->KLW', X_abb, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lz,Wwzy,xw->KLW', X_abb, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lz,Wxwz,yw->KLW', X_abb, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lz,Wxzw,yw->KLW', X_abb, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lz,xwuz,Wuwy->KLW', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lz,xwuz,Wuyw->KLW', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lz,xwzu,Wuyw->KLW', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lz,yzwu,Wxuw->KLW', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lz,yzwu,Wxwu->KLW', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzWw,xuvw,yuvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzWw,xuwv,yuzv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LzWw,xzuv,ywuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzWw,yuvz,xuvw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzWw,yuzv,xuwv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LzWw,ywuv,xzuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LzWx,zwuv,ywuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,LzwW,xuvw,yuvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,LzwW,xuvw,yuzv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LzwW,xuwv,yuzv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,LzwW,xzuv,ywuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,LzwW,xzuv,ywvu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,LzwW,yuvz,xuvw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,LzwW,yuvz,xuwv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,LzwW,yuzv,xuwv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,LzwW,ywuv,xzuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,LzwW,ywuv,xzvu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,Wvuy,xzvw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,Wvuy,xzwv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzwu,Wvwy,xzvu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lzwu,Wvyu,xzwv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lzwu,Wvyw,xzvu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,Wxuv,ywvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,Wxuv,ywzv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzwu,Wxuw,yz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,Wxvu,ywvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,Wxvu,ywzv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzwu,Wxvw,yuvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lzwu,Wxwu,yz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lzwu,Wxwv,yuvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,Wzvy,xvuw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,Wzvy,xvwu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzwu,Wzyv,xvwu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsvwy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsvyw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kxy,Lzwu,xvsu,Wzswvy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzswyv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('Kxy,Lzwu,xvsu,Wzsyvw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsywv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,xvsw,Wzsvuy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,xvsw,Wzsyuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,xvus,Wzswyv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,xvus,Wzsywv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,xvuw,Wzvy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,xvuw,Wzyv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzwu,xvws,Wzsyuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzwu,xvwu,Wzyv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,xzvs,Wvsuwy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,xzvs,Wvsuyw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,xzvs,Wvswuy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lzwu,xzvs,Wvswyu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,xzvs,Wvsyuw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 5/24 * einsum('Kxy,Lzwu,xzvs,Wvsywu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzsvw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzswv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzvsw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 5/24 * einsum('Kxy,Lzwu,yuvs,Wxzvws->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzwsv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lzwu,yuvs,Wxzwvs->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvsuw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lzwu,yvsz,Wxvswu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvusw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvuws->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 5/24 * einsum('Kxy,Lzwu,yvsz,Wxvwsu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvwus->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,yvzs,Wxvuws->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,yvzs,Wxvwus->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwu,ywvs,Wxzsvu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwu,ywvs,Wxzvsu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwx,Wuvw,yuvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwx,Wuvw,yuzv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lzwx,Wuwv,yuzv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kxy,Lzwx,Wzuv,ywuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kxy,Lzwx,Wzuv,ywvu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lzwx,wuvs,Wzusvy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lzwx,wuvs,Wzusyv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lzwx,wuvs,Wzuvsy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Kxy,Lzwx,wuvs,Wzuvys->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Kxy,Lzwx,wuvs,Wzuysv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 5/24 * einsum('Kxy,Lzwx,wuvs,Wzuyvs->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsuwy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsuyw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvswuy->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Kxy,Lzwx,zuvs,Wvswyu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsyuw->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 5/24 * einsum('Kxy,Lzwx,zuvs,Wvsywu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,LzxW,zwuv,ywuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzxw,Wuvw,yuvz->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzxw,Wuwv,yuzv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lzxw,Wzuv,ywuv->KLW', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kxy,Lzxw,wuvs,Wzuyvs->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kxy,Lzxw,zuvs,Wvsywu->KLW', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += einsum('LxW,K,Kyxz,yz->KLW', X_bab, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('LxW,K,Kyzx,yz->KLW', X_bab, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,K,Kx,Wy->KLW', X_bab, e_cvs, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,K,KyzW,xz->KLW', X_bab, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,K,Kyzw,Wxwz->KLW', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,K,Kyzw,Wxzw->KLW', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,K,Kzwx,Wzwy->KLW', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,K,Kzwx,Wzyw->KLW', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,K,KzxW,yz->KLW', X_bab, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,K,Kzxw,Wzyw->KLW', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('LxW,xy,Kzwy,zw->KLW', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= einsum('LxW,xy,Kzyw,zw->KLW', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= einsum('LxW,yz,Kwxy,zw->KLW', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('LxW,yz,Kwyx,zw->KLW', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('LxW,yz,Kywx,zw->KLW', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += einsum('LxW,yz,Kyxw,zw->KLW', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Wz,Kwxz,yw->KLW', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Wz,Kywz,xw->KLW', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,xz,Kwuz,Wwuy->KLW', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,xz,Kwuz,Wwyu->KLW', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,xz,KwzW,yw->KLW', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,xz,Kwzu,Wwyu->KLW', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,xz,Kz,Wy->KLW', X_bab, h_aa, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,yz,KzwW,xw->KLW', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,yz,Kzwu,Wxuw->KLW', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,yz,Kzwu,Wxwu->KLW', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,zw,Kuxz,Wuyw->KLW', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,zw,Kuzx,Wuwy->KLW', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,zw,Kuzx,Wuyw->KLW', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,zw,Kyuz,Wxuw->KLW', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,zw,Kyuz,Wxwu->KLW', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,zw,KyzW,xw->KLW', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,zw,Kyzu,Wxuw->KLW', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,zw,Kyzu,Wxwu->KLW', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,zw,Kzux,Wwuy->KLW', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,zw,Kzux,Wwyu->KLW', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,zw,KzxW,yw->KLW', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,zw,Kzxu,Wwyu->KLW', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('LxW,Ky,xzwy,zw->KLW', X_bab, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= einsum('LxW,Ky,xzyw,zw->KLW', X_bab, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += einsum('LxW,Kyxz,ywuv,zwuv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= einsum('LxW,Kyxz,zwuv,ywuv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('LxW,Kyzw,xuvw,yvuz->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('LxW,Kyzw,xuvz,yvwu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('LxW,Kyzw,xuwv,yvzu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('LxW,Kyzw,xuwz,yu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= einsum('LxW,Kyzw,xuzv,yvwu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= einsum('LxW,Kyzw,xuzw,yu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('LxW,Kyzw,xyuv,zwuv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('LxW,Kyzx,ywuv,zwuv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('LxW,Kyzx,zwuv,ywuv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,KyzW,zwuv,xwuv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kyzw,Wuvw,xvuz->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,Kyzw,Wuvw,xvzu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,Kyzw,Wuvz,xvuw->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kyzw,Wuvz,xvwu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kyzw,Wuwv,xvzu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kyzw,Wuwz,xu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Lxy,Kyzw,wuvs,Wxusvz->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Lxy,Kyzw,wuvs,Wxuszv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Lxy,Kyzw,wuvs,Wxuvsz->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 5/24 * einsum('Lxy,Kyzw,wuvs,Wxuvzs->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Lxy,Kyzw,wuvs,Wxuzsv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kyzw,wuvs,Wxuzvs->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kyzw,zuvs,Wxusvw->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kyzw,zuvs,Wxuswv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kyzw,zuvs,Wxuvsw->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Lxy,Kyzw,zuvs,Wxuvws->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kyzw,zuvs,Wxuwsv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 7/24 * einsum('Lxy,Kyzw,zuvs,Wxuwvs->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kyzw,zwuv,Wxuv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,Kyzw,zwuv,Wxvu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kz,Wwyz,xw->KLW', X_bab, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kz,Wxwz,yw->KLW', X_bab, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kz,xwuz,Wuwy->KLW', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,Kz,xwuz,Wuyw->KLW', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kz,xwzu,Wuyw->KLW', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kz,yzwu,Wxuw->KLW', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,Kz,yzwu,Wxwu->KLW', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,KzwW,xuvw,yuvz->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,KzwW,xuvw,yuzv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,KzwW,xuwv,yuzv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,KzwW,xzuv,ywuv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,KzwW,xzuv,ywvu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,KzwW,yuvz,xuvw->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,KzwW,yuvz,xuwv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,KzwW,yuzv,xuwv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,KzwW,ywuv,xzuv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,KzwW,ywuv,xzvu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwu,Wvuy,xzvw->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,Kzwu,Wvuy,xzwv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kzwu,Wvyu,xzwv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kzwu,Wvyw,xzvu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwu,Wxuv,ywvz->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,Kzwu,Wxuv,ywzv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kzwu,Wxuw,yz->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,Kzwu,Wxvu,ywvz->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwu,Wxvu,ywzv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kzwu,Wxvw,yuvz->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwu,Wzvy,xvuw->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,Kzwu,Wzvy,xvwu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kzwu,Wzyv,xvwu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Lxy,Kzwu,xvsu,Wzsvwy->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Lxy,Kzwu,xvsu,Wzsvyw->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Lxy,Kzwu,xvsu,Wzswvy->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Lxy,Kzwu,xvsu,Wzswyv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('Lxy,Kzwu,xvsu,Wzsyvw->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Lxy,Kzwu,xvsu,Wzsywv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwu,xvsw,Wzsvuy->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,Kzwu,xvsw,Wzsyuv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwu,xvus,Wzswyv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,Kzwu,xvus,Wzsywv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwu,xvuw,Wzvy->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,Kzwu,xvuw,Wzyv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kzwu,xvws,Wzsyuv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kzwu,xvwu,Wzyv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwu,xzvs,Wvsuwy->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwu,xzvs,Wvsuyw->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwu,xzvs,Wvswuy->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Lxy,Kzwu,xzvs,Wvswyu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwu,xzvs,Wvsyuw->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 7/24 * einsum('Lxy,Kzwu,xzvs,Wvsywu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwu,yuvs,Wxzsvw->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwu,yuvs,Wxzswv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwu,yuvs,Wxzvsw->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 7/24 * einsum('Lxy,Kzwu,yuvs,Wxzvws->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwu,yuvs,Wxzwsv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Lxy,Kzwu,yuvs,Wxzwvs->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Lxy,Kzwu,yvsz,Wxvsuw->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 5/24 * einsum('Lxy,Kzwu,yvsz,Wxvswu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Lxy,Kzwu,yvsz,Wxvusw->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Lxy,Kzwu,yvsz,Wxvuws->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwu,yvsz,Wxvwsu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Lxy,Kzwu,yvsz,Wxvwus->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Lxy,Kzwu,yvzs,Wxvsuw->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Lxy,Kzwu,yvzs,Wxvswu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Lxy,Kzwu,yvzs,Wxvusw->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('Lxy,Kzwu,yvzs,Wxvuws->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Lxy,Kzwu,yvzs,Wxvwsu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Lxy,Kzwu,yvzs,Wxvwus->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Lxy,Kzwu,ywvs,Wxzsuv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Lxy,Kzwu,ywvs,Wxzsvu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Lxy,Kzwu,ywvs,Wxzusv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Lxy,Kzwu,ywvs,Wxzuvs->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('Lxy,Kzwu,ywvs,Wxzvsu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Lxy,Kzwu,ywvs,Wxzvus->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Lxy,Kzwx,Wuvw,yuvz->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Lxy,Kzwx,Wuvw,yuzv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/3 * einsum('Lxy,Kzwx,Wzuv,ywuv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Lxy,Kzwx,Wzuv,ywvu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwx,wuvs,Wzusvy->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwx,wuvs,Wzusyv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwx,wuvs,Wzuvsy->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Lxy,Kzwx,wuvs,Wzuvys->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/24 * einsum('Lxy,Kzwx,wuvs,Wzuysv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 7/24 * einsum('Lxy,Kzwx,wuvs,Wzuyvs->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwx,zuvs,Wvsuwy->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwx,zuvs,Wvsuyw->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwx,zuvs,Wvswuy->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Lxy,Kzwx,zuvs,Wvswyu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/24 * einsum('Lxy,Kzwx,zuvs,Wvsyuw->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca += 7/24 * einsum('Lxy,Kzwx,zuvs,Wvsywu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,KzxW,zwuv,ywuv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kzxw,Wuvw,yuvz->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kzxw,Wuwv,yuzv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kzxw,Wzuv,ywuv->KLW', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lxy,Kzxw,wuvs,Wzuyvs->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lxy,Kzxw,zuvs,Wvsywu->KLW', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma[s_cca__abb:f_cca__abb] += sigma_cca.reshape(-1).copy()

        # CVA <- CAA
        if nval > 0:
            sigma_cva  = einsum('KxW,Lx->KLW', X_aaa, h_va, optimize = einsum_type)
            sigma_cva -= einsum('KxW,L,Lx->KLW', X_aaa, e_val, t1_va, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lx,Wy->KLW', X_aaa, h_va, rdm_ca, optimize = einsum_type)
            sigma_cva += einsum('KxW,xy,Ly->KLW', X_aaa, h_aa, t1_va, optimize = einsum_type)
            sigma_cva += einsum('KxW,Lyxz,yz->KLW', X_aaa, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,Lyzx,yz->KLW', X_aaa, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LyWz,xz->KLW', X_aaa, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LyzW,xz->KLW', X_aaa, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lyzw,Wxwz->KLW', X_aaa, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lyzw,Wxzw->KLW', X_aaa, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzWx,yz->KLW', X_aaa, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwx,Wzwy->KLW', X_aaa, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwx,Wzyw->KLW', X_aaa, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LzxW,yz->KLW', X_aaa, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzxw,Wzyw->KLW', X_aaa, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('ixW,KLiy,xy->KLW', X_aaa, v_xvxa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('ixW,LKiy,xy->KLW', X_aaa, v_vxxa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('ixy,KLiW,xy->KLW', X_aaa, v_xvxa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('ixy,KLiz,Wxyz->KLW', X_aaa, v_xvxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('ixy,KLiz,Wxzy->KLW', X_aaa, v_xvxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('ixy,LKiW,xy->KLW', X_aaa, v_vxxa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('ixy,LKiz,Wxyz->KLW', X_aaa, v_vxxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('ixy,LKiz,Wxzy->KLW', X_aaa, v_vxxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LyWz,xz->KLW', X_abb, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lyzw,Wxwz->KLW', X_abb, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lyzw,Wxzw->KLW', X_abb, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzWx,yz->KLW', X_abb, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lzwx,Wzwy->KLW', X_abb, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwx,Wzyw->KLW', X_abb, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('ixy,KLiW,xy->KLW', X_abb, v_xvxa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('ixy,KLiz,Wxyz->KLW', X_abb, v_xvxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('ixy,KLiz,Wxzy->KLW', X_abb, v_xvxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('ixy,LKiW,xy->KLW', X_abb, v_vxxa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('ixy,LKiz,Wxyz->KLW', X_abb, v_vxxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('ixy,LKiz,Wxzy->KLW', X_abb, v_vxxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= einsum('KxW,L,Lyxz,yz->KLW', X_aaa, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('KxW,L,Lyzx,yz->KLW', X_aaa, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,L,Lx,Wy->KLW', X_aaa, e_val, t1_va, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,L,LyWz,xz->KLW', X_aaa, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,L,LyzW,xz->KLW', X_aaa, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,L,Lyzw,Wxwz->KLW', X_aaa, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,L,Lyzw,Wxzw->KLW', X_aaa, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,L,LzWx,yz->KLW', X_aaa, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,L,Lzwx,Wzwy->KLW', X_aaa, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,L,Lzwx,Wzyw->KLW', X_aaa, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,L,LzxW,yz->KLW', X_aaa, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,L,Lzxw,Wzyw->KLW', X_aaa, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,xy,Lzwy,zw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += einsum('KxW,xy,Lzyw,zw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += einsum('KxW,yz,Lwxy,zw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,yz,Lwyx,zw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('KxW,yz,Lywx,zw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= einsum('KxW,yz,Lyxw,zw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Wz,Lwxz,yw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Wz,Lwzx,yw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Wz,Lywz,xw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Wz,Lyzw,xw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,xz,LwWz,yw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,xz,Lwuz,Wwuy->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,xz,Lwuz,Wwyu->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,xz,LwzW,yw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,xz,Lwzu,Wwyu->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,xz,Lz,Wy->KLW', X_aaa, h_aa, t1_va, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,yz,LzWw,xw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,yz,LzwW,xw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,yz,Lzwu,Wxuw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,yz,Lzwu,Wxwu->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,zw,Luxz,Wuyw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,zw,Luzx,Wuwy->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,zw,Luzx,Wuyw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,zw,LyWz,xw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,zw,Lyuz,Wxuw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,zw,Lyuz,Wxwu->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,zw,LyzW,xw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,zw,Lyzu,Wxuw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,zw,Lyzu,Wxwu->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,zw,LzWx,yw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,zw,Lzux,Wwuy->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,zw,Lzux,Wwyu->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,zw,LzxW,yw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,zw,Lzxu,Wwyu->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,Ly,xzwy,zw->KLW', X_aaa, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += einsum('KxW,Ly,xzyw,zw->KLW', X_aaa, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= einsum('KxW,Lyxz,ywuv,zwuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += einsum('KxW,Lyxz,zwuv,ywuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,Lyzw,xuvw,yvuz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,Lyzw,xuvz,yvwu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,Lyzw,xuwv,yvzu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,Lyzw,xuwz,yu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += einsum('KxW,Lyzw,xuzv,yvwu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += einsum('KxW,Lyzw,xuzw,yu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('KxW,Lyzw,xyuv,zwuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('KxW,Lyzx,ywuv,zwuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,Lyzx,zwuv,ywuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LyWz,zwuv,xwuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LyzW,zwuv,xwuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lyzw,Wuvw,xvuz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lyzw,Wuvw,xvzu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lyzw,Wuvz,xvuw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lyzw,Wuvz,xvwu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lyzw,Wuwv,xvzu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lyzw,Wuwz,xu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lyzw,Wuzv,xvwu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lyzw,Wuzw,xu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lyzw,wuvs,Wxusvz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuszv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuvsz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lyzw,wuvs,Wxuvzs->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuzsv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 5/24 * einsum('Kxy,Lyzw,wuvs,Wxuzvs->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lyzw,zuvs,Wxusvw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lyzw,zuvs,Wxuswv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lyzw,zuvs,Wxuvsw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lyzw,zuvs,Wxuvws->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lyzw,zuvs,Wxuwsv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 5/24 * einsum('Kxy,Lyzw,zuvs,Wxuwvs->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lyzw,zwuv,Wxuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lyzw,zwuv,Wxvu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lz,Wwyz,xw->KLW', X_aaa, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lz,Wwzy,xw->KLW', X_aaa, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lz,Wxwz,yw->KLW', X_aaa, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lz,Wxzw,yw->KLW', X_aaa, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lz,xwuz,Wuwy->KLW', X_aaa, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lz,xwuz,Wuyw->KLW', X_aaa, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lz,xwzu,Wuyw->KLW', X_aaa, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lz,yzwu,Wxuw->KLW', X_aaa, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lz,yzwu,Wxwu->KLW', X_aaa, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzWw,xuvw,yuvz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzWw,xuwv,yuzv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LzWw,xzuv,ywuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzWw,yuvz,xuvw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzWw,yuzv,xuwv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LzWw,ywuv,xzuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LzWx,zwuv,ywuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,LzwW,xuvw,yuvz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,LzwW,xuvw,yuzv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LzwW,xuwv,yuzv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,LzwW,xzuv,ywuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,LzwW,xzuv,ywvu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,LzwW,yuvz,xuvw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,LzwW,yuvz,xuwv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LzwW,yuzv,xuwv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,LzwW,ywuv,xzuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,LzwW,ywuv,xzvu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,Wvuy,xzvw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,Wvuy,xzwv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzwu,Wvwy,xzvu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzwu,Wvyu,xzwv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzwu,Wvyw,xzvu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,Wxuv,ywvz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,Wxuv,ywzv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzwu,Wxuw,yz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,Wxvu,ywvz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,Wxvu,ywzv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzwu,Wxvw,yuvz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzwu,Wxwu,yz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzwu,Wxwv,yuvz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,Wzvy,xvuw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,Wzvy,xvwu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzwu,Wzyv,xvwu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsvwy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsvyw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,xvsu,Wzswvy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzswyv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('Kxy,Lzwu,xvsu,Wzsyvw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsywv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,xvsw,Wzsvuy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,xvsw,Wzsyuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,xvus,Wzswyv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,xvus,Wzsywv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,xvuw,Wzvy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,xvuw,Wzyv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzwu,xvws,Wzsyuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzwu,xvwu,Wzyv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,xzvs,Wvsuwy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,xzvs,Wvsuyw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,xzvs,Wvswuy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lzwu,xzvs,Wvswyu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,xzvs,Wvsyuw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 5/24 * einsum('Kxy,Lzwu,xzvs,Wvsywu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzsvw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzswv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzvsw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lzwu,yuvs,Wxzvws->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzwsv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 5/24 * einsum('Kxy,Lzwu,yuvs,Wxzwvs->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvsuw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lzwu,yvsz,Wxvswu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvusw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvuws->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 5/24 * einsum('Kxy,Lzwu,yvsz,Wxvwsu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvwus->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,yvzs,Wxvuws->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,yvzs,Wxvwus->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,ywvs,Wxzsvu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,ywvs,Wxzvsu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwx,Wuvw,yuvz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwx,Wuvw,yuzv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzwx,Wuwv,yuzv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwx,Wzuv,ywuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwx,Wzuv,ywvu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwx,wuvs,Wzusvy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwx,wuvs,Wzusyv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwx,wuvs,Wzuvsy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lzwx,wuvs,Wzuvys->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwx,wuvs,Wzuysv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 5/24 * einsum('Kxy,Lzwx,wuvs,Wzuyvs->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsuwy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsuyw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvswuy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lzwx,zuvs,Wvswyu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsyuw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 5/24 * einsum('Kxy,Lzwx,zuvs,Wvsywu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzxW,zwuv,ywuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzxw,Wuvw,yuvz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzxw,Wuwv,yuzv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzxw,Wzuv,ywuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzxw,wuvs,Wzuyvs->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzxw,zuvs,Wvsywu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,L,LyWz,xz->KLW', X_abb, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,L,Lyzw,Wxwz->KLW', X_abb, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,L,Lyzw,Wxzw->KLW', X_abb, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,L,LzWx,yz->KLW', X_abb, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,L,Lzwx,Wzwy->KLW', X_abb, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,L,Lzwx,Wzyw->KLW', X_abb, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Wz,Lwzx,yw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Wz,Lyzw,xw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,xz,LwWz,yw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,xz,Lwuz,Wwuy->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,xz,Lwuz,Wwyu->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,yz,LzWw,xw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,yz,Lzwu,Wxuw->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,yz,Lzwu,Wxwu->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,zw,Luzx,Wuwy->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,zw,Luzx,Wuyw->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,zw,LyWz,xw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,zw,Lyuz,Wxuw->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,zw,Lyuz,Wxwu->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,zw,Lyzu,Wxuw->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,zw,Lyzu,Wxwu->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,zw,LzWx,yw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,zw,Lzux,Wwuy->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,zw,Lzux,Wwyu->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LyWz,zwuv,xwuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lyzw,Wuvw,xvuz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lyzw,Wuvw,xvzu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lyzw,Wuvz,xvuw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lyzw,Wuvz,xvwu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lyzw,Wuzv,xvwu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lyzw,Wuzw,xu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lyzw,wuvs,Wxusvz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuszv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuvsz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lyzw,wuvs,Wxuvzs->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuzsv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 7/24 * einsum('Kxy,Lyzw,wuvs,Wxuzvs->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lyzw,zuvs,Wxusvw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lyzw,zuvs,Wxuswv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lyzw,zuvs,Wxuvsw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 5/24 * einsum('Kxy,Lyzw,zuvs,Wxuvws->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lyzw,zuvs,Wxuwsv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lyzw,zuvs,Wxuwvs->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lyzw,zwuv,Wxuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lyzw,zwuv,Wxvu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lz,Wwzy,xw->KLW', X_abb, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lz,Wxzw,yw->KLW', X_abb, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lz,xwuz,Wuwy->KLW', X_abb, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lz,xwuz,Wuyw->KLW', X_abb, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lz,yzwu,Wxuw->KLW', X_abb, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lz,yzwu,Wxwu->KLW', X_abb, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzWw,xuvw,yuvz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzWw,xuwv,yuzv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LzWw,xzuv,ywuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzWw,yuvz,xuvw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzWw,yuzv,xuwv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LzWw,ywuv,xzuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LzWx,zwuv,ywuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,LzwW,xuvw,yuvz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,LzwW,xuvw,yuzv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,LzwW,xzuv,ywuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,LzwW,xzuv,ywvu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,LzwW,yuvz,xuvw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,LzwW,yuvz,xuwv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,LzwW,ywuv,xzuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,LzwW,ywuv,xzvu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lzwu,Wvuy,xzvw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,Wvuy,xzwv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzwu,Wvwy,xzvu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lzwu,Wxuv,ywvz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,Wxuv,ywzv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,Wxvu,ywvz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lzwu,Wxvu,ywzv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzwu,Wxwu,yz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzwu,Wxwv,yuvz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lzwu,Wzvy,xvuw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,Wzvy,xvwu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsvwy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsvyw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('Kxy,Lzwu,xvsu,Wzswvy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzswyv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsyvw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsywv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lzwu,xvsw,Wzsvuy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,xvsw,Wzsyuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,xvus,Wzsvwy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,xvus,Wzsvyw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,xvus,Wzswvy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,xvus,Wzswyv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,xvus,Wzsyvw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lzwu,xvuw,Wzvy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,xvuw,Wzyv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,xzvs,Wvsuwy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,xzvs,Wvsuyw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,xzvs,Wvswuy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('Kxy,Lzwu,xzvs,Wvswyu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,xzvs,Wvsyuw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,xzvs,Wvsywu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzsvw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzswv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzvsw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lzwu,yuvs,Wxzvws->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzwsv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 7/24 * einsum('Kxy,Lzwu,yuvs,Wxzwvs->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvsuw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lzwu,yvsz,Wxvswu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvusw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvuws->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 7/24 * einsum('Kxy,Lzwu,yvsz,Wxvwsu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvwus->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvsuw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvswu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvusw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvuws->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvwsu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('Kxy,Lzwu,yvzs,Wxvwus->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzsuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('Kxy,Lzwu,ywvs,Wxzsvu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzusv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzuvs->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzvsu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzvus->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwx,Wuvw,yuvz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lzwx,Wuvw,yuzv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzwx,Wuwv,yuzv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwx,Wzuv,ywuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lzwx,Wzuv,ywvu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lzwx,wuvs,Wzusvy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lzwx,wuvs,Wzusyv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lzwx,wuvs,Wzuvsy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 5/24 * einsum('Kxy,Lzwx,wuvs,Wzuvys->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lzwx,wuvs,Wzuysv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,wuvs,Wzuyvs->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsuwy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsuyw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvswuy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 7/24 * einsum('Kxy,Lzwx,zuvs,Wvswyu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsyuw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lzwx,zuvs,Wvsywu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma[s_cva__aaa:f_cva__aaa] += sigma_cva.reshape(-1).copy()

            sigma_cva  = einsum('KxW,Lx->KLW', X_abb, h_va, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LyWz,xz->KLW', X_aaa, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lyzw,Wxwz->KLW', X_aaa, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lyzw,Wxzw->KLW', X_aaa, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzWx,yz->KLW', X_aaa, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lzwx,Wzwy->KLW', X_aaa, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwx,Wzyw->KLW', X_aaa, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('ixy,KLiW,xy->KLW', X_aaa, v_xvxa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('ixy,KLiz,Wxyz->KLW', X_aaa, v_xvxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('ixy,KLiz,Wxzy->KLW', X_aaa, v_xvxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= einsum('KxW,L,Lx->KLW', X_abb, e_val, t1_va, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lx,Wy->KLW', X_abb, h_va, rdm_ca, optimize = einsum_type)
            sigma_cva += einsum('KxW,xy,Ly->KLW', X_abb, h_aa, t1_va, optimize = einsum_type)
            sigma_cva += einsum('KxW,Lyxz,yz->KLW', X_abb, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,Lyzx,yz->KLW', X_abb, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LyWz,xz->KLW', X_abb, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LyzW,xz->KLW', X_abb, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lyzw,Wxwz->KLW', X_abb, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lyzw,Wxzw->KLW', X_abb, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzWx,yz->KLW', X_abb, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwx,Wzwy->KLW', X_abb, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwx,Wzyw->KLW', X_abb, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LzxW,yz->KLW', X_abb, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzxw,Wzyw->KLW', X_abb, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('ixW,KLiy,xy->KLW', X_abb, v_xvxa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('ixy,KLiW,xy->KLW', X_abb, v_xvxa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('ixy,KLiz,Wxyz->KLW', X_abb, v_xvxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('ixy,KLiz,Wxzy->KLW', X_abb, v_xvxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('ixW,LKiy,xy->KLW', X_bab, v_vxxa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('ixy,LKiz,Wxyz->KLW', X_bab, v_vxxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('ixy,LKiz,Wxzy->KLW', X_bab, v_vxxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,L,LyWz,xz->KLW', X_aaa, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,L,Lyzw,Wxwz->KLW', X_aaa, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,L,Lyzw,Wxzw->KLW', X_aaa, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,L,LzWx,yz->KLW', X_aaa, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,L,Lzwx,Wzwy->KLW', X_aaa, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,L,Lzwx,Wzyw->KLW', X_aaa, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Wz,Lwzx,yw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Wz,Lyzw,xw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,xz,LwWz,yw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,xz,Lwuz,Wwuy->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,xz,Lwuz,Wwyu->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,yz,LzWw,xw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,yz,Lzwu,Wxuw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,yz,Lzwu,Wxwu->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,zw,Luzx,Wuwy->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,zw,Luzx,Wuyw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,zw,LyWz,xw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,zw,Lyuz,Wxuw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,zw,Lyuz,Wxwu->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,zw,Lyzu,Wxuw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,zw,Lyzu,Wxwu->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,zw,LzWx,yw->KLW', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,zw,Lzux,Wwuy->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,zw,Lzux,Wwyu->KLW', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LyWz,zwuv,xwuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lyzw,Wuvw,xvuz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lyzw,Wuvw,xvzu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lyzw,Wuvz,xvuw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lyzw,Wuvz,xvwu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lyzw,Wuzv,xvwu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lyzw,Wuzw,xu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lyzw,wuvs,Wxusvz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuszv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuvsz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lyzw,wuvs,Wxuvzs->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuzsv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 7/24 * einsum('Kxy,Lyzw,wuvs,Wxuzvs->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lyzw,zuvs,Wxusvw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lyzw,zuvs,Wxuswv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lyzw,zuvs,Wxuvsw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 5/24 * einsum('Kxy,Lyzw,zuvs,Wxuvws->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lyzw,zuvs,Wxuwsv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lyzw,zuvs,Wxuwvs->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lyzw,zwuv,Wxuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lyzw,zwuv,Wxvu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lz,Wwzy,xw->KLW', X_aaa, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lz,Wxzw,yw->KLW', X_aaa, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lz,xwuz,Wuwy->KLW', X_aaa, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lz,xwuz,Wuyw->KLW', X_aaa, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lz,yzwu,Wxuw->KLW', X_aaa, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lz,yzwu,Wxwu->KLW', X_aaa, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzWw,xuvw,yuvz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzWw,xuwv,yuzv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LzWw,xzuv,ywuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzWw,yuvz,xuvw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzWw,yuzv,xuwv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LzWw,ywuv,xzuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LzWx,zwuv,ywuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,LzwW,xuvw,yuvz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,LzwW,xuvw,yuzv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,LzwW,xzuv,ywuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,LzwW,xzuv,ywvu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,LzwW,yuvz,xuvw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,LzwW,yuvz,xuwv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,LzwW,ywuv,xzuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,LzwW,ywuv,xzvu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lzwu,Wvuy,xzvw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,Wvuy,xzwv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzwu,Wvwy,xzvu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lzwu,Wxuv,ywvz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,Wxuv,ywzv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,Wxvu,ywvz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lzwu,Wxvu,ywzv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzwu,Wxwu,yz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzwu,Wxwv,yuvz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lzwu,Wzvy,xvuw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,Wzvy,xvwu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsvwy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsvyw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('Kxy,Lzwu,xvsu,Wzswvy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzswyv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsyvw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsywv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lzwu,xvsw,Wzsvuy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,xvsw,Wzsyuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,xvus,Wzsvwy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,xvus,Wzsvyw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,xvus,Wzswvy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,xvus,Wzswyv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,xvus,Wzsyvw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lzwu,xvuw,Wzvy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,xvuw,Wzyv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,xzvs,Wvsuwy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,xzvs,Wvsuyw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,xzvs,Wvswuy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('Kxy,Lzwu,xzvs,Wvswyu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,xzvs,Wvsyuw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,xzvs,Wvsywu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lzwu,yuvs,Wxzsvw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lzwu,yuvs,Wxzswv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lzwu,yuvs,Wxzvsw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzvws->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lzwu,yuvs,Wxzwsv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 5/24 * einsum('Kxy,Lzwu,yuvs,Wxzwvs->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvsuw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lzwu,yvsz,Wxvswu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvusw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvuws->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 7/24 * einsum('Kxy,Lzwu,yvsz,Wxvwsu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvwus->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvsuw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvswu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvusw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvuws->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvwsu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('Kxy,Lzwu,yvzs,Wxvwus->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzsuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('Kxy,Lzwu,ywvs,Wxzsvu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzusv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzuvs->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzvsu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzvus->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwx,Wuvw,yuvz->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lzwx,Wuvw,yuzv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzwx,Wuwv,yuzv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwx,Wzuv,ywuv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lzwx,Wzuv,ywvu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lzwx,wuvs,Wzusvy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lzwx,wuvs,Wzusyv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lzwx,wuvs,Wzuvsy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 5/24 * einsum('Kxy,Lzwx,wuvs,Wzuvys->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lzwx,wuvs,Wzuysv->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,wuvs,Wzuyvs->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsuwy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsuyw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvswuy->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 7/24 * einsum('Kxy,Lzwx,zuvs,Wvswyu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsyuw->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lzwx,zuvs,Wvsywu->KLW', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= einsum('KxW,L,Lyxz,yz->KLW', X_abb, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('KxW,L,Lyzx,yz->KLW', X_abb, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,L,Lx,Wy->KLW', X_abb, e_val, t1_va, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,L,LyWz,xz->KLW', X_abb, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,L,LyzW,xz->KLW', X_abb, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,L,Lyzw,Wxwz->KLW', X_abb, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,L,Lyzw,Wxzw->KLW', X_abb, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,L,LzWx,yz->KLW', X_abb, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,L,Lzwx,Wzwy->KLW', X_abb, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,L,Lzwx,Wzyw->KLW', X_abb, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,L,LzxW,yz->KLW', X_abb, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,L,Lzxw,Wzyw->KLW', X_abb, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,xy,Lzwy,zw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += einsum('KxW,xy,Lzyw,zw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += einsum('KxW,yz,Lwxy,zw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,yz,Lwyx,zw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('KxW,yz,Lywx,zw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= einsum('KxW,yz,Lyxw,zw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Wz,Lwxz,yw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Wz,Lwzx,yw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Wz,Lywz,xw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Wz,Lyzw,xw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,xz,LwWz,yw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,xz,Lwuz,Wwuy->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,xz,Lwuz,Wwyu->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,xz,LwzW,yw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,xz,Lwzu,Wwyu->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,xz,Lz,Wy->KLW', X_abb, h_aa, t1_va, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,yz,LzWw,xw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,yz,LzwW,xw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,yz,Lzwu,Wxuw->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,yz,Lzwu,Wxwu->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,zw,Luxz,Wuyw->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,zw,Luzx,Wuwy->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,zw,Luzx,Wuyw->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,zw,LyWz,xw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,zw,Lyuz,Wxuw->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,zw,Lyuz,Wxwu->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,zw,LyzW,xw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,zw,Lyzu,Wxuw->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,zw,Lyzu,Wxwu->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,zw,LzWx,yw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,zw,Lzux,Wwuy->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,zw,Lzux,Wwyu->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,zw,LzxW,yw->KLW', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,zw,Lzxu,Wwyu->KLW', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,Ly,xzwy,zw->KLW', X_abb, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += einsum('KxW,Ly,xzyw,zw->KLW', X_abb, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= einsum('KxW,Lyxz,ywuv,zwuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += einsum('KxW,Lyxz,zwuv,ywuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,Lyzw,xuvw,yvuz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,Lyzw,xuvz,yvwu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,Lyzw,xuwv,yvzu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,Lyzw,xuwz,yu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += einsum('KxW,Lyzw,xuzv,yvwu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += einsum('KxW,Lyzw,xuzw,yu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('KxW,Lyzw,xyuv,zwuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('KxW,Lyzx,ywuv,zwuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,Lyzx,zwuv,ywuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LyWz,zwuv,xwuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LyzW,zwuv,xwuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lyzw,Wuvw,xvuz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lyzw,Wuvw,xvzu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lyzw,Wuvz,xvuw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lyzw,Wuvz,xvwu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lyzw,Wuwv,xvzu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lyzw,Wuwz,xu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lyzw,Wuzv,xvwu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lyzw,Wuzw,xu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lyzw,wuvs,Wxusvz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuszv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuvsz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lyzw,wuvs,Wxuvzs->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuzsv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 5/24 * einsum('Kxy,Lyzw,wuvs,Wxuzvs->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lyzw,zuvs,Wxusvw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lyzw,zuvs,Wxuswv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lyzw,zuvs,Wxuvsw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lyzw,zuvs,Wxuvws->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lyzw,zuvs,Wxuwsv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 5/24 * einsum('Kxy,Lyzw,zuvs,Wxuwvs->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lyzw,zwuv,Wxuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lyzw,zwuv,Wxvu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lz,Wwyz,xw->KLW', X_abb, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lz,Wwzy,xw->KLW', X_abb, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lz,Wxwz,yw->KLW', X_abb, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lz,Wxzw,yw->KLW', X_abb, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lz,xwuz,Wuwy->KLW', X_abb, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lz,xwuz,Wuyw->KLW', X_abb, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lz,xwzu,Wuyw->KLW', X_abb, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lz,yzwu,Wxuw->KLW', X_abb, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lz,yzwu,Wxwu->KLW', X_abb, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzWw,xuvw,yuvz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzWw,xuwv,yuzv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LzWw,xzuv,ywuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzWw,yuvz,xuvw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzWw,yuzv,xuwv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LzWw,ywuv,xzuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LzWx,zwuv,ywuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,LzwW,xuvw,yuvz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,LzwW,xuvw,yuzv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LzwW,xuwv,yuzv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,LzwW,xzuv,ywuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,LzwW,xzuv,ywvu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,LzwW,yuvz,xuvw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,LzwW,yuvz,xuwv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LzwW,yuzv,xuwv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,LzwW,ywuv,xzuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,LzwW,ywuv,xzvu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,Wvuy,xzvw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,Wvuy,xzwv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzwu,Wvwy,xzvu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzwu,Wvyu,xzwv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzwu,Wvyw,xzvu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,Wxuv,ywvz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,Wxuv,ywzv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzwu,Wxuw,yz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,Wxvu,ywvz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,Wxvu,ywzv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzwu,Wxvw,yuvz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzwu,Wxwu,yz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzwu,Wxwv,yuvz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,Wzvy,xvuw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,Wzvy,xvwu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzwu,Wzyv,xvwu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsvwy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsvyw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,xvsu,Wzswvy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzswyv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('Kxy,Lzwu,xvsu,Wzsyvw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsywv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,xvsw,Wzsvuy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,xvsw,Wzsyuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,xvus,Wzswyv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,xvus,Wzsywv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,xvuw,Wzvy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,xvuw,Wzyv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzwu,xvws,Wzsyuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzwu,xvwu,Wzyv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,xzvs,Wvsuwy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,xzvs,Wvsuyw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,xzvs,Wvswuy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lzwu,xzvs,Wvswyu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,xzvs,Wvsyuw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 5/24 * einsum('Kxy,Lzwu,xzvs,Wvsywu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzsvw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzswv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzvsw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 5/24 * einsum('Kxy,Lzwu,yuvs,Wxzvws->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzwsv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lzwu,yuvs,Wxzwvs->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvsuw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lzwu,yvsz,Wxvswu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvusw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvuws->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 5/24 * einsum('Kxy,Lzwu,yvsz,Wxvwsu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvwus->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,yvzs,Wxvuws->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,yvzs,Wxvwus->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,ywvs,Wxzsvu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,ywvs,Wxzvsu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwx,Wuvw,yuvz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwx,Wuvw,yuzv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzwx,Wuwv,yuzv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwx,Wzuv,ywuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwx,Wzuv,ywvu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwx,wuvs,Wzusvy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwx,wuvs,Wzusyv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwx,wuvs,Wzuvsy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lzwx,wuvs,Wzuvys->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwx,wuvs,Wzuysv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 5/24 * einsum('Kxy,Lzwx,wuvs,Wzuyvs->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsuwy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsuyw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvswuy->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lzwx,zuvs,Wvswyu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsyuw->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 5/24 * einsum('Kxy,Lzwx,zuvs,Wvsywu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzxW,zwuv,ywuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzxw,Wuvw,yuvz->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzxw,Wuwv,yuzv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzxw,Wzuv,ywuv->KLW', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzxw,wuvs,Wzuyvs->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzxw,zuvs,Wvsywu->KLW', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma[s_cva__abb:f_cva__abb] += sigma_cva.reshape(-1).copy()

            sigma_cva  = einsum('KxW,Lx->KLW', X_bab, h_va, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('ixy,LKiW,xy->KLW', X_aaa, v_vxxa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('ixy,LKiz,Wxyz->KLW', X_aaa, v_vxxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('ixy,LKiz,Wxzy->KLW', X_aaa, v_vxxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('ixW,LKiy,xy->KLW', X_abb, v_vxxa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('ixy,LKiW,xy->KLW', X_abb, v_vxxa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('ixy,LKiz,Wxyz->KLW', X_abb, v_vxxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('ixy,LKiz,Wxzy->KLW', X_abb, v_vxxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= einsum('KxW,L,Lx->KLW', X_bab, e_val, t1_va, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lx,Wy->KLW', X_bab, h_va, rdm_ca, optimize = einsum_type)
            sigma_cva += einsum('KxW,xy,Ly->KLW', X_bab, h_aa, t1_va, optimize = einsum_type)
            sigma_cva += einsum('KxW,Lyxz,yz->KLW', X_bab, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,Lyzx,yz->KLW', X_bab, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LyzW,xz->KLW', X_bab, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lyzw,Wxwz->KLW', X_bab, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lyzw,Wxzw->KLW', X_bab, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwx,Wzwy->KLW', X_bab, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lzwx,Wzyw->KLW', X_bab, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LzxW,yz->KLW', X_bab, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzxw,Wzyw->KLW', X_bab, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('ixW,KLiy,xy->KLW', X_bab, v_xvxa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('ixy,KLiz,Wxyz->KLW', X_bab, v_xvxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('ixy,KLiz,Wxzy->KLW', X_bab, v_xvxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= einsum('KxW,L,Lyxz,yz->KLW', X_bab, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('KxW,L,Lyzx,yz->KLW', X_bab, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,L,Lx,Wy->KLW', X_bab, e_val, t1_va, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,L,LyzW,xz->KLW', X_bab, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,L,Lyzw,Wxwz->KLW', X_bab, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,L,Lyzw,Wxzw->KLW', X_bab, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,L,Lzwx,Wzwy->KLW', X_bab, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,L,Lzwx,Wzyw->KLW', X_bab, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,L,LzxW,yz->KLW', X_bab, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,L,Lzxw,Wzyw->KLW', X_bab, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,xy,Lzwy,zw->KLW', X_bab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += einsum('KxW,xy,Lzyw,zw->KLW', X_bab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += einsum('KxW,yz,Lwxy,zw->KLW', X_bab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,yz,Lwyx,zw->KLW', X_bab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('KxW,yz,Lywx,zw->KLW', X_bab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= einsum('KxW,yz,Lyxw,zw->KLW', X_bab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Wz,Lwxz,yw->KLW', X_bab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Wz,Lywz,xw->KLW', X_bab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,xz,Lwuz,Wwuy->KLW', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,xz,Lwuz,Wwyu->KLW', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,xz,LwzW,yw->KLW', X_bab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,xz,Lwzu,Wwyu->KLW', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,xz,Lz,Wy->KLW', X_bab, h_aa, t1_va, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,yz,LzwW,xw->KLW', X_bab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,yz,Lzwu,Wxuw->KLW', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,yz,Lzwu,Wxwu->KLW', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,zw,Luxz,Wuyw->KLW', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,zw,Luzx,Wuwy->KLW', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,zw,Luzx,Wuyw->KLW', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,zw,Lyuz,Wxuw->KLW', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,zw,Lyuz,Wxwu->KLW', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,zw,LyzW,xw->KLW', X_bab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,zw,Lyzu,Wxuw->KLW', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,zw,Lyzu,Wxwu->KLW', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,zw,Lzux,Wwuy->KLW', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,zw,Lzux,Wwyu->KLW', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,zw,LzxW,yw->KLW', X_bab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,zw,Lzxu,Wwyu->KLW', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,Ly,xzwy,zw->KLW', X_bab, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += einsum('KxW,Ly,xzyw,zw->KLW', X_bab, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= einsum('KxW,Lyxz,ywuv,zwuv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += einsum('KxW,Lyxz,zwuv,ywuv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,Lyzw,xuvw,yvuz->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,Lyzw,xuvz,yvwu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,Lyzw,xuwv,yvzu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,Lyzw,xuwz,yu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += einsum('KxW,Lyzw,xuzv,yvwu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += einsum('KxW,Lyzw,xuzw,yu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('KxW,Lyzw,xyuv,zwuv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('KxW,Lyzx,ywuv,zwuv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('KxW,Lyzx,zwuv,ywuv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LyzW,zwuv,xwuv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lyzw,Wuvw,xvuz->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lyzw,Wuvw,xvzu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lyzw,Wuvz,xvuw->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lyzw,Wuvz,xvwu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lyzw,Wuwv,xvzu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lyzw,Wuwz,xu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lyzw,wuvs,Wxusvz->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lyzw,wuvs,Wxuszv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lyzw,wuvs,Wxuvsz->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 5/24 * einsum('Kxy,Lyzw,wuvs,Wxuvzs->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lyzw,wuvs,Wxuzsv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lyzw,wuvs,Wxuzvs->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lyzw,zuvs,Wxusvw->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lyzw,zuvs,Wxuswv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lyzw,zuvs,Wxuvsw->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lyzw,zuvs,Wxuvws->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lyzw,zuvs,Wxuwsv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 7/24 * einsum('Kxy,Lyzw,zuvs,Wxuwvs->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lyzw,zwuv,Wxuv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lyzw,zwuv,Wxvu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lz,Wwyz,xw->KLW', X_bab, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lz,Wxwz,yw->KLW', X_bab, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lz,xwuz,Wuwy->KLW', X_bab, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lz,xwuz,Wuyw->KLW', X_bab, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lz,xwzu,Wuyw->KLW', X_bab, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lz,yzwu,Wxuw->KLW', X_bab, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lz,yzwu,Wxwu->KLW', X_bab, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,LzwW,xuvw,yuvz->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,LzwW,xuvw,yuzv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LzwW,xuwv,yuzv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,LzwW,xzuv,ywuv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,LzwW,xzuv,ywvu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,LzwW,yuvz,xuvw->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,LzwW,yuvz,xuwv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,LzwW,yuzv,xuwv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,LzwW,ywuv,xzuv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,LzwW,ywuv,xzvu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwu,Wvuy,xzvw->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lzwu,Wvuy,xzwv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzwu,Wvyu,xzwv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzwu,Wvyw,xzvu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,Wxuv,ywvz->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lzwu,Wxuv,ywzv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzwu,Wxuw,yz->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lzwu,Wxvu,ywvz->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,Wxvu,ywzv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzwu,Wxvw,yuvz->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,Wzvy,xvuw->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lzwu,Wzvy,xvwu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzwu,Wzyv,xvwu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsvwy->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsvyw->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,xvsu,Wzswvy->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,xvsu,Wzswyv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('Kxy,Lzwu,xvsu,Wzsyvw->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,xvsu,Wzsywv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,xvsw,Wzsvuy->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lzwu,xvsw,Wzsyuv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,xvus,Wzswyv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lzwu,xvus,Wzsywv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwu,xvuw,Wzvy->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lzwu,xvuw,Wzyv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzwu,xvws,Wzsyuv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzwu,xvwu,Wzyv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,xzvs,Wvsuwy->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,xzvs,Wvsuyw->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,xzvs,Wvswuy->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lzwu,xzvs,Wvswyu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,xzvs,Wvsyuw->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 7/24 * einsum('Kxy,Lzwu,xzvs,Wvsywu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzsvw->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzswv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzvsw->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 7/24 * einsum('Kxy,Lzwu,yuvs,Wxzvws->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,yuvs,Wxzwsv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lzwu,yuvs,Wxzwvs->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lzwu,yvsz,Wxvsuw->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 5/24 * einsum('Kxy,Lzwu,yvsz,Wxvswu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lzwu,yvsz,Wxvusw->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lzwu,yvsz,Wxvuws->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwu,yvsz,Wxvwsu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lzwu,yvsz,Wxvwus->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvsuw->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvswu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvusw->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('Kxy,Lzwu,yvzs,Wxvuws->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvwsu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,yvzs,Wxvwus->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzsuv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzsvu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzusv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzuvs->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('Kxy,Lzwu,ywvs,Wxzvsu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kxy,Lzwu,ywvs,Wxzvus->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kxy,Lzwx,Wuvw,yuvz->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kxy,Lzwx,Wuvw,yuzv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kxy,Lzwx,Wzuv,ywuv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kxy,Lzwx,Wzuv,ywvu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,wuvs,Wzusvy->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,wuvs,Wzusyv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,wuvs,Wzuvsy->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('Kxy,Lzwx,wuvs,Wzuvys->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/24 * einsum('Kxy,Lzwx,wuvs,Wzuysv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 7/24 * einsum('Kxy,Lzwx,wuvs,Wzuyvs->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsuwy->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsuyw->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwx,zuvs,Wvswuy->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kxy,Lzwx,zuvs,Wvswyu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/24 * einsum('Kxy,Lzwx,zuvs,Wvsyuw->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva -= 7/24 * einsum('Kxy,Lzwx,zuvs,Wvsywu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,LzxW,zwuv,ywuv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzxw,Wuvw,yuvz->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzxw,Wuwv,yuzv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzxw,Wzuv,ywuv->KLW', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kxy,Lzxw,wuvs,Wzuyvs->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kxy,Lzxw,zuvs,Wvsywu->KLW', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma[s_cva__bab:f_cva__bab] += sigma_cva.reshape(-1).copy()

        # CCE <- CAA
        if nextern > 0:
            sigma_cce =- 1/2 * einsum('Kxy,LyBz,xz->KLB', X_aaa, v_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LyzB,xz->KLB', X_aaa, v_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzBx,yz->KLB', X_aaa, v_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LzxB,yz->KLB', X_aaa, v_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,KyBz,xz->KLB', X_aaa, v_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,KyzB,xz->KLB', X_aaa, v_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,KzBx,yz->KLB', X_aaa, v_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,KzxB,yz->KLB', X_aaa, v_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('ixy,KLiB,xy->KLB', X_aaa, v_xxxe, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('ixy,LKiB,xy->KLB', X_aaa, v_xxxe, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LyBz,xz->KLB', X_abb, v_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzBx,yz->KLB', X_abb, v_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,KyBz,xz->KLB', X_abb, v_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,KzBx,yz->KLB', X_abb, v_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('ixy,KLiB,xy->KLB', X_abb, v_xxxe, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('ixy,LKiB,xy->KLB', X_abb, v_xxxe, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,B,LyBz,xz->KLB', X_aaa, e_extern, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,B,LyzB,xz->KLB', X_aaa, e_extern, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,B,LzBx,yz->KLB', X_aaa, e_extern, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,B,LzxB,yz->KLB', X_aaa, e_extern, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,L,LyBz,xz->KLB', X_aaa, e_cvs, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,L,LyzB,xz->KLB', X_aaa, e_cvs, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,L,LzBx,yz->KLB', X_aaa, e_cvs, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,L,LzxB,yz->KLB', X_aaa, e_cvs, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,B,KyBz,xz->KLB', X_aaa, e_extern, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,B,KyzB,xz->KLB', X_aaa, e_extern, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,B,KzBx,yz->KLB', X_aaa, e_extern, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,B,KzxB,yz->KLB', X_aaa, e_extern, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,K,KyBz,xz->KLB', X_aaa, e_cvs, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,K,KyzB,xz->KLB', X_aaa, e_cvs, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,K,KzBx,yz->KLB', X_aaa, e_cvs, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,K,KzxB,yz->KLB', X_aaa, e_cvs, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,xz,LwBz,yw->KLB', X_aaa, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,xz,LwzB,yw->KLB', X_aaa, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,yz,LzBw,xw->KLB', X_aaa, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,yz,LzwB,xw->KLB', X_aaa, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,zw,LyBz,xw->KLB', X_aaa, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,zw,LyzB,xw->KLB', X_aaa, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,zw,LzBx,yw->KLB', X_aaa, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,zw,LzxB,yw->KLB', X_aaa, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,xz,KwBz,yw->KLB', X_aaa, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,xz,KwzB,yw->KLB', X_aaa, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,yz,KzBw,xw->KLB', X_aaa, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,yz,KzwB,xw->KLB', X_aaa, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,zw,KyBz,xw->KLB', X_aaa, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,zw,KyzB,xw->KLB', X_aaa, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,zw,KzBx,yw->KLB', X_aaa, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,zw,KzxB,yw->KLB', X_aaa, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LyBz,zwuv,xwuv->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LyzB,zwuv,xwuv->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzBw,xuvw,yuvz->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzBw,xuwv,yuzv->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LzBw,xzuv,ywuv->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzBw,yuvz,xuvw->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzBw,yuzv,xuwv->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LzBw,ywuv,xzuv->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LzBx,zwuv,ywuv->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/6 * einsum('Kxy,LzwB,xuvw,yuvz->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/6 * einsum('Kxy,LzwB,xuvw,yuzv->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LzwB,xuwv,yuzv->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/6 * einsum('Kxy,LzwB,xzuv,ywuv->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/6 * einsum('Kxy,LzwB,xzuv,ywvu->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/6 * einsum('Kxy,LzwB,yuvz,xuvw->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/6 * einsum('Kxy,LzwB,yuvz,xuwv->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LzwB,yuzv,xuwv->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/6 * einsum('Kxy,LzwB,ywuv,xzuv->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/6 * einsum('Kxy,LzwB,ywuv,xzvu->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzxB,zwuv,ywuv->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,KyBz,zwuv,xwuv->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,KyzB,zwuv,xwuv->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,KzBw,xuvw,yuvz->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,KzBw,xuwv,yuzv->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,KzBw,xzuv,ywuv->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,KzBw,yuvz,xuvw->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,KzBw,yuzv,xuwv->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,KzBw,ywuv,xzuv->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,KzBx,zwuv,ywuv->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/6 * einsum('Lxy,KzwB,xuvw,yuvz->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/6 * einsum('Lxy,KzwB,xuvw,yuzv->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,KzwB,xuwv,yuzv->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/6 * einsum('Lxy,KzwB,xzuv,ywuv->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/6 * einsum('Lxy,KzwB,xzuv,ywvu->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/6 * einsum('Lxy,KzwB,yuvz,xuvw->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/6 * einsum('Lxy,KzwB,yuvz,xuwv->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,KzwB,yuzv,xuwv->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/6 * einsum('Lxy,KzwB,ywuv,xzuv->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/6 * einsum('Lxy,KzwB,ywuv,xzvu->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,KzxB,zwuv,ywuv->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,B,LyBz,xz->KLB', X_abb, e_extern, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,B,LzBx,yz->KLB', X_abb, e_extern, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,L,LyBz,xz->KLB', X_abb, e_cvs, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,L,LzBx,yz->KLB', X_abb, e_cvs, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,B,KyBz,xz->KLB', X_abb, e_extern, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,B,KzBx,yz->KLB', X_abb, e_extern, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,K,KyBz,xz->KLB', X_abb, e_cvs, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,K,KzBx,yz->KLB', X_abb, e_cvs, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,xz,LwBz,yw->KLB', X_abb, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,yz,LzBw,xw->KLB', X_abb, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,zw,LyBz,xw->KLB', X_abb, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,zw,LzBx,yw->KLB', X_abb, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,xz,KwBz,yw->KLB', X_abb, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,yz,KzBw,xw->KLB', X_abb, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,zw,KyBz,xw->KLB', X_abb, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,zw,KzBx,yw->KLB', X_abb, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LyBz,zwuv,xwuv->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzBw,xuvw,yuvz->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzBw,xuwv,yuzv->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LzBw,xzuv,ywuv->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzBw,yuvz,xuvw->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzBw,yuzv,xuwv->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LzBw,ywuv,xzuv->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LzBx,zwuv,ywuv->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/3 * einsum('Kxy,LzwB,xuvw,yuvz->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/6 * einsum('Kxy,LzwB,xuvw,yuzv->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/3 * einsum('Kxy,LzwB,xzuv,ywuv->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/6 * einsum('Kxy,LzwB,xzuv,ywvu->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/3 * einsum('Kxy,LzwB,yuvz,xuvw->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/6 * einsum('Kxy,LzwB,yuvz,xuwv->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/3 * einsum('Kxy,LzwB,ywuv,xzuv->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/6 * einsum('Kxy,LzwB,ywuv,xzvu->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,KyBz,zwuv,xwuv->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,KzBw,xuvw,yuvz->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,KzBw,xuwv,yuzv->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,KzBw,xzuv,ywuv->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,KzBw,yuvz,xuvw->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,KzBw,yuzv,xuwv->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,KzBw,ywuv,xzuv->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,KzBx,zwuv,ywuv->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/3 * einsum('Lxy,KzwB,xuvw,yuvz->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/6 * einsum('Lxy,KzwB,xuvw,yuzv->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/3 * einsum('Lxy,KzwB,xzuv,ywuv->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/6 * einsum('Lxy,KzwB,xzuv,ywvu->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/3 * einsum('Lxy,KzwB,yuvz,xuvw->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/6 * einsum('Lxy,KzwB,yuvz,xuwv->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/3 * einsum('Lxy,KzwB,ywuv,xzuv->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/6 * einsum('Lxy,KzwB,ywuv,xzvu->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma[s_cce__aaa:f_cce__aaa] += sigma_cce[cvs_tril_ind[0], cvs_tril_ind[1]].reshape(-1).copy()

            sigma_cce =- 1/2 * einsum('Kxy,LyBz,xz->KLB', X_aaa, v_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzBx,yz->KLB', X_aaa, v_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('ixy,KLiB,xy->KLB', X_aaa, v_xxxe, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LyBz,xz->KLB', X_abb, v_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LyzB,xz->KLB', X_abb, v_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzBx,yz->KLB', X_abb, v_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LzxB,yz->KLB', X_abb, v_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('ixy,KLiB,xy->KLB', X_abb, v_xxxe, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,KyzB,xz->KLB', X_bab, v_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,KzxB,yz->KLB', X_bab, v_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,B,LyBz,xz->KLB', X_aaa, e_extern, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,B,LzBx,yz->KLB', X_aaa, e_extern, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,L,LyBz,xz->KLB', X_aaa, e_cvs, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,L,LzBx,yz->KLB', X_aaa, e_cvs, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,xz,LwBz,yw->KLB', X_aaa, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,yz,LzBw,xw->KLB', X_aaa, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,zw,LyBz,xw->KLB', X_aaa, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,zw,LzBx,yw->KLB', X_aaa, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LyBz,zwuv,xwuv->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzBw,xuvw,yuvz->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzBw,xuwv,yuzv->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LzBw,xzuv,ywuv->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzBw,yuvz,xuvw->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzBw,yuzv,xuwv->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LzBw,ywuv,xzuv->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LzBx,zwuv,ywuv->KLB', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/3 * einsum('Kxy,LzwB,xuvw,yuvz->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/6 * einsum('Kxy,LzwB,xuvw,yuzv->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/3 * einsum('Kxy,LzwB,xzuv,ywuv->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/6 * einsum('Kxy,LzwB,xzuv,ywvu->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/3 * einsum('Kxy,LzwB,yuvz,xuvw->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/6 * einsum('Kxy,LzwB,yuvz,xuwv->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/3 * einsum('Kxy,LzwB,ywuv,xzuv->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/6 * einsum('Kxy,LzwB,ywuv,xzvu->KLB', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,B,LyBz,xz->KLB', X_abb, e_extern, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,B,LyzB,xz->KLB', X_abb, e_extern, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,B,LzBx,yz->KLB', X_abb, e_extern, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,B,LzxB,yz->KLB', X_abb, e_extern, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,L,LyBz,xz->KLB', X_abb, e_cvs, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,L,LyzB,xz->KLB', X_abb, e_cvs, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,L,LzBx,yz->KLB', X_abb, e_cvs, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,L,LzxB,yz->KLB', X_abb, e_cvs, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,xz,LwBz,yw->KLB', X_abb, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,xz,LwzB,yw->KLB', X_abb, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,yz,LzBw,xw->KLB', X_abb, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,yz,LzwB,xw->KLB', X_abb, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,zw,LyBz,xw->KLB', X_abb, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,zw,LyzB,xw->KLB', X_abb, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,zw,LzBx,yw->KLB', X_abb, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,zw,LzxB,yw->KLB', X_abb, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LyBz,zwuv,xwuv->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LyzB,zwuv,xwuv->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzBw,xuvw,yuvz->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzBw,xuwv,yuzv->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LzBw,xzuv,ywuv->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzBw,yuvz,xuvw->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzBw,yuzv,xuwv->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LzBw,ywuv,xzuv->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LzBx,zwuv,ywuv->KLB', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/6 * einsum('Kxy,LzwB,xuvw,yuvz->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/6 * einsum('Kxy,LzwB,xuvw,yuzv->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LzwB,xuwv,yuzv->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/6 * einsum('Kxy,LzwB,xzuv,ywuv->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/6 * einsum('Kxy,LzwB,xzuv,ywvu->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/6 * einsum('Kxy,LzwB,yuvz,xuvw->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/6 * einsum('Kxy,LzwB,yuvz,xuwv->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxy,LzwB,yuzv,xuwv->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/6 * einsum('Kxy,LzwB,ywuv,xzuv->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/6 * einsum('Kxy,LzwB,ywuv,xzvu->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxy,LzxB,zwuv,ywuv->KLB', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,B,KyzB,xz->KLB', X_bab, e_extern, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,B,KzxB,yz->KLB', X_bab, e_extern, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,K,KyzB,xz->KLB', X_bab, e_cvs, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,K,KzxB,yz->KLB', X_bab, e_cvs, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,xz,KwzB,yw->KLB', X_bab, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,yz,KzwB,xw->KLB', X_bab, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,zw,KyzB,xw->KLB', X_bab, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,zw,KzxB,yw->KLB', X_bab, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,KyzB,zwuv,xwuv->KLB', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/6 * einsum('Lxy,KzwB,xuvw,yuvz->KLB', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/3 * einsum('Lxy,KzwB,xuvw,yuzv->KLB', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,KzwB,xuwv,yuzv->KLB', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/6 * einsum('Lxy,KzwB,xzuv,ywuv->KLB', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/3 * einsum('Lxy,KzwB,xzuv,ywvu->KLB', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/6 * einsum('Lxy,KzwB,yuvz,xuvw->KLB', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/3 * einsum('Lxy,KzwB,yuvz,xuwv->KLB', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxy,KzwB,yuzv,xuwv->KLB', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/6 * einsum('Lxy,KzwB,ywuv,xzuv->KLB', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/3 * einsum('Lxy,KzwB,ywuv,xzvu->KLB', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxy,KzxB,zwuv,ywuv->KLB', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma[s_cce__abb:f_cce__abb] += sigma_cce.reshape(-1).copy()

            # CVE <- CAA
            if nval > 0:
                sigma_cve =- 1/2 * einsum('Kxy,LyBz,xz->KLB', X_aaa, v_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LyzB,xz->KLB', X_aaa, v_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzBx,yz->KLB', X_aaa, v_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LzxB,yz->KLB', X_aaa, v_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('ixy,KLiB,xy->KLB', X_aaa, v_xvxe, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('ixy,LKiB,xy->KLB', X_aaa, v_vxxe, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LyBz,xz->KLB', X_abb, v_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzBx,yz->KLB', X_abb, v_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('ixy,KLiB,xy->KLB', X_abb, v_xvxe, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('ixy,LKiB,xy->KLB', X_abb, v_vxxe, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,B,LyBz,xz->KLB', X_aaa, e_extern, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,B,LyzB,xz->KLB', X_aaa, e_extern, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,B,LzBx,yz->KLB', X_aaa, e_extern, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,B,LzxB,yz->KLB', X_aaa, e_extern, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,L,LyBz,xz->KLB', X_aaa, e_val, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,L,LyzB,xz->KLB', X_aaa, e_val, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,L,LzBx,yz->KLB', X_aaa, e_val, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,L,LzxB,yz->KLB', X_aaa, e_val, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,xz,LwBz,yw->KLB', X_aaa, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,xz,LwzB,yw->KLB', X_aaa, h_aa, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,yz,LzBw,xw->KLB', X_aaa, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,yz,LzwB,xw->KLB', X_aaa, h_aa, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,zw,LyBz,xw->KLB', X_aaa, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,zw,LyzB,xw->KLB', X_aaa, h_aa, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,zw,LzBx,yw->KLB', X_aaa, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,zw,LzxB,yw->KLB', X_aaa, h_aa, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LyBz,zwuv,xwuv->KLB', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LyzB,zwuv,xwuv->KLB', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzBw,xuvw,yuvz->KLB', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzBw,xuwv,yuzv->KLB', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LzBw,xzuv,ywuv->KLB', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzBw,yuvz,xuvw->KLB', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzBw,yuzv,xuwv->KLB', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LzBw,ywuv,xzuv->KLB', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LzBx,zwuv,ywuv->KLB', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/6 * einsum('Kxy,LzwB,xuvw,yuvz->KLB', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/6 * einsum('Kxy,LzwB,xuvw,yuzv->KLB', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LzwB,xuwv,yuzv->KLB', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/6 * einsum('Kxy,LzwB,xzuv,ywuv->KLB', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/6 * einsum('Kxy,LzwB,xzuv,ywvu->KLB', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/6 * einsum('Kxy,LzwB,yuvz,xuvw->KLB', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/6 * einsum('Kxy,LzwB,yuvz,xuwv->KLB', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LzwB,yuzv,xuwv->KLB', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/6 * einsum('Kxy,LzwB,ywuv,xzuv->KLB', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/6 * einsum('Kxy,LzwB,ywuv,xzvu->KLB', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzxB,zwuv,ywuv->KLB', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,B,LyBz,xz->KLB', X_abb, e_extern, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,B,LzBx,yz->KLB', X_abb, e_extern, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,L,LyBz,xz->KLB', X_abb, e_val, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,L,LzBx,yz->KLB', X_abb, e_val, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,xz,LwBz,yw->KLB', X_abb, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,yz,LzBw,xw->KLB', X_abb, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,zw,LyBz,xw->KLB', X_abb, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,zw,LzBx,yw->KLB', X_abb, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LyBz,zwuv,xwuv->KLB', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzBw,xuvw,yuvz->KLB', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzBw,xuwv,yuzv->KLB', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LzBw,xzuv,ywuv->KLB', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzBw,yuvz,xuvw->KLB', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzBw,yuzv,xuwv->KLB', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LzBw,ywuv,xzuv->KLB', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LzBx,zwuv,ywuv->KLB', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/3 * einsum('Kxy,LzwB,xuvw,yuvz->KLB', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/6 * einsum('Kxy,LzwB,xuvw,yuzv->KLB', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/3 * einsum('Kxy,LzwB,xzuv,ywuv->KLB', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/6 * einsum('Kxy,LzwB,xzuv,ywvu->KLB', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/3 * einsum('Kxy,LzwB,yuvz,xuvw->KLB', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/6 * einsum('Kxy,LzwB,yuvz,xuwv->KLB', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/3 * einsum('Kxy,LzwB,ywuv,xzuv->KLB', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/6 * einsum('Kxy,LzwB,ywuv,xzvu->KLB', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma[s_cve__aaa:f_cve__aaa] += sigma_cve.reshape(-1).copy()

                sigma_cve =- 1/2 * einsum('Kxy,LyBz,xz->KLB', X_aaa, v_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzBx,yz->KLB', X_aaa, v_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('ixy,KLiB,xy->KLB', X_aaa, v_xvxe, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LyBz,xz->KLB', X_abb, v_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LyzB,xz->KLB', X_abb, v_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzBx,yz->KLB', X_abb, v_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LzxB,yz->KLB', X_abb, v_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('ixy,KLiB,xy->KLB', X_abb, v_xvxe, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,B,LyBz,xz->KLB', X_aaa, e_extern, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,B,LzBx,yz->KLB', X_aaa, e_extern, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,L,LyBz,xz->KLB', X_aaa, e_val, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,L,LzBx,yz->KLB', X_aaa, e_val, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,xz,LwBz,yw->KLB', X_aaa, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,yz,LzBw,xw->KLB', X_aaa, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,zw,LyBz,xw->KLB', X_aaa, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,zw,LzBx,yw->KLB', X_aaa, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LyBz,zwuv,xwuv->KLB', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzBw,xuvw,yuvz->KLB', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzBw,xuwv,yuzv->KLB', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LzBw,xzuv,ywuv->KLB', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzBw,yuvz,xuvw->KLB', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzBw,yuzv,xuwv->KLB', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LzBw,ywuv,xzuv->KLB', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LzBx,zwuv,ywuv->KLB', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/3 * einsum('Kxy,LzwB,xuvw,yuvz->KLB', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/6 * einsum('Kxy,LzwB,xuvw,yuzv->KLB', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/3 * einsum('Kxy,LzwB,xzuv,ywuv->KLB', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/6 * einsum('Kxy,LzwB,xzuv,ywvu->KLB', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/3 * einsum('Kxy,LzwB,yuvz,xuvw->KLB', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/6 * einsum('Kxy,LzwB,yuvz,xuwv->KLB', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/3 * einsum('Kxy,LzwB,ywuv,xzuv->KLB', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/6 * einsum('Kxy,LzwB,ywuv,xzvu->KLB', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,B,LyBz,xz->KLB', X_abb, e_extern, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,B,LyzB,xz->KLB', X_abb, e_extern, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,B,LzBx,yz->KLB', X_abb, e_extern, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,B,LzxB,yz->KLB', X_abb, e_extern, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,L,LyBz,xz->KLB', X_abb, e_val, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,L,LyzB,xz->KLB', X_abb, e_val, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,L,LzBx,yz->KLB', X_abb, e_val, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,L,LzxB,yz->KLB', X_abb, e_val, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,xz,LwBz,yw->KLB', X_abb, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,xz,LwzB,yw->KLB', X_abb, h_aa, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,yz,LzBw,xw->KLB', X_abb, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,yz,LzwB,xw->KLB', X_abb, h_aa, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,zw,LyBz,xw->KLB', X_abb, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,zw,LyzB,xw->KLB', X_abb, h_aa, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,zw,LzBx,yw->KLB', X_abb, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,zw,LzxB,yw->KLB', X_abb, h_aa, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LyBz,zwuv,xwuv->KLB', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LyzB,zwuv,xwuv->KLB', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzBw,xuvw,yuvz->KLB', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzBw,xuwv,yuzv->KLB', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LzBw,xzuv,ywuv->KLB', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzBw,yuvz,xuvw->KLB', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzBw,yuzv,xuwv->KLB', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LzBw,ywuv,xzuv->KLB', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LzBx,zwuv,ywuv->KLB', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/6 * einsum('Kxy,LzwB,xuvw,yuvz->KLB', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/6 * einsum('Kxy,LzwB,xuvw,yuzv->KLB', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LzwB,xuwv,yuzv->KLB', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/6 * einsum('Kxy,LzwB,xzuv,ywuv->KLB', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/6 * einsum('Kxy,LzwB,xzuv,ywvu->KLB', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/6 * einsum('Kxy,LzwB,yuvz,xuvw->KLB', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/6 * einsum('Kxy,LzwB,yuvz,xuwv->KLB', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LzwB,yuzv,xuwv->KLB', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/6 * einsum('Kxy,LzwB,ywuv,xzuv->KLB', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/6 * einsum('Kxy,LzwB,ywuv,xzvu->KLB', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzxB,zwuv,ywuv->KLB', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma[s_cve__abb:f_cve__abb] += sigma_cve.reshape(-1).copy()

                sigma_cve =- 1/2 * einsum('ixy,LKiB,xy->KLB', X_aaa, v_vxxe, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('ixy,LKiB,xy->KLB', X_abb, v_vxxe, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LyzB,xz->KLB', X_bab, v_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LzxB,yz->KLB', X_bab, v_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,B,LyzB,xz->KLB', X_bab, e_extern, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,B,LzxB,yz->KLB', X_bab, e_extern, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,L,LyzB,xz->KLB', X_bab, e_val, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,L,LzxB,yz->KLB', X_bab, e_val, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,xz,LwzB,yw->KLB', X_bab, h_aa, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,yz,LzwB,xw->KLB', X_bab, h_aa, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,zw,LyzB,xw->KLB', X_bab, h_aa, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,zw,LzxB,yw->KLB', X_bab, h_aa, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LyzB,zwuv,xwuv->KLB', X_bab, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/6 * einsum('Kxy,LzwB,xuvw,yuvz->KLB', X_bab, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/3 * einsum('Kxy,LzwB,xuvw,yuzv->KLB', X_bab, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LzwB,xuwv,yuzv->KLB', X_bab, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/6 * einsum('Kxy,LzwB,xzuv,ywuv->KLB', X_bab, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/3 * einsum('Kxy,LzwB,xzuv,ywvu->KLB', X_bab, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/6 * einsum('Kxy,LzwB,yuvz,xuvw->KLB', X_bab, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/3 * einsum('Kxy,LzwB,yuvz,xuwv->KLB', X_bab, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxy,LzwB,yuzv,xuwv->KLB', X_bab, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/6 * einsum('Kxy,LzwB,ywuv,xzuv->KLB', X_bab, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/3 * einsum('Kxy,LzwB,ywuv,xzvu->KLB', X_bab, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxy,LzxB,zwuv,ywuv->KLB', X_bab, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma[s_cve__bab:f_cve__bab] += sigma_cve.reshape(-1).copy()

            # CAE <- CAA
            sigma_cae =- 1/2 * einsum('Kxy,yB,Zx->KZB', X_aaa, h_ae, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,yzwB,Zwxz->KZB', X_aaa, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,yzwB,Zwzx->KZB', X_aaa, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zwxB,Zywz->KZB', X_aaa, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zwxB,Zyzw->KZB', X_aaa, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('Kxy,zywB,Zwxz->KZB', X_aaa, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('ixy,KyBi,Zx->KZB', X_aaa, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('ixy,KyiB,Zx->KZB', X_aaa, v_xaxe, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('ixy,KzBi,Zyxz->KZB', X_aaa, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('ixy,KzBi,Zyzx->KZB', X_aaa, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('ixy,KziB,Zyxz->KZB', X_aaa, v_xaxe, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('ixy,KziB,Zyzx->KZB', X_aaa, v_xaxe, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,yzwB,Zwxz->KZB', X_abb, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,yzwB,Zwzx->KZB', X_abb, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,zwxB,Zywz->KZB', X_abb, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zwxB,Zyzw->KZB', X_abb, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('ixy,KzBi,Zyxz->KZB', X_abb, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('ixy,KzBi,Zyzx->KZB', X_abb, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('ixy,KziB,Zyxz->KZB', X_abb, v_xaxe, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('ixy,KziB,Zyzx->KZB', X_abb, v_xaxe, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('ixy,KyBi,Zx->KZB', X_bab, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('ixy,KzBi,Zyxz->KZB', X_bab, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('ixy,KzBi,Zyzx->KZB', X_bab, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('Kxy,B,yB,Zx->KZB', X_aaa, e_extern, t1_ae, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('Kxy,B,yzBw,Zwxz->KZB', X_aaa, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,B,zwBx,Zywz->KZB', X_aaa, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,B,zwBx,Zyzw->KZB', X_aaa, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,B,zyBw,Zwxz->KZB', X_aaa, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,B,zyBw,Zwzx->KZB', X_aaa, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,xz,wuBz,Zyuw->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,xz,wuBz,Zywu->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,yz,wzBu,Zuwx->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,yz,wzBu,Zuxw->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxy,yz,zB,Zx->KZB', X_aaa, h_aa, t1_ae, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxy,yz,zwBu,Zuxw->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zw,uyBz,Zwux->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zw,uyBz,Zwxu->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zw,uzBx,Zyuw->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zw,uzBx,Zywu->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('Kxy,zw,yuBz,Zwxu->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxy,zw,yzBu,Zuxw->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zw,zuBx,Zyuw->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zw,zuBx,Zywu->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zw,zyBu,Zuwx->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zw,zyBu,Zuxw->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,yzBw,wuvs,xzuZsv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 5/12 * einsum('Kxy,yzBw,wuvs,xzuZvs->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,yzBw,wuvs,xzusZv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,yzBw,wuvs,xzusvZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,yzBw,wuvs,xzuvZs->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,yzBw,wuvs,xzuvsZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxy,yzBw,zuvs,xvsZwu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zB,xzwu,Zyuw->KZB', X_aaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zB,xzwu,Zywu->KZB', X_aaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zB,ywuz,Zuwx->KZB', X_aaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zB,ywuz,Zuxw->KZB', X_aaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxy,zB,ywzu,Zuxw->KZB', X_aaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 5/24 * einsum('Kxy,zwBu,xvsu,zwsZvy->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,xvsu,zwsZyv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,xvsu,zwsvZy->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,xvsu,zwsvyZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,xvsu,zwsyZv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBu,xvsu,zwsyvZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zwBu,xvus,zwsZyv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zwBu,xvus,zwsyZv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBu,xwvs,zvsZuy->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 5/24 * einsum('Kxy,zwBu,xwvs,zvsZyu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBu,xwvs,zvsuZy->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBu,xwvs,zvsuyZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zwBu,xwvs,zvsyZu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBu,xwvs,zvsyuZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zwBu,xzvs,wvsuZy->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zwBu,xzvs,wvsuyZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,yuvs,xzwZsv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 5/24 * einsum('Kxy,zwBu,yuvs,xzwZvs->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,yuvs,xzwsZv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,yuvs,xzwsvZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBu,yuvs,xzwvZs->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,yuvs,xzwvsZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zwBu,yvsw,xzvZsu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zwBu,yvsw,xzvsZu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvsz,xwvZsu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('Kxy,zwBu,yvsz,xwvZus->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvsz,xwvsZu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yvsz,xwvsuZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvsz,xwvuZs->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvsz,xwvusZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvws,xzvZsu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('Kxy,zwBu,yvws,xzvZus->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvws,xzvsZu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvws,xzvsuZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yvws,xzvuZs->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvws,xzvusZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zwBu,yvwz,Zuvx->KZB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zwBu,yvwz,Zuxv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxy,zwBu,yvzs,xwvZus->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxy,zwBu,yvzw,Zuxv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBx,wuvs,zvsZuy->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 5/24 * einsum('Kxy,zwBx,wuvs,zvsZyu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBx,wuvs,zvsuZy->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBx,wuvs,zvsuyZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zwBx,wuvs,zvsyZu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBx,wuvs,zvsyuZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBx,zuvs,wvsZuy->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 5/24 * einsum('Kxy,zwBx,zuvs,wvsZyu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBx,zuvs,wvsuZy->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBx,zuvs,wvsuyZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBx,zuvs,wvsyZu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBx,zuvs,wvsyuZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zwBx,zwuv,Zyuv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zwBx,zwuv,Zyvu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zyBw,wuvs,xzuZsv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zyBw,wuvs,xzuZvs->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zyBw,wuvs,xzusZv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zyBw,wuvs,xzusvZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 5/24 * einsum('Kxy,zyBw,wuvs,xzuvZs->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zyBw,wuvs,xzuvsZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zyBw,zuvs,xvsZuw->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 5/24 * einsum('Kxy,zyBw,zuvs,xvsZwu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zyBw,zuvs,xvsuZw->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zyBw,zuvs,xvsuwZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zyBw,zuvs,xvswZu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zyBw,zuvs,xvswuZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,B,zwBx,Zywz->KZB', X_abb, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,B,zwBx,Zyzw->KZB', X_abb, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,B,zyBw,Zwxz->KZB', X_abb, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,B,zyBw,Zwzx->KZB', X_abb, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,xz,wuBz,Zyuw->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,xz,wuBz,Zywu->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,yz,wzBu,Zuwx->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,yz,wzBu,Zuxw->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,zw,uyBz,Zwux->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zw,uyBz,Zwxu->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,zw,uzBx,Zyuw->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zw,uzBx,Zywu->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zw,zuBx,Zyuw->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,zw,zuBx,Zywu->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,zw,zyBu,Zuwx->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zw,zyBu,Zuxw->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,zB,xzwu,Zyuw->KZB', X_abb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zB,xzwu,Zywu->KZB', X_abb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,zB,ywuz,Zuwx->KZB', X_abb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zB,ywuz,Zuxw->KZB', X_abb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 7/24 * einsum('Kxy,zwBu,xvsu,zwsZvy->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBu,xvsu,zwsZyv->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBu,xvsu,zwsvZy->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBu,xvsu,zwsvyZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBu,xvsu,zwsyZv->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zwBu,xvsu,zwsyvZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,xvus,zwsZvy->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('Kxy,zwBu,xvus,zwsZyv->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,xvus,zwsvZy->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,xvus,zwsvyZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,xvus,zwsyZv->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,xvus,zwsyvZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,xwvs,zvsZuy->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 7/24 * einsum('Kxy,zwBu,xwvs,zvsZyu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,xwvs,zvsuZy->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,xwvs,zvsuyZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBu,xwvs,zvsyZu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,xwvs,zvsyuZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,xzvs,wvsZuy->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,xzvs,wvsZyu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,xzvs,wvsuZy->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('Kxy,zwBu,xzvs,wvsuyZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,xzvs,wvsyZu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,xzvs,wvsyuZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yuvs,xzwZsv->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yuvs,xzwZvs->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yuvs,xzwsZv->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yuvs,xzwsvZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('Kxy,zwBu,yuvs,xzwvZs->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yuvs,xzwvsZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zwBu,yvsw,xzvZsu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,zwBu,yvsw,xzvsZu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvsz,xwvZsu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yvsz,xwvZus->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvsz,xwvsZu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('Kxy,zwBu,yvsz,xwvsuZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvsz,xwvuZs->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvsz,xwvusZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvws,xzvZsu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yvws,xzvZus->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvws,xzvsZu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvws,xzvsuZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('Kxy,zwBu,yvws,xzvuZs->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvws,xzvusZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,zwBu,yvwz,Zuvx->KZB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zwBu,yvwz,Zuxv->KZB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBx,wuvs,zvsZuy->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 7/24 * einsum('Kxy,zwBx,wuvs,zvsZyu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBx,wuvs,zvsuZy->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBx,wuvs,zvsuyZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBx,wuvs,zvsyZu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBx,wuvs,zvsyuZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zwBx,zuvs,wvsZuy->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBx,zuvs,wvsZyu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zwBx,zuvs,wvsuZy->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zwBx,zuvs,wvsuyZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 5/24 * einsum('Kxy,zwBx,zuvs,wvsyZu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zwBx,zuvs,wvsyuZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,zwBx,zwuv,Zyuv->KZB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zwBx,zwuv,Zyvu->KZB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zyBw,wuvs,xzuZsv->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zyBw,wuvs,xzuZvs->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zyBw,wuvs,xzusZv->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zyBw,wuvs,xzusvZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 7/24 * einsum('Kxy,zyBw,wuvs,xzuvZs->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zyBw,wuvs,xzuvsZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zyBw,zuvs,xvsZuw->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zyBw,zuvs,xvsZwu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zyBw,zuvs,xvsuZw->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zyBw,zuvs,xvsuwZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 5/24 * einsum('Kxy,zyBw,zuvs,xvswZu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zyBw,zuvs,xvswuZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma[s_cae__aaa:f_cae__aaa] += sigma_cae.reshape(-1).copy()

            sigma_cae =- 1/6 * einsum('Kxy,yzwB,Zwxz->KZB', X_aaa, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,yzwB,Zwzx->KZB', X_aaa, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,zwxB,Zywz->KZB', X_aaa, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zwxB,Zyzw->KZB', X_aaa, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('ixy,KziB,Zyxz->KZB', X_aaa, v_xaxe, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('ixy,KziB,Zyzx->KZB', X_aaa, v_xaxe, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('Kxy,yB,Zx->KZB', X_abb, h_ae, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,yzwB,Zwxz->KZB', X_abb, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,yzwB,Zwzx->KZB', X_abb, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zwxB,Zywz->KZB', X_abb, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zwxB,Zyzw->KZB', X_abb, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('Kxy,zywB,Zwxz->KZB', X_abb, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('ixy,KyiB,Zx->KZB', X_abb, v_xaxe, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('ixy,KziB,Zyxz->KZB', X_abb, v_xaxe, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('ixy,KziB,Zyzx->KZB', X_abb, v_xaxe, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,B,zwBx,Zywz->KZB', X_aaa, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,B,zwBx,Zyzw->KZB', X_aaa, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,B,zyBw,Zwxz->KZB', X_aaa, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,B,zyBw,Zwzx->KZB', X_aaa, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,xz,wuBz,Zyuw->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,xz,wuBz,Zywu->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,yz,wzBu,Zuwx->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,yz,wzBu,Zuxw->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,zw,uyBz,Zwux->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zw,uyBz,Zwxu->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,zw,uzBx,Zyuw->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zw,uzBx,Zywu->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zw,zuBx,Zyuw->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,zw,zuBx,Zywu->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,zw,zyBu,Zuwx->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zw,zyBu,Zuxw->KZB', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,zB,xzwu,Zyuw->KZB', X_aaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zB,xzwu,Zywu->KZB', X_aaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,zB,ywuz,Zuwx->KZB', X_aaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zB,ywuz,Zuxw->KZB', X_aaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 7/24 * einsum('Kxy,zwBu,xvsu,zwsZvy->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBu,xvsu,zwsZyv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBu,xvsu,zwsvZy->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBu,xvsu,zwsvyZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBu,xvsu,zwsyZv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zwBu,xvsu,zwsyvZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,xvus,zwsZvy->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('Kxy,zwBu,xvus,zwsZyv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,xvus,zwsvZy->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,xvus,zwsvyZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,xvus,zwsyZv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,xvus,zwsyvZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,xwvs,zvsZuy->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 7/24 * einsum('Kxy,zwBu,xwvs,zvsZyu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,xwvs,zvsuZy->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,xwvs,zvsuyZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBu,xwvs,zvsyZu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,xwvs,zvsyuZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,xzvs,wvsZuy->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,xzvs,wvsZyu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,xzvs,wvsuZy->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('Kxy,zwBu,xzvs,wvsuyZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,xzvs,wvsyZu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,xzvs,wvsyuZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yuvs,xzwZsv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yuvs,xzwZvs->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yuvs,xzwsZv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yuvs,xzwsvZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('Kxy,zwBu,yuvs,xzwvZs->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yuvs,xzwvsZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zwBu,yvsw,xzvZsu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,zwBu,yvsw,xzvsZu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvsz,xwvZsu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yvsz,xwvZus->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvsz,xwvsZu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('Kxy,zwBu,yvsz,xwvsuZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvsz,xwvuZs->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvsz,xwvusZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvws,xzvZsu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yvws,xzvZus->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvws,xzvsZu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvws,xzvsuZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('Kxy,zwBu,yvws,xzvuZs->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvws,xzvusZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,zwBu,yvwz,Zuvx->KZB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zwBu,yvwz,Zuxv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBx,wuvs,zvsZuy->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 7/24 * einsum('Kxy,zwBx,wuvs,zvsZyu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBx,wuvs,zvsuZy->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBx,wuvs,zvsuyZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBx,wuvs,zvsyZu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBx,wuvs,zvsyuZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zwBx,zuvs,wvsZuy->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBx,zuvs,wvsZyu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zwBx,zuvs,wvsuZy->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zwBx,zuvs,wvsuyZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 5/24 * einsum('Kxy,zwBx,zuvs,wvsyZu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zwBx,zuvs,wvsyuZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,zwBx,zwuv,Zyuv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zwBx,zwuv,Zyvu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zyBw,wuvs,xzuZsv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zyBw,wuvs,xzuZvs->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zyBw,wuvs,xzusZv->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zyBw,wuvs,xzusvZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 7/24 * einsum('Kxy,zyBw,wuvs,xzuvZs->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zyBw,wuvs,xzuvsZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zyBw,zuvs,xvsZuw->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zyBw,zuvs,xvsZwu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zyBw,zuvs,xvsuZw->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zyBw,zuvs,xvsuwZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 5/24 * einsum('Kxy,zyBw,zuvs,xvswZu->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zyBw,zuvs,xvswuZ->KZB', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('Kxy,B,yB,Zx->KZB', X_abb, e_extern, t1_ae, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('Kxy,B,yzBw,Zwxz->KZB', X_abb, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,B,zwBx,Zywz->KZB', X_abb, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,B,zwBx,Zyzw->KZB', X_abb, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,B,zyBw,Zwxz->KZB', X_abb, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,B,zyBw,Zwzx->KZB', X_abb, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,xz,wuBz,Zyuw->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,xz,wuBz,Zywu->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,yz,wzBu,Zuwx->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,yz,wzBu,Zuxw->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxy,yz,zB,Zx->KZB', X_abb, h_aa, t1_ae, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxy,yz,zwBu,Zuxw->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zw,uyBz,Zwux->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zw,uyBz,Zwxu->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zw,uzBx,Zyuw->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zw,uzBx,Zywu->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('Kxy,zw,yuBz,Zwxu->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxy,zw,yzBu,Zuxw->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zw,zuBx,Zyuw->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zw,zuBx,Zywu->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zw,zyBu,Zuwx->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zw,zyBu,Zuxw->KZB', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,yzBw,wuvs,xzuZsv->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 5/12 * einsum('Kxy,yzBw,wuvs,xzuZvs->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,yzBw,wuvs,xzusZv->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,yzBw,wuvs,xzusvZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,yzBw,wuvs,xzuvZs->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,yzBw,wuvs,xzuvsZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxy,yzBw,zuvs,xvsZwu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zB,xzwu,Zyuw->KZB', X_abb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zB,xzwu,Zywu->KZB', X_abb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zB,ywuz,Zuwx->KZB', X_abb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zB,ywuz,Zuxw->KZB', X_abb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxy,zB,ywzu,Zuxw->KZB', X_abb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 5/24 * einsum('Kxy,zwBu,xvsu,zwsZvy->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,xvsu,zwsZyv->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,xvsu,zwsvZy->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,xvsu,zwsvyZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,xvsu,zwsyZv->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBu,xvsu,zwsyvZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zwBu,xvus,zwsZyv->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zwBu,xvus,zwsyZv->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBu,xwvs,zvsZuy->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 5/24 * einsum('Kxy,zwBu,xwvs,zvsZyu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBu,xwvs,zvsuZy->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBu,xwvs,zvsuyZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zwBu,xwvs,zvsyZu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBu,xwvs,zvsyuZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zwBu,xzvs,wvsuZy->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zwBu,xzvs,wvsuyZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,yuvs,xzwZsv->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 5/24 * einsum('Kxy,zwBu,yuvs,xzwZvs->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,yuvs,xzwsZv->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,yuvs,xzwsvZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBu,yuvs,xzwvZs->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,yuvs,xzwvsZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zwBu,yvsw,xzvZsu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zwBu,yvsw,xzvsZu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvsz,xwvZsu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('Kxy,zwBu,yvsz,xwvZus->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvsz,xwvsZu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yvsz,xwvsuZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvsz,xwvuZs->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvsz,xwvusZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvws,xzvZsu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('Kxy,zwBu,yvws,xzvZus->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvws,xzvsZu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvws,xzvsuZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yvws,xzvuZs->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvws,xzvusZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zwBu,yvwz,Zuvx->KZB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zwBu,yvwz,Zuxv->KZB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxy,zwBu,yvzs,xwvZus->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxy,zwBu,yvzw,Zuxv->KZB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBx,wuvs,zvsZuy->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 5/24 * einsum('Kxy,zwBx,wuvs,zvsZyu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBx,wuvs,zvsuZy->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBx,wuvs,zvsuyZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zwBx,wuvs,zvsyZu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBx,wuvs,zvsyuZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBx,zuvs,wvsZuy->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 5/24 * einsum('Kxy,zwBx,zuvs,wvsZyu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBx,zuvs,wvsuZy->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBx,zuvs,wvsuyZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBx,zuvs,wvsyZu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBx,zuvs,wvsyuZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zwBx,zwuv,Zyuv->KZB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zwBx,zwuv,Zyvu->KZB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zyBw,wuvs,xzuZsv->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zyBw,wuvs,xzuZvs->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zyBw,wuvs,xzusZv->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zyBw,wuvs,xzusvZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 5/24 * einsum('Kxy,zyBw,wuvs,xzuvZs->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zyBw,wuvs,xzuvsZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zyBw,zuvs,xvsZuw->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 5/24 * einsum('Kxy,zyBw,zuvs,xvsZwu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zyBw,zuvs,xvsuZw->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zyBw,zuvs,xvsuwZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zyBw,zuvs,xvswZu->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zyBw,zuvs,xvswuZ->KZB', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma[s_cae__abb:f_cae__abb] += sigma_cae.reshape(-1).copy()

            sigma_cae =- 1/2 * einsum('ixy,KyBi,Zx->KZB', X_aaa, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('ixy,KzBi,Zyxz->KZB', X_aaa, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('ixy,KzBi,Zyzx->KZB', X_aaa, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('ixy,KzBi,Zyxz->KZB', X_abb, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('ixy,KzBi,Zyzx->KZB', X_abb, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('Kxy,yB,Zx->KZB', X_bab, h_ae, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,yzwB,Zwxz->KZB', X_bab, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,yzwB,Zwzx->KZB', X_bab, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zwxB,Zywz->KZB', X_bab, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,zwxB,Zyzw->KZB', X_bab, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('Kxy,zywB,Zwxz->KZB', X_bab, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('ixy,KyBi,Zx->KZB', X_bab, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('ixy,KyiB,Zx->KZB', X_bab, v_xaxe, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('ixy,KzBi,Zyxz->KZB', X_bab, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('ixy,KzBi,Zyzx->KZB', X_bab, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('ixy,KziB,Zyxz->KZB', X_bab, v_xaxe, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('ixy,KziB,Zyzx->KZB', X_bab, v_xaxe, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('Kxy,B,yB,Zx->KZB', X_bab, e_extern, t1_ae, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('Kxy,B,yzBw,Zwxz->KZB', X_bab, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,B,zwBx,Zywz->KZB', X_bab, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,B,zwBx,Zyzw->KZB', X_bab, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,B,zyBw,Zwxz->KZB', X_bab, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,B,zyBw,Zwzx->KZB', X_bab, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,xz,wuBz,Zyuw->KZB', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,xz,wuBz,Zywu->KZB', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,yz,wzBu,Zuwx->KZB', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,yz,wzBu,Zuxw->KZB', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxy,yz,zB,Zx->KZB', X_bab, h_aa, t1_ae, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxy,yz,zwBu,Zuxw->KZB', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zw,uyBz,Zwux->KZB', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,zw,uyBz,Zwxu->KZB', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zw,uzBx,Zyuw->KZB', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,zw,uzBx,Zywu->KZB', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('Kxy,zw,yuBz,Zwxu->KZB', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxy,zw,yzBu,Zuxw->KZB', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,zw,zuBx,Zyuw->KZB', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zw,zuBx,Zywu->KZB', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zw,zyBu,Zuwx->KZB', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,zw,zyBu,Zuxw->KZB', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,yzBw,wuvs,xzuZsv->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 5/12 * einsum('Kxy,yzBw,wuvs,xzuZvs->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,yzBw,wuvs,xzusZv->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,yzBw,wuvs,xzusvZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,yzBw,wuvs,xzuvZs->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,yzBw,wuvs,xzuvsZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxy,yzBw,zuvs,xvsZwu->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zB,xzwu,Zyuw->KZB', X_bab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,zB,xzwu,Zywu->KZB', X_bab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zB,ywuz,Zuwx->KZB', X_bab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,zB,ywuz,Zuxw->KZB', X_bab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxy,zB,ywzu,Zuxw->KZB', X_bab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBu,xvsu,zwsZvy->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zwBu,xvsu,zwsZyv->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zwBu,xvsu,zwsvZy->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zwBu,xvsu,zwsvyZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zwBu,xvsu,zwsyZv->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 5/24 * einsum('Kxy,zwBu,xvsu,zwsyvZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,xvus,zwsZvy->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,xvus,zwsZyv->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,xvus,zwsvZy->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,xvus,zwsvyZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('Kxy,zwBu,xvus,zwsyZv->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,xvus,zwsyvZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBu,xwvs,zvsZuy->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,xwvs,zvsZyu->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBu,xwvs,zvsuZy->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBu,xwvs,zvsuyZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 5/24 * einsum('Kxy,zwBu,xwvs,zvsyZu->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBu,xwvs,zvsyuZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,xzvs,wvsZuy->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,xzvs,wvsZyu->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('Kxy,zwBu,xzvs,wvsuZy->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,xzvs,wvsuyZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,xzvs,wvsyZu->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,xzvs,wvsyuZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBu,yuvs,xzwZsv->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 5/24 * einsum('Kxy,zwBu,yuvs,xzwZvs->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBu,yuvs,xzwsZv->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBu,yuvs,xzwsvZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBu,yuvs,xzwvZs->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBu,yuvs,xzwvsZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,zwBu,yvsw,xzvZsu->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zwBu,yvsw,xzvsZu->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yvsz,xwvZsu->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('Kxy,zwBu,yvsz,xwvZus->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yvsz,xwvsZu->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvsz,xwvsuZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yvsz,xwvuZs->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yvsz,xwvusZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yvws,xzvZsu->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('Kxy,zwBu,yvws,xzvZus->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yvws,xzvsZu->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yvws,xzvsuZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kxy,zwBu,yvws,xzvuZs->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kxy,zwBu,yvws,xzvusZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxy,zwBu,yvwz,Zuvx->KZB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxy,zwBu,yvwz,Zuxv->KZB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxy,zwBu,yvzs,xwvZus->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxy,zwBu,yvzw,Zuxv->KZB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBx,wuvs,zvsZuy->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zwBx,wuvs,zvsZyu->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBx,wuvs,zvsuZy->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBx,wuvs,zvsuyZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 5/24 * einsum('Kxy,zwBx,wuvs,zvsyZu->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zwBx,wuvs,zvsyuZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBx,zuvs,wvsZuy->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 7/24 * einsum('Kxy,zwBx,zuvs,wvsZyu->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBx,zuvs,wvsuZy->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBx,zuvs,wvsuyZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zwBx,zuvs,wvsyZu->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zwBx,zuvs,wvsyuZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxy,zwBx,zwuv,Zyuv->KZB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxy,zwBx,zwuv,Zyvu->KZB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zyBw,wuvs,xzuZsv->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 7/24 * einsum('Kxy,zyBw,wuvs,xzuZvs->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zyBw,wuvs,xzusZv->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zyBw,wuvs,xzusvZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/8 * einsum('Kxy,zyBw,wuvs,xzuvZs->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/24 * einsum('Kxy,zyBw,wuvs,xzuvsZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zyBw,zuvs,xvsZuw->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 7/24 * einsum('Kxy,zyBw,zuvs,xvsZwu->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zyBw,zuvs,xvsuZw->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zyBw,zuvs,xvsuwZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/8 * einsum('Kxy,zyBw,zuvs,xvswZu->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('Kxy,zyBw,zuvs,xvswuZ->KZB', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma[s_cae__bab:f_cae__bab] += sigma_cae.reshape(-1).copy()

        # * <- CCA
        X_aaa = np.zeros((ncvs, ncvs, ncas))
        X_aaa[cvs_tril_ind[0], cvs_tril_ind[1]] =  Xt[s_cca__aaa:f_cca__aaa].reshape(-1, ncas).copy()
        X_aaa[cvs_tril_ind[1], cvs_tril_ind[0]] =- Xt[s_cca__aaa:f_cca__aaa].reshape(-1, ncas).copy()

        X_abb = Xt[s_cca__abb:f_cca__abb].reshape(ncvs, ncvs, ncas).copy()
        X_bab =- X_abb.transpose(1,0,2)

        # CAA <- CCA
        sigma_caa =- 1/2 * einsum('Kix,ix,WZ->KWZ', X_aaa, h_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('KjZ,jx,Wx->KWZ', X_aaa, h_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,jy,WxZy->KWZ', X_aaa, h_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,jy,WxyZ->KWZ', X_aaa, h_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iZxy,Wy->KWZ', X_aaa, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,iZyx,Wy->KWZ', X_aaa, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iyxz,WyZz->KWZ', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzx,WyZz->KWZ', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzx,WyzZ->KWZ', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('KjZ,jxyz,Wxyz->KWZ', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,jZyz,Wxyz->KWZ', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,jZyz,Wxzy->KWZ', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,jyzw,ZzwWxy->KWZ', X_aaa, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,ZzwWyx->KWZ', X_aaa, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/24 * einsum('Kjx,jyzw,ZzwxWy->KWZ', X_aaa, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,ZzwxyW->KWZ', X_aaa, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,ZzwyWx->KWZ', X_aaa, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,ZzwyxW->KWZ', X_aaa, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('ijZ,ijKx,Wx->KWZ', X_aaa, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('ijZ,jiKx,Wx->KWZ', X_aaa, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('ijx,ijKx,WZ->KWZ', X_aaa, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ijx,ijKy,WxZy->KWZ', X_aaa, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ijx,ijKy,WxyZ->KWZ', X_aaa, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('ijx,jiKx,WZ->KWZ', X_aaa, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ijx,jiKy,WxZy->KWZ', X_aaa, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ijx,jiKy,WxyZ->KWZ', X_aaa, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,ix,WZ->KWZ', X_abb, h_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,jy,WxZy->KWZ', X_abb, h_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jy,WxyZ->KWZ', X_abb, h_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iZxy,Wy->KWZ', X_abb, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iyxz,WyZz->KWZ', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzx,WyZz->KWZ', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzx,WyzZ->KWZ', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jZyz,Wxyz->KWZ', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,jZyz,Wxzy->KWZ', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('Kjx,jyzw,ZzwWxy->KWZ', X_abb, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jyzw,ZzwWyx->KWZ', X_abb, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jyzw,ZzwxWy->KWZ', X_abb, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jyzw,ZzwxyW->KWZ', X_abb, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jyzw,ZzwyWx->KWZ', X_abb, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jyzw,ZzwyxW->KWZ', X_abb, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('ijx,ijKx,WZ->KWZ', X_abb, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ijx,ijKy,WxZy->KWZ', X_abb, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ijx,ijKy,WxyZ->KWZ', X_abb, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,ix,WZ->KWZ', X_bab, h_xa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,iy,WxZy->KWZ', X_bab, h_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iy,WxyZ->KWZ', X_bab, h_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iZxy,Wy->KWZ', X_bab, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iZyz,Wxyz->KWZ', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,iZyz,Wxzy->KWZ', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iyxz,WyZz->KWZ', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('iKx,iyzw,ZzwWxy->KWZ', X_bab, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzw,ZzwWyx->KWZ', X_bab, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzw,ZzwxWy->KWZ', X_bab, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzw,ZzwxyW->KWZ', X_bab, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzw,ZzwyWx->KWZ', X_bab, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzw,ZzwyxW->KWZ', X_bab, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,iyzx,WyZz->KWZ', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzx,WyzZ->KWZ', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('ijx,jiKx,WZ->KWZ', X_bab, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ijx,jiKy,WxZy->KWZ', X_bab, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ijx,jiKy,WxyZ->KWZ', X_bab, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,i,iZxy,Wy->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,i,iZyx,Wy->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,i,ix,WZ->KWZ', X_aaa, e_cvs, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,i,iyxz,WyZz->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,i,iyzx,WyZz->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,i,iyzx,WyzZ->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('KjZ,j,jx,Wx->KWZ', X_aaa, e_cvs, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('KjZ,j,jxyz,Wxyz->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,j,jZyz,Wxyz->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,j,jZyz,Wxzy->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,j,jy,WxZy->KWZ', X_aaa, e_cvs, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,j,jy,WxyZ->KWZ', X_aaa, e_cvs, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,j,jyzw,ZzwWxy->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,j,jyzw,ZzwWyx->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/24 * einsum('Kjx,j,jyzw,ZzwxWy->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,j,jyzw,ZzwxyW->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,j,jyzw,ZzwyWx->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,j,jyzw,ZzwyxW->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,Zy,iyxz,Wz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,Zy,iyzx,Wz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,xy,iZyz,Wz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,xy,iZzy,Wz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,xy,iy,WZ->KWZ', X_aaa, h_aa, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,xy,izwy,WzZw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,xy,izwy,WzwZ->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,xy,izyw,WzZw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,yz,iZxy,Wz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,yz,iZyx,Wz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,yz,iwxy,WwZz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,yz,iwyx,WwZz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,yz,iwyx,WwzZ->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,yz,iywx,WzZw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,yz,iywx,WzwZ->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,yz,iyxw,WzZw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('KjZ,xy,jx,Wy->KWZ', X_aaa, h_aa, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('KjZ,xy,jxzw,Wyzw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('KjZ,xy,jzwx,Wzwy->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('KjZ,xy,jzxw,Wzyw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,Zy,jyzw,Wxwz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,Zy,jyzw,Wxzw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,yz,jZwy,Wxwz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,yz,jZwy,Wxzw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,yz,jZyw,Wxwz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,yz,jZyw,Wxzw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,yz,jwuy,ZzuWwx->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuWxw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuwWx->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuwxW->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuxWw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kjx,yz,jwuy,ZzuxwW->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,yz,jwyu,ZzuWxw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,yz,jwyu,ZzuxWw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,yz,jy,WxZz->KWZ', X_aaa, h_aa, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,yz,jy,WxzZ->KWZ', X_aaa, h_aa, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,yz,jywu,ZwuWxz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,yz,jywu,ZwuWzx->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/24 * einsum('Kjx,yz,jywu,ZwuxWz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,yz,jywu,ZwuxzW->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,yz,jywu,ZwuzWx->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,yz,jywu,ZwuzxW->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iZxy,yzwu,Wzwu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,iZyx,yzwu,Wzwu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iZyz,xwuy,Wuwz->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iZyz,xwuy,Wuzw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iZyz,xwuz,Wuwy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iZyz,xwuz,Wuyw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iZyz,xwyu,Wuzw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iZyz,xwyz,Ww->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,iZyz,xwzu,Wuyw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,iZyz,xwzy,Ww->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,iy,Zyxz,Wz->KWZ', X_aaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iy,Zyzx,Wz->KWZ', X_aaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iy,xzwy,WwZz->KWZ', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iy,xzwy,WwzZ->KWZ', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iy,xzyw,WwZz->KWZ', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,iyxz,Zwuy,Wwuz->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,iyxz,Zwyu,Wwzu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iyxz,Zzwu,Wywu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('Kix,iyxz,ywuv,ZzwWuv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwWvu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwuWv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwuvW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwvWu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwvuW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvWwy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/3 * einsum('Kix,iyxz,zwuv,ZuvWyw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvwWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvwyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvyWw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvywW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iyzw,Zuxy,Wuzw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzw,Zuyx,Wuwz->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,Zuyx,Wuzw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,Zwux,Wyuz->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzw,Zwux,Wyzu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,iyzw,Zwxu,Wyzu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iyzw,Zzux,Wyuw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,iyzw,Zzxu,Wyuw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuvw,ZzuWvy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuWyv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iyzw,xuvw,ZzuvWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuvyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuyWv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuyvW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,xuvz,ZwuWyv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzw,xuvz,ZwuvyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,xuwv,ZzuWyv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwv,ZzuyWv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,xuwz,WyZu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwz,WyuZ->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuWvy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/3 * einsum('Kix,iyzw,xuzv,ZwuWyv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuvWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuvyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuyWv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuyvW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iyzw,xuzw,WyZu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kix,iyzw,xyuv,ZzwWuv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kix,iyzw,xyuv,ZzwWvu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/24 * einsum('Kix,iyzw,xyuv,ZzwuWv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kix,iyzw,xyuv,ZzwuvW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kix,iyzw,xyuv,ZzwvWu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kix,iyzw,xyuv,ZzwvuW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzx,Zwuy,Wwuz->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzx,Zwuy,Wwzu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iyzx,Zwyu,Wwzu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzx,Zzwu,Wyuw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzx,Zzwu,Wywu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kix,iyzx,ywuv,ZzwWuv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kix,iyzx,ywuv,ZzwWvu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/24 * einsum('Kix,iyzx,ywuv,ZzwuWv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kix,iyzx,ywuv,ZzwuvW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kix,iyzx,ywuv,ZzwvWu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kix,iyzx,ywuv,ZzwvuW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kix,iyzx,zwuv,ZuvWwy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kix,iyzx,zwuv,ZuvWyw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kix,iyzx,zwuv,ZuvwWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kix,iyzx,zwuv,ZuvwyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/24 * einsum('Kix,iyzx,zwuv,ZuvyWw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kix,iyzx,zwuv,ZuvywW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('KjZ,jx,xyzw,Wyzw->KWZ', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 11/24 * einsum('KjZ,jxyz,xwuv,yzwWuv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('KjZ,jxyz,xwuv,yzwWvu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('KjZ,jxyz,xwuv,yzwuWv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('KjZ,jxyz,xwuv,yzwuvW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('KjZ,jxyz,xwuv,yzwvWu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('KjZ,jxyz,xwuv,yzwvuW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('KjZ,jxyz,ywuv,zuvWwx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('KjZ,jxyz,ywuv,zuvWxw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('KjZ,jxyz,ywuv,zuvwWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('KjZ,jxyz,ywuv,zuvwxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('KjZ,jxyz,ywuv,zuvxWw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('KjZ,jxyz,ywuv,zuvxwW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('KjZ,jxyz,yzwu,Wxwu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('KjZ,jxyz,zwuv,yuvWxw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jZyz,ywuv,zuvWwx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/24 * einsum('Kjx,jZyz,ywuv,zuvWxw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jZyz,ywuv,zuvwWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jZyz,ywuv,zuvwxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jZyz,ywuv,zuvxWw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jZyz,ywuv,zuvxwW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,jZyz,yzwu,Wxuw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,jZyz,yzwu,Wxwu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jZyz,zwuv,yuvWwx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/24 * einsum('Kjx,jZyz,zwuv,yuvWxw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jZyz,zwuv,yuvwWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jZyz,zwuv,yuvwxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,jZyz,zwuv,yuvxWw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jZyz,zwuv,yuvxwW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,jy,Zyzw,Wxwz->KWZ', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,jy,Zyzw,Wxzw->KWZ', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,jy,yzwu,ZwuWxz->KWZ', X_aaa, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jy,yzwu,ZwuWzx->KWZ', X_aaa, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/24 * einsum('Kjx,jy,yzwu,ZwuxWz->KWZ', X_aaa, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jy,yzwu,ZwuxzW->KWZ', X_aaa, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jy,yzwu,ZwuzWx->KWZ', X_aaa, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jy,yzwu,ZwuzxW->KWZ', X_aaa, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/24 * einsum('Kjx,jyzw,Zuvy,zwvWux->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jyzw,Zuvy,zwvWxu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jyzw,Zuvy,zwvuWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jyzw,Zuvy,zwvuxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jyzw,Zuvy,zwvxWu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jyzw,Zuvy,zwvxuW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,jyzw,Zuyv,zwvWxu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,jyzw,Zuyv,zwvxWu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/24 * einsum('Kjx,jyzw,Zwuv,zuvWxy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvWyx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,jyzw,Zwuv,zuvxWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvxyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvyWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvyxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,jyzw,Zzuv,wuvyWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,jyzw,Zzuv,wuvyxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/15 * einsum('Kjx,jyzw,wuvs,ZzvsWuxy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/30 * einsum('Kjx,jyzw,wuvs,ZzvsWuyx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 11/120 * einsum('Kjx,jyzw,wuvs,ZzvsWxuy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/40 * einsum('Kjx,jyzw,wuvs,ZzvsWxyu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/120 * einsum('Kjx,jyzw,wuvs,ZzvsWyux->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/40 * einsum('Kjx,jyzw,wuvs,ZzvsWyxu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jyzw,wuvs,ZzvsuWxy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/120 * einsum('Kjx,jyzw,wuvs,ZzvsuWyx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/20 * einsum('Kjx,jyzw,wuvs,ZzvsuxWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/30 * einsum('Kjx,jyzw,wuvs,ZzvsuxyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/15 * einsum('Kjx,jyzw,wuvs,ZzvsuyWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jyzw,wuvs,ZzvsuyxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,jyzw,wuvs,ZzvsxWuy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 11/120 * einsum('Kjx,jyzw,wuvs,ZzvsxWyu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 11/120 * einsum('Kjx,jyzw,wuvs,ZzvsxuWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 5/24 * einsum('Kjx,jyzw,wuvs,ZzvsxuyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,jyzw,wuvs,ZzvsxyuW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/30 * einsum('Kjx,jyzw,wuvs,ZzvsyWux->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/20 * einsum('Kjx,jyzw,wuvs,ZzvsyWxu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/15 * einsum('Kjx,jyzw,wuvs,ZzvsyuWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jyzw,wuvs,ZzvsyuxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 29/120 * einsum('Kjx,jyzw,wuvs,ZzvsyxWu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/40 * einsum('Kjx,jyzw,wuvs,ZzvsyxuW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jyzw,yuvs,ZzwuWsvx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/20 * einsum('Kjx,jyzw,yuvs,ZzwuWsxv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/20 * einsum('Kjx,jyzw,yuvs,ZzwuWvsx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/60 * einsum('Kjx,jyzw,yuvs,ZzwuWxsv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/20 * einsum('Kjx,jyzw,yuvs,ZzwusWvx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/60 * einsum('Kjx,jyzw,yuvs,ZzwusWxv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,yuvs,ZzwusvWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/40 * einsum('Kjx,jyzw,yuvs,ZzwusvxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/120 * einsum('Kjx,jyzw,yuvs,ZzwusxWv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 11/120 * einsum('Kjx,jyzw,yuvs,ZzwusxvW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,yuvs,ZzwuvWsx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/120 * einsum('Kjx,jyzw,yuvs,ZzwuvWxs->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/10 * einsum('Kjx,jyzw,yuvs,ZzwuvsWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 2/15 * einsum('Kjx,jyzw,yuvs,ZzwuvsxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/60 * einsum('Kjx,jyzw,yuvs,ZzwuvxWs->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/10 * einsum('Kjx,jyzw,yuvs,ZzwuvxsW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 2/15 * einsum('Kjx,jyzw,yuvs,ZzwuxWsv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 13/60 * einsum('Kjx,jyzw,yuvs,ZzwuxWvs->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 23/120 * einsum('Kjx,jyzw,yuvs,ZzwuxsWv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 11/120 * einsum('Kjx,jyzw,yuvs,ZzwuxsvW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 17/120 * einsum('Kjx,jyzw,yuvs,ZzwuxvWs->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 9/40 * einsum('Kjx,jyzw,yuvs,ZzwuxvsW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/60 * einsum('Kjx,jyzw,zuvs,ZwvsWuxy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,jyzw,zuvs,ZwvsWxuy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 7/120 * einsum('Kjx,jyzw,zuvs,ZwvsWxyu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/20 * einsum('Kjx,jyzw,zuvs,ZwvsuWxy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/15 * einsum('Kjx,jyzw,zuvs,ZwvsuWyx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 5/24 * einsum('Kjx,jyzw,zuvs,ZwvsuxWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 13/120 * einsum('Kjx,jyzw,zuvs,ZwvsuxyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jyzw,zuvs,ZwvsuyWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/40 * einsum('Kjx,jyzw,zuvs,ZwvsxWuy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 13/120 * einsum('Kjx,jyzw,zuvs,ZwvsxWyu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 9/40 * einsum('Kjx,jyzw,zuvs,ZwvsxuWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,jyzw,zuvs,ZwvsxuyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jyzw,zuvs,ZwvsxyWu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,jyzw,zuvs,ZwvsxyuW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,jyzw,zuvs,ZwvsyWux->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,zuvs,ZwvsyWxu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 11/40 * einsum('Kjx,jyzw,zuvs,ZwvsyuWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 23/120 * einsum('Kjx,jyzw,zuvs,ZwvsyuxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 13/60 * einsum('Kjx,jyzw,zuvs,ZwvsyxWu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/10 * einsum('Kjx,jyzw,zuvs,ZwvsyxuW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,jyzw,zwuv,ZuvWxy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,zwuv,ZuvWyx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/24 * einsum('Kjx,jyzw,zwuv,ZuvxWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,zwuv,ZuvxyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,zwuv,ZuvyWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,zwuv,ZuvyxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,i,iZxy,Wy->KWZ', X_abb, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,i,ix,WZ->KWZ', X_abb, e_cvs, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,i,iyxz,WyZz->KWZ', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,i,iyzx,WyZz->KWZ', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,i,iyzx,WyzZ->KWZ', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,j,jZyz,Wxyz->KWZ', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,j,jZyz,Wxzy->KWZ', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,j,jy,WxZy->KWZ', X_abb, e_cvs, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,j,jy,WxyZ->KWZ', X_abb, e_cvs, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('Kjx,j,jyzw,ZzwWxy->KWZ', X_abb, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,j,jyzw,ZzwWyx->KWZ', X_abb, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,j,jyzw,ZzwxWy->KWZ', X_abb, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,j,jyzw,ZzwxyW->KWZ', X_abb, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,j,jyzw,ZzwyWx->KWZ', X_abb, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,j,jyzw,ZzwyxW->KWZ', X_abb, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,Zy,iyxz,Wz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,xy,iZyz,Wz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,xy,iy,WZ->KWZ', X_abb, h_aa, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,xy,izwy,WzZw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,xy,izwy,WzwZ->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,xy,izyw,WzZw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,yz,iZxy,Wz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,yz,iwxy,WwZz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,yz,iwyx,WwZz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,yz,iwyx,WwzZ->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,yz,iywx,WzZw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,yz,iywx,WzwZ->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,yz,iyxw,WzZw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,Zy,jyzw,Wxwz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,Zy,jyzw,Wxzw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,yz,jZwy,Wxwz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,yz,jZwy,Wxzw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,yz,jZyw,Wxwz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,yz,jZyw,Wxzw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,yz,jwuy,ZzuWwx->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,yz,jwuy,ZzuWxw->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,yz,jwuy,ZzuwWx->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,yz,jwuy,ZzuwxW->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,yz,jwuy,ZzuxWw->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,yz,jwuy,ZzuxwW->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,yz,jwyu,ZzuWwx->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,yz,jwyu,ZzuWxw->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,yz,jwyu,ZzuwWx->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,yz,jwyu,ZzuwxW->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,yz,jwyu,ZzuxwW->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,yz,jy,WxZz->KWZ', X_abb, h_aa, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,yz,jy,WxzZ->KWZ', X_abb, h_aa, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('Kjx,yz,jywu,ZwuWxz->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,yz,jywu,ZwuWzx->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,yz,jywu,ZwuxWz->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,yz,jywu,ZwuxzW->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,yz,jywu,ZwuzWx->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,yz,jywu,ZwuzxW->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iZxy,yzwu,Wzwu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iZyz,xwuy,Wuwz->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iZyz,xwuy,Wuzw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iZyz,xwuz,Wuwy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iZyz,xwuz,Wuyw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iZyz,xwyu,Wuzw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iZyz,xwyz,Ww->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iy,Zyzx,Wz->KWZ', X_abb, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iy,xzwy,WwZz->KWZ', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iy,xzwy,WwzZ->KWZ', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iy,xzyw,WwZz->KWZ', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,iyxz,Zwuy,Wwuz->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,iyxz,Zwyu,Wwzu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iyxz,Zzwu,Wywu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyxz,ywuv,ZzwWuv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyxz,ywuv,ZzwWvu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyxz,ywuv,ZzwuWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyxz,ywuv,ZzwuvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyxz,ywuv,ZzwvWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyxz,ywuv,ZzwvuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyxz,zwuv,ZuvWwy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyxz,zwuv,ZuvWyw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyxz,zwuv,ZuvwWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyxz,zwuv,ZuvwyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyxz,zwuv,ZuvyWw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyxz,zwuv,ZuvywW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzw,Zuyx,Wuwz->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,Zuyx,Wuzw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,Zwux,Wyuz->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,Zwux,Wyzu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iyzw,Zzux,Wyuw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kix,iyzw,xuvw,ZzuWvy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kix,iyzw,xuvw,ZzuWyv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kix,iyzw,xuvw,ZzuvWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kix,iyzw,xuvw,ZzuvyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kix,iyzw,xuvw,ZzuyWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kix,iyzw,xuvw,ZzuyvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvz,ZwuWvy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuvz,ZwuWyv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvz,ZwuvWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvz,ZwuyWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvz,ZwuyvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuwv,ZzuWvy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuwv,ZzuWyv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuwv,ZzuvWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuwv,ZzuvyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuwv,ZzuyvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,xuwz,WyZu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuwz,WyuZ->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuzv,ZwuWvy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzw,xuzv,ZwuWyv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuzv,ZwuvWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuzv,ZwuvyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuzv,ZwuyWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuzv,ZwuyvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iyzw,xuzw,WyZu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('Kix,iyzw,xyuv,ZzwWuv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kix,iyzw,xyuv,ZzwWvu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kix,iyzw,xyuv,ZzwuWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kix,iyzw,xyuv,ZzwuvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kix,iyzw,xyuv,ZzwvWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kix,iyzw,xyuv,ZzwvuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzx,Zwuy,Wwuz->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzx,Zwuy,Wwzu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzx,Zzwu,Wyuw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzx,Zzwu,Wywu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('Kix,iyzx,ywuv,ZzwWuv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kix,iyzx,ywuv,ZzwWvu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kix,iyzx,ywuv,ZzwuWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kix,iyzx,ywuv,ZzwuvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kix,iyzx,ywuv,ZzwvWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kix,iyzx,ywuv,ZzwvuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kix,iyzx,zwuv,ZuvWwy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('Kix,iyzx,zwuv,ZuvWyw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kix,iyzx,zwuv,ZuvwWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kix,iyzx,zwuv,ZuvwyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kix,iyzx,zwuv,ZuvyWw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kix,iyzx,zwuv,ZuvywW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jZyz,ywuv,zuvWwx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 7/48 * einsum('Kjx,jZyz,ywuv,zuvWxw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jZyz,ywuv,zuvwWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jZyz,ywuv,zuvwxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jZyz,ywuv,zuvxWw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jZyz,ywuv,zuvxwW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,jZyz,yzwu,Wxuw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jZyz,yzwu,Wxwu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jZyz,zwuv,yuvWwx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jZyz,zwuv,yuvWxw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jZyz,zwuv,yuvwWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jZyz,zwuv,yuvwxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('Kjx,jZyz,zwuv,yuvxWw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jZyz,zwuv,yuvxwW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jy,Zyzw,Wxwz->KWZ', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,jy,Zyzw,Wxzw->KWZ', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('Kjx,jy,yzwu,ZwuWxz->KWZ', X_abb, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jy,yzwu,ZwuWzx->KWZ', X_abb, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jy,yzwu,ZwuxWz->KWZ', X_abb, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jy,yzwu,ZwuxzW->KWZ', X_abb, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jy,yzwu,ZwuzWx->KWZ', X_abb, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jy,yzwu,ZwuzxW->KWZ', X_abb, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,Zuvy,zwvWux->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,Zuvy,zwvWxu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,Zuvy,zwvuWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,Zuvy,zwvuxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,Zuvy,zwvxWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('Kjx,jyzw,Zuvy,zwvxuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jyzw,Zuyv,zwvWux->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zuyv,zwvWxu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jyzw,Zuyv,zwvuWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jyzw,Zuyv,zwvuxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jyzw,Zuyv,zwvxWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jyzw,Zuyv,zwvxuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,Zwuv,zuvWxy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,Zwuv,zuvWyx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 7/48 * einsum('Kjx,jyzw,Zwuv,zuvxWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,Zwuv,zuvxyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,Zwuv,zuvyWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,Zwuv,zuvyxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,jyzw,Zzuv,wuvWxy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,jyzw,Zzuv,wuvWyx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,jyzw,Zzuv,wuvxWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,jyzw,Zzuv,wuvxyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jyzw,Zzuv,wuvyWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/60 * einsum('Kjx,jyzw,wuvs,ZzvsWuxy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/120 * einsum('Kjx,jyzw,wuvs,ZzvsWuyx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/40 * einsum('Kjx,jyzw,wuvs,ZzvsWxuy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/20 * einsum('Kjx,jyzw,wuvs,ZzvsWxyu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/60 * einsum('Kjx,jyzw,wuvs,ZzvsWyux->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/60 * einsum('Kjx,jyzw,wuvs,ZzvsWyxu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/240 * einsum('Kjx,jyzw,wuvs,ZzvsuWxy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/80 * einsum('Kjx,jyzw,wuvs,ZzvsuWyx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/20 * einsum('Kjx,jyzw,wuvs,ZzvsuxWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/40 * einsum('Kjx,jyzw,wuvs,ZzvsuxyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jyzw,wuvs,ZzvsuyWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/40 * einsum('Kjx,jyzw,wuvs,ZzvsuyxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/120 * einsum('Kjx,jyzw,wuvs,ZzvsxWuy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/20 * einsum('Kjx,jyzw,wuvs,ZzvsxWyu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 13/240 * einsum('Kjx,jyzw,wuvs,ZzvsxuWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 7/240 * einsum('Kjx,jyzw,wuvs,ZzvsxuyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jyzw,wuvs,ZzvsxyWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/80 * einsum('Kjx,jyzw,wuvs,ZzvsxyuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/240 * einsum('Kjx,jyzw,wuvs,ZzvsyWux->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/80 * einsum('Kjx,jyzw,wuvs,ZzvsyWxu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jyzw,wuvs,ZzvsyuWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/40 * einsum('Kjx,jyzw,wuvs,ZzvsyuxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,jyzw,wuvs,ZzvsyxWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/15 * einsum('Kjx,jyzw,wuvs,ZzvsyxuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 19/240 * einsum('Kjx,jyzw,yuvs,ZzwuWsvx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/60 * einsum('Kjx,jyzw,yuvs,ZzwuWsxv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 19/240 * einsum('Kjx,jyzw,yuvs,ZzwuWvsx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/120 * einsum('Kjx,jyzw,yuvs,ZzwuWvxs->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 29/240 * einsum('Kjx,jyzw,yuvs,ZzwusWvx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/40 * einsum('Kjx,jyzw,yuvs,ZzwusWxv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/10 * einsum('Kjx,jyzw,yuvs,ZzwusvWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jyzw,yuvs,ZzwusvxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,yuvs,ZzwusxWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 9/80 * einsum('Kjx,jyzw,yuvs,ZzwusxvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,yuvs,ZzwuvWsx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 7/240 * einsum('Kjx,jyzw,yuvs,ZzwuvWxs->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('Kjx,jyzw,yuvs,ZzwuvsWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/15 * einsum('Kjx,jyzw,yuvs,ZzwuvsxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/60 * einsum('Kjx,jyzw,yuvs,ZzwuvxWs->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/20 * einsum('Kjx,jyzw,yuvs,ZzwuvxsW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/30 * einsum('Kjx,jyzw,yuvs,ZzwuxWsv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/20 * einsum('Kjx,jyzw,yuvs,ZzwuxWvs->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 23/240 * einsum('Kjx,jyzw,yuvs,ZzwuxsWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/80 * einsum('Kjx,jyzw,yuvs,ZzwuxsvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 7/80 * einsum('Kjx,jyzw,yuvs,ZzwuxvWs->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 29/240 * einsum('Kjx,jyzw,yuvs,ZzwuxvsW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/30 * einsum('Kjx,jyzw,zuvs,ZwvsWuyx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 17/240 * einsum('Kjx,jyzw,zuvs,ZwvsWxuy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jyzw,zuvs,ZwvsWxyu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/40 * einsum('Kjx,jyzw,zuvs,ZwvsuWxy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/120 * einsum('Kjx,jyzw,zuvs,ZwvsuWyx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 7/120 * einsum('Kjx,jyzw,zuvs,ZwvsuxWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 7/60 * einsum('Kjx,jyzw,zuvs,ZwvsuxyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/80 * einsum('Kjx,jyzw,zuvs,ZwvsuyWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/80 * einsum('Kjx,jyzw,zuvs,ZwvsuyxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/80 * einsum('Kjx,jyzw,zuvs,ZwvsxWuy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 23/240 * einsum('Kjx,jyzw,zuvs,ZwvsxWyu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/20 * einsum('Kjx,jyzw,zuvs,ZwvsxuWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 13/120 * einsum('Kjx,jyzw,zuvs,ZwvsxuyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/30 * einsum('Kjx,jyzw,zuvs,ZwvsxyWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/40 * einsum('Kjx,jyzw,zuvs,ZwvsxyuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('Kjx,jyzw,zuvs,ZwvsyWux->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jyzw,zuvs,ZwvsyWxu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 7/60 * einsum('Kjx,jyzw,zuvs,ZwvsyuWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 17/120 * einsum('Kjx,jyzw,zuvs,ZwvsyuxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jyzw,zuvs,ZwvsyxWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 17/80 * einsum('Kjx,jyzw,zuvs,ZwvsyxuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('Kjx,jyzw,zwuv,ZuvWxy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jyzw,zwuv,ZuvWyx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jyzw,zwuv,ZuvxWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jyzw,zwuv,ZuvxyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jyzw,zwuv,ZuvyWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jyzw,zwuv,ZuvyxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,i,iZxy,Wy->KWZ', X_bab, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,i,iZyz,Wxyz->KWZ', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,i,iZyz,Wxzy->KWZ', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,i,ix,WZ->KWZ', X_bab, e_cvs, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,i,iy,WxZy->KWZ', X_bab, e_cvs, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,i,iy,WxyZ->KWZ', X_bab, e_cvs, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,i,iyxz,WyZz->KWZ', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('iKx,i,iyzw,ZzwWxy->KWZ', X_bab, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,i,iyzw,ZzwWyx->KWZ', X_bab, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,i,iyzw,ZzwxWy->KWZ', X_bab, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,i,iyzw,ZzwxyW->KWZ', X_bab, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,i,iyzw,ZzwyWx->KWZ', X_bab, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,i,iyzw,ZzwyxW->KWZ', X_bab, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,i,iyzx,WyZz->KWZ', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,i,iyzx,WyzZ->KWZ', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,Zy,iyxz,Wz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,Zy,iyzw,Wxwz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,Zy,iyzw,Wxzw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,xy,iZyz,Wz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,xy,iy,WZ->KWZ', X_bab, h_aa, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,xy,izwy,WzZw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,xy,izwy,WzwZ->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,xy,izyw,WzZw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,yz,iZwy,Wxwz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,yz,iZwy,Wxzw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,yz,iZxy,Wz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,yz,iZyw,Wxwz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,yz,iZyw,Wxzw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('iKx,yz,iwuy,ZzuWwx->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,yz,iwuy,ZzuWxw->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,yz,iwuy,ZzuwWx->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,yz,iwuy,ZzuwxW->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,yz,iwuy,ZzuxWw->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,yz,iwuy,ZzuxwW->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,yz,iwxy,WwZz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,yz,iwyu,ZzuWwx->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,yz,iwyu,ZzuWxw->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,yz,iwyu,ZzuwWx->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,yz,iwyu,ZzuwxW->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,yz,iwyu,ZzuxwW->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,yz,iwyx,WwZz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,yz,iwyx,WwzZ->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,yz,iy,WxZz->KWZ', X_bab, h_aa, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,yz,iy,WxzZ->KWZ', X_bab, h_aa, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('iKx,yz,iywu,ZwuWxz->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,yz,iywu,ZwuWzx->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,yz,iywu,ZwuxWz->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,yz,iywu,ZwuxzW->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,yz,iywu,ZwuzWx->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,yz,iywu,ZwuzxW->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,yz,iywx,WzZw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,yz,iywx,WzwZ->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,yz,iyxw,WzZw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iZxy,yzwu,Wzwu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iZyz,xwuy,Wuwz->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,iZyz,xwuy,Wuzw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,iZyz,xwuz,Wuwy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iZyz,xwuz,Wuyw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iZyz,xwyu,Wuzw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iZyz,xwyz,Ww->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iZyz,ywuv,zuvWwx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 7/48 * einsum('iKx,iZyz,ywuv,zuvWxw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iZyz,ywuv,zuvwWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iZyz,ywuv,zuvwxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iZyz,ywuv,zuvxWw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iZyz,ywuv,zuvxwW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,iZyz,yzwu,Wxuw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iZyz,yzwu,Wxwu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iZyz,zwuv,yuvWwx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iZyz,zwuv,yuvWxw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iZyz,zwuv,yuvwWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iZyz,zwuv,yuvwxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('iKx,iZyz,zwuv,yuvxWw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iZyz,zwuv,yuvxwW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iy,Zyzw,Wxwz->KWZ', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,iy,Zyzw,Wxzw->KWZ', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iy,Zyzx,Wz->KWZ', X_bab, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,iy,xzwy,WwZz->KWZ', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iy,xzwy,WwzZ->KWZ', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iy,xzyw,WwZz->KWZ', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('iKx,iy,yzwu,ZwuWxz->KWZ', X_bab, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iy,yzwu,ZwuWzx->KWZ', X_bab, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iy,yzwu,ZwuxWz->KWZ', X_bab, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iy,yzwu,ZwuxzW->KWZ', X_bab, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iy,yzwu,ZwuzWx->KWZ', X_bab, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iy,yzwu,ZwuzxW->KWZ', X_bab, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,iyxz,Zwuy,Wwuz->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,iyxz,Zwyu,Wwzu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iyxz,Zzwu,Wywu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,iyxz,ywuv,ZzwWuv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyxz,ywuv,ZzwWvu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyxz,ywuv,ZzwuWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyxz,ywuv,ZzwuvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyxz,ywuv,ZzwvWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyxz,ywuv,ZzwvuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyxz,zwuv,ZuvWwy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,iyxz,zwuv,ZuvWyw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyxz,zwuv,ZuvwWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyxz,zwuv,ZuvwyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyxz,zwuv,ZuvyWw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyxz,zwuv,ZuvywW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,Zuvy,zwvWux->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,Zuvy,zwvWxu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,Zuvy,zwvuWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,Zuvy,zwvuxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,Zuvy,zwvxWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('iKx,iyzw,Zuvy,zwvxuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,iyzw,Zuyv,zwvWux->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,Zuyv,zwvWxu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,iyzw,Zuyv,zwvuWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,iyzw,Zuyv,zwvuxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('iKx,iyzw,Zuyv,zwvxWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,iyzw,Zuyv,zwvxuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,iyzw,Zuyx,Wuwz->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,Zuyx,Wuzw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,Zwuv,zuvWxy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,Zwuv,zuvWyx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 7/48 * einsum('iKx,iyzw,Zwuv,zuvxWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,Zwuv,zuvxyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,Zwuv,zuvyWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,Zwuv,zuvyxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,iyzw,Zwux,Wyuz->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,Zwux,Wyzu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,Zzuv,wuvWxy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,Zzuv,wuvWyx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,Zzuv,wuvxWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,Zzuv,wuvxyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,Zzuv,wuvyWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iyzw,Zzux,Wyuw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/60 * einsum('iKx,iyzw,wuvs,ZzvsWuxy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/120 * einsum('iKx,iyzw,wuvs,ZzvsWuyx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/40 * einsum('iKx,iyzw,wuvs,ZzvsWxuy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/20 * einsum('iKx,iyzw,wuvs,ZzvsWxyu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/60 * einsum('iKx,iyzw,wuvs,ZzvsWyux->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/60 * einsum('iKx,iyzw,wuvs,ZzvsWyxu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/240 * einsum('iKx,iyzw,wuvs,ZzvsuWxy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/80 * einsum('iKx,iyzw,wuvs,ZzvsuWyx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/20 * einsum('iKx,iyzw,wuvs,ZzvsuxWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/40 * einsum('iKx,iyzw,wuvs,ZzvsuxyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,iyzw,wuvs,ZzvsuyWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/40 * einsum('iKx,iyzw,wuvs,ZzvsuyxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/120 * einsum('iKx,iyzw,wuvs,ZzvsxWuy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/20 * einsum('iKx,iyzw,wuvs,ZzvsxWyu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 13/240 * einsum('iKx,iyzw,wuvs,ZzvsxuWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 7/240 * einsum('iKx,iyzw,wuvs,ZzvsxuyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzw,wuvs,ZzvsxyWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/80 * einsum('iKx,iyzw,wuvs,ZzvsxyuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/240 * einsum('iKx,iyzw,wuvs,ZzvsyWux->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/80 * einsum('iKx,iyzw,wuvs,ZzvsyWxu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,iyzw,wuvs,ZzvsyuWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/40 * einsum('iKx,iyzw,wuvs,ZzvsyuxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,wuvs,ZzvsyxWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/15 * einsum('iKx,iyzw,wuvs,ZzvsyxuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('iKx,iyzw,xuvw,ZzuWvy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,xuvw,ZzuWyv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,iyzw,xuvw,ZzuvWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,xuvw,ZzuvyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,xuvw,ZzuyWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,xuvw,ZzuyvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,xuvz,ZwuWvy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,xuvz,ZwuWyv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,xuvz,ZwuvWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,xuvz,ZwuyWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,xuvz,ZwuyvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,xuwv,ZzuWvy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,xuwv,ZzuWyv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,xuwv,ZzuvWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,xuwv,ZzuvyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,xuwv,ZzuyvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,iyzw,xuwz,WyZu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,xuwz,WyuZ->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,xuzv,ZwuWvy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,iyzw,xuzv,ZwuWyv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,xuzv,ZwuvWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,xuzv,ZwuvyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,xuzv,ZwuyWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,xuzv,ZwuyvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iyzw,xuzw,WyZu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('iKx,iyzw,xyuv,ZzwWuv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,xyuv,ZzwWvu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,xyuv,ZzwuWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,xyuv,ZzwuvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,xyuv,ZzwvWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,xyuv,ZzwvuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 19/240 * einsum('iKx,iyzw,yuvs,ZzwuWsvx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/60 * einsum('iKx,iyzw,yuvs,ZzwuWsxv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 19/240 * einsum('iKx,iyzw,yuvs,ZzwuWvsx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/120 * einsum('iKx,iyzw,yuvs,ZzwuWvxs->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 29/240 * einsum('iKx,iyzw,yuvs,ZzwusWvx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/40 * einsum('iKx,iyzw,yuvs,ZzwusWxv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/10 * einsum('iKx,iyzw,yuvs,ZzwusvWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzw,yuvs,ZzwusvxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,yuvs,ZzwusxWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 9/80 * einsum('iKx,iyzw,yuvs,ZzwusxvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,yuvs,ZzwuvWsx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 7/240 * einsum('iKx,iyzw,yuvs,ZzwuvWxs->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('iKx,iyzw,yuvs,ZzwuvsWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/15 * einsum('iKx,iyzw,yuvs,ZzwuvsxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/60 * einsum('iKx,iyzw,yuvs,ZzwuvxWs->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/20 * einsum('iKx,iyzw,yuvs,ZzwuvxsW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/30 * einsum('iKx,iyzw,yuvs,ZzwuxWsv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/20 * einsum('iKx,iyzw,yuvs,ZzwuxWvs->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 23/240 * einsum('iKx,iyzw,yuvs,ZzwuxsWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/80 * einsum('iKx,iyzw,yuvs,ZzwuxsvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 7/80 * einsum('iKx,iyzw,yuvs,ZzwuxvWs->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 29/240 * einsum('iKx,iyzw,yuvs,ZzwuxvsW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/30 * einsum('iKx,iyzw,zuvs,ZwvsWuyx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 17/240 * einsum('iKx,iyzw,zuvs,ZwvsWxuy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzw,zuvs,ZwvsWxyu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/40 * einsum('iKx,iyzw,zuvs,ZwvsuWxy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/120 * einsum('iKx,iyzw,zuvs,ZwvsuWyx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 7/120 * einsum('iKx,iyzw,zuvs,ZwvsuxWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 7/60 * einsum('iKx,iyzw,zuvs,ZwvsuxyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/80 * einsum('iKx,iyzw,zuvs,ZwvsuyWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/80 * einsum('iKx,iyzw,zuvs,ZwvsuyxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/80 * einsum('iKx,iyzw,zuvs,ZwvsxWuy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 23/240 * einsum('iKx,iyzw,zuvs,ZwvsxWyu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/20 * einsum('iKx,iyzw,zuvs,ZwvsxuWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 13/120 * einsum('iKx,iyzw,zuvs,ZwvsxuyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/30 * einsum('iKx,iyzw,zuvs,ZwvsxyWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/40 * einsum('iKx,iyzw,zuvs,ZwvsxyuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('iKx,iyzw,zuvs,ZwvsyWux->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzw,zuvs,ZwvsyWxu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 7/60 * einsum('iKx,iyzw,zuvs,ZwvsyuWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 17/120 * einsum('iKx,iyzw,zuvs,ZwvsyuxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzw,zuvs,ZwvsyxWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 17/80 * einsum('iKx,iyzw,zuvs,ZwvsyxuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('iKx,iyzw,zwuv,ZuvWxy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzw,zwuv,ZuvWyx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzw,zwuv,ZuvxWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzw,zwuv,ZuvxyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzw,zwuv,ZuvyWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzw,zwuv,ZuvyxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,iyzx,Zwuy,Wwuz->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzx,Zwuy,Wwzu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzx,Zzwu,Wyuw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,iyzx,Zzwu,Wywu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('iKx,iyzx,ywuv,ZzwWuv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzx,ywuv,ZzwWvu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzx,ywuv,ZzwuWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzx,ywuv,ZzwuvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzx,ywuv,ZzwvWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzx,ywuv,ZzwvuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzx,zwuv,ZuvWwy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('iKx,iyzx,zwuv,ZuvWyw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzx,zwuv,ZuvwWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzx,zwuv,ZuvwyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzx,zwuv,ZuvyWw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzx,zwuv,ZuvywW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma[s_caa__aaa:f_caa__aaa] += sigma_caa.reshape(-1).copy()

        sigma_caa =- 1/2 * einsum('Kix,ix,WZ->KWZ', X_aaa, h_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('Kjx,jy,WxZy->KWZ', X_aaa, h_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,jy,WxyZ->KWZ', X_aaa, h_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iZxy,Wy->KWZ', X_aaa, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iyxz,WyZz->KWZ', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('Kix,iyzx,WyZz->KWZ', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzx,WyzZ->KWZ', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,jZyz,Wxyz->KWZ', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('Kjx,jZyz,Wxzy->KWZ', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 5/24 * einsum('Kjx,jyzw,ZzwWxy->KWZ', X_aaa, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jyzw,ZzwWyx->KWZ', X_aaa, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jyzw,ZzwxWy->KWZ', X_aaa, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jyzw,ZzwxyW->KWZ', X_aaa, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jyzw,ZzwyWx->KWZ', X_aaa, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jyzw,ZzwyxW->KWZ', X_aaa, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('ijx,ijKx,WZ->KWZ', X_aaa, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ijx,ijKy,WxZy->KWZ', X_aaa, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ijx,ijKy,WxyZ->KWZ', X_aaa, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('ijx,jiKx,WZ->KWZ', X_aaa, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ijx,jiKy,WxZy->KWZ', X_aaa, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ijx,jiKy,WxyZ->KWZ', X_aaa, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,ix,WZ->KWZ', X_abb, h_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('KjZ,jx,Wx->KWZ', X_abb, h_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jy,WxZy->KWZ', X_abb, h_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,jy,WxyZ->KWZ', X_abb, h_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iZxy,Wy->KWZ', X_abb, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,iZyx,Wy->KWZ', X_abb, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iyxz,WyZz->KWZ', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzx,WyZz->KWZ', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzx,WyzZ->KWZ', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('KjZ,jxyz,Wxyz->KWZ', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,jZyz,Wxyz->KWZ', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jZyz,Wxzy->KWZ', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,ZzwWxy->KWZ', X_abb, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,ZzwWyx->KWZ', X_abb, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('Kjx,jyzw,ZzwxWy->KWZ', X_abb, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,ZzwxyW->KWZ', X_abb, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,ZzwyWx->KWZ', X_abb, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,ZzwyxW->KWZ', X_abb, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('ijZ,ijKx,Wx->KWZ', X_abb, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('ijx,ijKx,WZ->KWZ', X_abb, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ijx,ijKy,WxZy->KWZ', X_abb, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ijx,ijKy,WxyZ->KWZ', X_abb, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKZ,ix,Wx->KWZ', X_bab, h_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,ix,WZ->KWZ', X_bab, h_xa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iy,WxZy->KWZ', X_bab, h_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iy,WxyZ->KWZ', X_bab, h_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKZ,ixyz,Wxyz->KWZ', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iZxy,Wy->KWZ', X_bab, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,iZyx,Wy->KWZ', X_bab, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iZyz,Wxyz->KWZ', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iZyz,Wxzy->KWZ', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iyxz,WyZz->KWZ', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,ZzwWxy->KWZ', X_bab, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,ZzwWyx->KWZ', X_bab, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('iKx,iyzw,ZzwxWy->KWZ', X_bab, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,ZzwxyW->KWZ', X_bab, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,ZzwyWx->KWZ', X_bab, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,ZzwyxW->KWZ', X_bab, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzx,WyZz->KWZ', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzx,WyzZ->KWZ', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('ijZ,jiKx,Wx->KWZ', X_bab, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('ijx,jiKx,WZ->KWZ', X_bab, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ijx,jiKy,WxZy->KWZ', X_bab, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ijx,jiKy,WxyZ->KWZ', X_bab, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,i,iZxy,Wy->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,i,ix,WZ->KWZ', X_aaa, e_cvs, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,i,iyxz,WyZz->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/3 * einsum('Kix,i,iyzx,WyZz->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,i,iyzx,WyzZ->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,j,jZyz,Wxyz->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/3 * einsum('Kjx,j,jZyz,Wxzy->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/3 * einsum('Kjx,j,jy,WxZy->KWZ', X_aaa, e_cvs, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,j,jy,WxyZ->KWZ', X_aaa, e_cvs, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 5/24 * einsum('Kjx,j,jyzw,ZzwWxy->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,j,jyzw,ZzwWyx->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,j,jyzw,ZzwxWy->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,j,jyzw,ZzwxyW->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,j,jyzw,ZzwyWx->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,j,jyzw,ZzwyxW->KWZ', X_aaa, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,Zy,iyxz,Wz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,xy,iZyz,Wz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,xy,iy,WZ->KWZ', X_aaa, h_aa, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('Kix,xy,izwy,WzZw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,xy,izwy,WzwZ->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,xy,izyw,WzZw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,yz,iZxy,Wz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,yz,iwxy,WwZz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('Kix,yz,iwyx,WwZz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,yz,iwyx,WwzZ->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/3 * einsum('Kix,yz,iywx,WzZw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,yz,iywx,WzwZ->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,yz,iyxw,WzZw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/3 * einsum('Kjx,Zy,jyzw,Wxwz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,Zy,jyzw,Wxzw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,yz,jZwy,Wxwz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('Kjx,yz,jZwy,Wxzw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('Kjx,yz,jZyw,Wxwz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,yz,jZyw,Wxzw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kjx,yz,jwuy,ZzuWwx->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuWxw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuwWx->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuwxW->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuxWw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,yz,jwuy,ZzuxwW->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,yz,jwyu,ZzuWwx->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,yz,jwyu,ZzuWxw->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,yz,jwyu,ZzuwWx->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,yz,jwyu,ZzuwxW->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,yz,jwyu,ZzuxwW->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('Kjx,yz,jy,WxZz->KWZ', X_aaa, h_aa, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,yz,jy,WxzZ->KWZ', X_aaa, h_aa, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 5/24 * einsum('Kjx,yz,jywu,ZwuWxz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,yz,jywu,ZwuWzx->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,yz,jywu,ZwuxWz->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,yz,jywu,ZwuxzW->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,yz,jywu,ZwuzWx->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,yz,jywu,ZwuzxW->KWZ', X_aaa, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iZxy,yzwu,Wzwu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iZyz,xwuy,Wuwz->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('Kix,iZyz,xwuy,Wuzw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('Kix,iZyz,xwuz,Wuwy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iZyz,xwuz,Wuyw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iZyz,xwyu,Wuzw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iZyz,xwyz,Ww->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iy,Zyzx,Wz->KWZ', X_aaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('Kix,iy,xzwy,WwZz->KWZ', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iy,xzwy,WwzZ->KWZ', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iy,xzyw,WwZz->KWZ', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,iyxz,Zwuy,Wwuz->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/2 * einsum('Kix,iyxz,Zwyu,Wwzu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iyxz,Zzwu,Wywu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('Kix,iyxz,ywuv,ZzwWuv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwWvu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwuWv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwuvW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwvWu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwvuW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvWwy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/3 * einsum('Kix,iyxz,zwuv,ZuvWyw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvwWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvwyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvyWw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvywW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/3 * einsum('Kix,iyzw,Zuyx,Wuwz->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzw,Zuyx,Wuzw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('Kix,iyzw,Zwux,Wyuz->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,Zwux,Wyzu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iyzw,Zzux,Wyuw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,iyzw,xuvw,ZzuWvy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuWyv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuvw,ZzuvWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuvyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuyWv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuyvW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzw,xuvz,ZwuWvy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,xuvz,ZwuWyv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzw,xuvz,ZwuvWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzw,xuvz,ZwuyWv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzw,xuvz,ZwuyvW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwv,ZzuWvy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,xuwv,ZzuWyv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwv,ZzuvWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwv,ZzuvyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwv,ZzuyvW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('Kix,iyzw,xuwz,WyZu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,xuwz,WyuZ->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuWvy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/3 * einsum('Kix,iyzw,xuzv,ZwuWyv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuvWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuvyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuyWv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuyvW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/2 * einsum('Kix,iyzw,xuzw,WyZu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 5/24 * einsum('Kix,iyzw,xyuv,ZzwWuv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kix,iyzw,xyuv,ZzwWvu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kix,iyzw,xyuv,ZzwuWv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kix,iyzw,xyuv,ZzwuvW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kix,iyzw,xyuv,ZzwvWu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kix,iyzw,xyuv,ZzwvuW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/3 * einsum('Kix,iyzx,Zwuy,Wwuz->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzx,Zwuy,Wwzu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzx,Zzwu,Wyuw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('Kix,iyzx,Zzwu,Wywu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 5/24 * einsum('Kix,iyzx,ywuv,ZzwWuv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kix,iyzx,ywuv,ZzwWvu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kix,iyzx,ywuv,ZzwuWv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kix,iyzx,ywuv,ZzwuvW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kix,iyzx,ywuv,ZzwvWu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kix,iyzx,ywuv,ZzwvuW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kix,iyzx,zwuv,ZuvWwy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/24 * einsum('Kix,iyzx,zwuv,ZuvWyw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kix,iyzx,zwuv,ZuvwWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kix,iyzx,zwuv,ZuvwyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kix,iyzx,zwuv,ZuvyWw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kix,iyzx,zwuv,ZuvywW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jZyz,ywuv,zuvWwx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 7/24 * einsum('Kjx,jZyz,ywuv,zuvWxw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jZyz,ywuv,zuvwWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jZyz,ywuv,zuvwxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,jZyz,ywuv,zuvxWw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jZyz,ywuv,zuvxwW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('Kjx,jZyz,yzwu,Wxuw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,jZyz,yzwu,Wxwu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jZyz,zwuv,yuvWwx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jZyz,zwuv,yuvWxw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jZyz,zwuv,yuvwWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jZyz,zwuv,yuvwxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/24 * einsum('Kjx,jZyz,zwuv,yuvxWw->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jZyz,zwuv,yuvxwW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,jy,Zyzw,Wxwz->KWZ', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/3 * einsum('Kjx,jy,Zyzw,Wxzw->KWZ', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 5/24 * einsum('Kjx,jy,yzwu,ZwuWxz->KWZ', X_aaa, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jy,yzwu,ZwuWzx->KWZ', X_aaa, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jy,yzwu,ZwuxWz->KWZ', X_aaa, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jy,yzwu,ZwuxzW->KWZ', X_aaa, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jy,yzwu,ZwuzWx->KWZ', X_aaa, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jy,yzwu,ZwuzxW->KWZ', X_aaa, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zuvy,zwvWux->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,jyzw,Zuvy,zwvWxu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,jyzw,Zuvy,zwvuWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,jyzw,Zuvy,zwvuxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,jyzw,Zuvy,zwvxWu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/24 * einsum('Kjx,jyzw,Zuvy,zwvxuW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jyzw,Zuyv,zwvWux->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,jyzw,Zuyv,zwvWxu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jyzw,Zuyv,zwvuWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jyzw,Zuyv,zwvuxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kjx,jyzw,Zuyv,zwvxWu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jyzw,Zuyv,zwvxuW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,jyzw,Zwuv,zuvWxy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvWyx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 7/24 * einsum('Kjx,jyzw,Zwuv,zuvxWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvxyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvyWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvyxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,jyzw,Zzuv,wuvWxy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,jyzw,Zzuv,wuvWyx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,jyzw,Zzuv,wuvxWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,jyzw,Zzuv,wuvxyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,jyzw,Zzuv,wuvyWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jyzw,wuvs,ZzvsWuxy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/15 * einsum('Kjx,jyzw,wuvs,ZzvsWuyx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/5 * einsum('Kjx,jyzw,wuvs,ZzvsWxuy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/10 * einsum('Kjx,jyzw,wuvs,ZzvsWxyu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/60 * einsum('Kjx,jyzw,wuvs,ZzvsWyux->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/30 * einsum('Kjx,jyzw,wuvs,ZzvsWyxu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jyzw,wuvs,ZzvsuWxy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/40 * einsum('Kjx,jyzw,wuvs,ZzvsuWyx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/20 * einsum('Kjx,jyzw,wuvs,ZzvsuxWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/20 * einsum('Kjx,jyzw,wuvs,ZzvsuxyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 2/15 * einsum('Kjx,jyzw,wuvs,ZzvsuyWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/20 * einsum('Kjx,jyzw,wuvs,ZzvsuyxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,jyzw,wuvs,ZzvsxWuy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/20 * einsum('Kjx,jyzw,wuvs,ZzvsxWyu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 13/120 * einsum('Kjx,jyzw,wuvs,ZzvsxuWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/120 * einsum('Kjx,jyzw,wuvs,ZzvsxuyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/120 * einsum('Kjx,jyzw,wuvs,ZzvsxyWu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/40 * einsum('Kjx,jyzw,wuvs,ZzvsxyuW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/120 * einsum('Kjx,jyzw,wuvs,ZzvsyWux->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/40 * einsum('Kjx,jyzw,wuvs,ZzvsyWxu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 11/60 * einsum('Kjx,jyzw,wuvs,ZzvsyuWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/10 * einsum('Kjx,jyzw,wuvs,ZzvsyuxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 7/60 * einsum('Kjx,jyzw,wuvs,ZzvsyxWu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 11/60 * einsum('Kjx,jyzw,wuvs,ZzvsyxuW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 11/60 * einsum('Kjx,jyzw,yuvs,ZzwuWsvx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 7/120 * einsum('Kjx,jyzw,yuvs,ZzwuWsxv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 2/15 * einsum('Kjx,jyzw,yuvs,ZzwuWvsx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/60 * einsum('Kjx,jyzw,yuvs,ZzwuWvxs->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/40 * einsum('Kjx,jyzw,yuvs,ZzwuWxsv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,jyzw,yuvs,ZzwusWvx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/40 * einsum('Kjx,jyzw,yuvs,ZzwusWxv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 7/40 * einsum('Kjx,jyzw,yuvs,ZzwusvWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jyzw,yuvs,ZzwusvxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/15 * einsum('Kjx,jyzw,yuvs,ZzwusxWv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 9/40 * einsum('Kjx,jyzw,yuvs,ZzwusxvW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 2/15 * einsum('Kjx,jyzw,yuvs,ZzwuvWsx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/60 * einsum('Kjx,jyzw,yuvs,ZzwuvWxs->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 19/120 * einsum('Kjx,jyzw,yuvs,ZzwuvsWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 13/120 * einsum('Kjx,jyzw,yuvs,ZzwuvsxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/120 * einsum('Kjx,jyzw,yuvs,ZzwuvxWs->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/40 * einsum('Kjx,jyzw,yuvs,ZzwuvxsW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 7/60 * einsum('Kjx,jyzw,yuvs,ZzwuxWsv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/40 * einsum('Kjx,jyzw,yuvs,ZzwuxWvs->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 17/120 * einsum('Kjx,jyzw,yuvs,ZzwuxsWv->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/20 * einsum('Kjx,jyzw,yuvs,ZzwuxsvW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/10 * einsum('Kjx,jyzw,yuvs,ZzwuxvWs->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,jyzw,yuvs,ZzwuxvsW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/40 * einsum('Kjx,jyzw,zuvs,ZwvsWuxy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/120 * einsum('Kjx,jyzw,zuvs,ZwvsWuyx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 13/60 * einsum('Kjx,jyzw,zuvs,ZwvsWxuy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/20 * einsum('Kjx,jyzw,zuvs,ZwvsWxyu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/40 * einsum('Kjx,jyzw,zuvs,ZwvsuWxy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/120 * einsum('Kjx,jyzw,zuvs,ZwvsuWyx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,jyzw,zuvs,ZwvsuxWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 11/60 * einsum('Kjx,jyzw,zuvs,ZwvsuxyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/20 * einsum('Kjx,jyzw,zuvs,ZwvsuyWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/5 * einsum('Kjx,jyzw,zuvs,ZwvsxWuy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,jyzw,zuvs,ZwvsxWyu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/20 * einsum('Kjx,jyzw,zuvs,ZwvsxuWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,jyzw,zuvs,ZwvsxuyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,zuvs,ZwvsxyWu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 7/40 * einsum('Kjx,jyzw,zuvs,ZwvsxyuW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 5/24 * einsum('Kjx,jyzw,zuvs,ZwvsyWux->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jyzw,zuvs,ZwvsyWxu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 19/120 * einsum('Kjx,jyzw,zuvs,ZwvsyuWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 5/24 * einsum('Kjx,jyzw,zuvs,ZwvsyuxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/60 * einsum('Kjx,jyzw,zuvs,ZwvsyxWu->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 2/5 * einsum('Kjx,jyzw,zuvs,ZwvsyxuW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 5/24 * einsum('Kjx,jyzw,zwuv,ZuvWxy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jyzw,zwuv,ZuvWyx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jyzw,zwuv,ZuvxWy->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jyzw,zwuv,ZuvxyW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jyzw,zwuv,ZuvyWx->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jyzw,zwuv,ZuvyxW->KWZ', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,i,iZxy,Wy->KWZ', X_abb, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,i,iZyx,Wy->KWZ', X_abb, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,i,ix,WZ->KWZ', X_abb, e_cvs, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,i,iyxz,WyZz->KWZ', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,i,iyzx,WyZz->KWZ', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,i,iyzx,WyzZ->KWZ', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('KjZ,j,jx,Wx->KWZ', X_abb, e_cvs, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('KjZ,j,jxyz,Wxyz->KWZ', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,j,jZyz,Wxyz->KWZ', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,j,jZyz,Wxzy->KWZ', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,j,jy,WxZy->KWZ', X_abb, e_cvs, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,j,jy,WxyZ->KWZ', X_abb, e_cvs, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,j,jyzw,ZzwWxy->KWZ', X_abb, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,j,jyzw,ZzwWyx->KWZ', X_abb, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('Kjx,j,jyzw,ZzwxWy->KWZ', X_abb, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,j,jyzw,ZzwxyW->KWZ', X_abb, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,j,jyzw,ZzwyWx->KWZ', X_abb, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,j,jyzw,ZzwyxW->KWZ', X_abb, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,Zy,iyxz,Wz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,Zy,iyzx,Wz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,xy,iZyz,Wz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,xy,iZzy,Wz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,xy,iy,WZ->KWZ', X_abb, h_aa, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,xy,izwy,WzZw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,xy,izwy,WzwZ->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,xy,izyw,WzZw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,yz,iZxy,Wz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,yz,iZyx,Wz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,yz,iwxy,WwZz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,yz,iwyx,WwZz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,yz,iwyx,WwzZ->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,yz,iywx,WzZw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,yz,iywx,WzwZ->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,yz,iyxw,WzZw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('KjZ,xy,jx,Wy->KWZ', X_abb, h_aa, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('KjZ,xy,jxzw,Wyzw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('KjZ,xy,jzwx,Wzwy->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('KjZ,xy,jzxw,Wzyw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,Zy,jyzw,Wxwz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,Zy,jyzw,Wxzw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,yz,jZwy,Wxwz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,yz,jZwy,Wxzw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,yz,jZyw,Wxwz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,yz,jZyw,Wxzw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,yz,jwuy,ZzuWwx->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,yz,jwuy,ZzuWxw->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,yz,jwuy,ZzuwWx->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,yz,jwuy,ZzuwxW->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,yz,jwuy,ZzuxWw->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,yz,jwuy,ZzuxwW->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,yz,jwyu,ZzuWxw->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,yz,jwyu,ZzuxWw->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,yz,jy,WxZz->KWZ', X_abb, h_aa, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,yz,jy,WxzZ->KWZ', X_abb, h_aa, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,yz,jywu,ZwuWxz->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,yz,jywu,ZwuWzx->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('Kjx,yz,jywu,ZwuxWz->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,yz,jywu,ZwuxzW->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,yz,jywu,ZwuzWx->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,yz,jywu,ZwuzxW->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iZxy,yzwu,Wzwu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,iZyx,yzwu,Wzwu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iZyz,xwuy,Wuwz->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iZyz,xwuy,Wuzw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iZyz,xwuz,Wuwy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iZyz,xwuz,Wuyw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iZyz,xwyu,Wuzw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iZyz,xwyz,Ww->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,iZyz,xwzu,Wuyw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,iZyz,xwzy,Ww->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,iy,Zyxz,Wz->KWZ', X_abb, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iy,Zyzx,Wz->KWZ', X_abb, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iy,xzwy,WwZz->KWZ', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iy,xzwy,WwzZ->KWZ', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iy,xzyw,WwZz->KWZ', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,iyxz,Zwuy,Wwuz->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,iyxz,Zwyu,Wwzu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iyxz,Zzwu,Wywu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyxz,ywuv,ZzwWuv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyxz,ywuv,ZzwWvu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyxz,ywuv,ZzwuWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyxz,ywuv,ZzwuvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyxz,ywuv,ZzwvWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyxz,ywuv,ZzwvuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyxz,zwuv,ZuvWwy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyxz,zwuv,ZuvWyw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyxz,zwuv,ZuvwWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyxz,zwuv,ZuvwyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyxz,zwuv,ZuvyWw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyxz,zwuv,ZuvywW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iyzw,Zuxy,Wuzw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,Zuyx,Wuwz->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,Zuyx,Wuzw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,Zwux,Wyuz->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,Zwux,Wyzu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,iyzw,Zwxu,Wyzu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iyzw,Zzux,Wyuw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,iyzw,Zzxu,Wyuw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kix,iyzw,xuvw,ZzuWvy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kix,iyzw,xuvw,ZzuWyv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kix,iyzw,xuvw,ZzuvWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kix,iyzw,xuvw,ZzuvyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kix,iyzw,xuvw,ZzuyWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kix,iyzw,xuvw,ZzuyvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuvz,ZwuWyv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvz,ZwuvyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuwv,ZzuWyv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuwv,ZzuyWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuwz,WyZu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuwz,WyuZ->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuzv,ZwuWvy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzw,xuzv,ZwuWyv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuzv,ZwuvWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuzv,ZwuvyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuzv,ZwuyWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuzv,ZwuyvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iyzw,xuzw,WyZu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kix,iyzw,xyuv,ZzwWuv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kix,iyzw,xyuv,ZzwWvu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('Kix,iyzw,xyuv,ZzwuWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kix,iyzw,xyuv,ZzwuvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kix,iyzw,xyuv,ZzwvWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kix,iyzw,xyuv,ZzwvuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzx,Zwuy,Wwuz->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzx,Zwuy,Wwzu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iyzx,Zwyu,Wwzu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzx,Zzwu,Wyuw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzx,Zzwu,Wywu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kix,iyzx,ywuv,ZzwWuv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kix,iyzx,ywuv,ZzwWvu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('Kix,iyzx,ywuv,ZzwuWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kix,iyzx,ywuv,ZzwuvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kix,iyzx,ywuv,ZzwvWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kix,iyzx,ywuv,ZzwvuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kix,iyzx,zwuv,ZuvWwy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kix,iyzx,zwuv,ZuvWyw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kix,iyzx,zwuv,ZuvwWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kix,iyzx,zwuv,ZuvwyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('Kix,iyzx,zwuv,ZuvyWw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kix,iyzx,zwuv,ZuvywW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('KjZ,jx,xyzw,Wyzw->KWZ', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 11/48 * einsum('KjZ,jxyz,xwuv,yzwWuv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('KjZ,jxyz,xwuv,yzwWvu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('KjZ,jxyz,xwuv,yzwuWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('KjZ,jxyz,xwuv,yzwuvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('KjZ,jxyz,xwuv,yzwvWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('KjZ,jxyz,xwuv,yzwvuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('KjZ,jxyz,ywuv,zuvWwx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('KjZ,jxyz,ywuv,zuvWxw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('KjZ,jxyz,ywuv,zuvwWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('KjZ,jxyz,ywuv,zuvwxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('KjZ,jxyz,ywuv,zuvxWw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('KjZ,jxyz,ywuv,zuvxwW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('KjZ,jxyz,yzwu,Wxwu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('KjZ,jxyz,zwuv,yuvWxw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jZyz,ywuv,zuvWwx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('Kjx,jZyz,ywuv,zuvWxw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jZyz,ywuv,zuvwWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jZyz,ywuv,zuvwxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jZyz,ywuv,zuvxWw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jZyz,ywuv,zuvxwW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jZyz,yzwu,Wxuw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,jZyz,yzwu,Wxwu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jZyz,zwuv,yuvWwx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('Kjx,jZyz,zwuv,yuvWxw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jZyz,zwuv,yuvwWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jZyz,zwuv,yuvwxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jZyz,zwuv,yuvxWw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jZyz,zwuv,yuvxwW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,jy,Zyzw,Wxwz->KWZ', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jy,Zyzw,Wxzw->KWZ', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jy,yzwu,ZwuWxz->KWZ', X_abb, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jy,yzwu,ZwuWzx->KWZ', X_abb, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('Kjx,jy,yzwu,ZwuxWz->KWZ', X_abb, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jy,yzwu,ZwuxzW->KWZ', X_abb, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jy,yzwu,ZwuzWx->KWZ', X_abb, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jy,yzwu,ZwuzxW->KWZ', X_abb, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('Kjx,jyzw,Zuvy,zwvWux->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jyzw,Zuvy,zwvWxu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jyzw,Zuvy,zwvuWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jyzw,Zuvy,zwvuxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jyzw,Zuvy,zwvxWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jyzw,Zuvy,zwvxuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jyzw,Zuyv,zwvWxu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,jyzw,Zuyv,zwvxWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('Kjx,jyzw,Zwuv,zuvWxy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,Zwuv,zuvWyx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,Zwuv,zuvxWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,Zwuv,zuvxyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,Zwuv,zuvyWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,Zwuv,zuvyxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jyzw,Zzuv,wuvyWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,jyzw,Zzuv,wuvyxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jyzw,wuvs,ZzvsWuxy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 7/240 * einsum('Kjx,jyzw,wuvs,ZzvsWuyx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 11/240 * einsum('Kjx,jyzw,wuvs,ZzvsWxuy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/80 * einsum('Kjx,jyzw,wuvs,ZzvsWxyu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/120 * einsum('Kjx,jyzw,wuvs,ZzvsWyux->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/40 * einsum('Kjx,jyzw,wuvs,ZzvsWyxu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/120 * einsum('Kjx,jyzw,wuvs,ZzvsuWxy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/60 * einsum('Kjx,jyzw,wuvs,ZzvsuWyx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jyzw,wuvs,ZzvsuxWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 7/240 * einsum('Kjx,jyzw,wuvs,ZzvsuxyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/120 * einsum('Kjx,jyzw,wuvs,ZzvsuyWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/60 * einsum('Kjx,jyzw,wuvs,ZzvsuyxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,wuvs,ZzvsxWuy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 11/240 * einsum('Kjx,jyzw,wuvs,ZzvsxWyu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 7/120 * einsum('Kjx,jyzw,wuvs,ZzvsxuWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 11/120 * einsum('Kjx,jyzw,wuvs,ZzvsxuyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/80 * einsum('Kjx,jyzw,wuvs,ZzvsxyWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 17/240 * einsum('Kjx,jyzw,wuvs,ZzvsxyuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/240 * einsum('Kjx,jyzw,wuvs,ZzvsyWux->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/80 * einsum('Kjx,jyzw,wuvs,ZzvsyWxu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/120 * einsum('Kjx,jyzw,wuvs,ZzvsyuWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/60 * einsum('Kjx,jyzw,wuvs,ZzvsyuxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 13/120 * einsum('Kjx,jyzw,wuvs,ZzvsyxWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/20 * einsum('Kjx,jyzw,wuvs,ZzvsyxuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 13/240 * einsum('Kjx,jyzw,yuvs,ZzwuWsvx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/80 * einsum('Kjx,jyzw,yuvs,ZzwuWsxv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/80 * einsum('Kjx,jyzw,yuvs,ZzwuWvsx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/80 * einsum('Kjx,jyzw,yuvs,ZzwuWvxs->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/120 * einsum('Kjx,jyzw,yuvs,ZzwuWxsv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,yuvs,ZzwusWvx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/240 * einsum('Kjx,jyzw,yuvs,ZzwusWxv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 11/240 * einsum('Kjx,jyzw,yuvs,ZzwusvWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jyzw,yuvs,ZzwusvxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/60 * einsum('Kjx,jyzw,yuvs,ZzwusxWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/30 * einsum('Kjx,jyzw,yuvs,ZzwusxvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/120 * einsum('Kjx,jyzw,yuvs,ZzwuvWsx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/60 * einsum('Kjx,jyzw,yuvs,ZzwuvWxs->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/40 * einsum('Kjx,jyzw,yuvs,ZzwuvsWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,yuvs,ZzwuvsxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/240 * einsum('Kjx,jyzw,yuvs,ZzwuvxWs->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/80 * einsum('Kjx,jyzw,yuvs,ZzwuvxsW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/15 * einsum('Kjx,jyzw,yuvs,ZzwuxWsv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 13/120 * einsum('Kjx,jyzw,yuvs,ZzwuxWvs->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,jyzw,yuvs,ZzwuxsWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/30 * einsum('Kjx,jyzw,yuvs,ZzwuxsvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,jyzw,yuvs,ZzwuxvWs->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,jyzw,yuvs,ZzwuxvsW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/120 * einsum('Kjx,jyzw,zuvs,ZwvsWuxy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/40 * einsum('Kjx,jyzw,zuvs,ZwvsWuyx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/80 * einsum('Kjx,jyzw,zuvs,ZwvsWxuy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 7/240 * einsum('Kjx,jyzw,zuvs,ZwvsWxyu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/60 * einsum('Kjx,jyzw,zuvs,ZwvsuWyx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('Kjx,jyzw,zuvs,ZwvsuxWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 13/240 * einsum('Kjx,jyzw,zuvs,ZwvsuxyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/15 * einsum('Kjx,jyzw,zuvs,ZwvsuyWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/80 * einsum('Kjx,jyzw,zuvs,ZwvsxWuy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 7/240 * einsum('Kjx,jyzw,zuvs,ZwvsxWyu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 9/80 * einsum('Kjx,jyzw,zuvs,ZwvsxuWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,zuvs,ZwvsxuyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jyzw,zuvs,ZwvsxyWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/80 * einsum('Kjx,jyzw,zuvs,ZwvsxyuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,zuvs,ZwvsyWux->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,zuvs,ZwvsyWxu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 11/80 * einsum('Kjx,jyzw,zuvs,ZwvsyuWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 17/240 * einsum('Kjx,jyzw,zuvs,ZwvsyuxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jyzw,zuvs,ZwvsyxWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/10 * einsum('Kjx,jyzw,zuvs,ZwvsyxuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,zwuv,ZuvWxy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,zwuv,ZuvWyx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('Kjx,jyzw,zwuv,ZuvxWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,zwuv,ZuvxyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,zwuv,ZuvyWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,zwuv,ZuvyxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKZ,i,ix,Wx->KWZ', X_bab, e_cvs, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKZ,i,ixyz,Wxyz->KWZ', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,i,iZxy,Wy->KWZ', X_bab, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,i,iZyx,Wy->KWZ', X_bab, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,i,iZyz,Wxyz->KWZ', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,i,iZyz,Wxzy->KWZ', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,i,ix,WZ->KWZ', X_bab, e_cvs, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,i,iy,WxZy->KWZ', X_bab, e_cvs, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,i,iy,WxyZ->KWZ', X_bab, e_cvs, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,i,iyxz,WyZz->KWZ', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,i,iyzw,ZzwWxy->KWZ', X_bab, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,i,iyzw,ZzwWyx->KWZ', X_bab, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('iKx,i,iyzw,ZzwxWy->KWZ', X_bab, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,i,iyzw,ZzwxyW->KWZ', X_bab, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,i,iyzw,ZzwyWx->KWZ', X_bab, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,i,iyzw,ZzwyxW->KWZ', X_bab, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,i,iyzx,WyZz->KWZ', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,i,iyzx,WyzZ->KWZ', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKZ,xy,ix,Wy->KWZ', X_bab, h_aa, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKZ,xy,ixzw,Wyzw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKZ,xy,izwx,Wzwy->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKZ,xy,izxw,Wzyw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,Zy,iyxz,Wz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,Zy,iyzw,Wxwz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,Zy,iyzw,Wxzw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,Zy,iyzx,Wz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,xy,iZyz,Wz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,xy,iZzy,Wz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,xy,iy,WZ->KWZ', X_bab, h_aa, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,xy,izwy,WzZw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,xy,izwy,WzwZ->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,xy,izyw,WzZw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,yz,iZwy,Wxwz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,yz,iZwy,Wxzw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,yz,iZxy,Wz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,yz,iZyw,Wxwz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,yz,iZyw,Wxzw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,yz,iZyx,Wz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,yz,iwuy,ZzuWwx->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,yz,iwuy,ZzuWxw->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,yz,iwuy,ZzuwWx->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,yz,iwuy,ZzuwxW->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,yz,iwuy,ZzuxWw->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('iKx,yz,iwuy,ZzuxwW->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,yz,iwxy,WwZz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,yz,iwyu,ZzuWxw->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,yz,iwyu,ZzuxWw->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,yz,iwyx,WwZz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,yz,iwyx,WwzZ->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,yz,iy,WxZz->KWZ', X_bab, h_aa, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,yz,iy,WxzZ->KWZ', X_bab, h_aa, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,yz,iywu,ZwuWxz->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,yz,iywu,ZwuWzx->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('iKx,yz,iywu,ZwuxWz->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,yz,iywu,ZwuxzW->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,yz,iywu,ZwuzWx->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,yz,iywu,ZwuzxW->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,yz,iywx,WzZw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,yz,iywx,WzwZ->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,yz,iyxw,WzZw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKZ,ix,xyzw,Wyzw->KWZ', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 11/48 * einsum('iKZ,ixyz,xwuv,yzwWuv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKZ,ixyz,xwuv,yzwWvu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKZ,ixyz,xwuv,yzwuWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKZ,ixyz,xwuv,yzwuvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKZ,ixyz,xwuv,yzwvWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKZ,ixyz,xwuv,yzwvuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKZ,ixyz,ywuv,zuvWwx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKZ,ixyz,ywuv,zuvWxw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKZ,ixyz,ywuv,zuvwWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKZ,ixyz,ywuv,zuvwxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKZ,ixyz,ywuv,zuvxWw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKZ,ixyz,ywuv,zuvxwW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKZ,ixyz,yzwu,Wxwu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKZ,ixyz,zwuv,yuvWxw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iZxy,yzwu,Wzwu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,iZyx,yzwu,Wzwu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iZyz,xwuy,Wuwz->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iZyz,xwuy,Wuzw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iZyz,xwuz,Wuwy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iZyz,xwuz,Wuyw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iZyz,xwyu,Wuzw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iZyz,xwyz,Ww->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,iZyz,xwzu,Wuyw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,iZyz,xwzy,Ww->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iZyz,ywuv,zuvWwx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('iKx,iZyz,ywuv,zuvWxw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iZyz,ywuv,zuvwWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iZyz,ywuv,zuvwxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iZyz,ywuv,zuvxWw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iZyz,ywuv,zuvxwW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iZyz,yzwu,Wxuw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iZyz,yzwu,Wxwu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iZyz,zwuv,yuvWwx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('iKx,iZyz,zwuv,yuvWxw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iZyz,zwuv,yuvwWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iZyz,zwuv,yuvwxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iZyz,zwuv,yuvxWw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iZyz,zwuv,yuvxwW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,iy,Zyxz,Wz->KWZ', X_bab, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iy,Zyzw,Wxwz->KWZ', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iy,Zyzw,Wxzw->KWZ', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iy,Zyzx,Wz->KWZ', X_bab, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iy,xzwy,WwZz->KWZ', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iy,xzwy,WwzZ->KWZ', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iy,xzyw,WwZz->KWZ', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iy,yzwu,ZwuWxz->KWZ', X_bab, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iy,yzwu,ZwuWzx->KWZ', X_bab, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('iKx,iy,yzwu,ZwuxWz->KWZ', X_bab, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iy,yzwu,ZwuxzW->KWZ', X_bab, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iy,yzwu,ZwuzWx->KWZ', X_bab, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iy,yzwu,ZwuzxW->KWZ', X_bab, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,iyxz,Zwuy,Wwuz->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,iyxz,Zwyu,Wwzu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iyxz,Zzwu,Wywu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,iyxz,ywuv,ZzwWuv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyxz,ywuv,ZzwWvu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyxz,ywuv,ZzwuWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyxz,ywuv,ZzwuvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyxz,ywuv,ZzwvWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyxz,ywuv,ZzwvuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyxz,zwuv,ZuvWwy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,iyxz,zwuv,ZuvWyw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyxz,zwuv,ZuvwWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyxz,zwuv,ZuvwyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyxz,zwuv,ZuvyWw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyxz,zwuv,ZuvywW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('iKx,iyzw,Zuvy,zwvWux->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzw,Zuvy,zwvWxu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzw,Zuvy,zwvuWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzw,Zuvy,zwvuxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzw,Zuvy,zwvxWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzw,Zuvy,zwvxuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iyzw,Zuxy,Wuzw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,Zuyv,zwvWxu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,Zuyv,zwvxWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,Zuyx,Wuwz->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,Zuyx,Wuzw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('iKx,iyzw,Zwuv,zuvWxy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,Zwuv,zuvWyx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,Zwuv,zuvxWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,Zwuv,zuvxyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,Zwuv,zuvyWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,Zwuv,zuvyxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,Zwux,Wyuz->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,Zwux,Wyzu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,iyzw,Zwxu,Wyzu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,Zzuv,wuvyWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,Zzuv,wuvyxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iyzw,Zzux,Wyuw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,iyzw,Zzxu,Wyuw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzw,wuvs,ZzvsWuxy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 7/240 * einsum('iKx,iyzw,wuvs,ZzvsWuyx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 11/240 * einsum('iKx,iyzw,wuvs,ZzvsWxuy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/80 * einsum('iKx,iyzw,wuvs,ZzvsWxyu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/120 * einsum('iKx,iyzw,wuvs,ZzvsWyux->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/40 * einsum('iKx,iyzw,wuvs,ZzvsWyxu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/120 * einsum('iKx,iyzw,wuvs,ZzvsuWxy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/60 * einsum('iKx,iyzw,wuvs,ZzvsuWyx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzw,wuvs,ZzvsuxWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 7/240 * einsum('iKx,iyzw,wuvs,ZzvsuxyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/120 * einsum('iKx,iyzw,wuvs,ZzvsuyWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/60 * einsum('iKx,iyzw,wuvs,ZzvsuyxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,wuvs,ZzvsxWuy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 11/240 * einsum('iKx,iyzw,wuvs,ZzvsxWyu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 7/120 * einsum('iKx,iyzw,wuvs,ZzvsxuWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 11/120 * einsum('iKx,iyzw,wuvs,ZzvsxuyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/80 * einsum('iKx,iyzw,wuvs,ZzvsxyWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 17/240 * einsum('iKx,iyzw,wuvs,ZzvsxyuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/240 * einsum('iKx,iyzw,wuvs,ZzvsyWux->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/80 * einsum('iKx,iyzw,wuvs,ZzvsyWxu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/120 * einsum('iKx,iyzw,wuvs,ZzvsyuWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/60 * einsum('iKx,iyzw,wuvs,ZzvsyuxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 13/120 * einsum('iKx,iyzw,wuvs,ZzvsyxWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/20 * einsum('iKx,iyzw,wuvs,ZzvsyxuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,iyzw,xuvw,ZzuWvy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,xuvw,ZzuWyv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('iKx,iyzw,xuvw,ZzuvWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,xuvw,ZzuvyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,xuvw,ZzuyWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,xuvw,ZzuyvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,xuvz,ZwuWyv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,xuvz,ZwuvyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,xuwv,ZzuWyv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,xuwv,ZzuyWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,xuwz,WyZu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,xuwz,WyuZ->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,xuzv,ZwuWvy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,iyzw,xuzv,ZwuWyv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,xuzv,ZwuvWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,xuzv,ZwuvyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,xuzv,ZwuyWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,xuzv,ZwuyvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iyzw,xuzw,WyZu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzw,xyuv,ZzwWuv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzw,xyuv,ZzwWvu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('iKx,iyzw,xyuv,ZzwuWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzw,xyuv,ZzwuvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzw,xyuv,ZzwvWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzw,xyuv,ZzwvuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 13/240 * einsum('iKx,iyzw,yuvs,ZzwuWsvx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/80 * einsum('iKx,iyzw,yuvs,ZzwuWsxv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/80 * einsum('iKx,iyzw,yuvs,ZzwuWvsx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/80 * einsum('iKx,iyzw,yuvs,ZzwuWvxs->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/120 * einsum('iKx,iyzw,yuvs,ZzwuWxsv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,yuvs,ZzwusWvx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/240 * einsum('iKx,iyzw,yuvs,ZzwusWxv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 11/240 * einsum('iKx,iyzw,yuvs,ZzwusvWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzw,yuvs,ZzwusvxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/60 * einsum('iKx,iyzw,yuvs,ZzwusxWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/30 * einsum('iKx,iyzw,yuvs,ZzwusxvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/120 * einsum('iKx,iyzw,yuvs,ZzwuvWsx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/60 * einsum('iKx,iyzw,yuvs,ZzwuvWxs->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/40 * einsum('iKx,iyzw,yuvs,ZzwuvsWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,yuvs,ZzwuvsxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/240 * einsum('iKx,iyzw,yuvs,ZzwuvxWs->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/80 * einsum('iKx,iyzw,yuvs,ZzwuvxsW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/15 * einsum('iKx,iyzw,yuvs,ZzwuxWsv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 13/120 * einsum('iKx,iyzw,yuvs,ZzwuxWvs->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,yuvs,ZzwuxsWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/30 * einsum('iKx,iyzw,yuvs,ZzwuxsvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,yuvs,ZzwuxvWs->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('iKx,iyzw,yuvs,ZzwuxvsW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/120 * einsum('iKx,iyzw,zuvs,ZwvsWuxy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/40 * einsum('iKx,iyzw,zuvs,ZwvsWuyx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/80 * einsum('iKx,iyzw,zuvs,ZwvsWxuy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 7/240 * einsum('iKx,iyzw,zuvs,ZwvsWxyu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/60 * einsum('iKx,iyzw,zuvs,ZwvsuWyx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('iKx,iyzw,zuvs,ZwvsuxWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 13/240 * einsum('iKx,iyzw,zuvs,ZwvsuxyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/15 * einsum('iKx,iyzw,zuvs,ZwvsuyWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/80 * einsum('iKx,iyzw,zuvs,ZwvsxWuy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 7/240 * einsum('iKx,iyzw,zuvs,ZwvsxWyu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 9/80 * einsum('iKx,iyzw,zuvs,ZwvsxuWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,zuvs,ZwvsxuyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzw,zuvs,ZwvsxyWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/80 * einsum('iKx,iyzw,zuvs,ZwvsxyuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,zuvs,ZwvsyWux->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,zuvs,ZwvsyWxu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 11/80 * einsum('iKx,iyzw,zuvs,ZwvsyuWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 17/240 * einsum('iKx,iyzw,zuvs,ZwvsyuxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,zuvs,ZwvsyxWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/10 * einsum('iKx,iyzw,zuvs,ZwvsyxuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,zwuv,ZuvWxy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,zwuv,ZuvWyx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('iKx,iyzw,zwuv,ZuvxWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,zwuv,ZuvxyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,zwuv,ZuvyWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,zwuv,ZuvyxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzx,Zwuy,Wwuz->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzx,Zwuy,Wwzu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iyzx,Zwyu,Wwzu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzx,Zzwu,Wyuw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzx,Zzwu,Wywu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzx,ywuv,ZzwWuv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzx,ywuv,ZzwWvu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('iKx,iyzx,ywuv,ZzwuWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzx,ywuv,ZzwuvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzx,ywuv,ZzwvWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzx,ywuv,ZzwvuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzx,zwuv,ZuvWwy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzx,zwuv,ZuvWyw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzx,zwuv,ZuvwWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzx,zwuv,ZuvwyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('iKx,iyzx,zwuv,ZuvyWw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzx,zwuv,ZuvywW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma[s_caa__abb:f_caa__abb] += sigma_caa.reshape(-1).copy()

        sigma_caa =- 1/4 * einsum('iKZ,ix,Wx->KWZ', X_abb, h_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iy,WxZy->KWZ', X_abb, h_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,iy,WxyZ->KWZ', X_abb, h_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKZ,ixyz,Wxyz->KWZ', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,iZyx,Wy->KWZ', X_abb, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,iZyz,Wxyz->KWZ', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iZyz,Wxzy->KWZ', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,ZzwWxy->KWZ', X_abb, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,ZzwWyx->KWZ', X_abb, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('iKx,iyzw,ZzwxWy->KWZ', X_abb, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,ZzwxyW->KWZ', X_abb, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,ZzwyWx->KWZ', X_abb, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,ZzwyxW->KWZ', X_abb, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzx,WyZz->KWZ', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,iyzx,WyzZ->KWZ', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('ijZ,jiKx,Wx->KWZ', X_abb, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('ijx,jiKy,WxZy->KWZ', X_abb, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('ijx,jiKy,WxyZ->KWZ', X_abb, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('KjZ,jx,Wx->KWZ', X_bab, h_xa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,jy,WxZy->KWZ', X_bab, h_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,jy,WxyZ->KWZ', X_bab, h_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,iZyx,Wy->KWZ', X_bab, v_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzx,WyZz->KWZ', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzx,WyzZ->KWZ', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('KjZ,jxyz,Wxyz->KWZ', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,jZyz,Wxyz->KWZ', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,jZyz,Wxzy->KWZ', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,ZzwWxy->KWZ', X_bab, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,ZzwWyx->KWZ', X_bab, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('Kjx,jyzw,ZzwxWy->KWZ', X_bab, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,ZzwxyW->KWZ', X_bab, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,ZzwyWx->KWZ', X_bab, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,ZzwyxW->KWZ', X_bab, v_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('ijZ,ijKx,Wx->KWZ', X_bab, v_xxxa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('ijx,ijKy,WxZy->KWZ', X_bab, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('ijx,ijKy,WxyZ->KWZ', X_bab, v_xxxa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKZ,i,ix,Wx->KWZ', X_abb, e_cvs, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKZ,i,ixyz,Wxyz->KWZ', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,i,iZyx,Wy->KWZ', X_abb, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,i,iZyz,Wxyz->KWZ', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,i,iZyz,Wxzy->KWZ', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,i,iy,WxZy->KWZ', X_abb, e_cvs, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,i,iy,WxyZ->KWZ', X_abb, e_cvs, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,i,iyzw,ZzwWxy->KWZ', X_abb, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,i,iyzw,ZzwWyx->KWZ', X_abb, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('iKx,i,iyzw,ZzwxWy->KWZ', X_abb, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,i,iyzw,ZzwxyW->KWZ', X_abb, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,i,iyzw,ZzwyWx->KWZ', X_abb, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,i,iyzw,ZzwyxW->KWZ', X_abb, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,i,iyzx,WyZz->KWZ', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,i,iyzx,WyzZ->KWZ', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKZ,xy,ix,Wy->KWZ', X_abb, h_aa, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKZ,xy,ixzw,Wyzw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKZ,xy,izwx,Wzwy->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKZ,xy,izxw,Wzyw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,Zy,iyzw,Wxwz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,Zy,iyzw,Wxzw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,Zy,iyzx,Wz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,xy,iZzy,Wz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,xy,izwy,WzZw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,xy,izwy,WzwZ->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,yz,iZwy,Wxwz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,yz,iZwy,Wxzw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,yz,iZyw,Wxwz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,yz,iZyw,Wxzw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,yz,iZyx,Wz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,yz,iwuy,ZzuWwx->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,yz,iwuy,ZzuWxw->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,yz,iwuy,ZzuwWx->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,yz,iwuy,ZzuwxW->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,yz,iwuy,ZzuxWw->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('iKx,yz,iwuy,ZzuxwW->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,yz,iwyu,ZzuWxw->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,yz,iwyu,ZzuxWw->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,yz,iwyx,WwZz->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,yz,iwyx,WwzZ->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,yz,iy,WxZz->KWZ', X_abb, h_aa, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,yz,iy,WxzZ->KWZ', X_abb, h_aa, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,yz,iywu,ZwuWxz->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,yz,iywu,ZwuWzx->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('iKx,yz,iywu,ZwuxWz->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,yz,iywu,ZwuxzW->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,yz,iywu,ZwuzWx->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,yz,iywu,ZwuzxW->KWZ', X_abb, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,yz,iywx,WzZw->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,yz,iywx,WzwZ->KWZ', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKZ,ix,xyzw,Wyzw->KWZ', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 11/48 * einsum('iKZ,ixyz,xwuv,yzwWuv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKZ,ixyz,xwuv,yzwWvu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKZ,ixyz,xwuv,yzwuWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKZ,ixyz,xwuv,yzwuvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKZ,ixyz,xwuv,yzwvWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKZ,ixyz,xwuv,yzwvuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKZ,ixyz,ywuv,zuvWwx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKZ,ixyz,ywuv,zuvWxw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKZ,ixyz,ywuv,zuvwWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKZ,ixyz,ywuv,zuvwxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKZ,ixyz,ywuv,zuvxWw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKZ,ixyz,ywuv,zuvxwW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKZ,ixyz,yzwu,Wxwu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKZ,ixyz,zwuv,yuvWxw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,iZyx,yzwu,Wzwu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,iZyz,xwuy,Wuwz->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iZyz,xwuy,Wuzw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iZyz,xwuz,Wuwy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,iZyz,xwuz,Wuyw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,iZyz,xwzu,Wuyw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,iZyz,xwzy,Ww->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iZyz,ywuv,zuvWwx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iZyz,ywuv,zuvWxw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iZyz,ywuv,zuvwWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iZyz,ywuv,zuvwxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('iKx,iZyz,ywuv,zuvxWw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iZyz,ywuv,zuvxwW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iZyz,yzwu,Wxuw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,iZyz,yzwu,Wxwu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iZyz,zwuv,yuvWwx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 7/48 * einsum('iKx,iZyz,zwuv,yuvWxw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iZyz,zwuv,yuvwWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iZyz,zwuv,yuvwxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iZyz,zwuv,yuvxWw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iZyz,zwuv,yuvxwW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,iy,Zyxz,Wz->KWZ', X_abb, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,iy,Zyzw,Wxwz->KWZ', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iy,Zyzw,Wxzw->KWZ', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iy,xzwy,WwZz->KWZ', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,iy,xzwy,WwzZ->KWZ', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iy,yzwu,ZwuWxz->KWZ', X_abb, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iy,yzwu,ZwuWzx->KWZ', X_abb, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('iKx,iy,yzwu,ZwuxWz->KWZ', X_abb, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iy,yzwu,ZwuxzW->KWZ', X_abb, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iy,yzwu,ZwuzWx->KWZ', X_abb, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iy,yzwu,ZwuzxW->KWZ', X_abb, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 7/48 * einsum('iKx,iyzw,Zuvy,zwvWux->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,Zuvy,zwvWxu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,Zuvy,zwvuWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,Zuvy,zwvuxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,Zuvy,zwvxWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,Zuvy,zwvxuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iyzw,Zuxy,Wuzw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,Zuyv,zwvWux->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('iKx,iyzw,Zuyv,zwvWxu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,Zuyv,zwvuWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,Zuyv,zwvuxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,iyzw,Zuyv,zwvxWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,Zuyv,zwvxuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,Zuyx,Wuwz->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,iyzw,Zuyx,Wuzw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 7/48 * einsum('iKx,iyzw,Zwuv,zuvWxy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzw,Zwuv,zuvWyx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzw,Zwuv,zuvxWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzw,Zwuv,zuvxyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzw,Zwuv,zuvyWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzw,Zwuv,zuvyxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,Zwux,Wyuz->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,iyzw,Zwux,Wyzu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,iyzw,Zwxu,Wyzu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,Zzuv,wuvWxy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,Zzuv,wuvWyx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,Zzuv,wuvxWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,Zzuv,wuvxyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,Zzuv,wuvyxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('iKx,iyzw,Zzxu,Wyuw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/240 * einsum('iKx,iyzw,wuvs,ZzvsWuxy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/80 * einsum('iKx,iyzw,wuvs,ZzvsWuyx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/120 * einsum('iKx,iyzw,wuvs,ZzvsWxuy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/40 * einsum('iKx,iyzw,wuvs,ZzvsWxyu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,wuvs,ZzvsWyux->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/80 * einsum('iKx,iyzw,wuvs,ZzvsWyxu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/30 * einsum('iKx,iyzw,wuvs,ZzvsuWxy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,iyzw,wuvs,ZzvsuWyx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 7/240 * einsum('iKx,iyzw,wuvs,ZzvsuxWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 17/240 * einsum('iKx,iyzw,wuvs,ZzvsuxyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,wuvs,ZzvsuyWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/20 * einsum('iKx,iyzw,wuvs,ZzvsuyxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/10 * einsum('iKx,iyzw,wuvs,ZzvsxWyu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/20 * einsum('iKx,iyzw,wuvs,ZzvsxuWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/20 * einsum('iKx,iyzw,wuvs,ZzvsxuyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/60 * einsum('iKx,iyzw,wuvs,ZzvsxyWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/60 * einsum('iKx,iyzw,wuvs,ZzvsxyuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/60 * einsum('iKx,iyzw,wuvs,ZzvsyWux->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,iyzw,wuvs,ZzvsyWxu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/15 * einsum('iKx,iyzw,wuvs,ZzvsyuWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/40 * einsum('iKx,iyzw,wuvs,ZzvsyuxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,wuvs,ZzvsyxWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/80 * einsum('iKx,iyzw,wuvs,ZzvsyxuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,xuvw,ZzuWvy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,iyzw,xuvw,ZzuWyv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('iKx,iyzw,xuvw,ZzuvWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,iyzw,xuvw,ZzuvyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,iyzw,xuvw,ZzuyWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,iyzw,xuvw,ZzuyvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,xuvz,ZwuWvy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,xuvz,ZwuvWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,xuvz,ZwuvyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,xuvz,ZwuyWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzw,xuvz,ZwuyvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,xuwv,ZzuWyv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,iyzw,xuwv,ZzuyWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzw,xuwz,WyZu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,iyzw,xuwz,WyuZ->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,iyzw,xyuv,ZzwWuv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,xyuv,ZzwWvu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('iKx,iyzw,xyuv,ZzwuWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,xyuv,ZzwuvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,xyuv,ZzwvWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,xyuv,ZzwvuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 19/240 * einsum('iKx,iyzw,yuvs,ZzwuWsvx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/80 * einsum('iKx,iyzw,yuvs,ZzwuWsxv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/240 * einsum('iKx,iyzw,yuvs,ZzwuWvsx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/240 * einsum('iKx,iyzw,yuvs,ZzwuWvxs->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,yuvs,ZzwuWxsv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/10 * einsum('iKx,iyzw,yuvs,ZzwuWxvs->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 9/80 * einsum('iKx,iyzw,yuvs,ZzwusWvx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 11/240 * einsum('iKx,iyzw,yuvs,ZzwusWxv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/240 * einsum('iKx,iyzw,yuvs,ZzwusvWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/120 * einsum('iKx,iyzw,yuvs,ZzwusvxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/20 * einsum('iKx,iyzw,yuvs,ZzwusxWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 7/240 * einsum('iKx,iyzw,yuvs,ZzwusxvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/20 * einsum('iKx,iyzw,yuvs,ZzwuvWsx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,iyzw,yuvs,ZzwuvWxs->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/120 * einsum('iKx,iyzw,yuvs,ZzwuvsWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzw,yuvs,ZzwuvsxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 13/240 * einsum('iKx,iyzw,yuvs,ZzwuvxWs->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/30 * einsum('iKx,iyzw,yuvs,ZzwuvxsW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 9/40 * einsum('iKx,iyzw,yuvs,ZzwuxWvs->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,yuvs,ZzwuxsWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/80 * einsum('iKx,iyzw,yuvs,ZzwuxsvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 7/120 * einsum('iKx,iyzw,yuvs,ZzwuxvWs->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/80 * einsum('iKx,iyzw,yuvs,ZzwuxvsW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 7/120 * einsum('iKx,iyzw,zuvs,ZwvsWuxy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('iKx,iyzw,zuvs,ZwvsWuyx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 13/240 * einsum('iKx,iyzw,zuvs,ZwvsWxuy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('iKx,iyzw,zuvs,ZwvsWxyu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/15 * einsum('iKx,iyzw,zuvs,ZwvsWyxu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/15 * einsum('iKx,iyzw,zuvs,ZwvsuWxy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/30 * einsum('iKx,iyzw,zuvs,ZwvsuWyx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/40 * einsum('iKx,iyzw,zuvs,ZwvsuxWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/15 * einsum('iKx,iyzw,zuvs,ZwvsuxyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzw,zuvs,ZwvsuyWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,zuvs,ZwvsuyxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,zuvs,ZwvsxWuy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 9/80 * einsum('iKx,iyzw,zuvs,ZwvsxWyu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/40 * einsum('iKx,iyzw,zuvs,ZwvsxuWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/15 * einsum('iKx,iyzw,zuvs,ZwvsxuyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/40 * einsum('iKx,iyzw,zuvs,ZwvsxyuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 7/240 * einsum('iKx,iyzw,zuvs,ZwvsyWux->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 43/240 * einsum('iKx,iyzw,zuvs,ZwvsyWxu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('iKx,iyzw,zuvs,ZwvsyuWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/16 * einsum('iKx,iyzw,zuvs,ZwvsyxWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/240 * einsum('iKx,iyzw,zuvs,ZwvsyxuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzw,zwuv,ZuvWxy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,zwuv,ZuvWyx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('iKx,iyzw,zwuv,ZuvxWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,zwuv,ZuvxyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,zwuv,ZuvyWx->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzw,zwuv,ZuvyxW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('iKx,iyzx,Zwuy,Wwuz->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('iKx,iyzx,Zwuy,Wwzu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('iKx,iyzx,Zwyu,Wwzu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('iKx,iyzx,Zzwu,Wyuw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('iKx,iyzx,Zzwu,Wywu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('iKx,iyzx,ywuv,ZzwWuv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzx,ywuv,ZzwWvu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 7/48 * einsum('iKx,iyzx,ywuv,ZzwuWv->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzx,ywuv,ZzwuvW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzx,ywuv,ZzwvWu->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('iKx,iyzx,ywuv,ZzwvuW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzx,zwuv,ZuvWwy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('iKx,iyzx,zwuv,ZuvWyw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzx,zwuv,ZuvwWy->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzx,zwuv,ZuvwyW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 7/48 * einsum('iKx,iyzx,zwuv,ZuvyWw->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('iKx,iyzx,zwuv,ZuvywW->KWZ', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,i,iZyx,Wy->KWZ', X_bab, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,i,iyzx,WyZz->KWZ', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,i,iyzx,WyzZ->KWZ', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('KjZ,j,jx,Wx->KWZ', X_bab, e_cvs, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('KjZ,j,jxyz,Wxyz->KWZ', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,j,jZyz,Wxyz->KWZ', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,j,jZyz,Wxzy->KWZ', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,j,jy,WxZy->KWZ', X_bab, e_cvs, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,j,jy,WxyZ->KWZ', X_bab, e_cvs, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,j,jyzw,ZzwWxy->KWZ', X_bab, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,j,jyzw,ZzwWyx->KWZ', X_bab, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('Kjx,j,jyzw,ZzwxWy->KWZ', X_bab, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,j,jyzw,ZzwxyW->KWZ', X_bab, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,j,jyzw,ZzwyWx->KWZ', X_bab, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,j,jyzw,ZzwyxW->KWZ', X_bab, e_cvs, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,Zy,iyzx,Wz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,xy,iZzy,Wz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,xy,izwy,WzZw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,xy,izwy,WzwZ->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,yz,iZyx,Wz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,yz,iwyx,WwZz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,yz,iwyx,WwzZ->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,yz,iywx,WzZw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,yz,iywx,WzwZ->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('KjZ,xy,jx,Wy->KWZ', X_bab, h_aa, t1_xa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('KjZ,xy,jxzw,Wyzw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('KjZ,xy,jzwx,Wzwy->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('KjZ,xy,jzxw,Wzyw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,Zy,jyzw,Wxwz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kjx,Zy,jyzw,Wxzw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,yz,jZwy,Wxwz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,yz,jZwy,Wxzw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,yz,jZyw,Wxwz->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,yz,jZyw,Wxzw->KWZ', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,yz,jwuy,ZzuWwx->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,yz,jwuy,ZzuWxw->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,yz,jwuy,ZzuwWx->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,yz,jwuy,ZzuwxW->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,yz,jwuy,ZzuxWw->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kjx,yz,jwuy,ZzuxwW->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,yz,jwyu,ZzuWxw->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,yz,jwyu,ZzuxWw->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,yz,jy,WxZz->KWZ', X_bab, h_aa, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,yz,jy,WxzZ->KWZ', X_bab, h_aa, t1_xa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,yz,jywu,ZwuWxz->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,yz,jywu,ZwuWzx->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('Kjx,yz,jywu,ZwuxWz->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,yz,jywu,ZwuxzW->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,yz,jywu,ZwuzWx->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,yz,jywu,ZwuzxW->KWZ', X_bab, h_aa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,iZyx,yzwu,Wzwu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iZyz,xwuy,Wuwz->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iZyz,xwuy,Wuzw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iZyz,xwuz,Wuwy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iZyz,xwuz,Wuyw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,iZyz,xwzu,Wuyw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,iZyz,xwzy,Ww->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,iy,Zyxz,Wz->KWZ', X_bab, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iy,xzwy,WwZz->KWZ', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iy,xzwy,WwzZ->KWZ', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iyzw,Zuxy,Wuzw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,Zuyx,Wuwz->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzw,Zuyx,Wuzw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,Zwux,Wyuz->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzw,Zwux,Wyzu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,iyzw,Zwxu,Wyzu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('Kix,iyzw,Zzxu,Wyuw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kix,iyzw,xuvw,ZzuWvy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kix,iyzw,xuvw,ZzuWyv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/8 * einsum('Kix,iyzw,xuvw,ZzuvWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kix,iyzw,xuvw,ZzuvyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kix,iyzw,xuvw,ZzuyWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kix,iyzw,xuvw,ZzuyvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuvz,ZwuWvy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuvz,ZwuvWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvz,ZwuvyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuvz,ZwuyWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzw,xuvz,ZwuyvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuwv,ZzuWyv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwv,ZzuyWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzw,xuwz,WyZu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwz,WyuZ->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kix,iyzw,xyuv,ZzwWuv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kix,iyzw,xyuv,ZzwWvu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kix,iyzw,xyuv,ZzwuWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kix,iyzw,xyuv,ZzwuvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kix,iyzw,xyuv,ZzwvWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kix,iyzw,xyuv,ZzwvuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kix,iyzx,Zwuy,Wwuz->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('Kix,iyzx,Zwuy,Wwzu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/4 * einsum('Kix,iyzx,Zwyu,Wwzu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kix,iyzx,Zzwu,Wyuw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kix,iyzx,Zzwu,Wywu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kix,iyzx,ywuv,ZzwWuv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kix,iyzx,ywuv,ZzwWvu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 7/48 * einsum('Kix,iyzx,ywuv,ZzwuWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kix,iyzx,ywuv,ZzwuvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kix,iyzx,ywuv,ZzwvWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kix,iyzx,ywuv,ZzwvuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kix,iyzx,zwuv,ZuvWwy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kix,iyzx,zwuv,ZuvWyw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kix,iyzx,zwuv,ZuvwWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kix,iyzx,zwuv,ZuvwyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 7/48 * einsum('Kix,iyzx,zwuv,ZuvyWw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kix,iyzx,zwuv,ZuvywW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('KjZ,jx,xyzw,Wyzw->KWZ', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 11/48 * einsum('KjZ,jxyz,xwuv,yzwWuv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('KjZ,jxyz,xwuv,yzwWvu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('KjZ,jxyz,xwuv,yzwuWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('KjZ,jxyz,xwuv,yzwuvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('KjZ,jxyz,xwuv,yzwvWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('KjZ,jxyz,xwuv,yzwvuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('KjZ,jxyz,ywuv,zuvWwx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('KjZ,jxyz,ywuv,zuvWxw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('KjZ,jxyz,ywuv,zuvwWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('KjZ,jxyz,ywuv,zuvwxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/6 * einsum('KjZ,jxyz,ywuv,zuvxWw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('KjZ,jxyz,ywuv,zuvxwW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('KjZ,jxyz,yzwu,Wxwu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/4 * einsum('KjZ,jxyz,zwuv,yuvWxw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jZyz,ywuv,zuvWwx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jZyz,ywuv,zuvWxw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jZyz,ywuv,zuvwWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jZyz,ywuv,zuvwxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('Kjx,jZyz,ywuv,zuvxWw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jZyz,ywuv,zuvxwW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,jZyz,yzwu,Wxuw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,jZyz,yzwu,Wxwu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jZyz,zwuv,yuvWwx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 7/48 * einsum('Kjx,jZyz,zwuv,yuvWxw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jZyz,zwuv,yuvwWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jZyz,zwuv,yuvwxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jZyz,zwuv,yuvxWw->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jZyz,zwuv,yuvxwW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/6 * einsum('Kjx,jy,Zyzw,Wxwz->KWZ', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,jy,Zyzw,Wxzw->KWZ', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jy,yzwu,ZwuWxz->KWZ', X_bab, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jy,yzwu,ZwuWzx->KWZ', X_bab, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('Kjx,jy,yzwu,ZwuxWz->KWZ', X_bab, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jy,yzwu,ZwuxzW->KWZ', X_bab, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jy,yzwu,ZwuzWx->KWZ', X_bab, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jy,yzwu,ZwuzxW->KWZ', X_bab, t1_xa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 7/48 * einsum('Kjx,jyzw,Zuvy,zwvWux->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,Zuvy,zwvWxu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,Zuvy,zwvuWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,Zuvy,zwvuxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,Zuvy,zwvxWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,Zuvy,zwvxuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zuyv,zwvWux->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/8 * einsum('Kjx,jyzw,Zuyv,zwvWxu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zuyv,zwvuWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zuyv,zwvuxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jyzw,Zuyv,zwvxWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zuyv,zwvxuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 7/48 * einsum('Kjx,jyzw,Zwuv,zuvWxy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jyzw,Zwuv,zuvWyx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/16 * einsum('Kjx,jyzw,Zwuv,zuvxWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jyzw,Zwuv,zuvxyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jyzw,Zwuv,zuvyWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jyzw,Zwuv,zuvyxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jyzw,Zzuv,wuvWxy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jyzw,Zzuv,wuvWyx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jyzw,Zzuv,wuvxWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/12 * einsum('Kjx,jyzw,Zzuv,wuvxyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 1/12 * einsum('Kjx,jyzw,Zzuv,wuvyxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/240 * einsum('Kjx,jyzw,wuvs,ZzvsWuxy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/80 * einsum('Kjx,jyzw,wuvs,ZzvsWuyx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/120 * einsum('Kjx,jyzw,wuvs,ZzvsWxuy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/40 * einsum('Kjx,jyzw,wuvs,ZzvsWxyu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,wuvs,ZzvsWyux->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/80 * einsum('Kjx,jyzw,wuvs,ZzvsWyxu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/30 * einsum('Kjx,jyzw,wuvs,ZzvsuWxy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jyzw,wuvs,ZzvsuWyx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 7/240 * einsum('Kjx,jyzw,wuvs,ZzvsuxWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 17/240 * einsum('Kjx,jyzw,wuvs,ZzvsuxyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,wuvs,ZzvsuyWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/20 * einsum('Kjx,jyzw,wuvs,ZzvsuyxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/10 * einsum('Kjx,jyzw,wuvs,ZzvsxWyu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/20 * einsum('Kjx,jyzw,wuvs,ZzvsxuWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/20 * einsum('Kjx,jyzw,wuvs,ZzvsxuyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/60 * einsum('Kjx,jyzw,wuvs,ZzvsxyWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/60 * einsum('Kjx,jyzw,wuvs,ZzvsxyuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/60 * einsum('Kjx,jyzw,wuvs,ZzvsyWux->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jyzw,wuvs,ZzvsyWxu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/15 * einsum('Kjx,jyzw,wuvs,ZzvsyuWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/40 * einsum('Kjx,jyzw,wuvs,ZzvsyuxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,wuvs,ZzvsyxWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/80 * einsum('Kjx,jyzw,wuvs,ZzvsyxuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 19/240 * einsum('Kjx,jyzw,yuvs,ZzwuWsvx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/80 * einsum('Kjx,jyzw,yuvs,ZzwuWsxv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/240 * einsum('Kjx,jyzw,yuvs,ZzwuWvsx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/240 * einsum('Kjx,jyzw,yuvs,ZzwuWvxs->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,yuvs,ZzwuWxsv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/10 * einsum('Kjx,jyzw,yuvs,ZzwuWxvs->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 9/80 * einsum('Kjx,jyzw,yuvs,ZzwusWvx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 11/240 * einsum('Kjx,jyzw,yuvs,ZzwusWxv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/240 * einsum('Kjx,jyzw,yuvs,ZzwusvWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/120 * einsum('Kjx,jyzw,yuvs,ZzwusvxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/20 * einsum('Kjx,jyzw,yuvs,ZzwusxWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 7/240 * einsum('Kjx,jyzw,yuvs,ZzwusxvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/20 * einsum('Kjx,jyzw,yuvs,ZzwuvWsx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jyzw,yuvs,ZzwuvWxs->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/120 * einsum('Kjx,jyzw,yuvs,ZzwuvsWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jyzw,yuvs,ZzwuvsxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 13/240 * einsum('Kjx,jyzw,yuvs,ZzwuvxWs->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/30 * einsum('Kjx,jyzw,yuvs,ZzwuvxsW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 9/40 * einsum('Kjx,jyzw,yuvs,ZzwuxWvs->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,yuvs,ZzwuxsWv->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/80 * einsum('Kjx,jyzw,yuvs,ZzwuxsvW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 7/120 * einsum('Kjx,jyzw,yuvs,ZzwuxvWs->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 3/80 * einsum('Kjx,jyzw,yuvs,ZzwuxvsW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 7/120 * einsum('Kjx,jyzw,zuvs,ZwvsWuxy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/24 * einsum('Kjx,jyzw,zuvs,ZwvsWuyx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 13/240 * einsum('Kjx,jyzw,zuvs,ZwvsWxuy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 5/48 * einsum('Kjx,jyzw,zuvs,ZwvsWxyu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/15 * einsum('Kjx,jyzw,zuvs,ZwvsWyxu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/15 * einsum('Kjx,jyzw,zuvs,ZwvsuWxy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/30 * einsum('Kjx,jyzw,zuvs,ZwvsuWyx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/40 * einsum('Kjx,jyzw,zuvs,ZwvsuxWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/15 * einsum('Kjx,jyzw,zuvs,ZwvsuxyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/48 * einsum('Kjx,jyzw,zuvs,ZwvsuyWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,zuvs,ZwvsuyxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,zuvs,ZwvsxWuy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 9/80 * einsum('Kjx,jyzw,zuvs,ZwvsxWyu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/40 * einsum('Kjx,jyzw,zuvs,ZwvsxuWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/15 * einsum('Kjx,jyzw,zuvs,ZwvsxuyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/40 * einsum('Kjx,jyzw,zuvs,ZwvsxyuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 7/240 * einsum('Kjx,jyzw,zuvs,ZwvsyWux->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 43/240 * einsum('Kjx,jyzw,zuvs,ZwvsyWxu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 1/24 * einsum('Kjx,jyzw,zuvs,ZwvsyuWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa += 3/16 * einsum('Kjx,jyzw,zuvs,ZwvsyxWu->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/240 * einsum('Kjx,jyzw,zuvs,ZwvsyxuW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
        sigma_caa -= 1/48 * einsum('Kjx,jyzw,zwuv,ZuvWxy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,zwuv,ZuvWyx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa -= 5/48 * einsum('Kjx,jyzw,zwuv,ZuvxWy->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,zwuv,ZuvxyW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,zwuv,ZuvyWx->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma_caa += 1/16 * einsum('Kjx,jyzw,zwuv,ZuvyxW->KWZ', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
        sigma[s_caa__bab:f_caa__bab] += sigma_caa.reshape(-1).copy()

        # CCA <- CCA
        sigma_cca =- einsum('Kix,LxWi->KLW', X_aaa, v_xaax, optimize = einsum_type)
        sigma_cca += einsum('Kix,LxiW->KLW', X_aaa, v_xaxa, optimize = einsum_type)
        sigma_cca += einsum('Lix,KxWi->KLW', X_aaa, v_xaax, optimize = einsum_type)
        sigma_cca -= einsum('Lix,KxiW->KLW', X_aaa, v_xaxa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('ijW,KLij->KLW', X_aaa, v_xxxx, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('ijW,KLji->KLW', X_aaa, v_xxxx, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kix,LxWi->KLW', X_abb, v_xaax, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lix,KxWi->KLW', X_abb, v_xaax, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('iKx,LxWi->KLW', X_bab, v_xaax, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('iLx,KxWi->KLW', X_bab, v_xaax, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kix,Lxiy,Wy->KLW', X_aaa, v_xaxa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kix,Lxyi,Wy->KLW', X_aaa, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kjx,LyWj,xy->KLW', X_aaa, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kjx,LyjW,xy->KLW', X_aaa, v_xaxa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kjx,Lyjz,Wyxz->KLW', X_aaa, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Kjx,Lyzj,Wyxz->KLW', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kjx,Lyzj,Wyzx->KLW', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Lix,Kxiy,Wy->KLW', X_aaa, v_xaxa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lix,Kxyi,Wy->KLW', X_aaa, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Ljx,KyWj,xy->KLW', X_aaa, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Ljx,KyjW,xy->KLW', X_aaa, v_xaxa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Ljx,Kyjz,Wyxz->KLW', X_aaa, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Ljx,Kyzj,Wyxz->KLW', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Ljx,Kyzj,Wyzx->KLW', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('ijx,KLij,Wx->KLW', X_aaa, v_xxxx, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('ijx,KLji,Wx->KLW', X_aaa, v_xxxx, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('Kix,Lxyi,Wy->KLW', X_abb, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('Kjx,LyWj,xy->KLW', X_abb, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kjx,Lyzj,Wyxz->KLW', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kjx,Lyzj,Wyzx->KLW', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('Lix,Kxyi,Wy->KLW', X_abb, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('Ljx,KyWj,xy->KLW', X_abb, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Ljx,Kyzj,Wyxz->KLW', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('Ljx,Kyzj,Wyzx->KLW', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('iKx,Lxyi,Wy->KLW', X_bab, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('iKx,LyWi,xy->KLW', X_bab, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('iKx,Lyzi,Wyxz->KLW', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('iKx,Lyzi,Wyzx->KLW', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('iLx,Kxyi,Wy->KLW', X_bab, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('iLx,KyWi,xy->KLW', X_bab, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('iLx,Kyzi,Wyxz->KLW', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('iLx,Kyzi,Wyzx->KLW', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kjx,Lyjz,yz,Wx->KLW', X_aaa, v_xaxa, rdm_ca, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('Kjx,Lyzj,yz,Wx->KLW', X_aaa, v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Ljx,Kyjz,yz,Wx->KLW', X_aaa, v_xaxa, rdm_ca, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('Ljx,Kyzj,yz,Wx->KLW', X_aaa, v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)
        sigma[s_cca__aaa:f_cca__aaa] += sigma_cca[cvs_tril_ind[0], cvs_tril_ind[1]].reshape(-1).copy()

        sigma_cca =- einsum('Kix,LxWi->KLW', X_aaa, v_xaax, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Kix,LxWi->KLW', X_abb, v_xaax, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kix,LxiW->KLW', X_abb, v_xaxa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('iLx,KxiW->KLW', X_abb, v_xaxa, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('ijW,KLij->KLW', X_abb, v_xxxx, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('Lix,KxiW->KLW', X_bab, v_xaxa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('iKx,LxWi->KLW', X_bab, v_xaax, optimize = einsum_type)
        sigma_cca -= 1/2 * einsum('iKx,LxiW->KLW', X_bab, v_xaxa, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('ijW,KLji->KLW', X_bab, v_xxxx, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kix,Lxyi,Wy->KLW', X_aaa, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/2 * einsum('Kjx,LyWj,xy->KLW', X_aaa, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Kjx,Lyzj,Wyxz->KLW', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/3 * einsum('Kjx,Lyzj,Wyzx->KLW', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('Kix,Lxiy,Wy->KLW', X_abb, v_xaxa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('Kix,Lxyi,Wy->KLW', X_abb, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('Kjx,LyWj,xy->KLW', X_abb, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('Kjx,LyjW,xy->KLW', X_abb, v_xaxa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('Kjx,Lyjz,Wyxz->KLW', X_abb, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('Kjx,Lyzj,Wyxz->KLW', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Kjx,Lyzj,Wyzx->KLW', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('iLx,Kxiy,Wy->KLW', X_abb, v_xaxa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('iLx,KyiW,xy->KLW', X_abb, v_xaxa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('iLx,Kyiz,Wyxz->KLW', X_abb, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/6 * einsum('iLx,Kyzi,Wyxz->KLW', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('iLx,Kyzi,Wyzx->KLW', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('ijx,KLij,Wx->KLW', X_abb, v_xxxx, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('Lix,Kxiy,Wy->KLW', X_bab, v_xaxa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('Ljx,KyjW,xy->KLW', X_bab, v_xaxa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('Ljx,Kyjz,Wyxz->KLW', X_bab, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/6 * einsum('Ljx,Kyzj,Wyxz->KLW', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('Ljx,Kyzj,Wyzx->KLW', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('iKx,Lxiy,Wy->KLW', X_bab, v_xaxa, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('iKx,Lxyi,Wy->KLW', X_bab, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('iKx,LyWi,xy->KLW', X_bab, v_xaax, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('iKx,LyiW,xy->KLW', X_bab, v_xaxa, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('iKx,Lyiz,Wyxz->KLW', X_bab, v_xaxa, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/12 * einsum('iKx,Lyzi,Wyxz->KLW', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca += 1/12 * einsum('iKx,Lyzi,Wyzx->KLW', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('ijx,KLji,Wx->KLW', X_bab, v_xxxx, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('Kjx,Lyjz,yz,Wx->KLW', X_abb, v_xaxa, rdm_ca, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('Kjx,Lyzj,yz,Wx->KLW', X_abb, v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/4 * einsum('iLx,Kyiz,yz,Wx->KLW', X_abb, v_xaxa, rdm_ca, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/8 * einsum('iLx,Kyzi,yz,Wx->KLW', X_abb, v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('Ljx,Kyjz,yz,Wx->KLW', X_bab, v_xaxa, rdm_ca, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('Ljx,Kyzj,yz,Wx->KLW', X_bab, v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)
        sigma_cca -= 1/4 * einsum('iKx,Lyiz,yz,Wx->KLW', X_bab, v_xaxa, rdm_ca, rdm_ca, optimize = einsum_type)
        sigma_cca += 1/8 * einsum('iKx,Lyzi,yz,Wx->KLW', X_bab, v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)
        sigma[s_cca__abb:f_cca__abb] += sigma_cca.reshape(-1).copy()

        # CVA <- CCA
        if nval > 0:
            sigma_cva =- einsum('Kix,LxWi->KLW', X_aaa, v_vaax, optimize = einsum_type)
            sigma_cva += einsum('Kix,LxiW->KLW', X_aaa, v_vaxa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('ijW,KLij->KLW', X_aaa, v_xvxx, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('ijW,KLji->KLW', X_aaa, v_xvxx, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kix,LxWi->KLW', X_abb, v_vaax, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('iKx,LxWi->KLW', X_bab, v_vaax, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kix,Lxiy,Wy->KLW', X_aaa, v_vaxa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kix,Lxyi,Wy->KLW', X_aaa, v_vaax, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kjx,LyWj,xy->KLW', X_aaa, v_vaax, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kjx,LyjW,xy->KLW', X_aaa, v_vaxa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kjx,Lyjz,Wyxz->KLW', X_aaa, v_vaxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kjx,Lyzj,Wyxz->KLW', X_aaa, v_vaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kjx,Lyzj,Wyzx->KLW', X_aaa, v_vaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('ijx,KLij,Wx->KLW', X_aaa, v_xvxx, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('ijx,KLji,Wx->KLW', X_aaa, v_xvxx, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('Kix,Lxyi,Wy->KLW', X_abb, v_vaax, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('Kjx,LyWj,xy->KLW', X_abb, v_vaax, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kjx,Lyzj,Wyxz->KLW', X_abb, v_vaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kjx,Lyzj,Wyzx->KLW', X_abb, v_vaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('iKx,Lxyi,Wy->KLW', X_bab, v_vaax, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('iKx,LyWi,xy->KLW', X_bab, v_vaax, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('iKx,Lyzi,Wyxz->KLW', X_bab, v_vaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('iKx,Lyzi,Wyzx->KLW', X_bab, v_vaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kjx,Lyjz,yz,Wx->KLW', X_aaa, v_vaxa, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('Kjx,Lyzj,yz,Wx->KLW', X_aaa, v_vaax, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma[s_cva__aaa:f_cva__aaa] += sigma_cva.reshape(-1).copy()

            sigma_cva =- einsum('Kix,LxWi->KLW', X_aaa, v_vaax, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kix,LxWi->KLW', X_abb, v_vaax, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kix,LxiW->KLW', X_abb, v_vaxa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('ijW,KLij->KLW', X_abb, v_xvxx, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('iKx,LxWi->KLW', X_bab, v_vaax, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('iKx,LxiW->KLW', X_bab, v_vaxa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('ijW,KLji->KLW', X_bab, v_xvxx, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kix,Lxyi,Wy->KLW', X_aaa, v_vaax, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kjx,LyWj,xy->KLW', X_aaa, v_vaax, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kjx,Lyzj,Wyxz->KLW', X_aaa, v_vaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kjx,Lyzj,Wyzx->KLW', X_aaa, v_vaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('Kix,Lxiy,Wy->KLW', X_abb, v_vaxa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('Kix,Lxyi,Wy->KLW', X_abb, v_vaax, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('Kjx,LyWj,xy->KLW', X_abb, v_vaax, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('Kjx,LyjW,xy->KLW', X_abb, v_vaxa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('Kjx,Lyjz,Wyxz->KLW', X_abb, v_vaxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kjx,Lyzj,Wyxz->KLW', X_abb, v_vaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('Kjx,Lyzj,Wyzx->KLW', X_abb, v_vaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('ijx,KLij,Wx->KLW', X_abb, v_xvxx, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('iKx,Lxiy,Wy->KLW', X_bab, v_vaxa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('iKx,Lxyi,Wy->KLW', X_bab, v_vaax, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('iKx,LyWi,xy->KLW', X_bab, v_vaax, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('iKx,LyiW,xy->KLW', X_bab, v_vaxa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('iKx,Lyiz,Wyxz->KLW', X_bab, v_vaxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('iKx,Lyzi,Wyxz->KLW', X_bab, v_vaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('iKx,Lyzi,Wyzx->KLW', X_bab, v_vaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('ijx,KLji,Wx->KLW', X_bab, v_xvxx, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('Kjx,Lyjz,yz,Wx->KLW', X_abb, v_vaxa, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kjx,Lyzj,yz,Wx->KLW', X_abb, v_vaax, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('iKx,Lyiz,yz,Wx->KLW', X_bab, v_vaxa, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('iKx,Lyzi,yz,Wx->KLW', X_bab, v_vaax, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma[s_cva__abb:f_cva__abb] += sigma_cva.reshape(-1).copy()

            sigma_cva =- 1/2 * einsum('iKx,LxiW->KLW', X_abb, v_vaxa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('ijW,KLji->KLW', X_abb, v_xvxx, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kix,LxiW->KLW', X_bab, v_vaxa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('ijW,KLij->KLW', X_bab, v_xvxx, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('iKx,Lxiy,Wy->KLW', X_abb, v_vaxa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('iKx,LyiW,xy->KLW', X_abb, v_vaxa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('iKx,Lyiz,Wyxz->KLW', X_abb, v_vaxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('iKx,Lyzi,Wyxz->KLW', X_abb, v_vaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/12 * einsum('iKx,Lyzi,Wyzx->KLW', X_abb, v_vaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('ijx,KLji,Wx->KLW', X_abb, v_xvxx, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('Kix,Lxiy,Wy->KLW', X_bab, v_vaxa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('Kjx,LyjW,xy->KLW', X_bab, v_vaxa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('Kjx,Lyjz,Wyxz->KLW', X_bab, v_vaxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kjx,Lyzj,Wyxz->KLW', X_bab, v_vaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/12 * einsum('Kjx,Lyzj,Wyzx->KLW', X_bab, v_vaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('ijx,KLij,Wx->KLW', X_bab, v_xvxx, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('iKx,Lyiz,yz,Wx->KLW', X_abb, v_vaxa, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/8 * einsum('iKx,Lyzi,yz,Wx->KLW', X_abb, v_vaax, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/4 * einsum('Kjx,Lyjz,yz,Wx->KLW', X_bab, v_vaxa, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/8 * einsum('Kjx,Lyzj,yz,Wx->KLW', X_bab, v_vaax, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma[s_cva__bab:f_cva__bab] += sigma_cva.reshape(-1).copy()

        # CCE <- CCA
        if nextern > 0:
            sigma_cce =- einsum('KLx,xB->KLB', X_aaa, h_ae, optimize = einsum_type)
            sigma_cce -= einsum('Kix,LxBi->KLB', X_aaa, v_xaex, optimize = einsum_type)
            sigma_cce += einsum('Kix,LxiB->KLB', X_aaa, v_xaxe, optimize = einsum_type)
            sigma_cce += einsum('Lix,KxBi->KLB', X_aaa, v_xaex, optimize = einsum_type)
            sigma_cce -= einsum('Lix,KxiB->KLB', X_aaa, v_xaxe, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kix,LxBi->KLB', X_abb, v_xaex, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lix,KxBi->KLB', X_abb, v_xaex, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('iKx,LxBi->KLB', X_bab, v_xaex, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('iLx,KxBi->KLB', X_bab, v_xaex, optimize = einsum_type)
            sigma_cce -= einsum('KLx,B,xB->KLB', X_aaa, e_extern, t1_ae, optimize = einsum_type)
            sigma_cce += einsum('KLx,xy,yB->KLB', X_aaa, h_aa, t1_ae, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('KLx,xyzB,zy->KLB', X_aaa, v_aaae, rdm_ca, optimize = einsum_type)
            sigma_cce -= einsum('KLx,yxzB,zy->KLB', X_aaa, v_aaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kjx,LyBj,xy->KLB', X_aaa, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kjx,LyjB,xy->KLB', X_aaa, v_xaxe, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Ljx,KyBj,xy->KLB', X_aaa, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Ljx,KyjB,xy->KLB', X_aaa, v_xaxe, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/4 * einsum('Kjx,LyBj,xy->KLB', X_abb, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/4 * einsum('Ljx,KyBj,xy->KLB', X_abb, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/4 * einsum('iKx,LyBi,xy->KLB', X_bab, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/4 * einsum('iLx,KyBi,xy->KLB', X_bab, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cce -= einsum('KLx,B,xyBz,zy->KLB', X_aaa, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('KLx,B,yxBz,zy->KLB', X_aaa, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce += einsum('KLx,xy,yzBw,wz->KLB', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KLx,xy,zyBw,wz->KLB', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('KLx,yz,wxBy,zw->KLB', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= einsum('KLx,yz,xwBy,zw->KLB', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce += einsum('KLx,yz,xyBw,zw->KLB', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KLx,yz,yxBw,zw->KLB', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce += einsum('KLx,xyBz,ywuv,zwuv->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= einsum('KLx,xyBz,zwuv,ywuv->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KLx,yB,xzwy,zw->KLB', X_aaa, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += einsum('KLx,yB,xzyw,zw->KLB', X_aaa, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KLx,yxBz,ywuv,zwuv->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('KLx,yxBz,zwuv,ywuv->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KLx,yzBw,xuvy,wvzu->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KLx,yzBw,xuvz,wvuy->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += einsum('KLx,yzBw,xuyv,wvzu->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += einsum('KLx,yzBw,xuyz,wu->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KLx,yzBw,xuzv,wvyu->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KLx,yzBw,xuzy,wu->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('KLx,yzBw,xwuv,yzuv->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma[s_cce__aaa:f_cce__aaa] += sigma_cce[cvs_tril_ind[0], cvs_tril_ind[1]].reshape(-1).copy()

            sigma_cce =- einsum('Kix,LxBi->KLB', X_aaa, v_xaex, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KLx,xB->KLB', X_abb, h_ae, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kix,LxBi->KLB', X_abb, v_xaex, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kix,LxiB->KLB', X_abb, v_xaxe, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('iLx,KxiB->KLB', X_abb, v_xaxe, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LKx,xB->KLB', X_bab, h_ae, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lix,KxiB->KLB', X_bab, v_xaxe, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('iKx,LxBi->KLB', X_bab, v_xaex, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('iKx,LxiB->KLB', X_bab, v_xaxe, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kjx,LyBj,xy->KLB', X_aaa, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KLx,B,xB->KLB', X_abb, e_extern, t1_ae, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('KLx,xy,yB->KLB', X_abb, h_aa, t1_ae, optimize = einsum_type)
            sigma_cce += 1/4 * einsum('KLx,xyzB,zy->KLB', X_abb, v_aaae, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KLx,yxzB,zy->KLB', X_abb, v_aaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/4 * einsum('Kjx,LyBj,xy->KLB', X_abb, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/4 * einsum('Kjx,LyjB,xy->KLB', X_abb, v_xaxe, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/4 * einsum('iLx,KyiB,xy->KLB', X_abb, v_xaxe, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LKx,B,xB->KLB', X_bab, e_extern, t1_ae, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('LKx,xy,yB->KLB', X_bab, h_aa, t1_ae, optimize = einsum_type)
            sigma_cce -= 1/4 * einsum('LKx,xyzB,zy->KLB', X_bab, v_aaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LKx,yxzB,zy->KLB', X_bab, v_aaae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/4 * einsum('Ljx,KyjB,xy->KLB', X_bab, v_xaxe, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/4 * einsum('iKx,LyBi,xy->KLB', X_bab, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/4 * einsum('iKx,LyiB,xy->KLB', X_bab, v_xaxe, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KLx,B,xyBz,zy->KLB', X_abb, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/4 * einsum('KLx,B,yxBz,zy->KLB', X_abb, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('KLx,xy,yzBw,wz->KLB', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/4 * einsum('KLx,xy,zyBw,wz->KLB', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/4 * einsum('KLx,yz,wxBy,zw->KLB', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KLx,yz,xwBy,zw->KLB', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('KLx,yz,xyBw,zw->KLB', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/4 * einsum('KLx,yz,yxBw,zw->KLB', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('KLx,xyBz,ywuv,zwuv->KLB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KLx,xyBz,zwuv,ywuv->KLB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/4 * einsum('KLx,yB,xzwy,zw->KLB', X_abb, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('KLx,yB,xzyw,zw->KLB', X_abb, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/4 * einsum('KLx,yxBz,ywuv,zwuv->KLB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/4 * einsum('KLx,yxBz,zwuv,ywuv->KLB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/4 * einsum('KLx,yzBw,xuvy,wvzu->KLB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/4 * einsum('KLx,yzBw,xuvz,wvuy->KLB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('KLx,yzBw,xuyv,wvzu->KLB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('KLx,yzBw,xuyz,wu->KLB', X_abb, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/4 * einsum('KLx,yzBw,xuzv,wvyu->KLB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/4 * einsum('KLx,yzBw,xuzy,wu->KLB', X_abb, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/4 * einsum('KLx,yzBw,xwuv,yzuv->KLB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LKx,B,xyBz,zy->KLB', X_bab, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/4 * einsum('LKx,B,yxBz,zy->KLB', X_bab, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('LKx,xy,yzBw,wz->KLB', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/4 * einsum('LKx,xy,zyBw,wz->KLB', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/4 * einsum('LKx,yz,wxBy,zw->KLB', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LKx,yz,xwBy,zw->KLB', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('LKx,yz,xyBw,zw->KLB', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/4 * einsum('LKx,yz,yxBw,zw->KLB', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('LKx,xyBz,ywuv,zwuv->KLB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LKx,xyBz,zwuv,ywuv->KLB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/4 * einsum('LKx,yB,xzwy,zw->KLB', X_bab, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('LKx,yB,xzyw,zw->KLB', X_bab, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/4 * einsum('LKx,yxBz,ywuv,zwuv->KLB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/4 * einsum('LKx,yxBz,zwuv,ywuv->KLB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/4 * einsum('LKx,yzBw,xuvy,wvzu->KLB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/4 * einsum('LKx,yzBw,xuvz,wvuy->KLB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('LKx,yzBw,xuyv,wvzu->KLB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('LKx,yzBw,xuyz,wu->KLB', X_bab, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/4 * einsum('LKx,yzBw,xuzv,wvyu->KLB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/4 * einsum('LKx,yzBw,xuzy,wu->KLB', X_bab, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/4 * einsum('LKx,yzBw,xwuv,yzuv->KLB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma[s_cce__abb:f_cce__abb] += sigma_cce.reshape(-1).copy()

            # CVE <- CCA
            if nval > 0:
                sigma_cve =- einsum('Kix,LxBi->KLB', X_aaa, v_vaex, optimize = einsum_type)
                sigma_cve += einsum('Kix,LxiB->KLB', X_aaa, v_vaxe, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kix,LxBi->KLB', X_abb, v_vaex, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('iKx,LxBi->KLB', X_bab, v_vaex, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kjx,LyBj,xy->KLB', X_aaa, v_vaex, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kjx,LyjB,xy->KLB', X_aaa, v_vaxe, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/4 * einsum('Kjx,LyBj,xy->KLB', X_abb, v_vaex, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/4 * einsum('iKx,LyBi,xy->KLB', X_bab, v_vaex, rdm_ca, optimize = einsum_type)
                sigma[s_cve__aaa:f_cve__aaa] += sigma_cve.reshape(-1).copy()

                sigma_cve =- einsum('Kix,LxBi->KLB', X_aaa, v_vaex, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kix,LxBi->KLB', X_abb, v_vaex, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kix,LxiB->KLB', X_abb, v_vaxe, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('iKx,LxBi->KLB', X_bab, v_vaex, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('iKx,LxiB->KLB', X_bab, v_vaxe, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kjx,LyBj,xy->KLB', X_aaa, v_vaex, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/4 * einsum('Kjx,LyBj,xy->KLB', X_abb, v_vaex, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/4 * einsum('Kjx,LyjB,xy->KLB', X_abb, v_vaxe, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/4 * einsum('iKx,LyBi,xy->KLB', X_bab, v_vaex, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/4 * einsum('iKx,LyiB,xy->KLB', X_bab, v_vaxe, rdm_ca, optimize = einsum_type)
                sigma[s_cve__abb:f_cve__abb] += sigma_cve.reshape(-1).copy()

                sigma_cve =- 1/2 * einsum('iKx,LxiB->KLB', X_abb, v_vaxe, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kix,LxiB->KLB', X_bab, v_vaxe, optimize = einsum_type)
                sigma_cve += 1/4 * einsum('iKx,LyiB,xy->KLB', X_abb, v_vaxe, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/4 * einsum('Kjx,LyjB,xy->KLB', X_bab, v_vaxe, rdm_ca, optimize = einsum_type)
                sigma[s_cve__bab:f_cve__bab] += sigma_cve.reshape(-1).copy()

        # CAE <- CCA
        if nextern > 0:
            sigma_cae =- 1/2 * einsum('Kix,iBxy,Zy->KZB', X_aaa, v_xeaa, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kix,iByx,Zy->KZB', X_aaa, v_xeaa, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kjx,jByz,Zxyz->KZB', X_aaa, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kjx,jByz,Zxzy->KZB', X_aaa, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('Kix,iBxy,Zy->KZB', X_abb, v_xeaa, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kjx,jByz,Zxyz->KZB', X_abb, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kjx,jByz,Zxzy->KZB', X_abb, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('iKx,iBxy,Zy->KZB', X_bab, v_xeaa, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('iKx,iByz,Zxyz->KZB', X_bab, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('iKx,iByz,Zxzy->KZB', X_bab, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma[s_cae__aaa:f_cae__aaa] += sigma_cae.reshape(-1).copy()

            sigma_cae =- 1/2 * einsum('Kix,iBxy,Zy->KZB', X_aaa, v_xeaa, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kjx,jByz,Zxyz->KZB', X_aaa, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kjx,jByz,Zxzy->KZB', X_aaa, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('Kix,iBxy,Zy->KZB', X_abb, v_xeaa, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('Kix,iByx,Zy->KZB', X_abb, v_xeaa, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kjx,jByz,Zxyz->KZB', X_abb, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('Kjx,jByz,Zxzy->KZB', X_abb, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('iKx,iBxy,Zy->KZB', X_bab, v_xeaa, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('iKx,iByx,Zy->KZB', X_bab, v_xeaa, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('iKx,iByz,Zxyz->KZB', X_bab, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('iKx,iByz,Zxzy->KZB', X_bab, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma[s_cae__abb:f_cae__abb] += sigma_cae.reshape(-1).copy()

            sigma_cae =- 1/4 * einsum('iKx,iByx,Zy->KZB', X_abb, v_xeaa, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('iKx,iByz,Zxyz->KZB', X_abb, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('iKx,iByz,Zxzy->KZB', X_abb, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('Kix,iByx,Zy->KZB', X_bab, v_xeaa, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kjx,jByz,Zxyz->KZB', X_bab, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('Kjx,jByz,Zxzy->KZB', X_bab, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma[s_cae__bab:f_cae__bab] += sigma_cae.reshape(-1).copy()

        # * <- CVA
        if nval > 0:
            X_aaa = Xt[s_cva__aaa:f_cva__aaa].reshape(ncvs, nval, ncas).copy()
            X_abb = Xt[s_cva__abb:f_cva__abb].reshape(ncvs, nval, ncas).copy()
            X_bab = Xt[s_cva__bab:f_cva__bab].reshape(ncvs, nval, ncas).copy()

            # CAA <- CVA
            sigma_caa =- 1/2 * einsum('Kix,ix,WZ->KWZ', X_aaa, h_va, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,jx,Wx->KWZ', X_aaa, h_va, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jy,WxZy->KWZ', X_aaa, h_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jy,WxyZ->KWZ', X_aaa, h_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iZxy,Wy->KWZ', X_aaa, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iZyx,Wy->KWZ', X_aaa, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyxz,WyZz->KWZ', X_aaa, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzx,WyZz->KWZ', X_aaa, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzx,WyzZ->KWZ', X_aaa, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,jxyz,Wxyz->KWZ', X_aaa, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jZyz,Wxyz->KWZ', X_aaa, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jZyz,Wxzy->KWZ', X_aaa, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,ZzwWxy->KWZ', X_aaa, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,ZzwWyx->KWZ', X_aaa, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kjx,jyzw,ZzwxWy->KWZ', X_aaa, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,ZzwxyW->KWZ', X_aaa, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,ZzwyWx->KWZ', X_aaa, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,ZzwyxW->KWZ', X_aaa, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('ijZ,ijKx,Wx->KWZ', X_aaa, v_xvxa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('ijZ,jiKx,Wx->KWZ', X_aaa, v_vxxa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('ijx,ijKx,WZ->KWZ', X_aaa, v_xvxa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('ijx,ijKy,WxZy->KWZ', X_aaa, v_xvxa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('ijx,ijKy,WxyZ->KWZ', X_aaa, v_xvxa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('ijx,jiKx,WZ->KWZ', X_aaa, v_vxxa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('ijx,jiKy,WxZy->KWZ', X_aaa, v_vxxa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('ijx,jiKy,WxyZ->KWZ', X_aaa, v_vxxa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,ix,WZ->KWZ', X_abb, h_va, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kjx,jy,WxZy->KWZ', X_abb, h_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jy,WxyZ->KWZ', X_abb, h_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iZxy,Wy->KWZ', X_abb, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyxz,WyZz->KWZ', X_abb, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,iyzx,WyZz->KWZ', X_abb, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzx,WyzZ->KWZ', X_abb, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jZyz,Wxyz->KWZ', X_abb, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kjx,jZyz,Wxzy->KWZ', X_abb, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,jyzw,ZzwWxy->KWZ', X_abb, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,ZzwWyx->KWZ', X_abb, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,ZzwxWy->KWZ', X_abb, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,ZzwxyW->KWZ', X_abb, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,ZzwyWx->KWZ', X_abb, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,ZzwyxW->KWZ', X_abb, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('ijx,ijKx,WZ->KWZ', X_abb, v_xvxa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('ijx,ijKy,WxZy->KWZ', X_abb, v_xvxa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('ijx,ijKy,WxyZ->KWZ', X_abb, v_xvxa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('ijx,jiKx,WZ->KWZ', X_bab, v_vxxa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('ijx,jiKy,WxZy->KWZ', X_bab, v_vxxa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('ijx,jiKy,WxyZ->KWZ', X_bab, v_vxxa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,i,iZxy,Wy->KWZ', X_aaa, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,i,iZyx,Wy->KWZ', X_aaa, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,i,ix,WZ->KWZ', X_aaa, e_val, t1_va, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,i,iyxz,WyZz->KWZ', X_aaa, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,i,iyzx,WyZz->KWZ', X_aaa, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,i,iyzx,WyzZ->KWZ', X_aaa, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('KjZ,j,jx,Wx->KWZ', X_aaa, e_val, t1_va, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('KjZ,j,jxyz,Wxyz->KWZ', X_aaa, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,j,jZyz,Wxyz->KWZ', X_aaa, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,j,jZyz,Wxzy->KWZ', X_aaa, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,j,jy,WxZy->KWZ', X_aaa, e_val, t1_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,j,jy,WxyZ->KWZ', X_aaa, e_val, t1_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,j,jyzw,ZzwWxy->KWZ', X_aaa, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,j,jyzw,ZzwWyx->KWZ', X_aaa, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,j,jyzw,ZzwxWy->KWZ', X_aaa, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,j,jyzw,ZzwxyW->KWZ', X_aaa, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,j,jyzw,ZzwyWx->KWZ', X_aaa, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,j,jyzw,ZzwyxW->KWZ', X_aaa, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,Zy,iyxz,Wz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,Zy,iyzx,Wz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,xy,iZyz,Wz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,xy,iZzy,Wz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,xy,iy,WZ->KWZ', X_aaa, h_aa, t1_va, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,xy,izwy,WzZw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,xy,izwy,WzwZ->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,xy,izyw,WzZw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,yz,iZxy,Wz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,yz,iZyx,Wz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,yz,iwxy,WwZz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,yz,iwyx,WwZz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,yz,iwyx,WwzZ->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,yz,iywx,WzZw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,yz,iywx,WzwZ->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,yz,iyxw,WzZw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,xy,jx,Wy->KWZ', X_aaa, h_aa, t1_va, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('KjZ,xy,jxzw,Wyzw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,xy,jzwx,Wzwy->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,xy,jzxw,Wzyw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,Zy,jyzw,Wxwz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,Zy,jyzw,Wxzw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,yz,jZwy,Wxwz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,yz,jZwy,Wxzw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,yz,jZyw,Wxwz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,yz,jZyw,Wxzw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,yz,jwuy,ZzuWwx->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuWxw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuwWx->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuwxW->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuxWw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kjx,yz,jwuy,ZzuxwW->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,yz,jwyu,ZzuWxw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,yz,jwyu,ZzuxWw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,yz,jy,WxZz->KWZ', X_aaa, h_aa, t1_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,yz,jy,WxzZ->KWZ', X_aaa, h_aa, t1_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,yz,jywu,ZwuWxz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,yz,jywu,ZwuWzx->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,yz,jywu,ZwuxWz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,yz,jywu,ZwuxzW->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,yz,jywu,ZwuzWx->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,yz,jywu,ZwuzxW->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iZxy,yzwu,Wzwu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iZyx,yzwu,Wzwu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iZyz,xwuy,Wuwz->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iZyz,xwuy,Wuzw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iZyz,xwuz,Wuwy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iZyz,xwuz,Wuyw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iZyz,xwyu,Wuzw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iZyz,xwyz,Ww->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iZyz,xwzu,Wuyw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iZyz,xwzy,Ww->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iy,Zyxz,Wz->KWZ', X_aaa, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iy,Zyzx,Wz->KWZ', X_aaa, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iy,xzwy,WwZz->KWZ', X_aaa, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iy,xzwy,WwzZ->KWZ', X_aaa, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iy,xzyw,WwZz->KWZ', X_aaa, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iyxz,Zwuy,Wwuz->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iyxz,Zwyu,Wwzu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyxz,Zzwu,Wywu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,iyxz,ywuv,ZzwWuv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwWvu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwuWv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwuvW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwvWu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwvuW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvWwy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,iyxz,zwuv,ZuvWyw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvwWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvwyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvyWw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvywW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyzw,Zuxy,Wuzw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,Zuyx,Wuwz->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,Zuyx,Wuzw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,Zwux,Wyuz->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,Zwux,Wyzu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iyzw,Zwxu,Wyzu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyzw,Zzux,Wyuw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iyzw,Zzxu,Wyuw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kix,iyzw,xuvw,ZzuWvy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuWyv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kix,iyzw,xuvw,ZzuvWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuvyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuyWv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuyvW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuvz,ZwuWyv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuvz,ZwuvyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuwv,ZzuWyv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwv,ZzuyWv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuwz,WyZu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwz,WyuZ->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuWvy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,iyzw,xuzv,ZwuWyv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuvWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuvyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuyWv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuyvW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyzw,xuzw,WyZu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kix,iyzw,xyuv,ZzwWuv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzw,xyuv,ZzwWvu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kix,iyzw,xyuv,ZzwuWv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzw,xyuv,ZzwuvW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzw,xyuv,ZzwvWu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzw,xyuv,ZzwvuW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzx,Zwuy,Wwuz->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzx,Zwuy,Wwzu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyzx,Zwyu,Wwzu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzx,Zzwu,Wyuw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzx,Zzwu,Wywu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kix,iyzx,ywuv,ZzwWuv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzx,ywuv,ZzwWvu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kix,iyzx,ywuv,ZzwuWv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzx,ywuv,ZzwuvW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzx,ywuv,ZzwvWu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzx,ywuv,ZzwvuW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kix,iyzx,zwuv,ZuvWwy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kix,iyzx,zwuv,ZuvWyw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kix,iyzx,zwuv,ZuvwWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kix,iyzx,zwuv,ZuvwyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kix,iyzx,zwuv,ZuvyWw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kix,iyzx,zwuv,ZuvywW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,jx,xyzw,Wyzw->KWZ', X_aaa, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 11/24 * einsum('KjZ,jxyz,xwuv,yzwWuv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('KjZ,jxyz,xwuv,yzwWvu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('KjZ,jxyz,xwuv,yzwuWv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('KjZ,jxyz,xwuv,yzwuvW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('KjZ,jxyz,xwuv,yzwvWu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('KjZ,jxyz,xwuv,yzwvuW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('KjZ,jxyz,ywuv,zuvWwx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('KjZ,jxyz,ywuv,zuvWxw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('KjZ,jxyz,ywuv,zuvwWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('KjZ,jxyz,ywuv,zuvwxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('KjZ,jxyz,ywuv,zuvxWw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('KjZ,jxyz,ywuv,zuvxwW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,jxyz,yzwu,Wxwu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,jxyz,zwuv,yuvWxw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jZyz,ywuv,zuvWwx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,jZyz,ywuv,zuvWxw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jZyz,ywuv,zuvwWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jZyz,ywuv,zuvwxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jZyz,ywuv,zuvxWw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jZyz,ywuv,zuvxwW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jZyz,yzwu,Wxuw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jZyz,yzwu,Wxwu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jZyz,zwuv,yuvWwx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kjx,jZyz,zwuv,yuvWxw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jZyz,zwuv,yuvwWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jZyz,zwuv,yuvwxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jZyz,zwuv,yuvxWw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jZyz,zwuv,yuvxwW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jy,Zyzw,Wxwz->KWZ', X_aaa, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jy,Zyzw,Wxzw->KWZ', X_aaa, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jy,yzwu,ZwuWxz->KWZ', X_aaa, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jy,yzwu,ZwuWzx->KWZ', X_aaa, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kjx,jy,yzwu,ZwuxWz->KWZ', X_aaa, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jy,yzwu,ZwuxzW->KWZ', X_aaa, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jy,yzwu,ZwuzWx->KWZ', X_aaa, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jy,yzwu,ZwuzxW->KWZ', X_aaa, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,jyzw,Zuvy,zwvWux->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,Zuvy,zwvWxu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,Zuvy,zwvuWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,Zuvy,zwvuxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,Zuvy,zwvxWu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,Zuvy,zwvxuW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jyzw,Zuyv,zwvWxu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jyzw,Zuyv,zwvxWu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kjx,jyzw,Zwuv,zuvWxy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvWyx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,Zwuv,zuvxWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvxyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvyWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvyxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jyzw,Zzuv,wuvyWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jyzw,Zzuv,wuvyxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/15 * einsum('Kjx,jyzw,wuvs,ZzvsWuxy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/30 * einsum('Kjx,jyzw,wuvs,ZzvsWuyx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 11/120 * einsum('Kjx,jyzw,wuvs,ZzvsWxuy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/40 * einsum('Kjx,jyzw,wuvs,ZzvsWxyu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/120 * einsum('Kjx,jyzw,wuvs,ZzvsWyux->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/40 * einsum('Kjx,jyzw,wuvs,ZzvsWyxu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,wuvs,ZzvsuWxy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/120 * einsum('Kjx,jyzw,wuvs,ZzvsuWyx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/20 * einsum('Kjx,jyzw,wuvs,ZzvsuxWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/30 * einsum('Kjx,jyzw,wuvs,ZzvsuxyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/15 * einsum('Kjx,jyzw,wuvs,ZzvsuyWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,jyzw,wuvs,ZzvsuyxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,wuvs,ZzvsxWuy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 11/120 * einsum('Kjx,jyzw,wuvs,ZzvsxWyu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/120 * einsum('Kjx,jyzw,wuvs,ZzvsxuWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,jyzw,wuvs,ZzvsxuyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jyzw,wuvs,ZzvsxyuW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/30 * einsum('Kjx,jyzw,wuvs,ZzvsyWux->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kjx,jyzw,wuvs,ZzvsyWxu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/15 * einsum('Kjx,jyzw,wuvs,ZzvsyuWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,jyzw,wuvs,ZzvsyuxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 29/120 * einsum('Kjx,jyzw,wuvs,ZzvsyxWu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/40 * einsum('Kjx,jyzw,wuvs,ZzvsyxuW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,jyzw,yuvs,ZzwuWsvx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kjx,jyzw,yuvs,ZzwuWsxv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kjx,jyzw,yuvs,ZzwuWvsx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kjx,jyzw,yuvs,ZzwuWxsv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/20 * einsum('Kjx,jyzw,yuvs,ZzwusWvx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/60 * einsum('Kjx,jyzw,yuvs,ZzwusWxv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,yuvs,ZzwusvWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/40 * einsum('Kjx,jyzw,yuvs,ZzwusvxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/120 * einsum('Kjx,jyzw,yuvs,ZzwusxWv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/120 * einsum('Kjx,jyzw,yuvs,ZzwusxvW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,yuvs,ZzwuvWsx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/120 * einsum('Kjx,jyzw,yuvs,ZzwuvWxs->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/10 * einsum('Kjx,jyzw,yuvs,ZzwuvsWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 2/15 * einsum('Kjx,jyzw,yuvs,ZzwuvsxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kjx,jyzw,yuvs,ZzwuvxWs->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/10 * einsum('Kjx,jyzw,yuvs,ZzwuvxsW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 2/15 * einsum('Kjx,jyzw,yuvs,ZzwuxWsv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/60 * einsum('Kjx,jyzw,yuvs,ZzwuxWvs->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 23/120 * einsum('Kjx,jyzw,yuvs,ZzwuxsWv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 11/120 * einsum('Kjx,jyzw,yuvs,ZzwuxsvW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 17/120 * einsum('Kjx,jyzw,yuvs,ZzwuxvWs->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 9/40 * einsum('Kjx,jyzw,yuvs,ZzwuxvsW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/60 * einsum('Kjx,jyzw,zuvs,ZwvsWuxy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,zuvs,ZwvsWxuy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 7/120 * einsum('Kjx,jyzw,zuvs,ZwvsWxyu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kjx,jyzw,zuvs,ZwvsuWxy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/15 * einsum('Kjx,jyzw,zuvs,ZwvsuWyx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,jyzw,zuvs,ZwvsuxWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/120 * einsum('Kjx,jyzw,zuvs,ZwvsuxyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,jyzw,zuvs,ZwvsuyWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/40 * einsum('Kjx,jyzw,zuvs,ZwvsxWuy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 13/120 * einsum('Kjx,jyzw,zuvs,ZwvsxWyu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 9/40 * einsum('Kjx,jyzw,zuvs,ZwvsxuWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,zuvs,ZwvsxuyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,zuvs,ZwvsxyWu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,zuvs,ZwvsxyuW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,zuvs,ZwvsyWux->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,zuvs,ZwvsyWxu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/40 * einsum('Kjx,jyzw,zuvs,ZwvsyuWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 23/120 * einsum('Kjx,jyzw,zuvs,ZwvsyuxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/60 * einsum('Kjx,jyzw,zuvs,ZwvsyxWu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/10 * einsum('Kjx,jyzw,zuvs,ZwvsyxuW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,zwuv,ZuvWxy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,zwuv,ZuvWyx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kjx,jyzw,zwuv,ZuvxWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,zwuv,ZuvxyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,zwuv,ZuvyWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,zwuv,ZuvyxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,i,iZxy,Wy->KWZ', X_abb, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,i,ix,WZ->KWZ', X_abb, e_val, t1_va, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,i,iyxz,WyZz->KWZ', X_abb, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,i,iyzx,WyZz->KWZ', X_abb, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,i,iyzx,WyzZ->KWZ', X_abb, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,j,jZyz,Wxyz->KWZ', X_abb, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kjx,j,jZyz,Wxzy->KWZ', X_abb, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kjx,j,jy,WxZy->KWZ', X_abb, e_val, t1_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,j,jy,WxyZ->KWZ', X_abb, e_val, t1_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kjx,j,jyzw,ZzwWxy->KWZ', X_abb, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,j,jyzw,ZzwWyx->KWZ', X_abb, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,j,jyzw,ZzwxWy->KWZ', X_abb, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,j,jyzw,ZzwxyW->KWZ', X_abb, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,j,jyzw,ZzwyWx->KWZ', X_abb, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,j,jyzw,ZzwyxW->KWZ', X_abb, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,Zy,iyxz,Wz->KWZ', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,xy,iZyz,Wz->KWZ', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,xy,iy,WZ->KWZ', X_abb, h_aa, t1_va, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,xy,izwy,WzZw->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,xy,izwy,WzwZ->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,xy,izyw,WzZw->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,yz,iZxy,Wz->KWZ', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,yz,iwxy,WwZz->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,yz,iwyx,WwZz->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,yz,iwyx,WwzZ->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,yz,iywx,WzZw->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,yz,iywx,WzwZ->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,yz,iyxw,WzZw->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kjx,Zy,jyzw,Wxwz->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,Zy,jyzw,Wxzw->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,yz,jZwy,Wxwz->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kjx,yz,jZwy,Wxzw->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kjx,yz,jZyw,Wxwz->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,yz,jZyw,Wxzw->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kjx,yz,jwuy,ZzuWwx->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuWxw->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuwWx->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuwxW->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuxWw->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,yz,jwuy,ZzuxwW->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,yz,jwyu,ZzuWwx->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,yz,jwyu,ZzuWxw->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,yz,jwyu,ZzuwWx->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,yz,jwyu,ZzuwxW->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,yz,jwyu,ZzuxwW->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kjx,yz,jy,WxZz->KWZ', X_abb, h_aa, t1_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,yz,jy,WxzZ->KWZ', X_abb, h_aa, t1_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kjx,yz,jywu,ZwuWxz->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,yz,jywu,ZwuWzx->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,yz,jywu,ZwuxWz->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,yz,jywu,ZwuxzW->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,yz,jywu,ZwuzWx->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,yz,jywu,ZwuzxW->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iZxy,yzwu,Wzwu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iZyz,xwuy,Wuwz->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,iZyz,xwuy,Wuzw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,iZyz,xwuz,Wuwy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iZyz,xwuz,Wuyw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iZyz,xwyu,Wuzw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iZyz,xwyz,Ww->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iy,Zyzx,Wz->KWZ', X_abb, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,iy,xzwy,WwZz->KWZ', X_abb, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iy,xzwy,WwzZ->KWZ', X_abb, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iy,xzyw,WwZz->KWZ', X_abb, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iyxz,Zwuy,Wwuz->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iyxz,Zwyu,Wwzu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyxz,Zzwu,Wywu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,iyxz,ywuv,ZzwWuv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwWvu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwuWv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwuvW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwvWu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwvuW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvWwy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,iyxz,zwuv,ZuvWyw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvwWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvwyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvyWw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvywW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,iyzw,Zuyx,Wuwz->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,Zuyx,Wuzw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,iyzw,Zwux,Wyuz->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,Zwux,Wyzu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyzw,Zzux,Wyuw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kix,iyzw,xuvw,ZzuWvy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuWyv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kix,iyzw,xuvw,ZzuvWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuvyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuyWv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuyvW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuvz,ZwuWvy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuvz,ZwuWyv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuvz,ZwuvWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuvz,ZwuyWv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuvz,ZwuyvW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwv,ZzuWvy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuwv,ZzuWyv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwv,ZzuvWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwv,ZzuvyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwv,ZzuyvW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,iyzw,xuwz,WyZu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuwz,WyuZ->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuWvy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,iyzw,xuzv,ZwuWyv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuvWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuvyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuyWv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuyvW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyzw,xuzw,WyZu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kix,iyzw,xyuv,ZzwWuv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kix,iyzw,xyuv,ZzwWvu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kix,iyzw,xyuv,ZzwuWv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kix,iyzw,xyuv,ZzwuvW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kix,iyzw,xyuv,ZzwvWu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kix,iyzw,xyuv,ZzwvuW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,iyzx,Zwuy,Wwuz->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzx,Zwuy,Wwzu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzx,Zzwu,Wyuw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,iyzx,Zzwu,Wywu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kix,iyzx,ywuv,ZzwWuv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kix,iyzx,ywuv,ZzwWvu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kix,iyzx,ywuv,ZzwuWv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kix,iyzx,ywuv,ZzwuvW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kix,iyzx,ywuv,ZzwvWu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kix,iyzx,ywuv,ZzwvuW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kix,iyzx,zwuv,ZuvWwy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kix,iyzx,zwuv,ZuvWyw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kix,iyzx,zwuv,ZuvwWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kix,iyzx,zwuv,ZuvwyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzx,zwuv,ZuvyWw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kix,iyzx,zwuv,ZuvywW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jZyz,ywuv,zuvWwx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 7/24 * einsum('Kjx,jZyz,ywuv,zuvWxw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jZyz,ywuv,zuvwWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jZyz,ywuv,zuvwxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jZyz,ywuv,zuvxWw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jZyz,ywuv,zuvxwW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kjx,jZyz,yzwu,Wxuw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jZyz,yzwu,Wxwu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jZyz,zwuv,yuvWwx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jZyz,zwuv,yuvWxw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jZyz,zwuv,yuvwWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jZyz,zwuv,yuvwxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,jZyz,zwuv,yuvxWw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jZyz,zwuv,yuvxwW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jy,Zyzw,Wxwz->KWZ', X_abb, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kjx,jy,Zyzw,Wxzw->KWZ', X_abb, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,jy,yzwu,ZwuWxz->KWZ', X_abb, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jy,yzwu,ZwuWzx->KWZ', X_abb, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jy,yzwu,ZwuxWz->KWZ', X_abb, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jy,yzwu,ZwuxzW->KWZ', X_abb, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jy,yzwu,ZwuzWx->KWZ', X_abb, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jy,yzwu,ZwuzxW->KWZ', X_abb, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zuvy,zwvWux->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,Zuvy,zwvWxu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,Zuvy,zwvuWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,Zuvy,zwvuxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,Zuvy,zwvxWu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kjx,jyzw,Zuvy,zwvxuW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,jyzw,Zuyv,zwvWux->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,jyzw,Zuyv,zwvWxu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,jyzw,Zuyv,zwvuWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,jyzw,Zuyv,zwvuxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kjx,jyzw,Zuyv,zwvxWu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,jyzw,Zuyv,zwvxuW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,Zwuv,zuvWxy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvWyx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 7/24 * einsum('Kjx,jyzw,Zwuv,zuvxWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvxyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvyWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvyxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jyzw,Zzuv,wuvWxy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jyzw,Zzuv,wuvWyx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jyzw,Zzuv,wuvxWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jyzw,Zzuv,wuvxyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jyzw,Zzuv,wuvyWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/30 * einsum('Kjx,jyzw,wuvs,ZzvsWuxy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/60 * einsum('Kjx,jyzw,wuvs,ZzvsWuyx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/20 * einsum('Kjx,jyzw,wuvs,ZzvsWxuy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/10 * einsum('Kjx,jyzw,wuvs,ZzvsWxyu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/30 * einsum('Kjx,jyzw,wuvs,ZzvsWyux->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/30 * einsum('Kjx,jyzw,wuvs,ZzvsWyxu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/120 * einsum('Kjx,jyzw,wuvs,ZzvsuWxy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/40 * einsum('Kjx,jyzw,wuvs,ZzvsuWyx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/10 * einsum('Kjx,jyzw,wuvs,ZzvsuxWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/20 * einsum('Kjx,jyzw,wuvs,ZzvsuxyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,jyzw,wuvs,ZzvsuyWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/20 * einsum('Kjx,jyzw,wuvs,ZzvsuyxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/60 * einsum('Kjx,jyzw,wuvs,ZzvsxWuy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/10 * einsum('Kjx,jyzw,wuvs,ZzvsxWyu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/120 * einsum('Kjx,jyzw,wuvs,ZzvsxuWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/120 * einsum('Kjx,jyzw,wuvs,ZzvsxuyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,wuvs,ZzvsxyWu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/40 * einsum('Kjx,jyzw,wuvs,ZzvsxyuW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/120 * einsum('Kjx,jyzw,wuvs,ZzvsyWux->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/40 * einsum('Kjx,jyzw,wuvs,ZzvsyWxu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,jyzw,wuvs,ZzvsyuWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/20 * einsum('Kjx,jyzw,wuvs,ZzvsyuxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jyzw,wuvs,ZzvsyxWu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 2/15 * einsum('Kjx,jyzw,wuvs,ZzvsyxuW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 19/120 * einsum('Kjx,jyzw,yuvs,ZzwuWsvx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/30 * einsum('Kjx,jyzw,yuvs,ZzwuWsxv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 19/120 * einsum('Kjx,jyzw,yuvs,ZzwuWvsx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kjx,jyzw,yuvs,ZzwuWvxs->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 29/120 * einsum('Kjx,jyzw,yuvs,ZzwusWvx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/20 * einsum('Kjx,jyzw,yuvs,ZzwusWxv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/5 * einsum('Kjx,jyzw,yuvs,ZzwusvWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,yuvs,ZzwusvxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,yuvs,ZzwusxWv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 9/40 * einsum('Kjx,jyzw,yuvs,ZzwusxvW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,jyzw,yuvs,ZzwuvWsx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/120 * einsum('Kjx,jyzw,yuvs,ZzwuvWxs->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kjx,jyzw,yuvs,ZzwuvsWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 2/15 * einsum('Kjx,jyzw,yuvs,ZzwuvsxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/30 * einsum('Kjx,jyzw,yuvs,ZzwuvxWs->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/10 * einsum('Kjx,jyzw,yuvs,ZzwuvxsW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/15 * einsum('Kjx,jyzw,yuvs,ZzwuxWsv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/10 * einsum('Kjx,jyzw,yuvs,ZzwuxWvs->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 23/120 * einsum('Kjx,jyzw,yuvs,ZzwuxsWv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/40 * einsum('Kjx,jyzw,yuvs,ZzwuxsvW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 7/40 * einsum('Kjx,jyzw,yuvs,ZzwuxvWs->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 29/120 * einsum('Kjx,jyzw,yuvs,ZzwuxvsW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/15 * einsum('Kjx,jyzw,zuvs,ZwvsWuyx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 17/120 * einsum('Kjx,jyzw,zuvs,ZwvsWxuy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,zuvs,ZwvsWxyu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kjx,jyzw,zuvs,ZwvsuWxy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/60 * einsum('Kjx,jyzw,zuvs,ZwvsuWyx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/60 * einsum('Kjx,jyzw,zuvs,ZwvsuxWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/30 * einsum('Kjx,jyzw,zuvs,ZwvsuxyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/40 * einsum('Kjx,jyzw,zuvs,ZwvsuyWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/40 * einsum('Kjx,jyzw,zuvs,ZwvsuyxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/40 * einsum('Kjx,jyzw,zuvs,ZwvsxWuy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 23/120 * einsum('Kjx,jyzw,zuvs,ZwvsxWyu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/10 * einsum('Kjx,jyzw,zuvs,ZwvsxuWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/60 * einsum('Kjx,jyzw,zuvs,ZwvsxuyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/15 * einsum('Kjx,jyzw,zuvs,ZwvsxyWu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/20 * einsum('Kjx,jyzw,zuvs,ZwvsxyuW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,jyzw,zuvs,ZwvsyWux->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,zuvs,ZwvsyWxu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/30 * einsum('Kjx,jyzw,zuvs,ZwvsyuWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 17/60 * einsum('Kjx,jyzw,zuvs,ZwvsyuxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,zuvs,ZwvsyxWu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 17/40 * einsum('Kjx,jyzw,zuvs,ZwvsyxuW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,jyzw,zwuv,ZuvWxy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,zwuv,ZuvWyx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,zwuv,ZuvxWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,zwuv,ZuvxyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,zwuv,ZuvyWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,zwuv,ZuvyxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma[s_caa__aaa:f_caa__aaa] += sigma_caa.reshape(-1).copy()

            sigma_caa =- 1/2 * einsum('Kix,ix,WZ->KWZ', X_aaa, h_va, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kjx,jy,WxZy->KWZ', X_aaa, h_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jy,WxyZ->KWZ', X_aaa, h_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iZxy,Wy->KWZ', X_aaa, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyxz,WyZz->KWZ', X_aaa, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,iyzx,WyZz->KWZ', X_aaa, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzx,WyzZ->KWZ', X_aaa, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jZyz,Wxyz->KWZ', X_aaa, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kjx,jZyz,Wxzy->KWZ', X_aaa, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,jyzw,ZzwWxy->KWZ', X_aaa, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,ZzwWyx->KWZ', X_aaa, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,ZzwxWy->KWZ', X_aaa, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,ZzwxyW->KWZ', X_aaa, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,ZzwyWx->KWZ', X_aaa, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,ZzwyxW->KWZ', X_aaa, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('ijx,ijKx,WZ->KWZ', X_aaa, v_xvxa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('ijx,ijKy,WxZy->KWZ', X_aaa, v_xvxa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('ijx,ijKy,WxyZ->KWZ', X_aaa, v_xvxa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('ijx,jiKx,WZ->KWZ', X_aaa, v_vxxa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('ijx,jiKy,WxZy->KWZ', X_aaa, v_vxxa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('ijx,jiKy,WxyZ->KWZ', X_aaa, v_vxxa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,ix,WZ->KWZ', X_abb, h_va, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,jx,Wx->KWZ', X_abb, h_va, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jy,WxZy->KWZ', X_abb, h_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jy,WxyZ->KWZ', X_abb, h_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iZxy,Wy->KWZ', X_abb, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iZyx,Wy->KWZ', X_abb, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyxz,WyZz->KWZ', X_abb, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzx,WyZz->KWZ', X_abb, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzx,WyzZ->KWZ', X_abb, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,jxyz,Wxyz->KWZ', X_abb, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jZyz,Wxyz->KWZ', X_abb, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jZyz,Wxzy->KWZ', X_abb, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,ZzwWxy->KWZ', X_abb, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,ZzwWyx->KWZ', X_abb, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kjx,jyzw,ZzwxWy->KWZ', X_abb, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,ZzwxyW->KWZ', X_abb, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,ZzwyWx->KWZ', X_abb, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,ZzwyxW->KWZ', X_abb, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('ijZ,ijKx,Wx->KWZ', X_abb, v_xvxa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('ijx,ijKx,WZ->KWZ', X_abb, v_xvxa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('ijx,ijKy,WxZy->KWZ', X_abb, v_xvxa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('ijx,ijKy,WxyZ->KWZ', X_abb, v_xvxa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('ijZ,jiKx,Wx->KWZ', X_bab, v_vxxa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('ijx,jiKx,WZ->KWZ', X_bab, v_vxxa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('ijx,jiKy,WxZy->KWZ', X_bab, v_vxxa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('ijx,jiKy,WxyZ->KWZ', X_bab, v_vxxa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,i,iZxy,Wy->KWZ', X_aaa, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,i,ix,WZ->KWZ', X_aaa, e_val, t1_va, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,i,iyxz,WyZz->KWZ', X_aaa, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,i,iyzx,WyZz->KWZ', X_aaa, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,i,iyzx,WyzZ->KWZ', X_aaa, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,j,jZyz,Wxyz->KWZ', X_aaa, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kjx,j,jZyz,Wxzy->KWZ', X_aaa, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kjx,j,jy,WxZy->KWZ', X_aaa, e_val, t1_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,j,jy,WxyZ->KWZ', X_aaa, e_val, t1_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kjx,j,jyzw,ZzwWxy->KWZ', X_aaa, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,j,jyzw,ZzwWyx->KWZ', X_aaa, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,j,jyzw,ZzwxWy->KWZ', X_aaa, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,j,jyzw,ZzwxyW->KWZ', X_aaa, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,j,jyzw,ZzwyWx->KWZ', X_aaa, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,j,jyzw,ZzwyxW->KWZ', X_aaa, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,Zy,iyxz,Wz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,xy,iZyz,Wz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,xy,iy,WZ->KWZ', X_aaa, h_aa, t1_va, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,xy,izwy,WzZw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,xy,izwy,WzwZ->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,xy,izyw,WzZw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,yz,iZxy,Wz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,yz,iwxy,WwZz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,yz,iwyx,WwZz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,yz,iwyx,WwzZ->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,yz,iywx,WzZw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,yz,iywx,WzwZ->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,yz,iyxw,WzZw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kjx,Zy,jyzw,Wxwz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,Zy,jyzw,Wxzw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,yz,jZwy,Wxwz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kjx,yz,jZwy,Wxzw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kjx,yz,jZyw,Wxwz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,yz,jZyw,Wxzw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kjx,yz,jwuy,ZzuWwx->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuWxw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuwWx->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuwxW->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuxWw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,yz,jwuy,ZzuxwW->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,yz,jwyu,ZzuWwx->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,yz,jwyu,ZzuWxw->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,yz,jwyu,ZzuwWx->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,yz,jwyu,ZzuwxW->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,yz,jwyu,ZzuxwW->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kjx,yz,jy,WxZz->KWZ', X_aaa, h_aa, t1_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,yz,jy,WxzZ->KWZ', X_aaa, h_aa, t1_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kjx,yz,jywu,ZwuWxz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,yz,jywu,ZwuWzx->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,yz,jywu,ZwuxWz->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,yz,jywu,ZwuxzW->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,yz,jywu,ZwuzWx->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,yz,jywu,ZwuzxW->KWZ', X_aaa, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iZxy,yzwu,Wzwu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iZyz,xwuy,Wuwz->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,iZyz,xwuy,Wuzw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,iZyz,xwuz,Wuwy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iZyz,xwuz,Wuyw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iZyz,xwyu,Wuzw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iZyz,xwyz,Ww->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iy,Zyzx,Wz->KWZ', X_aaa, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,iy,xzwy,WwZz->KWZ', X_aaa, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iy,xzwy,WwzZ->KWZ', X_aaa, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iy,xzyw,WwZz->KWZ', X_aaa, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iyxz,Zwuy,Wwuz->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iyxz,Zwyu,Wwzu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyxz,Zzwu,Wywu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,iyxz,ywuv,ZzwWuv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwWvu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwuWv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwuvW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwvWu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwvuW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvWwy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,iyxz,zwuv,ZuvWyw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvwWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvwyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvyWw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvywW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,iyzw,Zuyx,Wuwz->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,Zuyx,Wuzw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,iyzw,Zwux,Wyuz->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,Zwux,Wyzu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyzw,Zzux,Wyuw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kix,iyzw,xuvw,ZzuWvy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuWyv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kix,iyzw,xuvw,ZzuvWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuvyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuyWv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuyvW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuvz,ZwuWvy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuvz,ZwuWyv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuvz,ZwuvWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuvz,ZwuyWv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuvz,ZwuyvW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwv,ZzuWvy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuwv,ZzuWyv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwv,ZzuvWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwv,ZzuvyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwv,ZzuyvW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,iyzw,xuwz,WyZu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuwz,WyuZ->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuWvy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,iyzw,xuzv,ZwuWyv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuvWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuvyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuyWv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuyvW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyzw,xuzw,WyZu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kix,iyzw,xyuv,ZzwWuv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kix,iyzw,xyuv,ZzwWvu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kix,iyzw,xyuv,ZzwuWv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kix,iyzw,xyuv,ZzwuvW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kix,iyzw,xyuv,ZzwvWu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kix,iyzw,xyuv,ZzwvuW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,iyzx,Zwuy,Wwuz->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzx,Zwuy,Wwzu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzx,Zzwu,Wyuw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,iyzx,Zzwu,Wywu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kix,iyzx,ywuv,ZzwWuv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kix,iyzx,ywuv,ZzwWvu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kix,iyzx,ywuv,ZzwuWv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kix,iyzx,ywuv,ZzwuvW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kix,iyzx,ywuv,ZzwvWu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kix,iyzx,ywuv,ZzwvuW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kix,iyzx,zwuv,ZuvWwy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kix,iyzx,zwuv,ZuvWyw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kix,iyzx,zwuv,ZuvwWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kix,iyzx,zwuv,ZuvwyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzx,zwuv,ZuvyWw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kix,iyzx,zwuv,ZuvywW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jZyz,ywuv,zuvWwx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 7/24 * einsum('Kjx,jZyz,ywuv,zuvWxw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jZyz,ywuv,zuvwWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jZyz,ywuv,zuvwxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jZyz,ywuv,zuvxWw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jZyz,ywuv,zuvxwW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kjx,jZyz,yzwu,Wxuw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jZyz,yzwu,Wxwu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jZyz,zwuv,yuvWwx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jZyz,zwuv,yuvWxw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jZyz,zwuv,yuvwWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jZyz,zwuv,yuvwxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,jZyz,zwuv,yuvxWw->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jZyz,zwuv,yuvxwW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jy,Zyzw,Wxwz->KWZ', X_aaa, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kjx,jy,Zyzw,Wxzw->KWZ', X_aaa, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,jy,yzwu,ZwuWxz->KWZ', X_aaa, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jy,yzwu,ZwuWzx->KWZ', X_aaa, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jy,yzwu,ZwuxWz->KWZ', X_aaa, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jy,yzwu,ZwuxzW->KWZ', X_aaa, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jy,yzwu,ZwuzWx->KWZ', X_aaa, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jy,yzwu,ZwuzxW->KWZ', X_aaa, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zuvy,zwvWux->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,Zuvy,zwvWxu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,Zuvy,zwvuWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,Zuvy,zwvuxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,Zuvy,zwvxWu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kjx,jyzw,Zuvy,zwvxuW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,jyzw,Zuyv,zwvWux->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,jyzw,Zuyv,zwvWxu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,jyzw,Zuyv,zwvuWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,jyzw,Zuyv,zwvuxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kjx,jyzw,Zuyv,zwvxWu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,jyzw,Zuyv,zwvxuW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,Zwuv,zuvWxy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvWyx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 7/24 * einsum('Kjx,jyzw,Zwuv,zuvxWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvxyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvyWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvyxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jyzw,Zzuv,wuvWxy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jyzw,Zzuv,wuvWyx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jyzw,Zzuv,wuvxWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jyzw,Zzuv,wuvxyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jyzw,Zzuv,wuvyWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,jyzw,wuvs,ZzvsWuxy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/15 * einsum('Kjx,jyzw,wuvs,ZzvsWuyx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/5 * einsum('Kjx,jyzw,wuvs,ZzvsWxuy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/10 * einsum('Kjx,jyzw,wuvs,ZzvsWxyu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kjx,jyzw,wuvs,ZzvsWyux->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/30 * einsum('Kjx,jyzw,wuvs,ZzvsWyxu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,wuvs,ZzvsuWxy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/40 * einsum('Kjx,jyzw,wuvs,ZzvsuWyx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kjx,jyzw,wuvs,ZzvsuxWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/20 * einsum('Kjx,jyzw,wuvs,ZzvsuxyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 2/15 * einsum('Kjx,jyzw,wuvs,ZzvsuyWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/20 * einsum('Kjx,jyzw,wuvs,ZzvsuyxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,jyzw,wuvs,ZzvsxWuy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/20 * einsum('Kjx,jyzw,wuvs,ZzvsxWyu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/120 * einsum('Kjx,jyzw,wuvs,ZzvsxuWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/120 * einsum('Kjx,jyzw,wuvs,ZzvsxuyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/120 * einsum('Kjx,jyzw,wuvs,ZzvsxyWu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/40 * einsum('Kjx,jyzw,wuvs,ZzvsxyuW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/120 * einsum('Kjx,jyzw,wuvs,ZzvsyWux->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/40 * einsum('Kjx,jyzw,wuvs,ZzvsyWxu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/60 * einsum('Kjx,jyzw,wuvs,ZzvsyuWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/10 * einsum('Kjx,jyzw,wuvs,ZzvsyuxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 7/60 * einsum('Kjx,jyzw,wuvs,ZzvsyxWu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 11/60 * einsum('Kjx,jyzw,wuvs,ZzvsyxuW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/60 * einsum('Kjx,jyzw,yuvs,ZzwuWsvx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 7/120 * einsum('Kjx,jyzw,yuvs,ZzwuWsxv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 2/15 * einsum('Kjx,jyzw,yuvs,ZzwuWvsx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kjx,jyzw,yuvs,ZzwuWvxs->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/40 * einsum('Kjx,jyzw,yuvs,ZzwuWxsv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jyzw,yuvs,ZzwusWvx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/40 * einsum('Kjx,jyzw,yuvs,ZzwusWxv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 7/40 * einsum('Kjx,jyzw,yuvs,ZzwusvWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,yuvs,ZzwusvxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/15 * einsum('Kjx,jyzw,yuvs,ZzwusxWv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 9/40 * einsum('Kjx,jyzw,yuvs,ZzwusxvW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 2/15 * einsum('Kjx,jyzw,yuvs,ZzwuvWsx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kjx,jyzw,yuvs,ZzwuvWxs->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 19/120 * einsum('Kjx,jyzw,yuvs,ZzwuvsWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 13/120 * einsum('Kjx,jyzw,yuvs,ZzwuvsxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/120 * einsum('Kjx,jyzw,yuvs,ZzwuvxWs->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/40 * einsum('Kjx,jyzw,yuvs,ZzwuvxsW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 7/60 * einsum('Kjx,jyzw,yuvs,ZzwuxWsv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/40 * einsum('Kjx,jyzw,yuvs,ZzwuxWvs->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 17/120 * einsum('Kjx,jyzw,yuvs,ZzwuxsWv->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/20 * einsum('Kjx,jyzw,yuvs,ZzwuxsvW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/10 * einsum('Kjx,jyzw,yuvs,ZzwuxvWs->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jyzw,yuvs,ZzwuxvsW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/40 * einsum('Kjx,jyzw,zuvs,ZwvsWuxy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/120 * einsum('Kjx,jyzw,zuvs,ZwvsWuyx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/60 * einsum('Kjx,jyzw,zuvs,ZwvsWxuy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/20 * einsum('Kjx,jyzw,zuvs,ZwvsWxyu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/40 * einsum('Kjx,jyzw,zuvs,ZwvsuWxy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/120 * einsum('Kjx,jyzw,zuvs,ZwvsuWyx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jyzw,zuvs,ZwvsuxWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/60 * einsum('Kjx,jyzw,zuvs,ZwvsuxyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kjx,jyzw,zuvs,ZwvsuyWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/5 * einsum('Kjx,jyzw,zuvs,ZwvsxWuy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jyzw,zuvs,ZwvsxWyu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/20 * einsum('Kjx,jyzw,zuvs,ZwvsxuWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jyzw,zuvs,ZwvsxuyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,zuvs,ZwvsxyWu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/40 * einsum('Kjx,jyzw,zuvs,ZwvsxyuW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,jyzw,zuvs,ZwvsyWux->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,zuvs,ZwvsyWxu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 19/120 * einsum('Kjx,jyzw,zuvs,ZwvsyuWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,jyzw,zuvs,ZwvsyuxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/60 * einsum('Kjx,jyzw,zuvs,ZwvsyxWu->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 2/5 * einsum('Kjx,jyzw,zuvs,ZwvsyxuW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,jyzw,zwuv,ZuvWxy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,zwuv,ZuvWyx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,zwuv,ZuvxWy->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,zwuv,ZuvxyW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,zwuv,ZuvyWx->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,zwuv,ZuvyxW->KWZ', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,i,iZxy,Wy->KWZ', X_abb, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,i,iZyx,Wy->KWZ', X_abb, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,i,ix,WZ->KWZ', X_abb, e_val, t1_va, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,i,iyxz,WyZz->KWZ', X_abb, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,i,iyzx,WyZz->KWZ', X_abb, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,i,iyzx,WyzZ->KWZ', X_abb, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('KjZ,j,jx,Wx->KWZ', X_abb, e_val, t1_va, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('KjZ,j,jxyz,Wxyz->KWZ', X_abb, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,j,jZyz,Wxyz->KWZ', X_abb, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,j,jZyz,Wxzy->KWZ', X_abb, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,j,jy,WxZy->KWZ', X_abb, e_val, t1_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,j,jy,WxyZ->KWZ', X_abb, e_val, t1_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,j,jyzw,ZzwWxy->KWZ', X_abb, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,j,jyzw,ZzwWyx->KWZ', X_abb, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,j,jyzw,ZzwxWy->KWZ', X_abb, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,j,jyzw,ZzwxyW->KWZ', X_abb, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,j,jyzw,ZzwyWx->KWZ', X_abb, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,j,jyzw,ZzwyxW->KWZ', X_abb, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,Zy,iyxz,Wz->KWZ', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,Zy,iyzx,Wz->KWZ', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,xy,iZyz,Wz->KWZ', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,xy,iZzy,Wz->KWZ', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,xy,iy,WZ->KWZ', X_abb, h_aa, t1_va, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,xy,izwy,WzZw->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,xy,izwy,WzwZ->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,xy,izyw,WzZw->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,yz,iZxy,Wz->KWZ', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,yz,iZyx,Wz->KWZ', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,yz,iwxy,WwZz->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,yz,iwyx,WwZz->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,yz,iwyx,WwzZ->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,yz,iywx,WzZw->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,yz,iywx,WzwZ->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,yz,iyxw,WzZw->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,xy,jx,Wy->KWZ', X_abb, h_aa, t1_va, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('KjZ,xy,jxzw,Wyzw->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,xy,jzwx,Wzwy->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,xy,jzxw,Wzyw->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,Zy,jyzw,Wxwz->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,Zy,jyzw,Wxzw->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,yz,jZwy,Wxwz->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,yz,jZwy,Wxzw->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,yz,jZyw,Wxwz->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,yz,jZyw,Wxzw->KWZ', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,yz,jwuy,ZzuWwx->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuWxw->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuwWx->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuwxW->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuxWw->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kjx,yz,jwuy,ZzuxwW->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,yz,jwyu,ZzuWxw->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,yz,jwyu,ZzuxWw->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,yz,jy,WxZz->KWZ', X_abb, h_aa, t1_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,yz,jy,WxzZ->KWZ', X_abb, h_aa, t1_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,yz,jywu,ZwuWxz->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,yz,jywu,ZwuWzx->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,yz,jywu,ZwuxWz->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,yz,jywu,ZwuxzW->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,yz,jywu,ZwuzWx->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,yz,jywu,ZwuzxW->KWZ', X_abb, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iZxy,yzwu,Wzwu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iZyx,yzwu,Wzwu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iZyz,xwuy,Wuwz->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iZyz,xwuy,Wuzw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iZyz,xwuz,Wuwy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iZyz,xwuz,Wuyw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iZyz,xwyu,Wuzw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iZyz,xwyz,Ww->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iZyz,xwzu,Wuyw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iZyz,xwzy,Ww->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iy,Zyxz,Wz->KWZ', X_abb, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iy,Zyzx,Wz->KWZ', X_abb, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iy,xzwy,WwZz->KWZ', X_abb, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iy,xzwy,WwzZ->KWZ', X_abb, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iy,xzyw,WwZz->KWZ', X_abb, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iyxz,Zwuy,Wwuz->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iyxz,Zwyu,Wwzu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyxz,Zzwu,Wywu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,iyxz,ywuv,ZzwWuv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwWvu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwuWv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwuvW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwvWu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyxz,ywuv,ZzwvuW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvWwy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,iyxz,zwuv,ZuvWyw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvwWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvwyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvyWw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyxz,zwuv,ZuvywW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyzw,Zuxy,Wuzw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,Zuyx,Wuwz->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,Zuyx,Wuzw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,Zwux,Wyuz->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,Zwux,Wyzu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iyzw,Zwxu,Wyzu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyzw,Zzux,Wyuw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iyzw,Zzxu,Wyuw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kix,iyzw,xuvw,ZzuWvy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuWyv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kix,iyzw,xuvw,ZzuvWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuvyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuyWv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuyvW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuvz,ZwuWyv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuvz,ZwuvyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuwv,ZzuWyv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwv,ZzuyWv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuwz,WyZu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwz,WyuZ->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuWvy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,iyzw,xuzv,ZwuWyv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuvWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuvyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuyWv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuzv,ZwuyvW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyzw,xuzw,WyZu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kix,iyzw,xyuv,ZzwWuv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzw,xyuv,ZzwWvu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kix,iyzw,xyuv,ZzwuWv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzw,xyuv,ZzwuvW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzw,xyuv,ZzwvWu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzw,xyuv,ZzwvuW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzx,Zwuy,Wwuz->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzx,Zwuy,Wwzu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyzx,Zwyu,Wwzu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzx,Zzwu,Wyuw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzx,Zzwu,Wywu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kix,iyzx,ywuv,ZzwWuv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzx,ywuv,ZzwWvu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kix,iyzx,ywuv,ZzwuWv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzx,ywuv,ZzwuvW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzx,ywuv,ZzwvWu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzx,ywuv,ZzwvuW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kix,iyzx,zwuv,ZuvWwy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kix,iyzx,zwuv,ZuvWyw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kix,iyzx,zwuv,ZuvwWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kix,iyzx,zwuv,ZuvwyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kix,iyzx,zwuv,ZuvyWw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kix,iyzx,zwuv,ZuvywW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,jx,xyzw,Wyzw->KWZ', X_abb, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 11/24 * einsum('KjZ,jxyz,xwuv,yzwWuv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('KjZ,jxyz,xwuv,yzwWvu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('KjZ,jxyz,xwuv,yzwuWv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('KjZ,jxyz,xwuv,yzwuvW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('KjZ,jxyz,xwuv,yzwvWu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('KjZ,jxyz,xwuv,yzwvuW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('KjZ,jxyz,ywuv,zuvWwx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('KjZ,jxyz,ywuv,zuvWxw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('KjZ,jxyz,ywuv,zuvwWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('KjZ,jxyz,ywuv,zuvwxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('KjZ,jxyz,ywuv,zuvxWw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('KjZ,jxyz,ywuv,zuvxwW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,jxyz,yzwu,Wxwu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,jxyz,zwuv,yuvWxw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jZyz,ywuv,zuvWwx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,jZyz,ywuv,zuvWxw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jZyz,ywuv,zuvwWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jZyz,ywuv,zuvwxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jZyz,ywuv,zuvxWw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jZyz,ywuv,zuvxwW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jZyz,yzwu,Wxuw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jZyz,yzwu,Wxwu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jZyz,zwuv,yuvWwx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kjx,jZyz,zwuv,yuvWxw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jZyz,zwuv,yuvwWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jZyz,zwuv,yuvwxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jZyz,zwuv,yuvxWw->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jZyz,zwuv,yuvxwW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jy,Zyzw,Wxwz->KWZ', X_abb, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jy,Zyzw,Wxzw->KWZ', X_abb, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jy,yzwu,ZwuWxz->KWZ', X_abb, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jy,yzwu,ZwuWzx->KWZ', X_abb, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kjx,jy,yzwu,ZwuxWz->KWZ', X_abb, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jy,yzwu,ZwuxzW->KWZ', X_abb, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jy,yzwu,ZwuzWx->KWZ', X_abb, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jy,yzwu,ZwuzxW->KWZ', X_abb, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,jyzw,Zuvy,zwvWux->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,Zuvy,zwvWxu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,Zuvy,zwvuWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,Zuvy,zwvuxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,Zuvy,zwvxWu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,Zuvy,zwvxuW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jyzw,Zuyv,zwvWxu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jyzw,Zuyv,zwvxWu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kjx,jyzw,Zwuv,zuvWxy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvWyx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,Zwuv,zuvxWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvxyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvyWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zwuv,zuvyxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jyzw,Zzuv,wuvyWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jyzw,Zzuv,wuvyxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,wuvs,ZzvsWuxy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/120 * einsum('Kjx,jyzw,wuvs,ZzvsWuyx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 11/120 * einsum('Kjx,jyzw,wuvs,ZzvsWxuy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/40 * einsum('Kjx,jyzw,wuvs,ZzvsWxyu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/60 * einsum('Kjx,jyzw,wuvs,ZzvsWyux->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kjx,jyzw,wuvs,ZzvsWyxu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/60 * einsum('Kjx,jyzw,wuvs,ZzvsuWxy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/30 * einsum('Kjx,jyzw,wuvs,ZzvsuWyx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,wuvs,ZzvsuxWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 7/120 * einsum('Kjx,jyzw,wuvs,ZzvsuxyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kjx,jyzw,wuvs,ZzvsuyWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/30 * einsum('Kjx,jyzw,wuvs,ZzvsuyxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,wuvs,ZzvsxWuy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 11/120 * einsum('Kjx,jyzw,wuvs,ZzvsxWyu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/60 * einsum('Kjx,jyzw,wuvs,ZzvsxuWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/60 * einsum('Kjx,jyzw,wuvs,ZzvsxuyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/40 * einsum('Kjx,jyzw,wuvs,ZzvsxyWu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 17/120 * einsum('Kjx,jyzw,wuvs,ZzvsxyuW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/120 * einsum('Kjx,jyzw,wuvs,ZzvsyWux->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/40 * einsum('Kjx,jyzw,wuvs,ZzvsyWxu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kjx,jyzw,wuvs,ZzvsyuWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/30 * einsum('Kjx,jyzw,wuvs,ZzvsyuxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 13/60 * einsum('Kjx,jyzw,wuvs,ZzvsyxWu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/10 * einsum('Kjx,jyzw,wuvs,ZzvsyxuW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/120 * einsum('Kjx,jyzw,yuvs,ZzwuWsvx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/40 * einsum('Kjx,jyzw,yuvs,ZzwuWsxv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/40 * einsum('Kjx,jyzw,yuvs,ZzwuWvsx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/40 * einsum('Kjx,jyzw,yuvs,ZzwuWvxs->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kjx,jyzw,yuvs,ZzwuWxsv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,yuvs,ZzwusWvx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/120 * einsum('Kjx,jyzw,yuvs,ZzwusWxv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 11/120 * einsum('Kjx,jyzw,yuvs,ZzwusvWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,yuvs,ZzwusvxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/30 * einsum('Kjx,jyzw,yuvs,ZzwusxWv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/15 * einsum('Kjx,jyzw,yuvs,ZzwusxvW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kjx,jyzw,yuvs,ZzwuvWsx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/30 * einsum('Kjx,jyzw,yuvs,ZzwuvWxs->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kjx,jyzw,yuvs,ZzwuvsWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,jyzw,yuvs,ZzwuvsxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/120 * einsum('Kjx,jyzw,yuvs,ZzwuvxWs->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/40 * einsum('Kjx,jyzw,yuvs,ZzwuvxsW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 2/15 * einsum('Kjx,jyzw,yuvs,ZzwuxWsv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/60 * einsum('Kjx,jyzw,yuvs,ZzwuxWvs->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jyzw,yuvs,ZzwuxsWv->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/15 * einsum('Kjx,jyzw,yuvs,ZzwuxsvW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jyzw,yuvs,ZzwuxvWs->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kjx,jyzw,yuvs,ZzwuxvsW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/60 * einsum('Kjx,jyzw,zuvs,ZwvsWuxy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/20 * einsum('Kjx,jyzw,zuvs,ZwvsWuyx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/40 * einsum('Kjx,jyzw,zuvs,ZwvsWxuy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 7/120 * einsum('Kjx,jyzw,zuvs,ZwvsWxyu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/30 * einsum('Kjx,jyzw,zuvs,ZwvsuWyx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,jyzw,zuvs,ZwvsuxWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/120 * einsum('Kjx,jyzw,zuvs,ZwvsuxyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 2/15 * einsum('Kjx,jyzw,zuvs,ZwvsuyWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/40 * einsum('Kjx,jyzw,zuvs,ZwvsxWuy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 7/120 * einsum('Kjx,jyzw,zuvs,ZwvsxWyu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 9/40 * einsum('Kjx,jyzw,zuvs,ZwvsxuWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,zuvs,ZwvsxuyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,zuvs,ZwvsxyWu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/40 * einsum('Kjx,jyzw,zuvs,ZwvsxyuW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,zuvs,ZwvsyWux->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,zuvs,ZwvsyWxu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/40 * einsum('Kjx,jyzw,zuvs,ZwvsyuWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 17/120 * einsum('Kjx,jyzw,zuvs,ZwvsyuxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jyzw,zuvs,ZwvsyxWu->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/5 * einsum('Kjx,jyzw,zuvs,ZwvsyxuW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,zwuv,ZuvWxy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,zwuv,ZuvWyx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kjx,jyzw,zwuv,ZuvxWy->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,zwuv,ZuvxyW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,zwuv,ZuvyWx->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,zwuv,ZuvyxW->KWZ', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma[s_caa__abb:f_caa__abb] += sigma_caa.reshape(-1).copy()

            sigma_caa  = 1/2 * einsum('ijZ,jiKx,Wx->KWZ', X_abb, v_vxxa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('ijx,jiKy,WxZy->KWZ', X_abb, v_vxxa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('ijx,jiKy,WxyZ->KWZ', X_abb, v_vxxa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,jx,Wx->KWZ', X_bab, h_va, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jy,WxZy->KWZ', X_bab, h_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kjx,jy,WxyZ->KWZ', X_bab, h_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iZyx,Wy->KWZ', X_bab, v_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzx,WyZz->KWZ', X_bab, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,iyzx,WyzZ->KWZ', X_bab, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,jxyz,Wxyz->KWZ', X_bab, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kjx,jZyz,Wxyz->KWZ', X_bab, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jZyz,Wxzy->KWZ', X_bab, v_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,ZzwWxy->KWZ', X_bab, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,ZzwWyx->KWZ', X_bab, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kjx,jyzw,ZzwxWy->KWZ', X_bab, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,ZzwxyW->KWZ', X_bab, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,ZzwyWx->KWZ', X_bab, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,ZzwyxW->KWZ', X_bab, v_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('ijZ,ijKx,Wx->KWZ', X_bab, v_xvxa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('ijx,ijKy,WxZy->KWZ', X_bab, v_xvxa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('ijx,ijKy,WxyZ->KWZ', X_bab, v_xvxa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,i,iZyx,Wy->KWZ', X_bab, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,i,iyzx,WyZz->KWZ', X_bab, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,i,iyzx,WyzZ->KWZ', X_bab, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('KjZ,j,jx,Wx->KWZ', X_bab, e_val, t1_va, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('KjZ,j,jxyz,Wxyz->KWZ', X_bab, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kjx,j,jZyz,Wxyz->KWZ', X_bab, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,j,jZyz,Wxzy->KWZ', X_bab, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,j,jy,WxZy->KWZ', X_bab, e_val, t1_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kjx,j,jy,WxyZ->KWZ', X_bab, e_val, t1_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,j,jyzw,ZzwWxy->KWZ', X_bab, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,j,jyzw,ZzwWyx->KWZ', X_bab, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,j,jyzw,ZzwxWy->KWZ', X_bab, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,j,jyzw,ZzwxyW->KWZ', X_bab, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,j,jyzw,ZzwyWx->KWZ', X_bab, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,j,jyzw,ZzwyxW->KWZ', X_bab, e_val, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,Zy,iyzx,Wz->KWZ', X_bab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,xy,iZzy,Wz->KWZ', X_bab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,xy,izwy,WzZw->KWZ', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,xy,izwy,WzwZ->KWZ', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,yz,iZyx,Wz->KWZ', X_bab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,yz,iwyx,WwZz->KWZ', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,yz,iwyx,WwzZ->KWZ', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,yz,iywx,WzZw->KWZ', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,yz,iywx,WzwZ->KWZ', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,xy,jx,Wy->KWZ', X_bab, h_aa, t1_va, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('KjZ,xy,jxzw,Wyzw->KWZ', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,xy,jzwx,Wzwy->KWZ', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,xy,jzxw,Wzyw->KWZ', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,Zy,jyzw,Wxwz->KWZ', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kjx,Zy,jyzw,Wxzw->KWZ', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kjx,yz,jZwy,Wxwz->KWZ', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,yz,jZwy,Wxzw->KWZ', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,yz,jZyw,Wxwz->KWZ', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kjx,yz,jZyw,Wxzw->KWZ', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,yz,jwuy,ZzuWwx->KWZ', X_bab, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,yz,jwuy,ZzuWxw->KWZ', X_bab, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,yz,jwuy,ZzuwWx->KWZ', X_bab, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,yz,jwuy,ZzuwxW->KWZ', X_bab, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,yz,jwuy,ZzuxWw->KWZ', X_bab, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kjx,yz,jwuy,ZzuxwW->KWZ', X_bab, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,yz,jwyu,ZzuWxw->KWZ', X_bab, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kjx,yz,jwyu,ZzuxWw->KWZ', X_bab, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,yz,jy,WxZz->KWZ', X_bab, h_aa, t1_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kjx,yz,jy,WxzZ->KWZ', X_bab, h_aa, t1_va, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,yz,jywu,ZwuWxz->KWZ', X_bab, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,yz,jywu,ZwuWzx->KWZ', X_bab, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,yz,jywu,ZwuxWz->KWZ', X_bab, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,yz,jywu,ZwuxzW->KWZ', X_bab, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,yz,jywu,ZwuzWx->KWZ', X_bab, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,yz,jywu,ZwuzxW->KWZ', X_bab, h_aa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iZyx,yzwu,Wzwu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,iZyz,xwuy,Wuwz->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iZyz,xwuy,Wuzw->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iZyz,xwuz,Wuwy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,iZyz,xwuz,Wuyw->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iZyz,xwzu,Wuyw->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iZyz,xwzy,Ww->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iy,Zyxz,Wz->KWZ', X_bab, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iy,xzwy,WwZz->KWZ', X_bab, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,iy,xzwy,WwzZ->KWZ', X_bab, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyzw,Zuxy,Wuzw->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,Zuyx,Wuwz->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,iyzw,Zuyx,Wuzw->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,Zwux,Wyuz->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,iyzw,Zwux,Wyzu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iyzw,Zwxu,Wyzu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kix,iyzw,Zzxu,Wyuw->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kix,iyzw,xuvw,ZzuWvy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kix,iyzw,xuvw,ZzuWyv->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kix,iyzw,xuvw,ZzuvWy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kix,iyzw,xuvw,ZzuvyW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kix,iyzw,xuvw,ZzuyWv->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kix,iyzw,xuvw,ZzuyvW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuvz,ZwuWvy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuvz,ZwuvWy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuvz,ZwuvyW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuvz,ZwuyWv->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzw,xuvz,ZwuyvW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwv,ZzuWyv->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,iyzw,xuwv,ZzuyWv->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzw,xuwz,WyZu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,iyzw,xuwz,WyuZ->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kix,iyzw,xyuv,ZzwWuv->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kix,iyzw,xyuv,ZzwWvu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kix,iyzw,xyuv,ZzwuWv->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kix,iyzw,xyuv,ZzwuvW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kix,iyzw,xyuv,ZzwvWu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kix,iyzw,xyuv,ZzwvuW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kix,iyzx,Zwuy,Wwuz->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kix,iyzx,Zwuy,Wwzu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kix,iyzx,Zwyu,Wwzu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kix,iyzx,Zzwu,Wyuw->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kix,iyzx,Zzwu,Wywu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kix,iyzx,ywuv,ZzwWuv->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kix,iyzx,ywuv,ZzwWvu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 7/24 * einsum('Kix,iyzx,ywuv,ZzwuWv->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kix,iyzx,ywuv,ZzwuvW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kix,iyzx,ywuv,ZzwvWu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kix,iyzx,ywuv,ZzwvuW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzx,zwuv,ZuvWwy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kix,iyzx,zwuv,ZuvWyw->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzx,zwuv,ZuvwWy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzx,zwuv,ZuvwyW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 7/24 * einsum('Kix,iyzx,zwuv,ZuvyWw->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kix,iyzx,zwuv,ZuvywW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,jx,xyzw,Wyzw->KWZ', X_bab, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 11/24 * einsum('KjZ,jxyz,xwuv,yzwWuv->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('KjZ,jxyz,xwuv,yzwWvu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('KjZ,jxyz,xwuv,yzwuWv->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('KjZ,jxyz,xwuv,yzwuvW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('KjZ,jxyz,xwuv,yzwvWu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('KjZ,jxyz,xwuv,yzwvuW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('KjZ,jxyz,ywuv,zuvWwx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('KjZ,jxyz,ywuv,zuvWxw->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('KjZ,jxyz,ywuv,zuvwWx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('KjZ,jxyz,ywuv,zuvwxW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('KjZ,jxyz,ywuv,zuvxWw->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('KjZ,jxyz,ywuv,zuvxwW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,jxyz,yzwu,Wxwu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('KjZ,jxyz,zwuv,yuvWxw->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jZyz,ywuv,zuvWwx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jZyz,ywuv,zuvWxw->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jZyz,ywuv,zuvwWx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jZyz,ywuv,zuvwxW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kjx,jZyz,ywuv,zuvxWw->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jZyz,ywuv,zuvxwW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jZyz,yzwu,Wxuw->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kjx,jZyz,yzwu,Wxwu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jZyz,zwuv,yuvWwx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 7/24 * einsum('Kjx,jZyz,zwuv,yuvWxw->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jZyz,zwuv,yuvwWx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jZyz,zwuv,yuvwxW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jZyz,zwuv,yuvxWw->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jZyz,zwuv,yuvxwW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kjx,jy,Zyzw,Wxwz->KWZ', X_bab, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jy,Zyzw,Wxzw->KWZ', X_bab, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jy,yzwu,ZwuWxz->KWZ', X_bab, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jy,yzwu,ZwuWzx->KWZ', X_bab, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kjx,jy,yzwu,ZwuxWz->KWZ', X_bab, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jy,yzwu,ZwuxzW->KWZ', X_bab, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jy,yzwu,ZwuzWx->KWZ', X_bab, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jy,yzwu,ZwuzxW->KWZ', X_bab, t1_va, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 7/24 * einsum('Kjx,jyzw,Zuvy,zwvWux->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zuvy,zwvWxu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zuvy,zwvuWx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zuvy,zwvuxW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,Zuvy,zwvxWu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,Zuvy,zwvxuW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,jyzw,Zuyv,zwvWux->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kjx,jyzw,Zuyv,zwvWxu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,jyzw,Zuyv,zwvuWx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,jyzw,Zuyv,zwvuxW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,jyzw,Zuyv,zwvxWu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,jyzw,Zuyv,zwvxuW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 7/24 * einsum('Kjx,jyzw,Zwuv,zuvWxy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,Zwuv,zuvWyx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kjx,jyzw,Zwuv,zuvxWy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,Zwuv,zuvxyW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,Zwuv,zuvyWx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,Zwuv,zuvyxW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jyzw,Zzuv,wuvWxy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jyzw,Zzuv,wuvWyx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jyzw,Zzuv,wuvxWy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kjx,jyzw,Zzuv,wuvxyW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kjx,jyzw,Zzuv,wuvyxW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/120 * einsum('Kjx,jyzw,wuvs,ZzvsWuxy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/40 * einsum('Kjx,jyzw,wuvs,ZzvsWuyx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kjx,jyzw,wuvs,ZzvsWxuy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kjx,jyzw,wuvs,ZzvsWxyu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,wuvs,ZzvsWyux->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/40 * einsum('Kjx,jyzw,wuvs,ZzvsWyxu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/15 * einsum('Kjx,jyzw,wuvs,ZzvsuWxy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,jyzw,wuvs,ZzvsuWyx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 7/120 * einsum('Kjx,jyzw,wuvs,ZzvsuxWy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 17/120 * einsum('Kjx,jyzw,wuvs,ZzvsuxyW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,jyzw,wuvs,ZzvsuyWx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/10 * einsum('Kjx,jyzw,wuvs,ZzvsuyxW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/5 * einsum('Kjx,jyzw,wuvs,ZzvsxWyu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/10 * einsum('Kjx,jyzw,wuvs,ZzvsxuWy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/10 * einsum('Kjx,jyzw,wuvs,ZzvsxuyW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/30 * einsum('Kjx,jyzw,wuvs,ZzvsxyWu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/30 * einsum('Kjx,jyzw,wuvs,ZzvsxyuW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/30 * einsum('Kjx,jyzw,wuvs,ZzvsyWux->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,jyzw,wuvs,ZzvsyWxu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 2/15 * einsum('Kjx,jyzw,wuvs,ZzvsyuWx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/20 * einsum('Kjx,jyzw,wuvs,ZzvsyuxW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,wuvs,ZzvsyxWu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/40 * einsum('Kjx,jyzw,wuvs,ZzvsyxuW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 19/120 * einsum('Kjx,jyzw,yuvs,ZzwuWsvx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/40 * einsum('Kjx,jyzw,yuvs,ZzwuWsxv->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/120 * einsum('Kjx,jyzw,yuvs,ZzwuWvsx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/120 * einsum('Kjx,jyzw,yuvs,ZzwuWvxs->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,jyzw,yuvs,ZzwuWxsv->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/5 * einsum('Kjx,jyzw,yuvs,ZzwuWxvs->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 9/40 * einsum('Kjx,jyzw,yuvs,ZzwusWvx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/120 * einsum('Kjx,jyzw,yuvs,ZzwusWxv->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/120 * einsum('Kjx,jyzw,yuvs,ZzwusvWx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/60 * einsum('Kjx,jyzw,yuvs,ZzwusvxW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/10 * einsum('Kjx,jyzw,yuvs,ZzwusxWv->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/120 * einsum('Kjx,jyzw,yuvs,ZzwusxvW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/10 * einsum('Kjx,jyzw,yuvs,ZzwuvWsx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,jyzw,yuvs,ZzwuvWxs->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/60 * einsum('Kjx,jyzw,yuvs,ZzwuvsWx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,yuvs,ZzwuvsxW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 13/120 * einsum('Kjx,jyzw,yuvs,ZzwuvxWs->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/15 * einsum('Kjx,jyzw,yuvs,ZzwuvxsW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 9/20 * einsum('Kjx,jyzw,yuvs,ZzwuxWvs->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,jyzw,yuvs,ZzwuxsWv->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/40 * einsum('Kjx,jyzw,yuvs,ZzwuxsvW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 7/60 * einsum('Kjx,jyzw,yuvs,ZzwuxvWs->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/40 * einsum('Kjx,jyzw,yuvs,ZzwuxvsW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/60 * einsum('Kjx,jyzw,zuvs,ZwvsWuxy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kjx,jyzw,zuvs,ZwvsWuyx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/120 * einsum('Kjx,jyzw,zuvs,ZwvsWxuy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kjx,jyzw,zuvs,ZwvsWxyu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 2/15 * einsum('Kjx,jyzw,zuvs,ZwvsWyxu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 2/15 * einsum('Kjx,jyzw,zuvs,ZwvsuWxy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/15 * einsum('Kjx,jyzw,zuvs,ZwvsuWyx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/20 * einsum('Kjx,jyzw,zuvs,ZwvsuxWy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 2/15 * einsum('Kjx,jyzw,zuvs,ZwvsuxyW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kjx,jyzw,zuvs,ZwvsuyWx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,zuvs,ZwvsuyxW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,zuvs,ZwvsxWuy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 9/40 * einsum('Kjx,jyzw,zuvs,ZwvsxWyu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/20 * einsum('Kjx,jyzw,zuvs,ZwvsxuWy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 2/15 * einsum('Kjx,jyzw,zuvs,ZwvsxuyW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kjx,jyzw,zuvs,ZwvsxyuW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/120 * einsum('Kjx,jyzw,zuvs,ZwvsyWux->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 43/120 * einsum('Kjx,jyzw,zuvs,ZwvsyWxu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kjx,jyzw,zuvs,ZwvsyuWx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/8 * einsum('Kjx,jyzw,zuvs,ZwvsyxWu->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/120 * einsum('Kjx,jyzw,zuvs,ZwvsyxuW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kjx,jyzw,zwuv,ZuvWxy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,zwuv,ZuvWyx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kjx,jyzw,zwuv,ZuvxWy->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,zwuv,ZuvxyW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,zwuv,ZuvyWx->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kjx,jyzw,zwuv,ZuvyxW->KWZ', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma[s_caa__bab:f_caa__bab] += sigma_caa.reshape(-1).copy()

            # CCA <- CVA
            sigma_cca =- einsum('Kix,LxWi->KLW', X_aaa, v_xaav, optimize = einsum_type)
            sigma_cca += einsum('Kix,LxiW->KLW', X_aaa, v_xava, optimize = einsum_type)
            sigma_cca += einsum('Lix,KxWi->KLW', X_aaa, v_xaav, optimize = einsum_type)
            sigma_cca -= einsum('Lix,KxiW->KLW', X_aaa, v_xava, optimize = einsum_type)
            sigma_cca -= einsum('ijW,KLij->KLW', X_aaa, v_xxxv, optimize = einsum_type)
            sigma_cca += einsum('ijW,KLji->KLW', X_aaa, v_xxvx, optimize = einsum_type)
            sigma_cca -= einsum('Kix,LxWi->KLW', X_abb, v_xaav, optimize = einsum_type)
            sigma_cca += einsum('Lix,KxWi->KLW', X_abb, v_xaav, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('Kix,Lxiy,Wy->KLW', X_aaa, v_xava, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Kix,Lxyi,Wy->KLW', X_aaa, v_xaav, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Kjx,LyWj,xy->KLW', X_aaa, v_xaav, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('Kjx,LyjW,xy->KLW', X_aaa, v_xava, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('Kjx,Lyjz,Wyxz->KLW', X_aaa, v_xava, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/6 * einsum('Kjx,Lyzj,Wyxz->KLW', X_aaa, v_xaav, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/6 * einsum('Kjx,Lyzj,Wyzx->KLW', X_aaa, v_xaav, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Lix,Kxiy,Wy->KLW', X_aaa, v_xava, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('Lix,Kxyi,Wy->KLW', X_aaa, v_xaav, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('Ljx,KyWj,xy->KLW', X_aaa, v_xaav, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Ljx,KyjW,xy->KLW', X_aaa, v_xava, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Ljx,Kyjz,Wyxz->KLW', X_aaa, v_xava, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/6 * einsum('Ljx,Kyzj,Wyxz->KLW', X_aaa, v_xaav, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/6 * einsum('Ljx,Kyzj,Wyzx->KLW', X_aaa, v_xaav, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('ijx,KLij,Wx->KLW', X_aaa, v_xxxv, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('ijx,KLji,Wx->KLW', X_aaa, v_xxvx, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Kix,Lxyi,Wy->KLW', X_abb, v_xaav, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Kjx,LyWj,xy->KLW', X_abb, v_xaav, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/6 * einsum('Kjx,Lyzj,Wyxz->KLW', X_abb, v_xaav, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/3 * einsum('Kjx,Lyzj,Wyzx->KLW', X_abb, v_xaav, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('Lix,Kxyi,Wy->KLW', X_abb, v_xaav, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('Ljx,KyWj,xy->KLW', X_abb, v_xaav, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/6 * einsum('Ljx,Kyzj,Wyxz->KLW', X_abb, v_xaav, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/3 * einsum('Ljx,Kyzj,Wyzx->KLW', X_abb, v_xaav, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Kjx,Lyjz,yz,Wx->KLW', X_aaa, v_xava, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('Kjx,Lyzj,yz,Wx->KLW', X_aaa, v_xaav, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('Ljx,Kyjz,yz,Wx->KLW', X_aaa, v_xava, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('Ljx,Kyzj,yz,Wx->KLW', X_aaa, v_xaav, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma[s_cca__aaa:f_cca__aaa] += sigma_cca[cvs_tril_ind[0], cvs_tril_ind[1]].reshape(-1).copy()

            sigma_cca =- einsum('Kix,LxWi->KLW', X_aaa, v_xaav, optimize = einsum_type)
            sigma_cca -= einsum('Kix,LxWi->KLW', X_abb, v_xaav, optimize = einsum_type)
            sigma_cca += einsum('Kix,LxiW->KLW', X_abb, v_xava, optimize = einsum_type)
            sigma_cca -= einsum('ijW,KLij->KLW', X_abb, v_xxxv, optimize = einsum_type)
            sigma_cca -= einsum('Lix,KxiW->KLW', X_bab, v_xava, optimize = einsum_type)
            sigma_cca += einsum('ijW,KLji->KLW', X_bab, v_xxvx, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Kix,Lxyi,Wy->KLW', X_aaa, v_xaav, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Kjx,LyWj,xy->KLW', X_aaa, v_xaav, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/6 * einsum('Kjx,Lyzj,Wyxz->KLW', X_aaa, v_xaav, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/3 * einsum('Kjx,Lyzj,Wyzx->KLW', X_aaa, v_xaav, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('Kix,Lxiy,Wy->KLW', X_abb, v_xava, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Kix,Lxyi,Wy->KLW', X_abb, v_xaav, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Kjx,LyWj,xy->KLW', X_abb, v_xaav, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('Kjx,LyjW,xy->KLW', X_abb, v_xava, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('Kjx,Lyjz,Wyxz->KLW', X_abb, v_xava, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/6 * einsum('Kjx,Lyzj,Wyxz->KLW', X_abb, v_xaav, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/6 * einsum('Kjx,Lyzj,Wyzx->KLW', X_abb, v_xaav, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('ijx,KLij,Wx->KLW', X_abb, v_xxxv, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Lix,Kxiy,Wy->KLW', X_bab, v_xava, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Ljx,KyjW,xy->KLW', X_bab, v_xava, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Ljx,Kyjz,Wyxz->KLW', X_bab, v_xava, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/3 * einsum('Ljx,Kyzj,Wyxz->KLW', X_bab, v_xaav, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/6 * einsum('Ljx,Kyzj,Wyzx->KLW', X_bab, v_xaav, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('ijx,KLji,Wx->KLW', X_bab, v_xxvx, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Kjx,Lyjz,yz,Wx->KLW', X_abb, v_xava, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('Kjx,Lyzj,yz,Wx->KLW', X_abb, v_xaav, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('Ljx,Kyjz,yz,Wx->KLW', X_bab, v_xava, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('Ljx,Kyzj,yz,Wx->KLW', X_bab, v_xaav, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma[s_cca__abb:f_cca__abb] += sigma_cca.reshape(-1).copy()

            # CVA <- CVA
            sigma_cva =- einsum('Kix,LxWi->KLW', X_aaa, v_vaav, optimize = einsum_type)
            sigma_cva += einsum('Kix,LxiW->KLW', X_aaa, v_vava, optimize = einsum_type)
            sigma_cva -= einsum('iLx,KxWi->KLW', X_aaa, v_xaax, optimize = einsum_type)
            sigma_cva += einsum('iLx,KxiW->KLW', X_aaa, v_xaxa, optimize = einsum_type)
            sigma_cva -= einsum('ijW,KLij->KLW', X_aaa, v_xvxv, optimize = einsum_type)
            sigma_cva += einsum('ijW,KLji->KLW', X_aaa, v_xvvx, optimize = einsum_type)
            sigma_cva -= einsum('Kix,LxWi->KLW', X_abb, v_vaav, optimize = einsum_type)
            sigma_cva -= einsum('iLx,KxWi->KLW', X_bab, v_xaax, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kix,Lxiy,Wy->KLW', X_aaa, v_vava, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kix,Lxyi,Wy->KLW', X_aaa, v_vaav, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kjx,LyWj,xy->KLW', X_aaa, v_vaav, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kjx,LyjW,xy->KLW', X_aaa, v_vava, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kjx,Lyjz,Wyxz->KLW', X_aaa, v_vava, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kjx,Lyzj,Wyxz->KLW', X_aaa, v_vaav, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kjx,Lyzj,Wyzx->KLW', X_aaa, v_vaav, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('iLx,Kxiy,Wy->KLW', X_aaa, v_xaxa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('iLx,Kxyi,Wy->KLW', X_aaa, v_xaax, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('iLx,KyWi,xy->KLW', X_aaa, v_xaax, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('iLx,KyiW,xy->KLW', X_aaa, v_xaxa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('iLx,Kyiz,Wyxz->KLW', X_aaa, v_xaxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('iLx,Kyzi,Wyxz->KLW', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('iLx,Kyzi,Wyzx->KLW', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('ijx,KLij,Wx->KLW', X_aaa, v_xvxv, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('ijx,KLji,Wx->KLW', X_aaa, v_xvvx, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kix,Lxyi,Wy->KLW', X_abb, v_vaav, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kjx,LyWj,xy->KLW', X_abb, v_vaav, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kjx,Lyzj,Wyxz->KLW', X_abb, v_vaav, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kjx,Lyzj,Wyzx->KLW', X_abb, v_vaav, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('iLx,Kxyi,Wy->KLW', X_bab, v_xaax, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('iLx,KyWi,xy->KLW', X_bab, v_xaax, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('iLx,Kyzi,Wyxz->KLW', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('iLx,Kyzi,Wyzx->KLW', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kjx,Lyjz,yz,Wx->KLW', X_aaa, v_vava, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('Kjx,Lyzj,yz,Wx->KLW', X_aaa, v_vaav, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('iLx,Kyiz,yz,Wx->KLW', X_aaa, v_xaxa, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('iLx,Kyzi,yz,Wx->KLW', X_aaa, v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma[s_cva__aaa:f_cva__aaa] += sigma_cva.reshape(-1).copy()

            sigma_cva =- einsum('Kix,LxWi->KLW', X_aaa, v_vaav, optimize = einsum_type)
            sigma_cva -= einsum('Kix,LxWi->KLW', X_abb, v_vaav, optimize = einsum_type)
            sigma_cva += einsum('Kix,LxiW->KLW', X_abb, v_vava, optimize = einsum_type)
            sigma_cva += einsum('iLx,KxiW->KLW', X_abb, v_xaxa, optimize = einsum_type)
            sigma_cva -= einsum('ijW,KLij->KLW', X_abb, v_xvxv, optimize = einsum_type)
            sigma_cva += einsum('ijW,KLji->KLW', X_bab, v_xvvx, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kix,Lxyi,Wy->KLW', X_aaa, v_vaav, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kjx,LyWj,xy->KLW', X_aaa, v_vaav, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kjx,Lyzj,Wyxz->KLW', X_aaa, v_vaav, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('Kjx,Lyzj,Wyzx->KLW', X_aaa, v_vaav, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kix,Lxiy,Wy->KLW', X_abb, v_vava, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kix,Lxyi,Wy->KLW', X_abb, v_vaav, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kjx,LyWj,xy->KLW', X_abb, v_vaav, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kjx,LyjW,xy->KLW', X_abb, v_vava, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kjx,Lyjz,Wyxz->KLW', X_abb, v_vava, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kjx,Lyzj,Wyxz->KLW', X_abb, v_vaav, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('Kjx,Lyzj,Wyzx->KLW', X_abb, v_vaav, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('iLx,Kxiy,Wy->KLW', X_abb, v_xaxa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('iLx,KyiW,xy->KLW', X_abb, v_xaxa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('iLx,Kyiz,Wyxz->KLW', X_abb, v_xaxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('iLx,Kyzi,Wyxz->KLW', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('iLx,Kyzi,Wyzx->KLW', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('ijx,KLij,Wx->KLW', X_abb, v_xvxv, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('ijx,KLji,Wx->KLW', X_bab, v_xvvx, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kjx,Lyjz,yz,Wx->KLW', X_abb, v_vava, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('Kjx,Lyzj,yz,Wx->KLW', X_abb, v_vaav, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('iLx,Kyiz,yz,Wx->KLW', X_abb, v_xaxa, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('iLx,Kyzi,yz,Wx->KLW', X_abb, v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma[s_cva__abb:f_cva__abb] += sigma_cva.reshape(-1).copy()

            sigma_cva =- einsum('iLx,KxWi->KLW', X_aaa, v_xaax, optimize = einsum_type)
            sigma_cva += einsum('ijW,KLji->KLW', X_abb, v_xvvx, optimize = einsum_type)
            sigma_cva += einsum('Kix,LxiW->KLW', X_bab, v_vava, optimize = einsum_type)
            sigma_cva -= einsum('iLx,KxWi->KLW', X_bab, v_xaax, optimize = einsum_type)
            sigma_cva += einsum('iLx,KxiW->KLW', X_bab, v_xaxa, optimize = einsum_type)
            sigma_cva -= einsum('ijW,KLij->KLW', X_bab, v_xvxv, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('iLx,Kxyi,Wy->KLW', X_aaa, v_xaax, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('iLx,KyWi,xy->KLW', X_aaa, v_xaax, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('iLx,Kyzi,Wyxz->KLW', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/3 * einsum('iLx,Kyzi,Wyzx->KLW', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('ijx,KLji,Wx->KLW', X_abb, v_xvvx, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kix,Lxiy,Wy->KLW', X_bab, v_vava, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kjx,LyjW,xy->KLW', X_bab, v_vava, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('Kjx,Lyjz,Wyxz->KLW', X_bab, v_vava, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/3 * einsum('Kjx,Lyzj,Wyxz->KLW', X_bab, v_vaav, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('Kjx,Lyzj,Wyzx->KLW', X_bab, v_vaav, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('iLx,Kxiy,Wy->KLW', X_bab, v_xaxa, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('iLx,Kxyi,Wy->KLW', X_bab, v_xaax, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('iLx,KyWi,xy->KLW', X_bab, v_xaax, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('iLx,KyiW,xy->KLW', X_bab, v_xaxa, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/2 * einsum('iLx,Kyiz,Wyxz->KLW', X_bab, v_xaxa, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/6 * einsum('iLx,Kyzi,Wyxz->KLW', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva -= 1/6 * einsum('iLx,Kyzi,Wyzx->KLW', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('ijx,KLij,Wx->KLW', X_bab, v_xvxv, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('Kjx,Lyjz,yz,Wx->KLW', X_bab, v_vava, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('Kjx,Lyzj,yz,Wx->KLW', X_bab, v_vaav, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cva += 1/2 * einsum('iLx,Kyiz,yz,Wx->KLW', X_bab, v_xaxa, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cva -= 1/4 * einsum('iLx,Kyzi,yz,Wx->KLW', X_bab, v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma[s_cva__bab:f_cva__bab] += sigma_cva.reshape(-1).copy()

            if nextern > 0:
                # CCE <- CVA
                sigma_cce =- einsum('Kix,LxBi->KLB', X_aaa, v_xaev, optimize = einsum_type)
                sigma_cce += einsum('Kix,LxiB->KLB', X_aaa, v_xave, optimize = einsum_type)
                sigma_cce += einsum('Lix,KxBi->KLB', X_aaa, v_xaev, optimize = einsum_type)
                sigma_cce -= einsum('Lix,KxiB->KLB', X_aaa, v_xave, optimize = einsum_type)
                sigma_cce -= einsum('Kix,LxBi->KLB', X_abb, v_xaev, optimize = einsum_type)
                sigma_cce += einsum('Lix,KxBi->KLB', X_abb, v_xaev, optimize = einsum_type)
                sigma_cce += 1/2 * einsum('Kjx,LyBj,xy->KLB', X_aaa, v_xaev, rdm_ca, optimize = einsum_type)
                sigma_cce -= 1/2 * einsum('Kjx,LyjB,xy->KLB', X_aaa, v_xave, rdm_ca, optimize = einsum_type)
                sigma_cce -= 1/2 * einsum('Ljx,KyBj,xy->KLB', X_aaa, v_xaev, rdm_ca, optimize = einsum_type)
                sigma_cce += 1/2 * einsum('Ljx,KyjB,xy->KLB', X_aaa, v_xave, rdm_ca, optimize = einsum_type)
                sigma_cce += 1/2 * einsum('Kjx,LyBj,xy->KLB', X_abb, v_xaev, rdm_ca, optimize = einsum_type)
                sigma_cce -= 1/2 * einsum('Ljx,KyBj,xy->KLB', X_abb, v_xaev, rdm_ca, optimize = einsum_type)
                sigma[s_cce__aaa:f_cce__aaa] += sigma_cce[cvs_tril_ind[0], cvs_tril_ind[1]].reshape(-1).copy()

                sigma_cce =- einsum('Kix,LxBi->KLB', X_aaa, v_xaev, optimize = einsum_type)
                sigma_cce -= einsum('Kix,LxBi->KLB', X_abb, v_xaev, optimize = einsum_type)
                sigma_cce += einsum('Kix,LxiB->KLB', X_abb, v_xave, optimize = einsum_type)
                sigma_cce -= einsum('Lix,KxiB->KLB', X_bab, v_xave, optimize = einsum_type)
                sigma_cce += 1/2 * einsum('Kjx,LyBj,xy->KLB', X_aaa, v_xaev, rdm_ca, optimize = einsum_type)
                sigma_cce += 1/2 * einsum('Kjx,LyBj,xy->KLB', X_abb, v_xaev, rdm_ca, optimize = einsum_type)
                sigma_cce -= 1/2 * einsum('Kjx,LyjB,xy->KLB', X_abb, v_xave, rdm_ca, optimize = einsum_type)
                sigma_cce += 1/2 * einsum('Ljx,KyjB,xy->KLB', X_bab, v_xave, rdm_ca, optimize = einsum_type)
                sigma[s_cce__abb:f_cce__abb] += sigma_cce.reshape(-1).copy()

                # CVE <- CVA
                sigma_cve =- einsum('KLx,xB->KLB', X_aaa, h_ae, optimize = einsum_type)
                sigma_cve -= einsum('Kix,LxBi->KLB', X_aaa, v_vaev, optimize = einsum_type)
                sigma_cve += einsum('Kix,LxiB->KLB', X_aaa, v_vave, optimize = einsum_type)
                sigma_cve -= einsum('iLx,KxBi->KLB', X_aaa, v_xaex, optimize = einsum_type)
                sigma_cve += einsum('iLx,KxiB->KLB', X_aaa, v_xaxe, optimize = einsum_type)
                sigma_cve -= einsum('Kix,LxBi->KLB', X_abb, v_vaev, optimize = einsum_type)
                sigma_cve -= einsum('iLx,KxBi->KLB', X_bab, v_xaex, optimize = einsum_type)
                sigma_cve -= einsum('KLx,B,xB->KLB', X_aaa, e_extern, t1_ae, optimize = einsum_type)
                sigma_cve += einsum('KLx,xy,yB->KLB', X_aaa, h_aa, t1_ae, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KLx,xyzB,zy->KLB', X_aaa, v_aaae, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KLx,yxzB,zy->KLB', X_aaa, v_aaae, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kjx,LyBj,xy->KLB', X_aaa, v_vaev, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kjx,LyjB,xy->KLB', X_aaa, v_vave, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('iLx,KyBi,xy->KLB', X_aaa, v_xaex, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('iLx,KyiB,xy->KLB', X_aaa, v_xaxe, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kjx,LyBj,xy->KLB', X_abb, v_vaev, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('iLx,KyBi,xy->KLB', X_bab, v_xaex, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KLx,B,xyBz,zy->KLB', X_aaa, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KLx,B,yxBz,zy->KLB', X_aaa, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KLx,xy,yzBw,wz->KLB', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,xy,zyBw,wz->KLB', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KLx,yz,wxBy,zw->KLB', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KLx,yz,xwBy,zw->KLB', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KLx,yz,xyBw,zw->KLB', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,yz,yxBw,zw->KLB', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KLx,xyBz,ywuv,zwuv->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= einsum('KLx,xyBz,zwuv,ywuv->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,yB,xzwy,zw->KLB', X_aaa, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KLx,yB,xzyw,zw->KLB', X_aaa, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,yxBz,ywuv,zwuv->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KLx,yxBz,zwuv,ywuv->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,yzBw,xuvy,wvzu->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,yzBw,xuvz,wvuy->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += einsum('KLx,yzBw,xuyv,wvzu->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += einsum('KLx,yzBw,xuyz,wu->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,yzBw,xuzv,wvyu->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,yzBw,xuzy,wu->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KLx,yzBw,xwuv,yzuv->KLB', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma[s_cve__aaa:f_cve__aaa] += sigma_cve.reshape(-1).copy()

                sigma_cve =- einsum('Kix,LxBi->KLB', X_aaa, v_vaev, optimize = einsum_type)
                sigma_cve -= einsum('KLx,xB->KLB', X_abb, h_ae, optimize = einsum_type)
                sigma_cve -= einsum('Kix,LxBi->KLB', X_abb, v_vaev, optimize = einsum_type)
                sigma_cve += einsum('Kix,LxiB->KLB', X_abb, v_vave, optimize = einsum_type)
                sigma_cve += einsum('iLx,KxiB->KLB', X_abb, v_xaxe, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kjx,LyBj,xy->KLB', X_aaa, v_vaev, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KLx,B,xB->KLB', X_abb, e_extern, t1_ae, optimize = einsum_type)
                sigma_cve += einsum('KLx,xy,yB->KLB', X_abb, h_aa, t1_ae, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KLx,xyzB,zy->KLB', X_abb, v_aaae, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KLx,yxzB,zy->KLB', X_abb, v_aaae, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kjx,LyBj,xy->KLB', X_abb, v_vaev, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kjx,LyjB,xy->KLB', X_abb, v_vave, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('iLx,KyiB,xy->KLB', X_abb, v_xaxe, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KLx,B,xyBz,zy->KLB', X_abb, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KLx,B,yxBz,zy->KLB', X_abb, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KLx,xy,yzBw,wz->KLB', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,xy,zyBw,wz->KLB', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KLx,yz,wxBy,zw->KLB', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KLx,yz,xwBy,zw->KLB', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KLx,yz,xyBw,zw->KLB', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,yz,yxBw,zw->KLB', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KLx,xyBz,ywuv,zwuv->KLB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= einsum('KLx,xyBz,zwuv,ywuv->KLB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,yB,xzwy,zw->KLB', X_abb, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KLx,yB,xzyw,zw->KLB', X_abb, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,yxBz,ywuv,zwuv->KLB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KLx,yxBz,zwuv,ywuv->KLB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,yzBw,xuvy,wvzu->KLB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,yzBw,xuvz,wvuy->KLB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += einsum('KLx,yzBw,xuyv,wvzu->KLB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += einsum('KLx,yzBw,xuyz,wu->KLB', X_abb, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,yzBw,xuzv,wvyu->KLB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,yzBw,xuzy,wu->KLB', X_abb, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KLx,yzBw,xwuv,yzuv->KLB', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma[s_cve__abb:f_cve__abb] += sigma_cve.reshape(-1).copy()

                sigma_cve =- einsum('iLx,KxBi->KLB', X_aaa, v_xaex, optimize = einsum_type)
                sigma_cve -= einsum('KLx,xB->KLB', X_bab, h_ae, optimize = einsum_type)
                sigma_cve += einsum('Kix,LxiB->KLB', X_bab, v_vave, optimize = einsum_type)
                sigma_cve -= einsum('iLx,KxBi->KLB', X_bab, v_xaex, optimize = einsum_type)
                sigma_cve += einsum('iLx,KxiB->KLB', X_bab, v_xaxe, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('iLx,KyBi,xy->KLB', X_aaa, v_xaex, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KLx,B,xB->KLB', X_bab, e_extern, t1_ae, optimize = einsum_type)
                sigma_cve += einsum('KLx,xy,yB->KLB', X_bab, h_aa, t1_ae, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KLx,xyzB,zy->KLB', X_bab, v_aaae, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KLx,yxzB,zy->KLB', X_bab, v_aaae, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kjx,LyjB,xy->KLB', X_bab, v_vave, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('iLx,KyBi,xy->KLB', X_bab, v_xaex, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('iLx,KyiB,xy->KLB', X_bab, v_xaxe, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KLx,B,xyBz,zy->KLB', X_bab, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KLx,B,yxBz,zy->KLB', X_bab, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KLx,xy,yzBw,wz->KLB', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,xy,zyBw,wz->KLB', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KLx,yz,wxBy,zw->KLB', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KLx,yz,xwBy,zw->KLB', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KLx,yz,xyBw,zw->KLB', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,yz,yxBw,zw->KLB', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KLx,xyBz,ywuv,zwuv->KLB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= einsum('KLx,xyBz,zwuv,ywuv->KLB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,yB,xzwy,zw->KLB', X_bab, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KLx,yB,xzyw,zw->KLB', X_bab, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,yxBz,ywuv,zwuv->KLB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KLx,yxBz,zwuv,ywuv->KLB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,yzBw,xuvy,wvzu->KLB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,yzBw,xuvz,wvuy->KLB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += einsum('KLx,yzBw,xuyv,wvzu->KLB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += einsum('KLx,yzBw,xuyz,wu->KLB', X_bab, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,yzBw,xuzv,wvyu->KLB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KLx,yzBw,xuzy,wu->KLB', X_bab, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KLx,yzBw,xwuv,yzuv->KLB', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma[s_cve__bab:f_cve__bab] += sigma_cve.reshape(-1).copy()

            # CAE <- CVA
            sigma_cae =- 1/2 * einsum('Kix,iBxy,Zy->KZB', X_aaa, v_veaa, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kix,iByx,Zy->KZB', X_aaa, v_veaa, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kjx,jByz,Zxyz->KZB', X_aaa, v_veaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kjx,jByz,Zxzy->KZB', X_aaa, v_veaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('Kix,iBxy,Zy->KZB', X_abb, v_veaa, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kjx,jByz,Zxyz->KZB', X_abb, v_veaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kjx,jByz,Zxzy->KZB', X_abb, v_veaa, rdm_ccaa, optimize = einsum_type)
            sigma[s_cae__aaa:f_cae__aaa] += sigma_cae.reshape(-1).copy()

            sigma_cae =- 1/2 * einsum('Kix,iBxy,Zy->KZB', X_aaa, v_veaa, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kjx,jByz,Zxyz->KZB', X_aaa, v_veaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kjx,jByz,Zxzy->KZB', X_aaa, v_veaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('Kix,iBxy,Zy->KZB', X_abb, v_veaa, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kix,iByx,Zy->KZB', X_abb, v_veaa, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kjx,jByz,Zxyz->KZB', X_abb, v_veaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kjx,jByz,Zxzy->KZB', X_abb, v_veaa, rdm_ccaa, optimize = einsum_type)
            sigma[s_cae__abb:f_cae__abb] += sigma_cae.reshape(-1).copy()

            sigma_cae  = 1/2 * einsum('Kix,iByx,Zy->KZB', X_bab, v_veaa, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kjx,jByz,Zxyz->KZB', X_bab, v_veaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kjx,jByz,Zxzy->KZB', X_bab, v_veaa, rdm_ccaa, optimize = einsum_type)
            sigma[s_cae__bab:f_cae__bab] += sigma_cae.reshape(-1).copy()

        if nextern > 0:
            # * <- CCE
            X_aaa = np.zeros((ncvs, ncvs, nextern))
            X_aaa[cvs_tril_ind[0], cvs_tril_ind[1]] =  Xt[s_cce__aaa:f_cce__aaa].reshape(-1, nextern).copy()
            X_aaa[cvs_tril_ind[1], cvs_tril_ind[0]] =- Xt[s_cce__aaa:f_cce__aaa].reshape(-1, nextern).copy()

            X_abb = Xt[s_cce__abb:f_cce__abb].reshape(ncvs, ncvs, nextern).copy()
            X_bab =- X_abb.transpose(1,0,2)

            # CAA <- CCE
            sigma_caa =- 1/2 * einsum('Kia,ia,WZ->KWZ', X_aaa, h_xe, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kia,iZax,Wx->KWZ', X_aaa, v_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kia,iZxa,Wx->KWZ', X_aaa, v_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kia,ixay,WxZy->KWZ', X_aaa, v_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,ixya,WxZy->KWZ', X_aaa, v_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,ixya,WxyZ->KWZ', X_aaa, v_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('ija,ijKa,WZ->KWZ', X_aaa, v_xxxe, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('ija,jiKa,WZ->KWZ', X_aaa, v_xxxe, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,ia,WZ->KWZ', X_abb, h_xe, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,iZax,Wx->KWZ', X_abb, v_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,ixay,WxZy->KWZ', X_abb, v_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,ixya,WxZy->KWZ', X_abb, v_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,ixya,WxyZ->KWZ', X_abb, v_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('ija,ijKa,WZ->KWZ', X_abb, v_xxxe, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,ia,WZ->KWZ', X_bab, h_xe, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,iZax,Wx->KWZ', X_bab, v_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,ixay,WxZy->KWZ', X_bab, v_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('iKa,ixya,WxZy->KWZ', X_bab, v_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,ixya,WxyZ->KWZ', X_bab, v_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('ija,jiKa,WZ->KWZ', X_bab, v_xxxe, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kia,a,iZax,Wx->KWZ', X_aaa, e_extern, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kia,a,iZxa,Wx->KWZ', X_aaa, e_extern, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kia,a,ia,WZ->KWZ', X_aaa, e_extern, t1_xe, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kia,a,ixay,WxZy->KWZ', X_aaa, e_extern, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,a,ixya,WxZy->KWZ', X_aaa, e_extern, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,a,ixya,WxyZ->KWZ', X_aaa, e_extern, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kia,i,iZax,Wx->KWZ', X_aaa, e_cvs, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kia,i,iZxa,Wx->KWZ', X_aaa, e_cvs, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kia,i,ia,WZ->KWZ', X_aaa, e_cvs, t1_xe, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kia,i,ixay,WxZy->KWZ', X_aaa, e_cvs, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,i,ixya,WxZy->KWZ', X_aaa, e_cvs, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,i,ixya,WxyZ->KWZ', X_aaa, e_cvs, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kia,Zx,ixay,Wy->KWZ', X_aaa, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kia,Zx,ixya,Wy->KWZ', X_aaa, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kia,xy,iZax,Wy->KWZ', X_aaa, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kia,xy,iZxa,Wy->KWZ', X_aaa, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kia,xy,ixaz,WyZz->KWZ', X_aaa, h_aa, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,xy,ixza,WyZz->KWZ', X_aaa, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,xy,ixza,WyzZ->KWZ', X_aaa, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kia,xy,izax,WzZy->KWZ', X_aaa, h_aa, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,xy,izxa,WzZy->KWZ', X_aaa, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,xy,izxa,WzyZ->KWZ', X_aaa, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kia,iZax,xyzw,Wyzw->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kia,iZxa,xyzw,Wyzw->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kia,ixay,Zyzw,Wxzw->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kia,ixay,Zzwx,Wzwy->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kia,ixay,Zzxw,Wzyw->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzWuw->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kia,ixay,xzwu,ZyzWwu->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzuWw->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzuwW->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzwWu->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzwuW->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kia,ixay,yzwu,ZwuWxz->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuWzx->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuxWz->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuxzW->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuzWx->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuzxW->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,ixya,Zyzw,Wxwz->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,ixya,Zyzw,Wxzw->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,ixya,Zzwx,Wzwy->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,ixya,Zzwx,Wzyw->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kia,ixya,Zzxw,Wzyw->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kia,ixya,xzwu,ZyzWuw->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kia,ixya,xzwu,ZyzWwu->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kia,ixya,xzwu,ZyzuWw->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kia,ixya,xzwu,ZyzuwW->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kia,ixya,xzwu,ZyzwWu->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kia,ixya,xzwu,ZyzwuW->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kia,ixya,yzwu,ZwuWxz->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kia,ixya,yzwu,ZwuWzx->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kia,ixya,yzwu,ZwuxWz->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kia,ixya,yzwu,ZwuxzW->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kia,ixya,yzwu,ZwuzWx->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kia,ixya,yzwu,ZwuzxW->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,a,iZax,Wx->KWZ', X_abb, e_extern, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,a,ia,WZ->KWZ', X_abb, e_extern, t1_xe, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,a,ixay,WxZy->KWZ', X_abb, e_extern, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,a,ixya,WxZy->KWZ', X_abb, e_extern, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,a,ixya,WxyZ->KWZ', X_abb, e_extern, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,i,iZax,Wx->KWZ', X_abb, e_cvs, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,i,ia,WZ->KWZ', X_abb, e_cvs, t1_xe, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,i,ixay,WxZy->KWZ', X_abb, e_cvs, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,i,ixya,WxZy->KWZ', X_abb, e_cvs, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,i,ixya,WxyZ->KWZ', X_abb, e_cvs, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,Zx,ixay,Wy->KWZ', X_abb, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,xy,iZax,Wy->KWZ', X_abb, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,xy,ixaz,WyZz->KWZ', X_abb, h_aa, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,xy,ixza,WyZz->KWZ', X_abb, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,xy,ixza,WyzZ->KWZ', X_abb, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,xy,izax,WzZy->KWZ', X_abb, h_aa, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,xy,izxa,WzZy->KWZ', X_abb, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,xy,izxa,WzyZ->KWZ', X_abb, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,iZax,xyzw,Wyzw->KWZ', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,ixay,Zyzw,Wxzw->KWZ', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,ixay,Zzwx,Wzwy->KWZ', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,ixay,Zzxw,Wzyw->KWZ', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,ixay,xzwu,ZyzWuw->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,ixay,xzwu,ZyzWwu->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,ixay,xzwu,ZyzuWw->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,ixay,xzwu,ZyzuwW->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,ixay,xzwu,ZyzwWu->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,ixay,xzwu,ZyzwuW->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,ixay,yzwu,ZwuWxz->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,ixay,yzwu,ZwuWzx->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,ixay,yzwu,ZwuxWz->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,ixay,yzwu,ZwuxzW->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,ixay,yzwu,ZwuzWx->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,ixay,yzwu,ZwuzxW->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,ixya,Zyzw,Wxwz->KWZ', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,ixya,Zyzw,Wxzw->KWZ', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,ixya,Zzwx,Wzwy->KWZ', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,ixya,Zzwx,Wzyw->KWZ', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/16 * einsum('Kia,ixya,xzwu,ZyzWuw->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/48 * einsum('Kia,ixya,xzwu,ZyzWwu->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/16 * einsum('Kia,ixya,xzwu,ZyzuWw->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/16 * einsum('Kia,ixya,xzwu,ZyzuwW->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/48 * einsum('Kia,ixya,xzwu,ZyzwWu->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/16 * einsum('Kia,ixya,xzwu,ZyzwuW->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/48 * einsum('Kia,ixya,yzwu,ZwuWxz->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('Kia,ixya,yzwu,ZwuWzx->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/48 * einsum('Kia,ixya,yzwu,ZwuxWz->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('Kia,ixya,yzwu,ZwuxzW->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('Kia,ixya,yzwu,ZwuzWx->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('Kia,ixya,yzwu,ZwuzxW->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,a,iZax,Wx->KWZ', X_bab, e_extern, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,a,ia,WZ->KWZ', X_bab, e_extern, t1_xe, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,a,ixay,WxZy->KWZ', X_bab, e_extern, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('iKa,a,ixya,WxZy->KWZ', X_bab, e_extern, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,a,ixya,WxyZ->KWZ', X_bab, e_extern, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('iKa,i,iZax,Wx->KWZ', X_bab, e_cvs, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('iKa,i,ia,WZ->KWZ', X_bab, e_cvs, t1_xe, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('iKa,i,ixay,WxZy->KWZ', X_bab, e_cvs, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('iKa,i,ixya,WxZy->KWZ', X_bab, e_cvs, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,i,ixya,WxyZ->KWZ', X_bab, e_cvs, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('iKa,Zx,ixay,Wy->KWZ', X_bab, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,xy,iZax,Wy->KWZ', X_bab, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('iKa,xy,ixaz,WyZz->KWZ', X_bab, h_aa, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('iKa,xy,ixza,WyZz->KWZ', X_bab, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,xy,ixza,WyzZ->KWZ', X_bab, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,xy,izax,WzZy->KWZ', X_bab, h_aa, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('iKa,xy,izxa,WzZy->KWZ', X_bab, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,xy,izxa,WzyZ->KWZ', X_bab, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,iZax,xyzw,Wyzw->KWZ', X_bab, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,ixay,Zyzw,Wxzw->KWZ', X_bab, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('iKa,ixay,Zzwx,Wzwy->KWZ', X_bab, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('iKa,ixay,Zzxw,Wzyw->KWZ', X_bab, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,ixay,xzwu,ZyzWuw->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('iKa,ixay,xzwu,ZyzWwu->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,ixay,xzwu,ZyzuWw->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,ixay,xzwu,ZyzuwW->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,ixay,xzwu,ZyzwWu->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,ixay,xzwu,ZyzwuW->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('iKa,ixay,yzwu,ZwuWxz->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,ixay,yzwu,ZwuWzx->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,ixay,yzwu,ZwuxWz->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,ixay,yzwu,ZwuxzW->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,ixay,yzwu,ZwuzWx->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,ixay,yzwu,ZwuzxW->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,ixya,Zyzw,Wxwz->KWZ', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('iKa,ixya,Zyzw,Wxzw->KWZ', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('iKa,ixya,Zzwx,Wzwy->KWZ', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,ixya,Zzwx,Wzyw->KWZ', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('iKa,ixya,xzwu,ZyzWuw->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/48 * einsum('iKa,ixya,xzwu,ZyzWwu->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('iKa,ixya,xzwu,ZyzuWw->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('iKa,ixya,xzwu,ZyzuwW->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/48 * einsum('iKa,ixya,xzwu,ZyzwWu->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('iKa,ixya,xzwu,ZyzwuW->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/48 * einsum('iKa,ixya,yzwu,ZwuWxz->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/16 * einsum('iKa,ixya,yzwu,ZwuWzx->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/48 * einsum('iKa,ixya,yzwu,ZwuxWz->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/16 * einsum('iKa,ixya,yzwu,ZwuxzW->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/16 * einsum('iKa,ixya,yzwu,ZwuzWx->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/16 * einsum('iKa,ixya,yzwu,ZwuzxW->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma[s_caa__aaa:f_caa__aaa] += sigma_caa.reshape(-1).copy()

            sigma_caa =- 1/2 * einsum('Kia,ia,WZ->KWZ', X_aaa, h_xe, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kia,iZax,Wx->KWZ', X_aaa, v_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kia,ixay,WxZy->KWZ', X_aaa, v_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kia,ixya,WxZy->KWZ', X_aaa, v_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,ixya,WxyZ->KWZ', X_aaa, v_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('ija,ijKa,WZ->KWZ', X_aaa, v_xxxe, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('ija,jiKa,WZ->KWZ', X_aaa, v_xxxe, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,ia,WZ->KWZ', X_abb, h_xe, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,iZax,Wx->KWZ', X_abb, v_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,iZxa,Wx->KWZ', X_abb, v_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,ixay,WxZy->KWZ', X_abb, v_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,ixya,WxZy->KWZ', X_abb, v_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,ixya,WxyZ->KWZ', X_abb, v_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('ija,ijKa,WZ->KWZ', X_abb, v_xxxe, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,ia,WZ->KWZ', X_bab, h_xe, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,iZax,Wx->KWZ', X_bab, v_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('iKa,iZxa,Wx->KWZ', X_bab, v_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,ixay,WxZy->KWZ', X_bab, v_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,ixya,WxZy->KWZ', X_bab, v_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,ixya,WxyZ->KWZ', X_bab, v_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('ija,jiKa,WZ->KWZ', X_bab, v_xxxe, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kia,a,iZax,Wx->KWZ', X_aaa, e_extern, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kia,a,ia,WZ->KWZ', X_aaa, e_extern, t1_xe, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kia,a,ixay,WxZy->KWZ', X_aaa, e_extern, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kia,a,ixya,WxZy->KWZ', X_aaa, e_extern, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,a,ixya,WxyZ->KWZ', X_aaa, e_extern, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kia,i,iZax,Wx->KWZ', X_aaa, e_cvs, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kia,i,ia,WZ->KWZ', X_aaa, e_cvs, t1_xe, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kia,i,ixay,WxZy->KWZ', X_aaa, e_cvs, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kia,i,ixya,WxZy->KWZ', X_aaa, e_cvs, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,i,ixya,WxyZ->KWZ', X_aaa, e_cvs, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kia,Zx,ixay,Wy->KWZ', X_aaa, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kia,xy,iZax,Wy->KWZ', X_aaa, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kia,xy,ixaz,WyZz->KWZ', X_aaa, h_aa, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kia,xy,ixza,WyZz->KWZ', X_aaa, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,xy,ixza,WyzZ->KWZ', X_aaa, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kia,xy,izax,WzZy->KWZ', X_aaa, h_aa, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kia,xy,izxa,WzZy->KWZ', X_aaa, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,xy,izxa,WzyZ->KWZ', X_aaa, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kia,iZax,xyzw,Wyzw->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kia,ixay,Zyzw,Wxzw->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kia,ixay,Zzwx,Wzwy->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kia,ixay,Zzxw,Wzyw->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzWuw->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kia,ixay,xzwu,ZyzWwu->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzuWw->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzuwW->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzwWu->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzwuW->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kia,ixay,yzwu,ZwuWxz->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuWzx->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuxWz->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuxzW->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuzWx->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuzxW->KWZ', X_aaa, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,ixya,Zyzw,Wxwz->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kia,ixya,Zyzw,Wxzw->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kia,ixya,Zzwx,Wzwy->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,ixya,Zzwx,Wzyw->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kia,ixya,xzwu,ZyzWuw->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kia,ixya,xzwu,ZyzWwu->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kia,ixya,xzwu,ZyzuWw->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kia,ixya,xzwu,ZyzuwW->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kia,ixya,xzwu,ZyzwWu->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kia,ixya,xzwu,ZyzwuW->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kia,ixya,yzwu,ZwuWxz->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kia,ixya,yzwu,ZwuWzx->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kia,ixya,yzwu,ZwuxWz->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kia,ixya,yzwu,ZwuxzW->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kia,ixya,yzwu,ZwuzWx->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kia,ixya,yzwu,ZwuzxW->KWZ', X_aaa, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,a,iZax,Wx->KWZ', X_abb, e_extern, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,a,iZxa,Wx->KWZ', X_abb, e_extern, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,a,ia,WZ->KWZ', X_abb, e_extern, t1_xe, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,a,ixay,WxZy->KWZ', X_abb, e_extern, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,a,ixya,WxZy->KWZ', X_abb, e_extern, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,a,ixya,WxyZ->KWZ', X_abb, e_extern, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,i,iZax,Wx->KWZ', X_abb, e_cvs, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,i,iZxa,Wx->KWZ', X_abb, e_cvs, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,i,ia,WZ->KWZ', X_abb, e_cvs, t1_xe, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,i,ixay,WxZy->KWZ', X_abb, e_cvs, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,i,ixya,WxZy->KWZ', X_abb, e_cvs, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,i,ixya,WxyZ->KWZ', X_abb, e_cvs, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,Zx,ixay,Wy->KWZ', X_abb, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,Zx,ixya,Wy->KWZ', X_abb, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,xy,iZax,Wy->KWZ', X_abb, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,xy,iZxa,Wy->KWZ', X_abb, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,xy,ixaz,WyZz->KWZ', X_abb, h_aa, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,xy,ixza,WyZz->KWZ', X_abb, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,xy,ixza,WyzZ->KWZ', X_abb, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,xy,izax,WzZy->KWZ', X_abb, h_aa, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,xy,izxa,WzZy->KWZ', X_abb, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,xy,izxa,WzyZ->KWZ', X_abb, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,iZax,xyzw,Wyzw->KWZ', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,iZxa,xyzw,Wyzw->KWZ', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,ixay,Zyzw,Wxzw->KWZ', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,ixay,Zzwx,Wzwy->KWZ', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,ixay,Zzxw,Wzyw->KWZ', X_abb, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,ixay,xzwu,ZyzWuw->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,ixay,xzwu,ZyzWwu->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,ixay,xzwu,ZyzuWw->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,ixay,xzwu,ZyzuwW->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,ixay,xzwu,ZyzwWu->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,ixay,xzwu,ZyzwuW->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,ixay,yzwu,ZwuWxz->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,ixay,yzwu,ZwuWzx->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,ixay,yzwu,ZwuxWz->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,ixay,yzwu,ZwuxzW->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,ixay,yzwu,ZwuzWx->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,ixay,yzwu,ZwuzxW->KWZ', X_abb, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,ixya,Zyzw,Wxwz->KWZ', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,ixya,Zyzw,Wxzw->KWZ', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,ixya,Zzwx,Wzwy->KWZ', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,ixya,Zzwx,Wzyw->KWZ', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,ixya,Zzxw,Wzyw->KWZ', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/48 * einsum('Kia,ixya,xzwu,ZyzWuw->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('Kia,ixya,xzwu,ZyzWwu->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/48 * einsum('Kia,ixya,xzwu,ZyzuWw->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/48 * einsum('Kia,ixya,xzwu,ZyzuwW->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/48 * einsum('Kia,ixya,xzwu,ZyzwWu->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/48 * einsum('Kia,ixya,xzwu,ZyzwuW->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/16 * einsum('Kia,ixya,yzwu,ZwuWxz->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/48 * einsum('Kia,ixya,yzwu,ZwuWzx->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/48 * einsum('Kia,ixya,yzwu,ZwuxWz->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/48 * einsum('Kia,ixya,yzwu,ZwuxzW->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/48 * einsum('Kia,ixya,yzwu,ZwuzWx->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/48 * einsum('Kia,ixya,yzwu,ZwuzxW->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,a,iZax,Wx->KWZ', X_bab, e_extern, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('iKa,a,iZxa,Wx->KWZ', X_bab, e_extern, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,a,ia,WZ->KWZ', X_bab, e_extern, t1_xe, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,a,ixay,WxZy->KWZ', X_bab, e_extern, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,a,ixya,WxZy->KWZ', X_bab, e_extern, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,a,ixya,WxyZ->KWZ', X_bab, e_extern, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('iKa,i,iZax,Wx->KWZ', X_bab, e_cvs, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,i,iZxa,Wx->KWZ', X_bab, e_cvs, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('iKa,i,ia,WZ->KWZ', X_bab, e_cvs, t1_xe, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('iKa,i,ixay,WxZy->KWZ', X_bab, e_cvs, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,i,ixya,WxZy->KWZ', X_bab, e_cvs, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,i,ixya,WxyZ->KWZ', X_bab, e_cvs, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('iKa,Zx,ixay,Wy->KWZ', X_bab, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,Zx,ixya,Wy->KWZ', X_bab, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,xy,iZax,Wy->KWZ', X_bab, h_aa, t1_xaea, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('iKa,xy,iZxa,Wy->KWZ', X_bab, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('iKa,xy,ixaz,WyZz->KWZ', X_bab, h_aa, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,xy,ixza,WyZz->KWZ', X_bab, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,xy,ixza,WyzZ->KWZ', X_bab, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,xy,izax,WzZy->KWZ', X_bab, h_aa, t1_xaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,xy,izxa,WzZy->KWZ', X_bab, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,xy,izxa,WzyZ->KWZ', X_bab, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,iZax,xyzw,Wyzw->KWZ', X_bab, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('iKa,iZxa,xyzw,Wyzw->KWZ', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,ixay,Zyzw,Wxzw->KWZ', X_bab, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('iKa,ixay,Zzwx,Wzwy->KWZ', X_bab, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('iKa,ixay,Zzxw,Wzyw->KWZ', X_bab, t1_xaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,ixay,xzwu,ZyzWuw->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('iKa,ixay,xzwu,ZyzWwu->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,ixay,xzwu,ZyzuWw->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,ixay,xzwu,ZyzuwW->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,ixay,xzwu,ZyzwWu->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,ixay,xzwu,ZyzwuW->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('iKa,ixay,yzwu,ZwuWxz->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,ixay,yzwu,ZwuWzx->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,ixay,yzwu,ZwuxWz->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,ixay,yzwu,ZwuxzW->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,ixay,yzwu,ZwuzWx->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,ixay,yzwu,ZwuzxW->KWZ', X_bab, t1_xaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,ixya,Zyzw,Wxwz->KWZ', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,ixya,Zyzw,Wxzw->KWZ', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,ixya,Zzwx,Wzwy->KWZ', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,ixya,Zzwx,Wzyw->KWZ', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,ixya,Zzxw,Wzyw->KWZ', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/48 * einsum('iKa,ixya,xzwu,ZyzWuw->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/16 * einsum('iKa,ixya,xzwu,ZyzWwu->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/48 * einsum('iKa,ixya,xzwu,ZyzuWw->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/48 * einsum('iKa,ixya,xzwu,ZyzuwW->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/48 * einsum('iKa,ixya,xzwu,ZyzwWu->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/48 * einsum('iKa,ixya,xzwu,ZyzwuW->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('iKa,ixya,yzwu,ZwuWxz->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/48 * einsum('iKa,ixya,yzwu,ZwuWzx->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/48 * einsum('iKa,ixya,yzwu,ZwuxWz->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/48 * einsum('iKa,ixya,yzwu,ZwuxzW->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/48 * einsum('iKa,ixya,yzwu,ZwuzWx->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/48 * einsum('iKa,ixya,yzwu,ZwuzxW->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma[s_caa__abb:f_caa__abb] += sigma_caa.reshape(-1).copy()

            sigma_caa =- 1/4 * einsum('iKa,iZxa,Wx->KWZ', X_abb, v_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,ixya,WxZy->KWZ', X_abb, v_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('iKa,ixya,WxyZ->KWZ', X_abb, v_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,iZxa,Wx->KWZ', X_bab, v_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,ixya,WxZy->KWZ', X_bab, v_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,ixya,WxyZ->KWZ', X_bab, v_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('iKa,a,iZxa,Wx->KWZ', X_abb, e_extern, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,a,ixya,WxZy->KWZ', X_abb, e_extern, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('iKa,a,ixya,WxyZ->KWZ', X_abb, e_extern, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,i,iZxa,Wx->KWZ', X_abb, e_cvs, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,i,ixya,WxZy->KWZ', X_abb, e_cvs, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('iKa,i,ixya,WxyZ->KWZ', X_abb, e_cvs, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,Zx,ixya,Wy->KWZ', X_abb, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('iKa,xy,iZxa,Wy->KWZ', X_abb, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,xy,ixza,WyZz->KWZ', X_abb, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('iKa,xy,ixza,WyzZ->KWZ', X_abb, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,xy,izxa,WzZy->KWZ', X_abb, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('iKa,xy,izxa,WzyZ->KWZ', X_abb, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('iKa,iZxa,xyzw,Wyzw->KWZ', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('iKa,ixya,Zyzw,Wxwz->KWZ', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('iKa,ixya,Zyzw,Wxzw->KWZ', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('iKa,ixya,Zzwx,Wzwy->KWZ', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('iKa,ixya,Zzwx,Wzyw->KWZ', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('iKa,ixya,Zzxw,Wzyw->KWZ', X_abb, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/16 * einsum('iKa,ixya,xzwu,ZyzWuw->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/48 * einsum('iKa,ixya,xzwu,ZyzWwu->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/16 * einsum('iKa,ixya,xzwu,ZyzuWw->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/16 * einsum('iKa,ixya,xzwu,ZyzuwW->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/48 * einsum('iKa,ixya,xzwu,ZyzwWu->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/16 * einsum('iKa,ixya,xzwu,ZyzwuW->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/48 * einsum('iKa,ixya,yzwu,ZwuWxz->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('iKa,ixya,yzwu,ZwuWzx->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/48 * einsum('iKa,ixya,yzwu,ZwuxWz->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('iKa,ixya,yzwu,ZwuxzW->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('iKa,ixya,yzwu,ZwuzWx->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('iKa,ixya,yzwu,ZwuzxW->KWZ', X_abb, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,a,iZxa,Wx->KWZ', X_bab, e_extern, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,a,ixya,WxZy->KWZ', X_bab, e_extern, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,a,ixya,WxyZ->KWZ', X_bab, e_extern, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,i,iZxa,Wx->KWZ', X_bab, e_cvs, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,i,ixya,WxZy->KWZ', X_bab, e_cvs, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,i,ixya,WxyZ->KWZ', X_bab, e_cvs, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,Zx,ixya,Wy->KWZ', X_bab, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,xy,iZxa,Wy->KWZ', X_bab, h_aa, t1_xaae, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,xy,ixza,WyZz->KWZ', X_bab, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,xy,ixza,WyzZ->KWZ', X_bab, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,xy,izxa,WzZy->KWZ', X_bab, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,xy,izxa,WzyZ->KWZ', X_bab, h_aa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kia,iZxa,xyzw,Wyzw->KWZ', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kia,ixya,Zyzw,Wxwz->KWZ', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kia,ixya,Zyzw,Wxzw->KWZ', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kia,ixya,Zzwx,Wzwy->KWZ', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kia,ixya,Zzwx,Wzyw->KWZ', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kia,ixya,Zzxw,Wzyw->KWZ', X_bab, t1_xaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('Kia,ixya,xzwu,ZyzWuw->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/48 * einsum('Kia,ixya,xzwu,ZyzWwu->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('Kia,ixya,xzwu,ZyzuWw->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('Kia,ixya,xzwu,ZyzuwW->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/48 * einsum('Kia,ixya,xzwu,ZyzwWu->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('Kia,ixya,xzwu,ZyzwuW->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/48 * einsum('Kia,ixya,yzwu,ZwuWxz->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/16 * einsum('Kia,ixya,yzwu,ZwuWzx->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/48 * einsum('Kia,ixya,yzwu,ZwuxWz->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/16 * einsum('Kia,ixya,yzwu,ZwuxzW->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/16 * einsum('Kia,ixya,yzwu,ZwuzWx->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/16 * einsum('Kia,ixya,yzwu,ZwuzxW->KWZ', X_bab, t1_xaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma[s_caa__bab:f_caa__bab] += sigma_caa.reshape(-1).copy()

            # CCA <- CCE
            sigma_cca =- einsum('KLa,Wa->KLW', X_aaa, h_ae, optimize = einsum_type)
            sigma_cca += einsum('Kia,iWLa->KLW', X_aaa, v_xaxe, optimize = einsum_type)
            sigma_cca -= einsum('Kia,iWaL->KLW', X_aaa, v_xaex, optimize = einsum_type)
            sigma_cca -= einsum('Lia,iWKa->KLW', X_aaa, v_xaxe, optimize = einsum_type)
            sigma_cca += einsum('Lia,iWaK->KLW', X_aaa, v_xaex, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('Kia,iWaL->KLW', X_abb, v_xaex, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Lia,iWaK->KLW', X_abb, v_xaex, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('iKa,iWaL->KLW', X_bab, v_xaex, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('iLa,iWaK->KLW', X_bab, v_xaex, optimize = einsum_type)
            sigma_cca -= einsum('KLa,a,Wa->KLW', X_aaa, e_extern, t1_ae, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('KLa,xa,Wx->KLW', X_aaa, h_ae, rdm_ca, optimize = einsum_type)
            sigma_cca += einsum('KLa,Wx,xa->KLW', X_aaa, h_aa, t1_ae, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('KLa,Wxya,xy->KLW', X_aaa, v_aaae, rdm_ca, optimize = einsum_type)
            sigma_cca -= einsum('KLa,xWya,xy->KLW', X_aaa, v_aaae, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('KLa,xyza,Wzyx->KLW', X_aaa, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('Kia,ixLa,Wx->KLW', X_aaa, v_xaxe, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Kia,ixaL,Wx->KLW', X_aaa, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Lia,ixKa,Wx->KLW', X_aaa, v_xaxe, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('Lia,ixaK,Wx->KLW', X_aaa, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('Kia,ixaL,Wx->KLW', X_abb, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('Lia,ixaK,Wx->KLW', X_abb, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('iKa,ixaL,Wx->KLW', X_bab, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('iLa,ixaK,Wx->KLW', X_bab, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cca -= einsum('KLa,a,Wxay,xy->KLW', X_aaa, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('KLa,a,xWay,yx->KLW', X_aaa, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('KLa,a,xa,Wx->KLW', X_aaa, e_extern, t1_ae, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('KLa,a,xyaz,Wzxy->KLW', X_aaa, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cca += einsum('KLa,Wx,xyaz,zy->KLW', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('KLa,Wx,yxaz,zy->KLW', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca += einsum('KLa,xy,Wxaz,yz->KLW', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca -= einsum('KLa,xy,Wzax,yz->KLW', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('KLa,xy,xWaz,yz->KLW', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('KLa,xy,xa,Wy->KLW', X_aaa, h_aa, t1_ae, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('KLa,xy,xzaw,Wwyz->KLW', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('KLa,xy,zWax,yz->KLW', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('KLa,xy,zwax,Wyzw->KLW', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('KLa,xy,zxaw,Wwzy->KLW', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cca += einsum('KLa,Wxay,xzwu,yzwu->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= einsum('KLa,Wxay,yzwu,xzwu->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('KLa,xWay,xzwu,yzwu->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('KLa,xWay,yzwu,xzwu->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += einsum('KLa,xa,Wyxz,yz->KLW', X_aaa, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('KLa,xa,Wyzx,yz->KLW', X_aaa, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('KLa,xa,xyzw,Wyzw->KLW', X_aaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('KLa,xyaz,Wwux,zuyw->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('KLa,xyaz,Wwuy,zuwx->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += einsum('KLa,xyaz,Wwxu,zuyw->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += einsum('KLa,xyaz,Wwxy,zw->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('KLa,xyaz,Wwyu,zuxw->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('KLa,xyaz,Wwyx,zw->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('KLa,xyaz,Wzwu,xywu->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/6 * einsum('KLa,xyaz,xwuv,Wzwuvy->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca -= 1/3 * einsum('KLa,xyaz,xwuv,Wzwuyv->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca += 1/6 * einsum('KLa,xyaz,xwuv,Wzwvuy->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca += 1/6 * einsum('KLa,xyaz,xwuv,Wzwvyu->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca += 1/6 * einsum('KLa,xyaz,xwuv,Wzwyuv->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca += 1/6 * einsum('KLa,xyaz,xwuv,Wzwyvu->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('KLa,xyaz,xywu,Wzwu->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('KLa,xyaz,ywuv,Wzwxuv->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca -= 1/24 * einsum('KLa,xyaz,zwuv,Wuvwxy->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca -= 1/24 * einsum('KLa,xyaz,zwuv,Wuvwyx->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca -= 1/24 * einsum('KLa,xyaz,zwuv,Wuvxwy->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca += 11/24 * einsum('KLa,xyaz,zwuv,Wuvxyw->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca -= 1/24 * einsum('KLa,xyaz,zwuv,Wuvywx->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca -= 1/24 * einsum('KLa,xyaz,zwuv,Wuvyxw->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma[s_cca__aaa:f_cca__aaa] += sigma_cca[cvs_tril_ind[0], cvs_tril_ind[1]].reshape(-1).copy()

            sigma_cca =- einsum('Kia,iWaL->KLW', X_aaa, v_xaex, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('KLa,Wa->KLW', X_abb, h_ae, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Kia,iWLa->KLW', X_abb, v_xaxe, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('Kia,iWaL->KLW', X_abb, v_xaex, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('iLa,iWKa->KLW', X_abb, v_xaxe, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('LKa,Wa->KLW', X_bab, h_ae, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('Lia,iWKa->KLW', X_bab, v_xaxe, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('iKa,iWLa->KLW', X_bab, v_xaxe, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('iKa,iWaL->KLW', X_bab, v_xaex, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Kia,ixaL,Wx->KLW', X_aaa, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('KLa,a,Wa->KLW', X_abb, e_extern, t1_ae, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('KLa,xa,Wx->KLW', X_abb, h_ae, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('KLa,Wx,xa->KLW', X_abb, h_aa, t1_ae, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('KLa,Wxya,xy->KLW', X_abb, v_aaae, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('KLa,xWya,xy->KLW', X_abb, v_aaae, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('KLa,xyza,Wzyx->KLW', X_abb, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('Kia,ixLa,Wx->KLW', X_abb, v_xaxe, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('Kia,ixaL,Wx->KLW', X_abb, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('iLa,ixKa,Wx->KLW', X_abb, v_xaxe, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('LKa,a,Wa->KLW', X_bab, e_extern, t1_ae, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('LKa,xa,Wx->KLW', X_bab, h_ae, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('LKa,Wx,xa->KLW', X_bab, h_aa, t1_ae, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('LKa,Wxya,xy->KLW', X_bab, v_aaae, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('LKa,xWya,xy->KLW', X_bab, v_aaae, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('LKa,xyza,Wzyx->KLW', X_bab, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('Lia,ixKa,Wx->KLW', X_bab, v_xaxe, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('iKa,ixLa,Wx->KLW', X_bab, v_xaxe, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('iKa,ixaL,Wx->KLW', X_bab, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('KLa,a,Wxay,xy->KLW', X_abb, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('KLa,a,xWay,yx->KLW', X_abb, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('KLa,a,xa,Wx->KLW', X_abb, e_extern, t1_ae, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('KLa,a,xyaz,Wzxy->KLW', X_abb, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('KLa,Wx,xyaz,zy->KLW', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('KLa,Wx,yxaz,zy->KLW', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('KLa,xy,Wxaz,yz->KLW', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('KLa,xy,Wzax,yz->KLW', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('KLa,xy,xWaz,yz->KLW', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('KLa,xy,xa,Wy->KLW', X_abb, h_aa, t1_ae, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('KLa,xy,xzaw,Wwyz->KLW', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('KLa,xy,zWax,yz->KLW', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('KLa,xy,zwax,Wyzw->KLW', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('KLa,xy,zxaw,Wwzy->KLW', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('KLa,Wxay,xzwu,yzwu->KLW', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('KLa,Wxay,yzwu,xzwu->KLW', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('KLa,xWay,xzwu,yzwu->KLW', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('KLa,xWay,yzwu,xzwu->KLW', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('KLa,xa,Wyxz,yz->KLW', X_abb, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('KLa,xa,Wyzx,yz->KLW', X_abb, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('KLa,xa,xyzw,Wyzw->KLW', X_abb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('KLa,xyaz,Wwux,zuyw->KLW', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('KLa,xyaz,Wwuy,zuwx->KLW', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('KLa,xyaz,Wwxu,zuyw->KLW', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('KLa,xyaz,Wwxy,zw->KLW', X_abb, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('KLa,xyaz,Wwyu,zuxw->KLW', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('KLa,xyaz,Wwyx,zw->KLW', X_abb, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('KLa,xyaz,Wzwu,xywu->KLW', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/12 * einsum('KLa,xyaz,xwuv,Wzwuvy->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca -= 1/6 * einsum('KLa,xyaz,xwuv,Wzwuyv->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca += 1/12 * einsum('KLa,xyaz,xwuv,Wzwvuy->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca += 1/12 * einsum('KLa,xyaz,xwuv,Wzwvyu->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca += 1/12 * einsum('KLa,xyaz,xwuv,Wzwyuv->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca += 1/12 * einsum('KLa,xyaz,xwuv,Wzwyvu->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('KLa,xyaz,xywu,Wzwu->KLW', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('KLa,xyaz,ywuv,Wzwxuv->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca -= 1/48 * einsum('KLa,xyaz,zwuv,Wuvwxy->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca -= 1/48 * einsum('KLa,xyaz,zwuv,Wuvwyx->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca -= 1/48 * einsum('KLa,xyaz,zwuv,Wuvxwy->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca += 11/48 * einsum('KLa,xyaz,zwuv,Wuvxyw->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca -= 1/48 * einsum('KLa,xyaz,zwuv,Wuvywx->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca -= 1/48 * einsum('KLa,xyaz,zwuv,Wuvyxw->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('LKa,a,Wxay,xy->KLW', X_bab, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('LKa,a,xWay,yx->KLW', X_bab, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('LKa,a,xa,Wx->KLW', X_bab, e_extern, t1_ae, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('LKa,a,xyaz,Wzxy->KLW', X_bab, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('LKa,Wx,xyaz,zy->KLW', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('LKa,Wx,yxaz,zy->KLW', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('LKa,xy,Wxaz,yz->KLW', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('LKa,xy,Wzax,yz->KLW', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('LKa,xy,xWaz,yz->KLW', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('LKa,xy,xa,Wy->KLW', X_bab, h_aa, t1_ae, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('LKa,xy,xzaw,Wwyz->KLW', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('LKa,xy,zWax,yz->KLW', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('LKa,xy,zwax,Wyzw->KLW', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('LKa,xy,zxaw,Wwzy->KLW', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('LKa,Wxay,xzwu,yzwu->KLW', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('LKa,Wxay,yzwu,xzwu->KLW', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('LKa,xWay,xzwu,yzwu->KLW', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('LKa,xWay,yzwu,xzwu->KLW', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('LKa,xa,Wyxz,yz->KLW', X_bab, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('LKa,xa,Wyzx,yz->KLW', X_bab, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('LKa,xa,xyzw,Wyzw->KLW', X_bab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('LKa,xyaz,Wwux,zuyw->KLW', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('LKa,xyaz,Wwuy,zuwx->KLW', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('LKa,xyaz,Wwxu,zuyw->KLW', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('LKa,xyaz,Wwxy,zw->KLW', X_bab, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('LKa,xyaz,Wwyu,zuxw->KLW', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('LKa,xyaz,Wwyx,zw->KLW', X_bab, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/4 * einsum('LKa,xyaz,Wzwu,xywu->KLW', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/12 * einsum('LKa,xyaz,xwuv,Wzwuvy->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca += 1/6 * einsum('LKa,xyaz,xwuv,Wzwuyv->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca -= 1/12 * einsum('LKa,xyaz,xwuv,Wzwvuy->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca -= 1/12 * einsum('LKa,xyaz,xwuv,Wzwvyu->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca -= 1/12 * einsum('LKa,xyaz,xwuv,Wzwyuv->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca -= 1/12 * einsum('LKa,xyaz,xwuv,Wzwyvu->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('LKa,xyaz,xywu,Wzwu->KLW', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/4 * einsum('LKa,xyaz,ywuv,Wzwxuv->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca += 1/48 * einsum('LKa,xyaz,zwuv,Wuvwxy->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca += 1/48 * einsum('LKa,xyaz,zwuv,Wuvwyx->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca += 1/48 * einsum('LKa,xyaz,zwuv,Wuvxwy->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca -= 11/48 * einsum('LKa,xyaz,zwuv,Wuvxyw->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca += 1/48 * einsum('LKa,xyaz,zwuv,Wuvywx->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cca += 1/48 * einsum('LKa,xyaz,zwuv,Wuvyxw->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma[s_cca__abb:f_cca__abb] += sigma_cca.reshape(-1).copy()

            # CVA <- CCE
            if nval > 0:
                sigma_cva  = einsum('Kia,iWLa->KLW', X_aaa, v_xave, optimize = einsum_type)
                sigma_cva -= einsum('Kia,iWaL->KLW', X_aaa, v_xaev, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('Kia,iWaL->KLW', X_abb, v_xaev, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('iKa,iWaL->KLW', X_bab, v_xaev, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('Kia,ixLa,Wx->KLW', X_aaa, v_xave, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('Kia,ixaL,Wx->KLW', X_aaa, v_xaev, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/4 * einsum('Kia,ixaL,Wx->KLW', X_abb, v_xaev, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/4 * einsum('iKa,ixaL,Wx->KLW', X_bab, v_xaev, rdm_ca, optimize = einsum_type)
                sigma[s_cva__aaa:f_cva__aaa] += sigma_cva.reshape(-1).copy()

                sigma_cva =- einsum('Kia,iWaL->KLW', X_aaa, v_xaev, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('Kia,iWLa->KLW', X_abb, v_xave, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('Kia,iWaL->KLW', X_abb, v_xaev, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('iKa,iWLa->KLW', X_bab, v_xave, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('iKa,iWaL->KLW', X_bab, v_xaev, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('Kia,ixaL,Wx->KLW', X_aaa, v_xaev, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/4 * einsum('Kia,ixLa,Wx->KLW', X_abb, v_xave, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/4 * einsum('Kia,ixaL,Wx->KLW', X_abb, v_xaev, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/4 * einsum('iKa,ixLa,Wx->KLW', X_bab, v_xave, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/4 * einsum('iKa,ixaL,Wx->KLW', X_bab, v_xaev, rdm_ca, optimize = einsum_type)
                sigma[s_cva__abb:f_cva__abb] += sigma_cva.reshape(-1).copy()

                sigma_cva =- 1/2 * einsum('iKa,iWLa->KLW', X_abb, v_xave, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('Kia,iWLa->KLW', X_bab, v_xave, optimize = einsum_type)
                sigma_cva += 1/4 * einsum('iKa,ixLa,Wx->KLW', X_abb, v_xave, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/4 * einsum('Kia,ixLa,Wx->KLW', X_bab, v_xave, rdm_ca, optimize = einsum_type)
                sigma[s_cva__bab:f_cva__bab] += sigma_cva.reshape(-1).copy()

            # CCE <- CCE
            sigma_cce  = einsum('Kia,iBLa->KLB', X_aaa, v_xexe, optimize = einsum_type)
            sigma_cce -= einsum('Kia,iBaL->KLB', X_aaa, v_xeex, optimize = einsum_type)
            sigma_cce -= einsum('Lia,iBKa->KLB', X_aaa, v_xexe, optimize = einsum_type)
            sigma_cce += einsum('Lia,iBaK->KLB', X_aaa, v_xeex, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('ijB,KLij->KLB', X_aaa, v_xxxx, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('ijB,KLji->KLB', X_aaa, v_xxxx, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kia,iBaL->KLB', X_abb, v_xeex, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lia,iBaK->KLB', X_abb, v_xeex, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('iKa,iBaL->KLB', X_bab, v_xeex, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('iLa,iBaK->KLB', X_bab, v_xeex, optimize = einsum_type)
            sigma[s_cce__aaa:f_cce__aaa] += sigma_cce[cvs_tril_ind[0], cvs_tril_ind[1]].reshape(-1).copy()

            sigma_cce =- einsum('Kia,iBaL->KLB', X_aaa, v_xeex, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kia,iBLa->KLB', X_abb, v_xexe, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kia,iBaL->KLB', X_abb, v_xeex, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('iLa,iBKa->KLB', X_abb, v_xexe, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('ijB,KLij->KLB', X_abb, v_xxxx, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lia,iBKa->KLB', X_bab, v_xexe, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('iKa,iBLa->KLB', X_bab, v_xexe, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('iKa,iBaL->KLB', X_bab, v_xeex, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('ijB,KLji->KLB', X_bab, v_xxxx, optimize = einsum_type)
            sigma[s_cce__abb:f_cce__abb] += sigma_cce.reshape(-1).copy()

            # CVE <- CCE
            if nval > 0:
                sigma_cve  = einsum('Kia,iBLa->KLB', X_aaa, v_xeve, optimize = einsum_type)
                sigma_cve -= einsum('Kia,iBaL->KLB', X_aaa, v_xeev, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('ijB,KLij->KLB', X_aaa, v_xvxx, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('ijB,KLji->KLB', X_aaa, v_xvxx, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kia,iBaL->KLB', X_abb, v_xeev, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('iKa,iBaL->KLB', X_bab, v_xeev, optimize = einsum_type)
                sigma[s_cve__aaa:f_cve__aaa] += sigma_cve.reshape(-1).copy()

                sigma_cve =- einsum('Kia,iBaL->KLB', X_aaa, v_xeev, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kia,iBLa->KLB', X_abb, v_xeve, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kia,iBaL->KLB', X_abb, v_xeev, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('ijB,KLij->KLB', X_abb, v_xvxx, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('iKa,iBLa->KLB', X_bab, v_xeve, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('iKa,iBaL->KLB', X_bab, v_xeev, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('ijB,KLji->KLB', X_bab, v_xvxx, optimize = einsum_type)
                sigma[s_cve__abb:f_cve__abb] += sigma_cve.reshape(-1).copy()

                sigma_cve =- 1/2 * einsum('iKa,iBLa->KLB', X_abb, v_xeve, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('ijB,KLji->KLB', X_abb, v_xvxx, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kia,iBLa->KLB', X_bab, v_xeve, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('ijB,KLij->KLB', X_bab, v_xvxx, optimize = einsum_type)
                sigma[s_cve__bab:f_cve__bab] += sigma_cve.reshape(-1).copy()

            # CAE <- CCE
            sigma_cae  = 1/2 * einsum('KjB,jx,Zx->KZB', X_aaa, h_xa, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('Kia,iBax,Zx->KZB', X_aaa, v_xeea, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kia,iBxa,Zx->KZB', X_aaa, v_xeae, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('KjB,jxyz,Zxyz->KZB', X_aaa, v_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('ijB,ijKx,Zx->KZB', X_aaa, v_xxxa, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('ijB,jiKx,Zx->KZB', X_aaa, v_xxxa, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('Kia,iBax,Zx->KZB', X_abb, v_xeea, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('iKa,iBax,Zx->KZB', X_bab, v_xeea, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('KjB,j,jx,Zx->KZB', X_aaa, e_cvs, t1_xa, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('KjB,j,jxyz,Zxyz->KZB', X_aaa, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('KjB,xy,jx,Zy->KZB', X_aaa, h_aa, t1_xa, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('KjB,xy,jxzw,Zyzw->KZB', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('KjB,xy,jzwx,Zzwy->KZB', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('KjB,xy,jzxw,Zzyw->KZB', X_aaa, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('KjB,jx,xyzw,Zyzw->KZB', X_aaa, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 11/24 * einsum('KjB,jxyz,xwuv,yzwZuv->KZB', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('KjB,jxyz,xwuv,yzwZvu->KZB', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('KjB,jxyz,xwuv,yzwuZv->KZB', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('KjB,jxyz,xwuv,yzwuvZ->KZB', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('KjB,jxyz,xwuv,yzwvZu->KZB', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/24 * einsum('KjB,jxyz,xwuv,yzwvuZ->KZB', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('KjB,jxyz,ywuv,zuvZwx->KZB', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('KjB,jxyz,ywuv,zuvZxw->KZB', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('KjB,jxyz,ywuv,zuvwZx->KZB', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('KjB,jxyz,ywuv,zuvwxZ->KZB', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('KjB,jxyz,ywuv,zuvxZw->KZB', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('KjB,jxyz,ywuv,zuvxwZ->KZB', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('KjB,jxyz,yzwu,Zxwu->KZB', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('KjB,jxyz,zwuv,yuvZxw->KZB', X_aaa, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma[s_cae__aaa:f_cae__aaa] += sigma_cae.reshape(-1).copy()

            sigma_cae =- 1/2 * einsum('Kia,iBax,Zx->KZB', X_aaa, v_xeea, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('KjB,jx,Zx->KZB', X_abb, h_xa, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('Kia,iBax,Zx->KZB', X_abb, v_xeea, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('Kia,iBxa,Zx->KZB', X_abb, v_xeae, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('KjB,jxyz,Zxyz->KZB', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('ijB,ijKx,Zx->KZB', X_abb, v_xxxa, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('iKB,ix,Zx->KZB', X_bab, h_xa, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('iKB,ixyz,Zxyz->KZB', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('iKa,iBax,Zx->KZB', X_bab, v_xeea, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('iKa,iBxa,Zx->KZB', X_bab, v_xeae, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('ijB,jiKx,Zx->KZB', X_bab, v_xxxa, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('KjB,j,jx,Zx->KZB', X_abb, e_cvs, t1_xa, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('KjB,j,jxyz,Zxyz->KZB', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('KjB,xy,jx,Zy->KZB', X_abb, h_aa, t1_xa, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('KjB,xy,jxzw,Zyzw->KZB', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('KjB,xy,jzwx,Zzwy->KZB', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('KjB,xy,jzxw,Zzyw->KZB', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('KjB,jx,xyzw,Zyzw->KZB', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 11/48 * einsum('KjB,jxyz,xwuv,yzwZuv->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/48 * einsum('KjB,jxyz,xwuv,yzwZvu->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/48 * einsum('KjB,jxyz,xwuv,yzwuZv->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/48 * einsum('KjB,jxyz,xwuv,yzwuvZ->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/48 * einsum('KjB,jxyz,xwuv,yzwvZu->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/48 * einsum('KjB,jxyz,xwuv,yzwvuZ->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('KjB,jxyz,ywuv,zuvZwx->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('KjB,jxyz,ywuv,zuvZxw->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('KjB,jxyz,ywuv,zuvwZx->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('KjB,jxyz,ywuv,zuvwxZ->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('KjB,jxyz,ywuv,zuvxZw->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('KjB,jxyz,ywuv,zuvxwZ->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('KjB,jxyz,yzwu,Zxwu->KZB', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('KjB,jxyz,zwuv,yuvZxw->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('iKB,i,ix,Zx->KZB', X_bab, e_cvs, t1_xa, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('iKB,i,ixyz,Zxyz->KZB', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('iKB,xy,ix,Zy->KZB', X_bab, h_aa, t1_xa, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('iKB,xy,ixzw,Zyzw->KZB', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('iKB,xy,izwx,Zzwy->KZB', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('iKB,xy,izxw,Zzyw->KZB', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('iKB,ix,xyzw,Zyzw->KZB', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 11/48 * einsum('iKB,ixyz,xwuv,yzwZuv->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/48 * einsum('iKB,ixyz,xwuv,yzwZvu->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/48 * einsum('iKB,ixyz,xwuv,yzwuZv->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/48 * einsum('iKB,ixyz,xwuv,yzwuvZ->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/48 * einsum('iKB,ixyz,xwuv,yzwvZu->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/48 * einsum('iKB,ixyz,xwuv,yzwvuZ->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('iKB,ixyz,ywuv,zuvZwx->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('iKB,ixyz,ywuv,zuvZxw->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('iKB,ixyz,ywuv,zuvwZx->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('iKB,ixyz,ywuv,zuvwxZ->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('iKB,ixyz,ywuv,zuvxZw->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('iKB,ixyz,ywuv,zuvxwZ->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('iKB,ixyz,yzwu,Zxwu->KZB', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('iKB,ixyz,zwuv,yuvZxw->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma[s_cae__abb:f_cae__abb] += sigma_cae.reshape(-1).copy()

            sigma_cae =- 1/4 * einsum('iKB,ix,Zx->KZB', X_abb, h_xa, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('iKB,ixyz,Zxyz->KZB', X_abb, v_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('iKa,iBxa,Zx->KZB', X_abb, v_xeae, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('ijB,jiKx,Zx->KZB', X_abb, v_xxxa, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('KjB,jx,Zx->KZB', X_bab, h_xa, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('Kia,iBxa,Zx->KZB', X_bab, v_xeae, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('KjB,jxyz,Zxyz->KZB', X_bab, v_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('ijB,ijKx,Zx->KZB', X_bab, v_xxxa, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('iKB,i,ix,Zx->KZB', X_abb, e_cvs, t1_xa, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('iKB,i,ixyz,Zxyz->KZB', X_abb, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('iKB,xy,ix,Zy->KZB', X_abb, h_aa, t1_xa, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('iKB,xy,ixzw,Zyzw->KZB', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('iKB,xy,izwx,Zzwy->KZB', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('iKB,xy,izxw,Zzyw->KZB', X_abb, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('iKB,ix,xyzw,Zyzw->KZB', X_abb, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 11/48 * einsum('iKB,ixyz,xwuv,yzwZuv->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/48 * einsum('iKB,ixyz,xwuv,yzwZvu->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/48 * einsum('iKB,ixyz,xwuv,yzwuZv->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/48 * einsum('iKB,ixyz,xwuv,yzwuvZ->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/48 * einsum('iKB,ixyz,xwuv,yzwvZu->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/48 * einsum('iKB,ixyz,xwuv,yzwvuZ->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('iKB,ixyz,ywuv,zuvZwx->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('iKB,ixyz,ywuv,zuvZxw->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('iKB,ixyz,ywuv,zuvwZx->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('iKB,ixyz,ywuv,zuvwxZ->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('iKB,ixyz,ywuv,zuvxZw->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/12 * einsum('iKB,ixyz,ywuv,zuvxwZ->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('iKB,ixyz,yzwu,Zxwu->KZB', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('iKB,ixyz,zwuv,yuvZxw->KZB', X_abb, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('KjB,j,jx,Zx->KZB', X_bab, e_cvs, t1_xa, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('KjB,j,jxyz,Zxyz->KZB', X_bab, e_cvs, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('KjB,xy,jx,Zy->KZB', X_bab, h_aa, t1_xa, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('KjB,xy,jxzw,Zyzw->KZB', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('KjB,xy,jzwx,Zzwy->KZB', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('KjB,xy,jzxw,Zzyw->KZB', X_bab, h_aa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('KjB,jx,xyzw,Zyzw->KZB', X_bab, t1_xa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 11/48 * einsum('KjB,jxyz,xwuv,yzwZuv->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/48 * einsum('KjB,jxyz,xwuv,yzwZvu->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/48 * einsum('KjB,jxyz,xwuv,yzwuZv->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/48 * einsum('KjB,jxyz,xwuv,yzwuvZ->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/48 * einsum('KjB,jxyz,xwuv,yzwvZu->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/48 * einsum('KjB,jxyz,xwuv,yzwvuZ->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('KjB,jxyz,ywuv,zuvZwx->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('KjB,jxyz,ywuv,zuvZxw->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('KjB,jxyz,ywuv,zuvwZx->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('KjB,jxyz,ywuv,zuvwxZ->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('KjB,jxyz,ywuv,zuvxZw->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae -= 1/12 * einsum('KjB,jxyz,ywuv,zuvxwZ->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('KjB,jxyz,yzwu,Zxwu->KZB', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('KjB,jxyz,zwuv,yuvZxw->KZB', X_bab, t1_xaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma[s_cae__bab:f_cae__bab] += sigma_cae.reshape(-1).copy()

            if nval > 0:
                # * <- CVE
                X_aaa = Xt[s_cve__aaa:f_cve__aaa].reshape(ncvs, nval, nextern).copy()
                X_abb = Xt[s_cve__abb:f_cve__abb].reshape(ncvs, nval, nextern).copy()
                X_bab = Xt[s_cve__bab:f_cve__bab].reshape(ncvs, nval, nextern).copy()

                # CAA <- CVE
                sigma_caa =- 1/2 * einsum('Kia,ia,WZ->KWZ', X_aaa, h_ve, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,iZax,Wx->KWZ', X_aaa, v_vaea, rdm_ca, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,iZxa,Wx->KWZ', X_aaa, v_vaae, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,ixay,WxZy->KWZ', X_aaa, v_vaea, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixya,WxZy->KWZ', X_aaa, v_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixya,WxyZ->KWZ', X_aaa, v_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('ija,ijKa,WZ->KWZ', X_aaa, v_xvxe, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('ija,jiKa,WZ->KWZ', X_aaa, v_vxxe, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,ia,WZ->KWZ', X_abb, h_ve, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,iZax,Wx->KWZ', X_abb, v_vaea, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,ixay,WxZy->KWZ', X_abb, v_vaea, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/3 * einsum('Kia,ixya,WxZy->KWZ', X_abb, v_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixya,WxyZ->KWZ', X_abb, v_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('ija,ijKa,WZ->KWZ', X_abb, v_xvxe, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('ija,jiKa,WZ->KWZ', X_bab, v_vxxe, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,a,iZax,Wx->KWZ', X_aaa, e_extern, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,a,iZxa,Wx->KWZ', X_aaa, e_extern, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,a,ia,WZ->KWZ', X_aaa, e_extern, t1_ve, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,a,ixay,WxZy->KWZ', X_aaa, e_extern, t1_vaea, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,a,ixya,WxZy->KWZ', X_aaa, e_extern, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,a,ixya,WxyZ->KWZ', X_aaa, e_extern, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,i,iZax,Wx->KWZ', X_aaa, e_val, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,i,iZxa,Wx->KWZ', X_aaa, e_val, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,i,ia,WZ->KWZ', X_aaa, e_val, t1_ve, rdm_ca, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,i,ixay,WxZy->KWZ', X_aaa, e_val, t1_vaea, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,i,ixya,WxZy->KWZ', X_aaa, e_val, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,i,ixya,WxyZ->KWZ', X_aaa, e_val, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,Zx,ixay,Wy->KWZ', X_aaa, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,Zx,ixya,Wy->KWZ', X_aaa, h_aa, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,xy,iZax,Wy->KWZ', X_aaa, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,xy,iZxa,Wy->KWZ', X_aaa, h_aa, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,xy,ixaz,WyZz->KWZ', X_aaa, h_aa, t1_vaea, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,xy,ixza,WyZz->KWZ', X_aaa, h_aa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,xy,ixza,WyzZ->KWZ', X_aaa, h_aa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,xy,izax,WzZy->KWZ', X_aaa, h_aa, t1_vaea, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,xy,izxa,WzZy->KWZ', X_aaa, h_aa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,xy,izxa,WzyZ->KWZ', X_aaa, h_aa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,iZax,xyzw,Wyzw->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,iZxa,xyzw,Wyzw->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,ixay,Zyzw,Wxzw->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,ixay,Zzwx,Wzwy->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,ixay,Zzxw,Wzyw->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzWuw->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/3 * einsum('Kia,ixay,xzwu,ZyzWwu->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzuWw->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzuwW->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzwWu->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzwuW->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/3 * einsum('Kia,ixay,yzwu,ZwuWxz->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuWzx->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuxWz->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuxzW->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuzWx->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuzxW->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixya,Zyzw,Wxwz->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixya,Zyzw,Wxzw->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixya,Zzwx,Wzwy->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixya,Zzwx,Wzyw->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,ixya,Zzxw,Wzyw->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/24 * einsum('Kia,ixya,xzwu,ZyzWuw->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/8 * einsum('Kia,ixya,xzwu,ZyzWwu->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/24 * einsum('Kia,ixya,xzwu,ZyzuWw->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/24 * einsum('Kia,ixya,xzwu,ZyzuwW->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 5/24 * einsum('Kia,ixya,xzwu,ZyzwWu->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/24 * einsum('Kia,ixya,xzwu,ZyzwuW->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/8 * einsum('Kia,ixya,yzwu,ZwuWxz->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/24 * einsum('Kia,ixya,yzwu,ZwuWzx->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 5/24 * einsum('Kia,ixya,yzwu,ZwuxWz->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/24 * einsum('Kia,ixya,yzwu,ZwuxzW->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/24 * einsum('Kia,ixya,yzwu,ZwuzWx->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/24 * einsum('Kia,ixya,yzwu,ZwuzxW->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,a,iZax,Wx->KWZ', X_abb, e_extern, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,a,ia,WZ->KWZ', X_abb, e_extern, t1_ve, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,a,ixay,WxZy->KWZ', X_abb, e_extern, t1_vaea, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/3 * einsum('Kia,a,ixya,WxZy->KWZ', X_abb, e_extern, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,a,ixya,WxyZ->KWZ', X_abb, e_extern, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,i,iZax,Wx->KWZ', X_abb, e_val, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,i,ia,WZ->KWZ', X_abb, e_val, t1_ve, rdm_ca, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,i,ixay,WxZy->KWZ', X_abb, e_val, t1_vaea, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/3 * einsum('Kia,i,ixya,WxZy->KWZ', X_abb, e_val, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,i,ixya,WxyZ->KWZ', X_abb, e_val, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,Zx,ixay,Wy->KWZ', X_abb, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,xy,iZax,Wy->KWZ', X_abb, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,xy,ixaz,WyZz->KWZ', X_abb, h_aa, t1_vaea, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/3 * einsum('Kia,xy,ixza,WyZz->KWZ', X_abb, h_aa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,xy,ixza,WyzZ->KWZ', X_abb, h_aa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,xy,izax,WzZy->KWZ', X_abb, h_aa, t1_vaea, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/3 * einsum('Kia,xy,izxa,WzZy->KWZ', X_abb, h_aa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,xy,izxa,WzyZ->KWZ', X_abb, h_aa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,iZax,xyzw,Wyzw->KWZ', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,ixay,Zyzw,Wxzw->KWZ', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,ixay,Zzwx,Wzwy->KWZ', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,ixay,Zzxw,Wzyw->KWZ', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzWuw->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/3 * einsum('Kia,ixay,xzwu,ZyzWwu->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzuWw->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzuwW->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzwWu->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzwuW->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/3 * einsum('Kia,ixay,yzwu,ZwuWxz->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuWzx->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuxWz->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuxzW->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuzWx->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuzxW->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixya,Zyzw,Wxwz->KWZ', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/3 * einsum('Kia,ixya,Zyzw,Wxzw->KWZ', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/3 * einsum('Kia,ixya,Zzwx,Wzwy->KWZ', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixya,Zzwx,Wzyw->KWZ', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/8 * einsum('Kia,ixya,xzwu,ZyzWuw->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 5/24 * einsum('Kia,ixya,xzwu,ZyzWwu->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/8 * einsum('Kia,ixya,xzwu,ZyzuWw->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/8 * einsum('Kia,ixya,xzwu,ZyzuwW->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/24 * einsum('Kia,ixya,xzwu,ZyzwWu->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/8 * einsum('Kia,ixya,xzwu,ZyzwuW->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 5/24 * einsum('Kia,ixya,yzwu,ZwuWxz->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/8 * einsum('Kia,ixya,yzwu,ZwuWzx->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/24 * einsum('Kia,ixya,yzwu,ZwuxWz->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/8 * einsum('Kia,ixya,yzwu,ZwuxzW->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/8 * einsum('Kia,ixya,yzwu,ZwuzWx->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/8 * einsum('Kia,ixya,yzwu,ZwuzxW->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma[s_caa__aaa:f_caa__aaa] += sigma_caa.reshape(-1).copy()

                sigma_caa =- 1/2 * einsum('Kia,ia,WZ->KWZ', X_aaa, h_ve, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,iZax,Wx->KWZ', X_aaa, v_vaea, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,ixay,WxZy->KWZ', X_aaa, v_vaea, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/3 * einsum('Kia,ixya,WxZy->KWZ', X_aaa, v_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixya,WxyZ->KWZ', X_aaa, v_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('ija,ijKa,WZ->KWZ', X_aaa, v_xvxe, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('ija,jiKa,WZ->KWZ', X_aaa, v_vxxe, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,ia,WZ->KWZ', X_abb, h_ve, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,iZax,Wx->KWZ', X_abb, v_vaea, rdm_ca, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,iZxa,Wx->KWZ', X_abb, v_vaae, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,ixay,WxZy->KWZ', X_abb, v_vaea, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixya,WxZy->KWZ', X_abb, v_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixya,WxyZ->KWZ', X_abb, v_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('ija,ijKa,WZ->KWZ', X_abb, v_xvxe, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('ija,jiKa,WZ->KWZ', X_bab, v_vxxe, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,a,iZax,Wx->KWZ', X_aaa, e_extern, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,a,ia,WZ->KWZ', X_aaa, e_extern, t1_ve, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,a,ixay,WxZy->KWZ', X_aaa, e_extern, t1_vaea, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/3 * einsum('Kia,a,ixya,WxZy->KWZ', X_aaa, e_extern, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,a,ixya,WxyZ->KWZ', X_aaa, e_extern, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,i,iZax,Wx->KWZ', X_aaa, e_val, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,i,ia,WZ->KWZ', X_aaa, e_val, t1_ve, rdm_ca, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,i,ixay,WxZy->KWZ', X_aaa, e_val, t1_vaea, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/3 * einsum('Kia,i,ixya,WxZy->KWZ', X_aaa, e_val, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,i,ixya,WxyZ->KWZ', X_aaa, e_val, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,Zx,ixay,Wy->KWZ', X_aaa, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,xy,iZax,Wy->KWZ', X_aaa, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,xy,ixaz,WyZz->KWZ', X_aaa, h_aa, t1_vaea, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/3 * einsum('Kia,xy,ixza,WyZz->KWZ', X_aaa, h_aa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,xy,ixza,WyzZ->KWZ', X_aaa, h_aa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,xy,izax,WzZy->KWZ', X_aaa, h_aa, t1_vaea, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/3 * einsum('Kia,xy,izxa,WzZy->KWZ', X_aaa, h_aa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,xy,izxa,WzyZ->KWZ', X_aaa, h_aa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,iZax,xyzw,Wyzw->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,ixay,Zyzw,Wxzw->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,ixay,Zzwx,Wzwy->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,ixay,Zzxw,Wzyw->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzWuw->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/3 * einsum('Kia,ixay,xzwu,ZyzWwu->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzuWw->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzuwW->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzwWu->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzwuW->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/3 * einsum('Kia,ixay,yzwu,ZwuWxz->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuWzx->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuxWz->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuxzW->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuzWx->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuzxW->KWZ', X_aaa, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixya,Zyzw,Wxwz->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/3 * einsum('Kia,ixya,Zyzw,Wxzw->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/3 * einsum('Kia,ixya,Zzwx,Wzwy->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixya,Zzwx,Wzyw->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/8 * einsum('Kia,ixya,xzwu,ZyzWuw->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 5/24 * einsum('Kia,ixya,xzwu,ZyzWwu->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/8 * einsum('Kia,ixya,xzwu,ZyzuWw->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/8 * einsum('Kia,ixya,xzwu,ZyzuwW->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/24 * einsum('Kia,ixya,xzwu,ZyzwWu->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/8 * einsum('Kia,ixya,xzwu,ZyzwuW->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 5/24 * einsum('Kia,ixya,yzwu,ZwuWxz->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/8 * einsum('Kia,ixya,yzwu,ZwuWzx->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/24 * einsum('Kia,ixya,yzwu,ZwuxWz->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/8 * einsum('Kia,ixya,yzwu,ZwuxzW->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/8 * einsum('Kia,ixya,yzwu,ZwuzWx->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/8 * einsum('Kia,ixya,yzwu,ZwuzxW->KWZ', X_aaa, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,a,iZax,Wx->KWZ', X_abb, e_extern, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,a,iZxa,Wx->KWZ', X_abb, e_extern, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,a,ia,WZ->KWZ', X_abb, e_extern, t1_ve, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,a,ixay,WxZy->KWZ', X_abb, e_extern, t1_vaea, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,a,ixya,WxZy->KWZ', X_abb, e_extern, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,a,ixya,WxyZ->KWZ', X_abb, e_extern, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,i,iZax,Wx->KWZ', X_abb, e_val, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,i,iZxa,Wx->KWZ', X_abb, e_val, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,i,ia,WZ->KWZ', X_abb, e_val, t1_ve, rdm_ca, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,i,ixay,WxZy->KWZ', X_abb, e_val, t1_vaea, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,i,ixya,WxZy->KWZ', X_abb, e_val, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,i,ixya,WxyZ->KWZ', X_abb, e_val, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,Zx,ixay,Wy->KWZ', X_abb, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,Zx,ixya,Wy->KWZ', X_abb, h_aa, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,xy,iZax,Wy->KWZ', X_abb, h_aa, t1_vaea, rdm_ca, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,xy,iZxa,Wy->KWZ', X_abb, h_aa, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,xy,ixaz,WyZz->KWZ', X_abb, h_aa, t1_vaea, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,xy,ixza,WyZz->KWZ', X_abb, h_aa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,xy,ixza,WyzZ->KWZ', X_abb, h_aa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,xy,izax,WzZy->KWZ', X_abb, h_aa, t1_vaea, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,xy,izxa,WzZy->KWZ', X_abb, h_aa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,xy,izxa,WzyZ->KWZ', X_abb, h_aa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,iZax,xyzw,Wyzw->KWZ', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,iZxa,xyzw,Wyzw->KWZ', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,ixay,Zyzw,Wxzw->KWZ', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,ixay,Zzwx,Wzwy->KWZ', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,ixay,Zzxw,Wzyw->KWZ', X_abb, t1_vaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzWuw->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/3 * einsum('Kia,ixay,xzwu,ZyzWwu->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzuWw->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzuwW->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzwWu->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixay,xzwu,ZyzwuW->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/3 * einsum('Kia,ixay,yzwu,ZwuWxz->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuWzx->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuxWz->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuxzW->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuzWx->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixay,yzwu,ZwuzxW->KWZ', X_abb, t1_vaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixya,Zyzw,Wxwz->KWZ', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixya,Zyzw,Wxzw->KWZ', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixya,Zzwx,Wzwy->KWZ', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixya,Zzwx,Wzyw->KWZ', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,ixya,Zzxw,Wzyw->KWZ', X_abb, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/24 * einsum('Kia,ixya,xzwu,ZyzWuw->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/8 * einsum('Kia,ixya,xzwu,ZyzWwu->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/24 * einsum('Kia,ixya,xzwu,ZyzuWw->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/24 * einsum('Kia,ixya,xzwu,ZyzuwW->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 5/24 * einsum('Kia,ixya,xzwu,ZyzwWu->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/24 * einsum('Kia,ixya,xzwu,ZyzwuW->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/8 * einsum('Kia,ixya,yzwu,ZwuWxz->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/24 * einsum('Kia,ixya,yzwu,ZwuWzx->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 5/24 * einsum('Kia,ixya,yzwu,ZwuxWz->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/24 * einsum('Kia,ixya,yzwu,ZwuxzW->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/24 * einsum('Kia,ixya,yzwu,ZwuzWx->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/24 * einsum('Kia,ixya,yzwu,ZwuzxW->KWZ', X_abb, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma[s_caa__abb:f_caa__abb] += sigma_caa.reshape(-1).copy()

                sigma_caa  = 1/2 * einsum('Kia,iZxa,Wx->KWZ', X_bab, v_vaae, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixya,WxZy->KWZ', X_bab, v_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/3 * einsum('Kia,ixya,WxyZ->KWZ', X_bab, v_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,a,iZxa,Wx->KWZ', X_bab, e_extern, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,a,ixya,WxZy->KWZ', X_bab, e_extern, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/3 * einsum('Kia,a,ixya,WxyZ->KWZ', X_bab, e_extern, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,i,iZxa,Wx->KWZ', X_bab, e_val, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,i,ixya,WxZy->KWZ', X_bab, e_val, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/3 * einsum('Kia,i,ixya,WxyZ->KWZ', X_bab, e_val, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,Zx,ixya,Wy->KWZ', X_bab, h_aa, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,xy,iZxa,Wy->KWZ', X_bab, h_aa, t1_vaae, rdm_ca, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,xy,ixza,WyZz->KWZ', X_bab, h_aa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/3 * einsum('Kia,xy,ixza,WyzZ->KWZ', X_bab, h_aa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,xy,izxa,WzZy->KWZ', X_bab, h_aa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/3 * einsum('Kia,xy,izxa,WzyZ->KWZ', X_bab, h_aa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/2 * einsum('Kia,iZxa,xyzw,Wyzw->KWZ', X_bab, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/3 * einsum('Kia,ixya,Zyzw,Wxwz->KWZ', X_bab, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/6 * einsum('Kia,ixya,Zyzw,Wxzw->KWZ', X_bab, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/6 * einsum('Kia,ixya,Zzwx,Wzwy->KWZ', X_bab, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa += 1/3 * einsum('Kia,ixya,Zzwx,Wzyw->KWZ', X_bab, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/2 * einsum('Kia,ixya,Zzxw,Wzyw->KWZ', X_bab, t1_vaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_caa -= 1/8 * einsum('Kia,ixya,xzwu,ZyzWuw->KWZ', X_bab, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/24 * einsum('Kia,ixya,xzwu,ZyzWwu->KWZ', X_bab, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/8 * einsum('Kia,ixya,xzwu,ZyzuWw->KWZ', X_bab, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/8 * einsum('Kia,ixya,xzwu,ZyzuwW->KWZ', X_bab, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 5/24 * einsum('Kia,ixya,xzwu,ZyzwWu->KWZ', X_bab, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/8 * einsum('Kia,ixya,xzwu,ZyzwuW->KWZ', X_bab, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 1/24 * einsum('Kia,ixya,yzwu,ZwuWxz->KWZ', X_bab, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/8 * einsum('Kia,ixya,yzwu,ZwuWzx->KWZ', X_bab, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa -= 5/24 * einsum('Kia,ixya,yzwu,ZwuxWz->KWZ', X_bab, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/8 * einsum('Kia,ixya,yzwu,ZwuxzW->KWZ', X_bab, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/8 * einsum('Kia,ixya,yzwu,ZwuzWx->KWZ', X_bab, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_caa += 1/8 * einsum('Kia,ixya,yzwu,ZwuzxW->KWZ', X_bab, t1_vaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma[s_caa__bab:f_caa__bab] += sigma_caa.reshape(-1).copy()

                # CCA <- CVE
                sigma_cca  = einsum('Kia,iWLa->KLW', X_aaa, v_vaxe, optimize = einsum_type)
                sigma_cca -= einsum('Kia,iWaL->KLW', X_aaa, v_vaex, optimize = einsum_type)
                sigma_cca -= einsum('Lia,iWKa->KLW', X_aaa, v_vaxe, optimize = einsum_type)
                sigma_cca += einsum('Lia,iWaK->KLW', X_aaa, v_vaex, optimize = einsum_type)
                sigma_cca -= einsum('Kia,iWaL->KLW', X_abb, v_vaex, optimize = einsum_type)
                sigma_cca += einsum('Lia,iWaK->KLW', X_abb, v_vaex, optimize = einsum_type)
                sigma_cca -= 1/2 * einsum('Kia,ixLa,Wx->KLW', X_aaa, v_vaxe, rdm_ca, optimize = einsum_type)
                sigma_cca += 1/2 * einsum('Kia,ixaL,Wx->KLW', X_aaa, v_vaex, rdm_ca, optimize = einsum_type)
                sigma_cca += 1/2 * einsum('Lia,ixKa,Wx->KLW', X_aaa, v_vaxe, rdm_ca, optimize = einsum_type)
                sigma_cca -= 1/2 * einsum('Lia,ixaK,Wx->KLW', X_aaa, v_vaex, rdm_ca, optimize = einsum_type)
                sigma_cca += 1/2 * einsum('Kia,ixaL,Wx->KLW', X_abb, v_vaex, rdm_ca, optimize = einsum_type)
                sigma_cca -= 1/2 * einsum('Lia,ixaK,Wx->KLW', X_abb, v_vaex, rdm_ca, optimize = einsum_type)
                sigma[s_cca__aaa:f_cca__aaa] += sigma_cca[cvs_tril_ind[0], cvs_tril_ind[1]].reshape(-1).copy()

                sigma_cca =- einsum('Kia,iWaL->KLW', X_aaa, v_vaex, optimize = einsum_type)
                sigma_cca += einsum('Kia,iWLa->KLW', X_abb, v_vaxe, optimize = einsum_type)
                sigma_cca -= einsum('Kia,iWaL->KLW', X_abb, v_vaex, optimize = einsum_type)
                sigma_cca -= einsum('Lia,iWKa->KLW', X_bab, v_vaxe, optimize = einsum_type)
                sigma_cca += 1/2 * einsum('Kia,ixaL,Wx->KLW', X_aaa, v_vaex, rdm_ca, optimize = einsum_type)
                sigma_cca -= 1/2 * einsum('Kia,ixLa,Wx->KLW', X_abb, v_vaxe, rdm_ca, optimize = einsum_type)
                sigma_cca += 1/2 * einsum('Kia,ixaL,Wx->KLW', X_abb, v_vaex, rdm_ca, optimize = einsum_type)
                sigma_cca += 1/2 * einsum('Lia,ixKa,Wx->KLW', X_bab, v_vaxe, rdm_ca, optimize = einsum_type)
                sigma[s_cca__abb:f_cca__abb] += sigma_cca.reshape(-1).copy()

                # CVA <- CVE
                sigma_cva =- einsum('KLa,Wa->KLW', X_aaa, h_ae, optimize = einsum_type)
                sigma_cva += einsum('Kia,iWLa->KLW', X_aaa, v_vave, optimize = einsum_type)
                sigma_cva -= einsum('Kia,iWaL->KLW', X_aaa, v_vaev, optimize = einsum_type)
                sigma_cva += einsum('iLa,iWKa->KLW', X_aaa, v_xaxe, optimize = einsum_type)
                sigma_cva -= einsum('iLa,iWaK->KLW', X_aaa, v_xaex, optimize = einsum_type)
                sigma_cva -= einsum('Kia,iWaL->KLW', X_abb, v_vaev, optimize = einsum_type)
                sigma_cva -= einsum('iLa,iWaK->KLW', X_bab, v_xaex, optimize = einsum_type)
                sigma_cva -= einsum('KLa,a,Wa->KLW', X_aaa, e_extern, t1_ae, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,xa,Wx->KLW', X_aaa, h_ae, rdm_ca, optimize = einsum_type)
                sigma_cva += einsum('KLa,Wx,xa->KLW', X_aaa, h_aa, t1_ae, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,Wxya,xy->KLW', X_aaa, v_aaae, rdm_ca, optimize = einsum_type)
                sigma_cva -= einsum('KLa,xWya,xy->KLW', X_aaa, v_aaae, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,xyza,Wzyx->KLW', X_aaa, v_aaae, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('Kia,ixLa,Wx->KLW', X_aaa, v_vave, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('Kia,ixaL,Wx->KLW', X_aaa, v_vaev, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('iLa,ixKa,Wx->KLW', X_aaa, v_xaxe, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('iLa,ixaK,Wx->KLW', X_aaa, v_xaex, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('Kia,ixaL,Wx->KLW', X_abb, v_vaev, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('iLa,ixaK,Wx->KLW', X_bab, v_xaex, rdm_ca, optimize = einsum_type)
                sigma_cva -= einsum('KLa,a,Wxay,xy->KLW', X_aaa, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,a,xWay,yx->KLW', X_aaa, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,a,xa,Wx->KLW', X_aaa, e_extern, t1_ae, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,a,xyaz,Wzxy->KLW', X_aaa, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
                sigma_cva += einsum('KLa,Wx,xyaz,zy->KLW', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,Wx,yxaz,zy->KLW', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva += einsum('KLa,xy,Wxaz,yz->KLW', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva -= einsum('KLa,xy,Wzax,yz->KLW', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xy,xWaz,yz->KLW', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xy,xa,Wy->KLW', X_aaa, h_aa, t1_ae, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xy,xzaw,Wwyz->KLW', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,xy,zWax,yz->KLW', X_aaa, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,xy,zwax,Wyzw->KLW', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xy,zxaw,Wwzy->KLW', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
                sigma_cva += einsum('KLa,Wxay,xzwu,yzwu->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= einsum('KLa,Wxay,yzwu,xzwu->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xWay,xzwu,yzwu->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,xWay,yzwu,xzwu->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva += einsum('KLa,xa,Wyxz,yz->KLW', X_aaa, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xa,Wyzx,yz->KLW', X_aaa, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xa,xyzw,Wyzw->KLW', X_aaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xyaz,Wwux,zuyw->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xyaz,Wwuy,zuwx->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva += einsum('KLa,xyaz,Wwxu,zuyw->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva += einsum('KLa,xyaz,Wwxy,zw->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xyaz,Wwyu,zuxw->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xyaz,Wwyx,zw->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,xyaz,Wzwu,xywu->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva += 1/6 * einsum('KLa,xyaz,xwuv,Wzwuvy->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva -= 1/3 * einsum('KLa,xyaz,xwuv,Wzwuyv->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva += 1/6 * einsum('KLa,xyaz,xwuv,Wzwvuy->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva += 1/6 * einsum('KLa,xyaz,xwuv,Wzwvyu->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva += 1/6 * einsum('KLa,xyaz,xwuv,Wzwyuv->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva += 1/6 * einsum('KLa,xyaz,xwuv,Wzwyvu->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xyaz,xywu,Wzwu->KLW', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xyaz,ywuv,Wzwxuv->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva -= 1/24 * einsum('KLa,xyaz,zwuv,Wuvwxy->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva -= 1/24 * einsum('KLa,xyaz,zwuv,Wuvwyx->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva -= 1/24 * einsum('KLa,xyaz,zwuv,Wuvxwy->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva += 11/24 * einsum('KLa,xyaz,zwuv,Wuvxyw->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva -= 1/24 * einsum('KLa,xyaz,zwuv,Wuvywx->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva -= 1/24 * einsum('KLa,xyaz,zwuv,Wuvyxw->KLW', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma[s_cva__aaa:f_cva__aaa] += sigma_cva.reshape(-1).copy()

                sigma_cva =- einsum('Kia,iWaL->KLW', X_aaa, v_vaev, optimize = einsum_type)
                sigma_cva -= einsum('KLa,Wa->KLW', X_abb, h_ae, optimize = einsum_type)
                sigma_cva += einsum('Kia,iWLa->KLW', X_abb, v_vave, optimize = einsum_type)
                sigma_cva -= einsum('Kia,iWaL->KLW', X_abb, v_vaev, optimize = einsum_type)
                sigma_cva += einsum('iLa,iWKa->KLW', X_abb, v_xaxe, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('Kia,ixaL,Wx->KLW', X_aaa, v_vaev, rdm_ca, optimize = einsum_type)
                sigma_cva -= einsum('KLa,a,Wa->KLW', X_abb, e_extern, t1_ae, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,xa,Wx->KLW', X_abb, h_ae, rdm_ca, optimize = einsum_type)
                sigma_cva += einsum('KLa,Wx,xa->KLW', X_abb, h_aa, t1_ae, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,Wxya,xy->KLW', X_abb, v_aaae, rdm_ca, optimize = einsum_type)
                sigma_cva -= einsum('KLa,xWya,xy->KLW', X_abb, v_aaae, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,xyza,Wzyx->KLW', X_abb, v_aaae, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('Kia,ixLa,Wx->KLW', X_abb, v_vave, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('Kia,ixaL,Wx->KLW', X_abb, v_vaev, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('iLa,ixKa,Wx->KLW', X_abb, v_xaxe, rdm_ca, optimize = einsum_type)
                sigma_cva -= einsum('KLa,a,Wxay,xy->KLW', X_abb, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,a,xWay,yx->KLW', X_abb, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,a,xa,Wx->KLW', X_abb, e_extern, t1_ae, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,a,xyaz,Wzxy->KLW', X_abb, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
                sigma_cva += einsum('KLa,Wx,xyaz,zy->KLW', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,Wx,yxaz,zy->KLW', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva += einsum('KLa,xy,Wxaz,yz->KLW', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva -= einsum('KLa,xy,Wzax,yz->KLW', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xy,xWaz,yz->KLW', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xy,xa,Wy->KLW', X_abb, h_aa, t1_ae, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xy,xzaw,Wwyz->KLW', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,xy,zWax,yz->KLW', X_abb, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,xy,zwax,Wyzw->KLW', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xy,zxaw,Wwzy->KLW', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
                sigma_cva += einsum('KLa,Wxay,xzwu,yzwu->KLW', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= einsum('KLa,Wxay,yzwu,xzwu->KLW', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xWay,xzwu,yzwu->KLW', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,xWay,yzwu,xzwu->KLW', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva += einsum('KLa,xa,Wyxz,yz->KLW', X_abb, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xa,Wyzx,yz->KLW', X_abb, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xa,xyzw,Wyzw->KLW', X_abb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xyaz,Wwux,zuyw->KLW', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xyaz,Wwuy,zuwx->KLW', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva += einsum('KLa,xyaz,Wwxu,zuyw->KLW', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva += einsum('KLa,xyaz,Wwxy,zw->KLW', X_abb, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xyaz,Wwyu,zuxw->KLW', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xyaz,Wwyx,zw->KLW', X_abb, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,xyaz,Wzwu,xywu->KLW', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva += 1/6 * einsum('KLa,xyaz,xwuv,Wzwuvy->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva -= 1/3 * einsum('KLa,xyaz,xwuv,Wzwuyv->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva += 1/6 * einsum('KLa,xyaz,xwuv,Wzwvuy->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva += 1/6 * einsum('KLa,xyaz,xwuv,Wzwvyu->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva += 1/6 * einsum('KLa,xyaz,xwuv,Wzwyuv->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva += 1/6 * einsum('KLa,xyaz,xwuv,Wzwyvu->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xyaz,xywu,Wzwu->KLW', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xyaz,ywuv,Wzwxuv->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva -= 1/24 * einsum('KLa,xyaz,zwuv,Wuvwxy->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva -= 1/24 * einsum('KLa,xyaz,zwuv,Wuvwyx->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva -= 1/24 * einsum('KLa,xyaz,zwuv,Wuvxwy->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva += 11/24 * einsum('KLa,xyaz,zwuv,Wuvxyw->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva -= 1/24 * einsum('KLa,xyaz,zwuv,Wuvywx->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva -= 1/24 * einsum('KLa,xyaz,zwuv,Wuvyxw->KLW', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma[s_cva__abb:f_cva__abb] += sigma_cva.reshape(-1).copy()

                sigma_cva =- einsum('iLa,iWaK->KLW', X_aaa, v_xaex, optimize = einsum_type)
                sigma_cva -= einsum('KLa,Wa->KLW', X_bab, h_ae, optimize = einsum_type)
                sigma_cva += einsum('Kia,iWLa->KLW', X_bab, v_vave, optimize = einsum_type)
                sigma_cva += einsum('iLa,iWKa->KLW', X_bab, v_xaxe, optimize = einsum_type)
                sigma_cva -= einsum('iLa,iWaK->KLW', X_bab, v_xaex, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('iLa,ixaK,Wx->KLW', X_aaa, v_xaex, rdm_ca, optimize = einsum_type)
                sigma_cva -= einsum('KLa,a,Wa->KLW', X_bab, e_extern, t1_ae, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,xa,Wx->KLW', X_bab, h_ae, rdm_ca, optimize = einsum_type)
                sigma_cva += einsum('KLa,Wx,xa->KLW', X_bab, h_aa, t1_ae, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,Wxya,xy->KLW', X_bab, v_aaae, rdm_ca, optimize = einsum_type)
                sigma_cva -= einsum('KLa,xWya,xy->KLW', X_bab, v_aaae, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,xyza,Wzyx->KLW', X_bab, v_aaae, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('Kia,ixLa,Wx->KLW', X_bab, v_vave, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('iLa,ixKa,Wx->KLW', X_bab, v_xaxe, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('iLa,ixaK,Wx->KLW', X_bab, v_xaex, rdm_ca, optimize = einsum_type)
                sigma_cva -= einsum('KLa,a,Wxay,xy->KLW', X_bab, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,a,xWay,yx->KLW', X_bab, e_extern, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,a,xa,Wx->KLW', X_bab, e_extern, t1_ae, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,a,xyaz,Wzxy->KLW', X_bab, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
                sigma_cva += einsum('KLa,Wx,xyaz,zy->KLW', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,Wx,yxaz,zy->KLW', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva += einsum('KLa,xy,Wxaz,yz->KLW', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva -= einsum('KLa,xy,Wzax,yz->KLW', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xy,xWaz,yz->KLW', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xy,xa,Wy->KLW', X_bab, h_aa, t1_ae, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xy,xzaw,Wwyz->KLW', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,xy,zWax,yz->KLW', X_bab, h_aa, t1_aaea, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,xy,zwax,Wyzw->KLW', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xy,zxaw,Wwzy->KLW', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
                sigma_cva += einsum('KLa,Wxay,xzwu,yzwu->KLW', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= einsum('KLa,Wxay,yzwu,xzwu->KLW', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xWay,xzwu,yzwu->KLW', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,xWay,yzwu,xzwu->KLW', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva += einsum('KLa,xa,Wyxz,yz->KLW', X_bab, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xa,Wyzx,yz->KLW', X_bab, t1_ae, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xa,xyzw,Wyzw->KLW', X_bab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xyaz,Wwux,zuyw->KLW', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xyaz,Wwuy,zuwx->KLW', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva += einsum('KLa,xyaz,Wwxu,zuyw->KLW', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva += einsum('KLa,xyaz,Wwxy,zw->KLW', X_bab, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xyaz,Wwyu,zuxw->KLW', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xyaz,Wwyx,zw->KLW', X_bab, t1_aaea, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('KLa,xyaz,Wzwu,xywu->KLW', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva += 1/6 * einsum('KLa,xyaz,xwuv,Wzwuvy->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva -= 1/3 * einsum('KLa,xyaz,xwuv,Wzwuyv->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva += 1/6 * einsum('KLa,xyaz,xwuv,Wzwvuy->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva += 1/6 * einsum('KLa,xyaz,xwuv,Wzwvyu->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva += 1/6 * einsum('KLa,xyaz,xwuv,Wzwyuv->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva += 1/6 * einsum('KLa,xyaz,xwuv,Wzwyvu->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xyaz,xywu,Wzwu->KLW', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('KLa,xyaz,ywuv,Wzwxuv->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva -= 1/24 * einsum('KLa,xyaz,zwuv,Wuvwxy->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva -= 1/24 * einsum('KLa,xyaz,zwuv,Wuvwyx->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva -= 1/24 * einsum('KLa,xyaz,zwuv,Wuvxwy->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva += 11/24 * einsum('KLa,xyaz,zwuv,Wuvxyw->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva -= 1/24 * einsum('KLa,xyaz,zwuv,Wuvywx->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cva -= 1/24 * einsum('KLa,xyaz,zwuv,Wuvyxw->KLW', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma[s_cva__bab:f_cva__bab] += sigma_cva.reshape(-1).copy()

                # CCE <- CVE
                sigma_cce  = einsum('Kia,iBLa->KLB', X_aaa, v_vexe, optimize = einsum_type)
                sigma_cce -= einsum('Kia,iBaL->KLB', X_aaa, v_veex, optimize = einsum_type)
                sigma_cce -= einsum('Lia,iBKa->KLB', X_aaa, v_vexe, optimize = einsum_type)
                sigma_cce += einsum('Lia,iBaK->KLB', X_aaa, v_veex, optimize = einsum_type)
                sigma_cce -= einsum('ijB,KLij->KLB', X_aaa, v_xxxv, optimize = einsum_type)
                sigma_cce += einsum('ijB,KLji->KLB', X_aaa, v_xxvx, optimize = einsum_type)
                sigma_cce -= einsum('Kia,iBaL->KLB', X_abb, v_veex, optimize = einsum_type)
                sigma_cce += einsum('Lia,iBaK->KLB', X_abb, v_veex, optimize = einsum_type)
                sigma[s_cce__aaa:f_cce__aaa] += sigma_cce[cvs_tril_ind[0], cvs_tril_ind[1]].reshape(-1).copy()

                sigma_cce =- einsum('Kia,iBaL->KLB', X_aaa, v_veex, optimize = einsum_type)
                sigma_cce += einsum('Kia,iBLa->KLB', X_abb, v_vexe, optimize = einsum_type)
                sigma_cce -= einsum('Kia,iBaL->KLB', X_abb, v_veex, optimize = einsum_type)
                sigma_cce -= einsum('ijB,KLij->KLB', X_abb, v_xxxv, optimize = einsum_type)
                sigma_cce -= einsum('Lia,iBKa->KLB', X_bab, v_vexe, optimize = einsum_type)
                sigma_cce += einsum('ijB,KLji->KLB', X_bab, v_xxvx, optimize = einsum_type)
                sigma[s_cce__abb:f_cce__abb] += sigma_cce.reshape(-1).copy()

                # CVE <- CVE
                sigma_cve  = einsum('Kia,iBLa->KLB', X_aaa, v_veve, optimize = einsum_type)
                sigma_cve -= einsum('Kia,iBaL->KLB', X_aaa, v_veev, optimize = einsum_type)
                sigma_cve += einsum('iLa,iBKa->KLB', X_aaa, v_xexe, optimize = einsum_type)
                sigma_cve -= einsum('iLa,iBaK->KLB', X_aaa, v_xeex, optimize = einsum_type)
                sigma_cve -= einsum('ijB,KLij->KLB', X_aaa, v_xvxv, optimize = einsum_type)
                sigma_cve += einsum('ijB,KLji->KLB', X_aaa, v_xvvx, optimize = einsum_type)
                sigma_cve -= einsum('Kia,iBaL->KLB', X_abb, v_veev, optimize = einsum_type)
                sigma_cve -= einsum('iLa,iBaK->KLB', X_bab, v_xeex, optimize = einsum_type)
                sigma[s_cve__aaa:f_cve__aaa] += sigma_cve.reshape(-1).copy()

                sigma_cve =- einsum('Kia,iBaL->KLB', X_aaa, v_veev, optimize = einsum_type)
                sigma_cve += einsum('Kia,iBLa->KLB', X_abb, v_veve, optimize = einsum_type)
                sigma_cve -= einsum('Kia,iBaL->KLB', X_abb, v_veev, optimize = einsum_type)
                sigma_cve += einsum('iLa,iBKa->KLB', X_abb, v_xexe, optimize = einsum_type)
                sigma_cve -= einsum('ijB,KLij->KLB', X_abb, v_xvxv, optimize = einsum_type)
                sigma_cve += einsum('ijB,KLji->KLB', X_bab, v_xvvx, optimize = einsum_type)
                sigma[s_cve__abb:f_cve__abb] += sigma_cve.reshape(-1).copy()

                sigma_cve =- einsum('iLa,iBaK->KLB', X_aaa, v_xeex, optimize = einsum_type)
                sigma_cve += einsum('ijB,KLji->KLB', X_abb, v_xvvx, optimize = einsum_type)
                sigma_cve += einsum('Kia,iBLa->KLB', X_bab, v_veve, optimize = einsum_type)
                sigma_cve += einsum('iLa,iBKa->KLB', X_bab, v_xexe, optimize = einsum_type)
                sigma_cve -= einsum('iLa,iBaK->KLB', X_bab, v_xeex, optimize = einsum_type)
                sigma_cve -= einsum('ijB,KLij->KLB', X_bab, v_xvxv, optimize = einsum_type)
                sigma[s_cve__bab:f_cve__bab] += sigma_cve.reshape(-1).copy()

                # CAE <- CVE
                sigma_cae  = 1/2 * einsum('KjB,jx,Zx->KZB', X_aaa, h_va, rdm_ca, optimize = einsum_type)
                sigma_cae -= 1/2 * einsum('Kia,iBax,Zx->KZB', X_aaa, v_veea, rdm_ca, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('Kia,iBxa,Zx->KZB', X_aaa, v_veae, rdm_ca, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,jxyz,Zxyz->KZB', X_aaa, v_vaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cae -= 1/2 * einsum('ijB,ijKx,Zx->KZB', X_aaa, v_xvxa, rdm_ca, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('ijB,jiKx,Zx->KZB', X_aaa, v_vxxa, rdm_ca, optimize = einsum_type)
                sigma_cae -= 1/2 * einsum('Kia,iBax,Zx->KZB', X_abb, v_veea, rdm_ca, optimize = einsum_type)
                sigma_cae -= 1/2 * einsum('KjB,j,jx,Zx->KZB', X_aaa, e_val, t1_va, rdm_ca, optimize = einsum_type)
                sigma_cae -= 1/2 * einsum('KjB,j,jxyz,Zxyz->KZB', X_aaa, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,xy,jx,Zy->KZB', X_aaa, h_aa, t1_va, rdm_ca, optimize = einsum_type)
                sigma_cae -= 1/2 * einsum('KjB,xy,jxzw,Zyzw->KZB', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,xy,jzwx,Zzwy->KZB', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,xy,jzxw,Zzyw->KZB', X_aaa, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,jx,xyzw,Zyzw->KZB', X_aaa, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cae -= 11/24 * einsum('KjB,jxyz,xwuv,yzwZuv->KZB', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae += 1/24 * einsum('KjB,jxyz,xwuv,yzwZvu->KZB', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae += 1/24 * einsum('KjB,jxyz,xwuv,yzwuZv->KZB', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae += 1/24 * einsum('KjB,jxyz,xwuv,yzwuvZ->KZB', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae += 1/24 * einsum('KjB,jxyz,xwuv,yzwvZu->KZB', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae += 1/24 * einsum('KjB,jxyz,xwuv,yzwvuZ->KZB', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae -= 1/6 * einsum('KjB,jxyz,ywuv,zuvZwx->KZB', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae -= 1/6 * einsum('KjB,jxyz,ywuv,zuvZxw->KZB', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae -= 1/6 * einsum('KjB,jxyz,ywuv,zuvwZx->KZB', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae -= 1/6 * einsum('KjB,jxyz,ywuv,zuvwxZ->KZB', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae += 1/3 * einsum('KjB,jxyz,ywuv,zuvxZw->KZB', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae -= 1/6 * einsum('KjB,jxyz,ywuv,zuvxwZ->KZB', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,jxyz,yzwu,Zxwu->KZB', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,jxyz,zwuv,yuvZxw->KZB', X_aaa, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma[s_cae__aaa:f_cae__aaa] += sigma_cae.reshape(-1).copy()

                sigma_cae =- 1/2 * einsum('Kia,iBax,Zx->KZB', X_aaa, v_veea, rdm_ca, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,jx,Zx->KZB', X_abb, h_va, rdm_ca, optimize = einsum_type)
                sigma_cae -= 1/2 * einsum('Kia,iBax,Zx->KZB', X_abb, v_veea, rdm_ca, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('Kia,iBxa,Zx->KZB', X_abb, v_veae, rdm_ca, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,jxyz,Zxyz->KZB', X_abb, v_vaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cae -= 1/2 * einsum('ijB,ijKx,Zx->KZB', X_abb, v_xvxa, rdm_ca, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('ijB,jiKx,Zx->KZB', X_bab, v_vxxa, rdm_ca, optimize = einsum_type)
                sigma_cae -= 1/2 * einsum('KjB,j,jx,Zx->KZB', X_abb, e_val, t1_va, rdm_ca, optimize = einsum_type)
                sigma_cae -= 1/2 * einsum('KjB,j,jxyz,Zxyz->KZB', X_abb, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,xy,jx,Zy->KZB', X_abb, h_aa, t1_va, rdm_ca, optimize = einsum_type)
                sigma_cae -= 1/2 * einsum('KjB,xy,jxzw,Zyzw->KZB', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,xy,jzwx,Zzwy->KZB', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,xy,jzxw,Zzyw->KZB', X_abb, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,jx,xyzw,Zyzw->KZB', X_abb, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cae -= 11/24 * einsum('KjB,jxyz,xwuv,yzwZuv->KZB', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae += 1/24 * einsum('KjB,jxyz,xwuv,yzwZvu->KZB', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae += 1/24 * einsum('KjB,jxyz,xwuv,yzwuZv->KZB', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae += 1/24 * einsum('KjB,jxyz,xwuv,yzwuvZ->KZB', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae += 1/24 * einsum('KjB,jxyz,xwuv,yzwvZu->KZB', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae += 1/24 * einsum('KjB,jxyz,xwuv,yzwvuZ->KZB', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae -= 1/6 * einsum('KjB,jxyz,ywuv,zuvZwx->KZB', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae -= 1/6 * einsum('KjB,jxyz,ywuv,zuvZxw->KZB', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae -= 1/6 * einsum('KjB,jxyz,ywuv,zuvwZx->KZB', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae -= 1/6 * einsum('KjB,jxyz,ywuv,zuvwxZ->KZB', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae += 1/3 * einsum('KjB,jxyz,ywuv,zuvxZw->KZB', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae -= 1/6 * einsum('KjB,jxyz,ywuv,zuvxwZ->KZB', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,jxyz,yzwu,Zxwu->KZB', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,jxyz,zwuv,yuvZxw->KZB', X_abb, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma[s_cae__abb:f_cae__abb] += sigma_cae.reshape(-1).copy()

                sigma_cae  = 1/2 * einsum('ijB,jiKx,Zx->KZB', X_abb, v_vxxa, rdm_ca, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,jx,Zx->KZB', X_bab, h_va, rdm_ca, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('Kia,iBxa,Zx->KZB', X_bab, v_veae, rdm_ca, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,jxyz,Zxyz->KZB', X_bab, v_vaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cae -= 1/2 * einsum('ijB,ijKx,Zx->KZB', X_bab, v_xvxa, rdm_ca, optimize = einsum_type)
                sigma_cae -= 1/2 * einsum('KjB,j,jx,Zx->KZB', X_bab, e_val, t1_va, rdm_ca, optimize = einsum_type)
                sigma_cae -= 1/2 * einsum('KjB,j,jxyz,Zxyz->KZB', X_bab, e_val, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,xy,jx,Zy->KZB', X_bab, h_aa, t1_va, rdm_ca, optimize = einsum_type)
                sigma_cae -= 1/2 * einsum('KjB,xy,jxzw,Zyzw->KZB', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,xy,jzwx,Zzwy->KZB', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,xy,jzxw,Zzyw->KZB', X_bab, h_aa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,jx,xyzw,Zyzw->KZB', X_bab, t1_va, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cae -= 11/24 * einsum('KjB,jxyz,xwuv,yzwZuv->KZB', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae += 1/24 * einsum('KjB,jxyz,xwuv,yzwZvu->KZB', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae += 1/24 * einsum('KjB,jxyz,xwuv,yzwuZv->KZB', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae += 1/24 * einsum('KjB,jxyz,xwuv,yzwuvZ->KZB', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae += 1/24 * einsum('KjB,jxyz,xwuv,yzwvZu->KZB', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae += 1/24 * einsum('KjB,jxyz,xwuv,yzwvuZ->KZB', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae -= 1/6 * einsum('KjB,jxyz,ywuv,zuvZwx->KZB', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae -= 1/6 * einsum('KjB,jxyz,ywuv,zuvZxw->KZB', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae -= 1/6 * einsum('KjB,jxyz,ywuv,zuvwZx->KZB', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae -= 1/6 * einsum('KjB,jxyz,ywuv,zuvwxZ->KZB', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae += 1/3 * einsum('KjB,jxyz,ywuv,zuvxZw->KZB', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae -= 1/6 * einsum('KjB,jxyz,ywuv,zuvxwZ->KZB', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,jxyz,yzwu,Zxwu->KZB', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cae += 1/2 * einsum('KjB,jxyz,zwuv,yuvZxw->KZB', X_bab, t1_vaaa, v_aaaa, rdm_cccaaa, optimize = einsum_type)
                sigma[s_cae__bab:f_cae__bab] += sigma_cae.reshape(-1).copy()

        if nextern > 0:
            # * <- CAE
            X_aaa = Xt[s_cae__aaa:f_cae__aaa].reshape(ncvs, ncas, nextern).copy()
            X_abb = Xt[s_cae__abb:f_cae__abb].reshape(ncvs, ncas, nextern).copy()
            X_bab = Xt[s_cae__bab:f_cae__bab].reshape(ncvs, ncas, nextern).copy()

            # CAA <- CAE
            sigma_caa =- 1/2 * einsum('Kxa,Za,Wx->KWZ', X_aaa, h_ae, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,ya,WyZx->KWZ', X_aaa, h_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,ya,WyxZ->KWZ', X_aaa, h_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,Zyza,Wyxz->KWZ', X_aaa, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,Zyza,Wyzx->KWZ', X_aaa, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kxa,yZza,Wyxz->KWZ', X_aaa, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzwa,ZxwWyz->KWZ', X_aaa, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yzwa,ZxwWzy->KWZ', X_aaa, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzwa,ZxwyWz->KWZ', X_aaa, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzwa,ZxwyzW->KWZ', X_aaa, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kxa,yzwa,ZxwzWy->KWZ', X_aaa, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzwa,ZxwzyW->KWZ', X_aaa, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('ixa,iZKa,Wx->KWZ', X_aaa, v_xaxe, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('ixa,iZaK,Wx->KWZ', X_aaa, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('ixa,iyKa,WyZx->KWZ', X_aaa, v_xaxe, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('ixa,iyKa,WyxZ->KWZ', X_aaa, v_xaxe, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('ixa,iyaK,WyZx->KWZ', X_aaa, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('ixa,iyaK,WyxZ->KWZ', X_aaa, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kxa,ya,WyZx->KWZ', X_abb, h_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,ya,WyxZ->KWZ', X_abb, h_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,Zyza,Wyxz->KWZ', X_abb, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kxa,Zyza,Wyzx->KWZ', X_abb, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yzwa,ZxwWyz->KWZ', X_abb, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kxa,yzwa,ZxwWzy->KWZ', X_abb, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yzwa,ZxwyWz->KWZ', X_abb, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yzwa,ZxwyzW->KWZ', X_abb, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzwa,ZxwzWy->KWZ', X_abb, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yzwa,ZxwzyW->KWZ', X_abb, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('ixa,iyKa,WyZx->KWZ', X_abb, v_xaxe, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('ixa,iyKa,WyxZ->KWZ', X_abb, v_xaxe, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('ixa,iZaK,Wx->KWZ', X_bab, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('ixa,iyaK,WyZx->KWZ', X_bab, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('ixa,iyaK,WyxZ->KWZ', X_bab, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kxa,a,Za,Wx->KWZ', X_aaa, e_extern, t1_ae, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kxa,a,Zyaz,Wyxz->KWZ', X_aaa, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,a,yZaz,Wyxz->KWZ', X_aaa, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,a,yZaz,Wyzx->KWZ', X_aaa, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,a,ya,WyZx->KWZ', X_aaa, e_extern, t1_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,a,ya,WyxZ->KWZ', X_aaa, e_extern, t1_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,a,yzaw,ZxwWyz->KWZ', X_aaa, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,a,yzaw,ZxwWzy->KWZ', X_aaa, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kxa,a,yzaw,ZxwyWz->KWZ', X_aaa, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,a,yzaw,ZxwyzW->KWZ', X_aaa, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,a,yzaw,ZxwzWy->KWZ', X_aaa, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,a,yzaw,ZxwzyW->KWZ', X_aaa, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kxa,Zy,ya,Wx->KWZ', X_aaa, h_aa, t1_ae, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kxa,Zy,yzaw,Wzxw->KWZ', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,Zy,zyaw,Wzwx->KWZ', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,Zy,zyaw,Wzxw->KWZ', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kxa,yz,Zway,Wwxz->KWZ', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kxa,yz,Zyaw,Wzxw->KWZ', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yz,wZay,Wwxz->KWZ', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yz,wZay,Wwzx->KWZ', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yz,wuay,ZxzWuw->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yz,wuay,ZxzWwu->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yz,wuay,ZxzuWw->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yz,wuay,ZxzuwW->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kxa,yz,wuay,ZxzwWu->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yz,wuay,ZxzwuW->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yz,wyau,ZxuWwz->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yz,wyau,ZxuWzw->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kxa,yz,wyau,ZxuwWz->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yz,wyau,ZxuwzW->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yz,wyau,ZxuzWw->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yz,wyau,ZxuzwW->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yz,yZaw,Wzwx->KWZ', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yz,yZaw,Wzxw->KWZ', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yz,ya,WzZx->KWZ', X_aaa, h_aa, t1_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yz,ya,WzxZ->KWZ', X_aaa, h_aa, t1_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yz,ywau,ZxuWzw->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yz,ywau,ZxuzWw->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/12 * einsum('Kxa,Zyaz,ywuv,xzwWuv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,Zyaz,ywuv,xzwWvu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,Zyaz,ywuv,xzwuWv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,Zyaz,ywuv,xzwuvW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,Zyaz,ywuv,xzwvWu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,Zyaz,ywuv,xzwvuW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kxa,Zyaz,zwuv,xuvWyw->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yZaz,ywuv,xzwWuv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yZaz,ywuv,xzwWvu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kxa,yZaz,ywuv,xzwuWv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yZaz,ywuv,xzwuvW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yZaz,ywuv,xzwvWu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yZaz,ywuv,xzwvuW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yZaz,zwuv,xuvWwy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kxa,yZaz,zwuv,xuvWyw->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yZaz,zwuv,xuvwWy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yZaz,zwuv,xuvwyW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yZaz,zwuv,xuvyWw->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yZaz,zwuv,xuvywW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,ya,Zzwy,Wzwx->KWZ', X_aaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,ya,Zzwy,Wzxw->KWZ', X_aaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kxa,ya,Zzyw,Wzxw->KWZ', X_aaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,ya,yzwu,ZxzWuw->KWZ', X_aaa, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,ya,yzwu,ZxzWwu->KWZ', X_aaa, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,ya,yzwu,ZxzuWw->KWZ', X_aaa, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,ya,yzwu,ZxzuwW->KWZ', X_aaa, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kxa,ya,yzwu,ZxzwWu->KWZ', X_aaa, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,ya,yzwu,ZxzwuW->KWZ', X_aaa, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuvy,xwvWuz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kxa,yzaw,Zuvy,xwvWzu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuvy,xwvuWz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zuvy,xwvuzW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuvy,xwvzWu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuvy,xwvzuW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yzaw,Zuvz,xwvWuy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yzaw,Zuvz,xwvyuW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kxa,yzaw,Zuyv,xwvWzu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kxa,yzaw,Zuyz,Wuxw->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuzv,xwvWuy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kxa,yzaw,Zuzv,xwvWyu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuzv,xwvuWy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuzv,xwvuyW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zuzv,xwvyWu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuzv,xwvyuW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yzaw,Zuzy,Wuwx->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yzaw,Zuzy,Wuxw->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kxa,yzaw,Zwuv,xuvWyz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzaw,Zwuv,xuvWzy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yzaw,Zwuv,xuvyWz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzaw,Zwuv,xuvyzW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzaw,Zwuv,xuvzWy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzaw,Zwuv,xuvzyW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kxa,yzaw,wuvs,ZxvsWuyz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kxa,yzaw,wuvs,ZxvsWuzy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/240 * einsum('Kxa,yzaw,wuvs,ZxvsWyuz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/80 * einsum('Kxa,yzaw,wuvs,ZxvsWyzu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/80 * einsum('Kxa,yzaw,wuvs,ZxvsWzuy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/80 * einsum('Kxa,yzaw,wuvs,ZxvsWzyu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/40 * einsum('Kxa,yzaw,wuvs,ZxvsuWyz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/120 * einsum('Kxa,yzaw,wuvs,ZxvsuWzy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 17/240 * einsum('Kxa,yzaw,wuvs,ZxvsuyWz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/240 * einsum('Kxa,yzaw,wuvs,ZxvsuyzW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/80 * einsum('Kxa,yzaw,wuvs,ZxvsuzWy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 9/80 * einsum('Kxa,yzaw,wuvs,ZxvsuzyW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 41/240 * einsum('Kxa,yzaw,wuvs,ZxvsyWuz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 5/48 * einsum('Kxa,yzaw,wuvs,ZxvsyWzu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 41/240 * einsum('Kxa,yzaw,wuvs,ZxvsyuWz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 19/80 * einsum('Kxa,yzaw,wuvs,ZxvsyuzW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,wuvs,ZxvsyzWu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 31/120 * einsum('Kxa,yzaw,wuvs,ZxvsyzuW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/80 * einsum('Kxa,yzaw,wuvs,ZxvszWuy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/16 * einsum('Kxa,yzaw,wuvs,ZxvszWyu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/80 * einsum('Kxa,yzaw,wuvs,ZxvszuWy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 9/80 * einsum('Kxa,yzaw,wuvs,ZxvszuyW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 19/120 * einsum('Kxa,yzaw,wuvs,ZxvszyWu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kxa,yzaw,wuvs,ZxvszyuW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/120 * einsum('Kxa,yzaw,yuvs,ZxwuWsvz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/30 * einsum('Kxa,yzaw,yuvs,ZxwuWszv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yzaw,yuvs,ZxwuWvsz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/30 * einsum('Kxa,yzaw,yuvs,ZxwuWzsv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/60 * einsum('Kxa,yzaw,yuvs,ZxwuWzvs->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/120 * einsum('Kxa,yzaw,yuvs,ZxwusWvz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,yuvs,ZxwusWzv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kxa,yzaw,yuvs,ZxwusvWz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 19/120 * einsum('Kxa,yzaw,yuvs,ZxwusvzW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 11/120 * einsum('Kxa,yzaw,yuvs,ZxwuszWv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/40 * einsum('Kxa,yzaw,yuvs,ZxwuszvW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 23/120 * einsum('Kxa,yzaw,yuvs,ZxwuvWsz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kxa,yzaw,yuvs,ZxwuvWzs->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/60 * einsum('Kxa,yzaw,yuvs,ZxwuvsWz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/120 * einsum('Kxa,yzaw,yuvs,ZxwuvszW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/40 * einsum('Kxa,yzaw,yuvs,ZxwuvzWs->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/120 * einsum('Kxa,yzaw,yuvs,ZxwuvzsW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 2/15 * einsum('Kxa,yzaw,yuvs,ZxwuzWsv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/60 * einsum('Kxa,yzaw,yuvs,ZxwuzWvs->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,yuvs,ZxwuzsWv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/40 * einsum('Kxa,yzaw,yuvs,ZxwuzsvW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 29/120 * einsum('Kxa,yzaw,yuvs,ZxwuzvWs->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 13/120 * einsum('Kxa,yzaw,yuvs,ZxwuzvsW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yzaw,yzuv,ZxwWuv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,yzuv,ZxwWvu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kxa,yzaw,yzuv,ZxwuWv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,yzuv,ZxwuvW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,yzuv,ZxwvWu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,yzuv,ZxwvuW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kxa,yzaw,zuvs,ZxwuWsvy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/30 * einsum('Kxa,yzaw,zuvs,ZxwuWsyv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,zuvs,ZxwuWvsy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/10 * einsum('Kxa,yzaw,zuvs,ZxwusWvy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kxa,yzaw,zuvs,ZxwusWyv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/120 * einsum('Kxa,yzaw,zuvs,ZxwusvWy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/120 * einsum('Kxa,yzaw,zuvs,ZxwusvyW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/120 * einsum('Kxa,yzaw,zuvs,ZxwusyWv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/40 * einsum('Kxa,yzaw,zuvs,ZxwusyvW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,zuvs,ZxwuvWsy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 17/120 * einsum('Kxa,yzaw,zuvs,ZxwuvsWy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 17/120 * einsum('Kxa,yzaw,zuvs,ZxwuvsyW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/40 * einsum('Kxa,yzaw,zuvs,ZxwuvyWs->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/120 * einsum('Kxa,yzaw,zuvs,ZxwuvysW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/60 * einsum('Kxa,yzaw,zuvs,ZxwuyWsv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 7/60 * einsum('Kxa,yzaw,zuvs,ZxwuyWvs->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/40 * einsum('Kxa,yzaw,zuvs,ZxwuysWv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 23/120 * einsum('Kxa,yzaw,zuvs,ZxwuysvW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 29/120 * einsum('Kxa,yzaw,zuvs,ZxwuyvWs->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/40 * einsum('Kxa,yzaw,zuvs,ZxwuyvsW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,a,yZaz,Wyxz->KWZ', X_abb, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kxa,a,yZaz,Wyzx->KWZ', X_abb, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kxa,a,ya,WyZx->KWZ', X_abb, e_extern, t1_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,a,ya,WyxZ->KWZ', X_abb, e_extern, t1_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kxa,a,yzaw,ZxwWyz->KWZ', X_abb, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,a,yzaw,ZxwWzy->KWZ', X_abb, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,a,yzaw,ZxwyWz->KWZ', X_abb, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,a,yzaw,ZxwyzW->KWZ', X_abb, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,a,yzaw,ZxwzWy->KWZ', X_abb, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,a,yzaw,ZxwzyW->KWZ', X_abb, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kxa,Zy,zyaw,Wzwx->KWZ', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,Zy,zyaw,Wzxw->KWZ', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yz,wZay,Wwxz->KWZ', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kxa,yz,wZay,Wwzx->KWZ', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yz,wuay,ZxzWuw->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kxa,yz,wuay,ZxzWwu->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yz,wuay,ZxzuWw->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yz,wuay,ZxzuwW->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yz,wuay,ZxzwWu->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yz,wuay,ZxzwuW->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kxa,yz,wyau,ZxuWwz->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yz,wyau,ZxuWzw->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yz,wyau,ZxuwWz->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yz,wyau,ZxuwzW->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yz,wyau,ZxuzWw->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yz,wyau,ZxuzwW->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kxa,yz,yZaw,Wzwx->KWZ', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yz,yZaw,Wzxw->KWZ', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kxa,yz,ya,WzZx->KWZ', X_abb, h_aa, t1_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yz,ya,WzxZ->KWZ', X_abb, h_aa, t1_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yz,ywau,ZxuWwz->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yz,ywau,ZxuWzw->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yz,ywau,ZxuwWz->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yz,ywau,ZxuwzW->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yz,ywau,ZxuzwW->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yZaz,ywuv,xzwWuv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yZaz,ywuv,xzwWvu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 7/24 * einsum('Kxa,yZaz,ywuv,xzwuWv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yZaz,ywuv,xzwuvW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yZaz,ywuv,xzwvWu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yZaz,ywuv,xzwvuW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yZaz,zwuv,xuvWwy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yZaz,zwuv,xuvWyw->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yZaz,zwuv,xuvwWy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yZaz,zwuv,xuvwyW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kxa,yZaz,zwuv,xuvyWw->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yZaz,zwuv,xuvywW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kxa,ya,Zzwy,Wzwx->KWZ', X_abb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,ya,Zzwy,Wzxw->KWZ', X_abb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,ya,yzwu,ZxzWuw->KWZ', X_abb, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kxa,ya,yzwu,ZxzWwu->KWZ', X_abb, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,ya,yzwu,ZxzuWw->KWZ', X_abb, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,ya,yzwu,ZxzuwW->KWZ', X_abb, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,ya,yzwu,ZxzwWu->KWZ', X_abb, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,ya,yzwu,ZxzwuW->KWZ', X_abb, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuvy,xwvWuz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zuvy,xwvWzu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuvy,xwvuWz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kxa,yzaw,Zuvy,xwvuzW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuvy,xwvzWu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuvy,xwvzuW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yzaw,Zuvz,xwvWyu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yzaw,Zuvz,xwvuWy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yzaw,Zuvz,xwvuyW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yzaw,Zuvz,xwvyWu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yzaw,Zuvz,xwvyuW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuzv,xwvWuy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zuzv,xwvWyu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuzv,xwvuWy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuzv,xwvuyW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kxa,yzaw,Zuzv,xwvyWu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuzv,xwvyuW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kxa,yzaw,Zuzy,Wuwx->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yzaw,Zuzy,Wuxw->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zwuv,xuvWyz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zwuv,xuvWzy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kxa,yzaw,Zwuv,xuvyWz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zwuv,xuvyzW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zwuv,xuvzWy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zwuv,xuvzyW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/30 * einsum('Kxa,yzaw,wuvs,ZxvsWuyz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kxa,yzaw,wuvs,ZxvsWuzy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/40 * einsum('Kxa,yzaw,wuvs,ZxvsWyuz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kxa,yzaw,wuvs,ZxvsWyzu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 13/120 * einsum('Kxa,yzaw,wuvs,ZxvsWzuy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,wuvs,ZxvsWzyu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/30 * einsum('Kxa,yzaw,wuvs,ZxvsuWyz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/20 * einsum('Kxa,yzaw,wuvs,ZxvsuWzy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/40 * einsum('Kxa,yzaw,wuvs,ZxvsuyWz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/40 * einsum('Kxa,yzaw,wuvs,ZxvsuyzW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 19/120 * einsum('Kxa,yzaw,wuvs,ZxvsuzWy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yzaw,wuvs,ZxvsuzyW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/15 * einsum('Kxa,yzaw,wuvs,ZxvsyWuz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/40 * einsum('Kxa,yzaw,wuvs,ZxvsyWzu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 11/60 * einsum('Kxa,yzaw,wuvs,ZxvsyuWz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 2/15 * einsum('Kxa,yzaw,wuvs,ZxvsyuzW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/15 * einsum('Kxa,yzaw,wuvs,ZxvsyzWu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 9/40 * einsum('Kxa,yzaw,wuvs,ZxvsyzuW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,wuvs,ZxvszWuy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/20 * einsum('Kxa,yzaw,wuvs,ZxvszWyu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 19/120 * einsum('Kxa,yzaw,wuvs,ZxvszuWy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yzaw,wuvs,ZxvszuyW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 17/120 * einsum('Kxa,yzaw,wuvs,ZxvszyWu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kxa,yzaw,wuvs,ZxvszyuW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/120 * einsum('Kxa,yzaw,yuvs,ZxwuWsvz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 7/40 * einsum('Kxa,yzaw,yuvs,ZxwuWvsz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/15 * einsum('Kxa,yzaw,yuvs,ZxwuWzsv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/20 * einsum('Kxa,yzaw,yuvs,ZxwusWvz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,yuvs,ZxwusWzv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 9/40 * einsum('Kxa,yzaw,yuvs,ZxwusvWz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 17/60 * einsum('Kxa,yzaw,yuvs,ZxwusvzW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/60 * einsum('Kxa,yzaw,yuvs,ZxwuszWv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/20 * einsum('Kxa,yzaw,yuvs,ZxwuszvW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,yuvs,ZxwuvWsz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/120 * einsum('Kxa,yzaw,yuvs,ZxwuvWzs->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/40 * einsum('Kxa,yzaw,yuvs,ZxwuvsWz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/60 * einsum('Kxa,yzaw,yuvs,ZxwuvszW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kxa,yzaw,yuvs,ZxwuvzWs->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,yuvs,ZxwuvzsW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/60 * einsum('Kxa,yzaw,yuvs,ZxwuzWsv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/20 * einsum('Kxa,yzaw,yuvs,ZxwuzWvs->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/120 * einsum('Kxa,yzaw,yuvs,ZxwuzsWv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 17/120 * einsum('Kxa,yzaw,yuvs,ZxwuzsvW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 9/40 * einsum('Kxa,yzaw,yuvs,ZxwuzvWs->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yzaw,yuvs,ZxwuzvsW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kxa,yzaw,yzuv,ZxwWuv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yzaw,yzuv,ZxwWvu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzaw,yzuv,ZxwuWv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yzaw,yzuv,ZxwuvW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yzaw,yzuv,ZxwvWu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yzaw,yzuv,ZxwvuW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 2/15 * einsum('Kxa,yzaw,zuvs,ZxwuWsvy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/30 * einsum('Kxa,yzaw,zuvs,ZxwuWsyv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/60 * einsum('Kxa,yzaw,zuvs,ZxwuWvsy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/60 * einsum('Kxa,yzaw,zuvs,ZxwuWvys->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kxa,yzaw,zuvs,ZxwusWvy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,zuvs,ZxwusWyv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/30 * einsum('Kxa,yzaw,zuvs,ZxwusvWy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/30 * einsum('Kxa,yzaw,zuvs,ZxwusvyW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/20 * einsum('Kxa,yzaw,zuvs,ZxwusyWv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 7/60 * einsum('Kxa,yzaw,zuvs,ZxwusyvW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/40 * einsum('Kxa,yzaw,zuvs,ZxwuvWsy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 11/120 * einsum('Kxa,yzaw,zuvs,ZxwuvWys->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/5 * einsum('Kxa,yzaw,zuvs,ZxwuvsWy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/5 * einsum('Kxa,yzaw,zuvs,ZxwuvsyW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yzaw,zuvs,ZxwuvysW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/60 * einsum('Kxa,yzaw,zuvs,ZxwuyWsv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kxa,yzaw,zuvs,ZxwuyWvs->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 29/120 * einsum('Kxa,yzaw,zuvs,ZxwuysWv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/40 * einsum('Kxa,yzaw,zuvs,ZxwuysvW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 9/40 * einsum('Kxa,yzaw,zuvs,ZxwuyvWs->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 47/120 * einsum('Kxa,yzaw,zuvs,ZxwuyvsW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma[s_caa__aaa:f_caa__aaa] += sigma_caa.reshape(-1).copy()

            sigma_caa =- 1/3 * einsum('Kxa,ya,WyZx->KWZ', X_aaa, h_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,ya,WyxZ->KWZ', X_aaa, h_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,Zyza,Wyxz->KWZ', X_aaa, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kxa,Zyza,Wyzx->KWZ', X_aaa, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yzwa,ZxwWyz->KWZ', X_aaa, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kxa,yzwa,ZxwWzy->KWZ', X_aaa, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yzwa,ZxwyWz->KWZ', X_aaa, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yzwa,ZxwyzW->KWZ', X_aaa, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzwa,ZxwzWy->KWZ', X_aaa, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yzwa,ZxwzyW->KWZ', X_aaa, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('ixa,iyKa,WyZx->KWZ', X_aaa, v_xaxe, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('ixa,iyKa,WyxZ->KWZ', X_aaa, v_xaxe, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('ixa,iyaK,WyZx->KWZ', X_aaa, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('ixa,iyaK,WyxZ->KWZ', X_aaa, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kxa,Za,Wx->KWZ', X_abb, h_ae, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,ya,WyZx->KWZ', X_abb, h_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,ya,WyxZ->KWZ', X_abb, h_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,Zyza,Wyxz->KWZ', X_abb, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,Zyza,Wyzx->KWZ', X_abb, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kxa,yZza,Wyxz->KWZ', X_abb, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzwa,ZxwWyz->KWZ', X_abb, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yzwa,ZxwWzy->KWZ', X_abb, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzwa,ZxwyWz->KWZ', X_abb, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzwa,ZxwyzW->KWZ', X_abb, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kxa,yzwa,ZxwzWy->KWZ', X_abb, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzwa,ZxwzyW->KWZ', X_abb, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('ixa,iZKa,Wx->KWZ', X_abb, v_xaxe, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('ixa,iyKa,WyZx->KWZ', X_abb, v_xaxe, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('ixa,iyKa,WyxZ->KWZ', X_abb, v_xaxe, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('ixa,iyaK,WyZx->KWZ', X_bab, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('ixa,iyaK,WyxZ->KWZ', X_bab, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,a,yZaz,Wyxz->KWZ', X_aaa, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kxa,a,yZaz,Wyzx->KWZ', X_aaa, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kxa,a,ya,WyZx->KWZ', X_aaa, e_extern, t1_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,a,ya,WyxZ->KWZ', X_aaa, e_extern, t1_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kxa,a,yzaw,ZxwWyz->KWZ', X_aaa, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,a,yzaw,ZxwWzy->KWZ', X_aaa, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,a,yzaw,ZxwyWz->KWZ', X_aaa, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,a,yzaw,ZxwyzW->KWZ', X_aaa, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,a,yzaw,ZxwzWy->KWZ', X_aaa, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,a,yzaw,ZxwzyW->KWZ', X_aaa, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kxa,Zy,zyaw,Wzwx->KWZ', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,Zy,zyaw,Wzxw->KWZ', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yz,wZay,Wwxz->KWZ', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kxa,yz,wZay,Wwzx->KWZ', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yz,wuay,ZxzWuw->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kxa,yz,wuay,ZxzWwu->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yz,wuay,ZxzuWw->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yz,wuay,ZxzuwW->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yz,wuay,ZxzwWu->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yz,wuay,ZxzwuW->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kxa,yz,wyau,ZxuWwz->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yz,wyau,ZxuWzw->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yz,wyau,ZxuwWz->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yz,wyau,ZxuwzW->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yz,wyau,ZxuzWw->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yz,wyau,ZxuzwW->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kxa,yz,yZaw,Wzwx->KWZ', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yz,yZaw,Wzxw->KWZ', X_aaa, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kxa,yz,ya,WzZx->KWZ', X_aaa, h_aa, t1_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yz,ya,WzxZ->KWZ', X_aaa, h_aa, t1_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yz,ywau,ZxuWwz->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yz,ywau,ZxuWzw->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yz,ywau,ZxuwWz->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yz,ywau,ZxuwzW->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yz,ywau,ZxuzwW->KWZ', X_aaa, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yZaz,ywuv,xzwWuv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yZaz,ywuv,xzwWvu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 7/24 * einsum('Kxa,yZaz,ywuv,xzwuWv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yZaz,ywuv,xzwuvW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yZaz,ywuv,xzwvWu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yZaz,ywuv,xzwvuW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yZaz,zwuv,xuvWwy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yZaz,zwuv,xuvWyw->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yZaz,zwuv,xuvwWy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yZaz,zwuv,xuvwyW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kxa,yZaz,zwuv,xuvyWw->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yZaz,zwuv,xuvywW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kxa,ya,Zzwy,Wzwx->KWZ', X_aaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,ya,Zzwy,Wzxw->KWZ', X_aaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,ya,yzwu,ZxzWuw->KWZ', X_aaa, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kxa,ya,yzwu,ZxzWwu->KWZ', X_aaa, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,ya,yzwu,ZxzuWw->KWZ', X_aaa, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,ya,yzwu,ZxzuwW->KWZ', X_aaa, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,ya,yzwu,ZxzwWu->KWZ', X_aaa, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,ya,yzwu,ZxzwuW->KWZ', X_aaa, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuvy,xwvWuz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zuvy,xwvWzu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuvy,xwvuWz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kxa,yzaw,Zuvy,xwvuzW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuvy,xwvzWu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuvy,xwvzuW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yzaw,Zuvz,xwvWyu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yzaw,Zuvz,xwvuWy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yzaw,Zuvz,xwvuyW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yzaw,Zuvz,xwvyWu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yzaw,Zuvz,xwvyuW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuzv,xwvWuy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zuzv,xwvWyu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuzv,xwvuWy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuzv,xwvuyW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kxa,yzaw,Zuzv,xwvyWu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuzv,xwvyuW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kxa,yzaw,Zuzy,Wuwx->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yzaw,Zuzy,Wuxw->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zwuv,xuvWyz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zwuv,xuvWzy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kxa,yzaw,Zwuv,xuvyWz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zwuv,xuvyzW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zwuv,xuvzWy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zwuv,xuvzyW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 7/120 * einsum('Kxa,yzaw,wuvs,ZxvsWuyz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,wuvs,ZxvsWuzy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/10 * einsum('Kxa,yzaw,wuvs,ZxvsWyuz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kxa,yzaw,wuvs,ZxvsWyzu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,wuvs,ZxvsWzuy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,wuvs,ZxvsWzyu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,wuvs,ZxvsuWyz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/40 * einsum('Kxa,yzaw,wuvs,ZxvsuWzy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/40 * einsum('Kxa,yzaw,wuvs,ZxvsuyzW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 11/60 * einsum('Kxa,yzaw,wuvs,ZxvsuzWy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yzaw,wuvs,ZxvsuzyW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kxa,yzaw,wuvs,ZxvsyWuz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 2/15 * einsum('Kxa,yzaw,wuvs,ZxvsyuWz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 7/120 * einsum('Kxa,yzaw,wuvs,ZxvsyuzW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/120 * einsum('Kxa,yzaw,wuvs,ZxvsyzWu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/10 * einsum('Kxa,yzaw,wuvs,ZxvsyzuW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 11/120 * einsum('Kxa,yzaw,wuvs,ZxvszWuy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/40 * einsum('Kxa,yzaw,wuvs,ZxvszWyu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kxa,yzaw,wuvs,ZxvszuWy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/20 * einsum('Kxa,yzaw,wuvs,ZxvszuyW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/60 * einsum('Kxa,yzaw,wuvs,ZxvszyWu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/120 * einsum('Kxa,yzaw,wuvs,ZxvszyuW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/60 * einsum('Kxa,yzaw,yuvs,ZxwuWsvz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/20 * einsum('Kxa,yzaw,yuvs,ZxwuWszv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kxa,yzaw,yuvs,ZxwuWvsz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzaw,yuvs,ZxwuWzsv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/40 * einsum('Kxa,yzaw,yuvs,ZxwuWzvs->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/20 * einsum('Kxa,yzaw,yuvs,ZxwusWvz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kxa,yzaw,yuvs,ZxwusWzv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/5 * einsum('Kxa,yzaw,yuvs,ZxwusvWz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 31/120 * einsum('Kxa,yzaw,yuvs,ZxwusvzW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/120 * einsum('Kxa,yzaw,yuvs,ZxwuszWv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/10 * einsum('Kxa,yzaw,yuvs,ZxwuszvW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/15 * einsum('Kxa,yzaw,yuvs,ZxwuvWsz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/60 * einsum('Kxa,yzaw,yuvs,ZxwuvWzs->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/20 * einsum('Kxa,yzaw,yuvs,ZxwuvsWz->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/120 * einsum('Kxa,yzaw,yuvs,ZxwuvszW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,yuvs,ZxwuvzWs->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kxa,yzaw,yuvs,ZxwuvzsW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/120 * einsum('Kxa,yzaw,yuvs,ZxwuzWsv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/40 * einsum('Kxa,yzaw,yuvs,ZxwuzWvs->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kxa,yzaw,yuvs,ZxwuzsWv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/60 * einsum('Kxa,yzaw,yuvs,ZxwuzsvW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 7/40 * einsum('Kxa,yzaw,yuvs,ZxwuzvWs->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/20 * einsum('Kxa,yzaw,yuvs,ZxwuzvsW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kxa,yzaw,yzuv,ZxwWuv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yzaw,yzuv,ZxwWvu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzaw,yzuv,ZxwuWv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yzaw,yzuv,ZxwuvW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yzaw,yzuv,ZxwvWu->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yzaw,yzuv,ZxwvuW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 2/15 * einsum('Kxa,yzaw,zuvs,ZxwuWsvy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/30 * einsum('Kxa,yzaw,zuvs,ZxwuWsyv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/60 * einsum('Kxa,yzaw,zuvs,ZxwuWvsy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/60 * einsum('Kxa,yzaw,zuvs,ZxwuWvys->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 13/120 * einsum('Kxa,yzaw,zuvs,ZxwusWvy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/120 * einsum('Kxa,yzaw,zuvs,ZxwusWyv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/30 * einsum('Kxa,yzaw,zuvs,ZxwusvWy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/30 * einsum('Kxa,yzaw,zuvs,ZxwusvyW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/20 * einsum('Kxa,yzaw,zuvs,ZxwusyWv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 7/60 * einsum('Kxa,yzaw,zuvs,ZxwusyvW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/40 * einsum('Kxa,yzaw,zuvs,ZxwuvWsy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/120 * einsum('Kxa,yzaw,zuvs,ZxwuvWys->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/5 * einsum('Kxa,yzaw,zuvs,ZxwuvsWy->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/5 * einsum('Kxa,yzaw,zuvs,ZxwuvsyW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yzaw,zuvs,ZxwuvysW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/60 * einsum('Kxa,yzaw,zuvs,ZxwuyWsv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kxa,yzaw,zuvs,ZxwuyWvs->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 17/120 * einsum('Kxa,yzaw,zuvs,ZxwuysWv->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/40 * einsum('Kxa,yzaw,zuvs,ZxwuysvW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yzaw,zuvs,ZxwuyvWs->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/24 * einsum('Kxa,yzaw,zuvs,ZxwuyvsW->KWZ', X_aaa, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kxa,a,Za,Wx->KWZ', X_abb, e_extern, t1_ae, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kxa,a,Zyaz,Wyxz->KWZ', X_abb, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,a,yZaz,Wyxz->KWZ', X_abb, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,a,yZaz,Wyzx->KWZ', X_abb, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,a,ya,WyZx->KWZ', X_abb, e_extern, t1_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,a,ya,WyxZ->KWZ', X_abb, e_extern, t1_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,a,yzaw,ZxwWyz->KWZ', X_abb, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,a,yzaw,ZxwWzy->KWZ', X_abb, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kxa,a,yzaw,ZxwyWz->KWZ', X_abb, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,a,yzaw,ZxwyzW->KWZ', X_abb, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,a,yzaw,ZxwzWy->KWZ', X_abb, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,a,yzaw,ZxwzyW->KWZ', X_abb, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kxa,Zy,ya,Wx->KWZ', X_abb, h_aa, t1_ae, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kxa,Zy,yzaw,Wzxw->KWZ', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,Zy,zyaw,Wzwx->KWZ', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,Zy,zyaw,Wzxw->KWZ', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kxa,yz,Zway,Wwxz->KWZ', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kxa,yz,Zyaw,Wzxw->KWZ', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yz,wZay,Wwxz->KWZ', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yz,wZay,Wwzx->KWZ', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yz,wuay,ZxzWuw->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yz,wuay,ZxzWwu->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yz,wuay,ZxzuWw->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yz,wuay,ZxzuwW->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kxa,yz,wuay,ZxzwWu->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yz,wuay,ZxzwuW->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yz,wyau,ZxuWwz->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yz,wyau,ZxuWzw->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kxa,yz,wyau,ZxuwWz->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yz,wyau,ZxuwzW->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yz,wyau,ZxuzWw->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yz,wyau,ZxuzwW->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yz,yZaw,Wzwx->KWZ', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yz,yZaw,Wzxw->KWZ', X_abb, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yz,ya,WzZx->KWZ', X_abb, h_aa, t1_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yz,ya,WzxZ->KWZ', X_abb, h_aa, t1_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yz,ywau,ZxuWzw->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yz,ywau,ZxuzWw->KWZ', X_abb, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/12 * einsum('Kxa,Zyaz,ywuv,xzwWuv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,Zyaz,ywuv,xzwWvu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,Zyaz,ywuv,xzwuWv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,Zyaz,ywuv,xzwuvW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,Zyaz,ywuv,xzwvWu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,Zyaz,ywuv,xzwvuW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kxa,Zyaz,zwuv,xuvWyw->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yZaz,ywuv,xzwWuv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yZaz,ywuv,xzwWvu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kxa,yZaz,ywuv,xzwuWv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yZaz,ywuv,xzwuvW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yZaz,ywuv,xzwvWu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yZaz,ywuv,xzwvuW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yZaz,zwuv,xuvWwy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kxa,yZaz,zwuv,xuvWyw->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yZaz,zwuv,xuvwWy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yZaz,zwuv,xuvwyW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yZaz,zwuv,xuvyWw->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yZaz,zwuv,xuvywW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,ya,Zzwy,Wzwx->KWZ', X_abb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,ya,Zzwy,Wzxw->KWZ', X_abb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kxa,ya,Zzyw,Wzxw->KWZ', X_abb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,ya,yzwu,ZxzWuw->KWZ', X_abb, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,ya,yzwu,ZxzWwu->KWZ', X_abb, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,ya,yzwu,ZxzuWw->KWZ', X_abb, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,ya,yzwu,ZxzuwW->KWZ', X_abb, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kxa,ya,yzwu,ZxzwWu->KWZ', X_abb, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,ya,yzwu,ZxzwuW->KWZ', X_abb, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuvy,xwvWuz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kxa,yzaw,Zuvy,xwvWzu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuvy,xwvuWz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zuvy,xwvuzW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuvy,xwvzWu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuvy,xwvzuW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yzaw,Zuvz,xwvWuy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yzaw,Zuvz,xwvyuW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kxa,yzaw,Zuyv,xwvWzu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kxa,yzaw,Zuyz,Wuxw->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuzv,xwvWuy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kxa,yzaw,Zuzv,xwvWyu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuzv,xwvuWy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuzv,xwvuyW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zuzv,xwvyWu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuzv,xwvyuW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yzaw,Zuzy,Wuwx->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yzaw,Zuzy,Wuxw->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kxa,yzaw,Zwuv,xuvWyz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzaw,Zwuv,xuvWzy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yzaw,Zwuv,xuvyWz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzaw,Zwuv,xuvyzW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzaw,Zwuv,xuvzWy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzaw,Zwuv,xuvzyW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/40 * einsum('Kxa,yzaw,wuvs,ZxvsWuyz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,wuvs,ZxvsWuzy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/240 * einsum('Kxa,yzaw,wuvs,ZxvsWyuz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/80 * einsum('Kxa,yzaw,wuvs,ZxvsWyzu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('Kxa,yzaw,wuvs,ZxvsWzuy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/16 * einsum('Kxa,yzaw,wuvs,ZxvsWzyu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kxa,yzaw,wuvs,ZxvsuWzy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/240 * einsum('Kxa,yzaw,wuvs,ZxvsuyWz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/240 * einsum('Kxa,yzaw,wuvs,ZxvsuyzW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('Kxa,yzaw,wuvs,ZxvsuzWy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('Kxa,yzaw,wuvs,ZxvsuzyW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 41/240 * einsum('Kxa,yzaw,wuvs,ZxvsyWuz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 5/48 * einsum('Kxa,yzaw,wuvs,ZxvsyWzu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 47/240 * einsum('Kxa,yzaw,wuvs,ZxvsyuWz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 17/80 * einsum('Kxa,yzaw,wuvs,ZxvsyuzW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 13/120 * einsum('Kxa,yzaw,wuvs,ZxvsyzWu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 7/30 * einsum('Kxa,yzaw,wuvs,ZxvsyzuW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/80 * einsum('Kxa,yzaw,wuvs,ZxvszWuy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/80 * einsum('Kxa,yzaw,wuvs,ZxvszWyu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('Kxa,yzaw,wuvs,ZxvszuWy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/16 * einsum('Kxa,yzaw,wuvs,ZxvszuyW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 2/15 * einsum('Kxa,yzaw,wuvs,ZxvszyWu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/120 * einsum('Kxa,yzaw,wuvs,ZxvszyuW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/120 * einsum('Kxa,yzaw,yuvs,ZxwuWsvz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/30 * einsum('Kxa,yzaw,yuvs,ZxwuWszv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yzaw,yuvs,ZxwuWvsz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,yuvs,ZxwuWzsv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/60 * einsum('Kxa,yzaw,yuvs,ZxwuWzvs->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/120 * einsum('Kxa,yzaw,yuvs,ZxwusWvz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 2/15 * einsum('Kxa,yzaw,yuvs,ZxwusWzv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/5 * einsum('Kxa,yzaw,yuvs,ZxwusvWz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 19/120 * einsum('Kxa,yzaw,yuvs,ZxwusvzW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/120 * einsum('Kxa,yzaw,yuvs,ZxwuszWv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/40 * einsum('Kxa,yzaw,yuvs,ZxwuszvW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 23/120 * einsum('Kxa,yzaw,yuvs,ZxwuvWsz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kxa,yzaw,yuvs,ZxwuvWzs->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/60 * einsum('Kxa,yzaw,yuvs,ZxwuvsWz->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/120 * einsum('Kxa,yzaw,yuvs,ZxwuvszW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/40 * einsum('Kxa,yzaw,yuvs,ZxwuvzWs->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/120 * einsum('Kxa,yzaw,yuvs,ZxwuvzsW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 2/15 * einsum('Kxa,yzaw,yuvs,ZxwuzWsv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/15 * einsum('Kxa,yzaw,yuvs,ZxwuzWvs->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,yuvs,ZxwuzsWv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/40 * einsum('Kxa,yzaw,yuvs,ZxwuzsvW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 29/120 * einsum('Kxa,yzaw,yuvs,ZxwuzvWs->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 19/120 * einsum('Kxa,yzaw,yuvs,ZxwuzvsW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yzaw,yzuv,ZxwWuv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,yzuv,ZxwWvu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kxa,yzaw,yzuv,ZxwuWv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,yzuv,ZxwuvW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,yzuv,ZxwvWu->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,yzuv,ZxwvuW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 3/40 * einsum('Kxa,yzaw,zuvs,ZxwuWsvy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/120 * einsum('Kxa,yzaw,zuvs,ZxwuWsyv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/120 * einsum('Kxa,yzaw,zuvs,ZxwuWvsy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/40 * einsum('Kxa,yzaw,zuvs,ZxwuWvys->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/40 * einsum('Kxa,yzaw,zuvs,ZxwusWvy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/120 * einsum('Kxa,yzaw,zuvs,ZxwusWyv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 17/120 * einsum('Kxa,yzaw,zuvs,ZxwusvWy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 17/120 * einsum('Kxa,yzaw,zuvs,ZxwusvyW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/30 * einsum('Kxa,yzaw,zuvs,ZxwusyWv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kxa,yzaw,zuvs,ZxwusyvW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/120 * einsum('Kxa,yzaw,zuvs,ZxwuvWsy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/40 * einsum('Kxa,yzaw,zuvs,ZxwuvWys->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/120 * einsum('Kxa,yzaw,zuvs,ZxwuvsWy->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/120 * einsum('Kxa,yzaw,zuvs,ZxwuvsyW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,zuvs,ZxwuvysW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 13/60 * einsum('Kxa,yzaw,zuvs,ZxwuyWsv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 7/60 * einsum('Kxa,yzaw,zuvs,ZxwuyWvs->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/4 * einsum('Kxa,yzaw,zuvs,ZxwuysWv->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yzaw,zuvs,ZxwuysvW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 4/15 * einsum('Kxa,yzaw,zuvs,ZxwuyvWs->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/20 * einsum('Kxa,yzaw,zuvs,ZxwuyvsW->KWZ', X_abb, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma[s_caa__abb:f_caa__abb] += sigma_caa.reshape(-1).copy()

            sigma_caa =- 1/2 * einsum('ixa,iZaK,Wx->KWZ', X_aaa, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('ixa,iyaK,WyZx->KWZ', X_aaa, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('ixa,iyaK,WyxZ->KWZ', X_aaa, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kxa,Za,Wx->KWZ', X_bab, h_ae, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,ya,WyZx->KWZ', X_bab, h_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kxa,ya,WyxZ->KWZ', X_bab, h_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kxa,Zyza,Wyxz->KWZ', X_bab, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,Zyza,Wyzx->KWZ', X_bab, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kxa,yZza,Wyxz->KWZ', X_bab, v_aaae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzwa,ZxwWyz->KWZ', X_bab, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yzwa,ZxwWzy->KWZ', X_bab, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzwa,ZxwyWz->KWZ', X_bab, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzwa,ZxwyzW->KWZ', X_bab, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 7/24 * einsum('Kxa,yzwa,ZxwzWy->KWZ', X_bab, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzwa,ZxwzyW->KWZ', X_bab, v_aaae, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('ixa,iZKa,Wx->KWZ', X_bab, v_xaxe, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('ixa,iZaK,Wx->KWZ', X_bab, v_xaex, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('ixa,iyKa,WyZx->KWZ', X_bab, v_xaxe, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('ixa,iyKa,WyxZ->KWZ', X_bab, v_xaxe, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('ixa,iyaK,WyZx->KWZ', X_bab, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('ixa,iyaK,WyxZ->KWZ', X_bab, v_xaex, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kxa,a,Za,Wx->KWZ', X_bab, e_extern, t1_ae, rdm_ca, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kxa,a,Zyaz,Wyxz->KWZ', X_bab, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kxa,a,yZaz,Wyxz->KWZ', X_bab, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,a,yZaz,Wyzx->KWZ', X_bab, e_extern, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,a,ya,WyZx->KWZ', X_bab, e_extern, t1_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kxa,a,ya,WyxZ->KWZ', X_bab, e_extern, t1_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,a,yzaw,ZxwWyz->KWZ', X_bab, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,a,yzaw,ZxwWzy->KWZ', X_bab, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 7/24 * einsum('Kxa,a,yzaw,ZxwyWz->KWZ', X_bab, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,a,yzaw,ZxwyzW->KWZ', X_bab, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,a,yzaw,ZxwzWy->KWZ', X_bab, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,a,yzaw,ZxwzyW->KWZ', X_bab, e_extern, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kxa,Zy,ya,Wx->KWZ', X_bab, h_aa, t1_ae, rdm_ca, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kxa,Zy,yzaw,Wzxw->KWZ', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,Zy,zyaw,Wzwx->KWZ', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kxa,Zy,zyaw,Wzxw->KWZ', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kxa,yz,Zway,Wwxz->KWZ', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kxa,yz,Zyaw,Wzxw->KWZ', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/3 * einsum('Kxa,yz,wZay,Wwxz->KWZ', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yz,wZay,Wwzx->KWZ', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yz,wuay,ZxzWuw->KWZ', X_bab, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yz,wuay,ZxzWwu->KWZ', X_bab, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yz,wuay,ZxzuWw->KWZ', X_bab, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yz,wuay,ZxzuwW->KWZ', X_bab, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kxa,yz,wuay,ZxzwWu->KWZ', X_bab, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yz,wuay,ZxzwuW->KWZ', X_bab, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yz,wyau,ZxuWwz->KWZ', X_bab, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yz,wyau,ZxuWzw->KWZ', X_bab, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kxa,yz,wyau,ZxuwWz->KWZ', X_bab, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yz,wyau,ZxuwzW->KWZ', X_bab, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yz,wyau,ZxuzWw->KWZ', X_bab, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yz,wyau,ZxuzwW->KWZ', X_bab, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yz,yZaw,Wzwx->KWZ', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kxa,yz,yZaw,Wzxw->KWZ', X_bab, h_aa, t1_aaea, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yz,ya,WzZx->KWZ', X_bab, h_aa, t1_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kxa,yz,ya,WzxZ->KWZ', X_bab, h_aa, t1_ae, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yz,ywau,ZxuWzw->KWZ', X_bab, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kxa,yz,ywau,ZxuzWw->KWZ', X_bab, h_aa, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 5/12 * einsum('Kxa,Zyaz,ywuv,xzwWuv->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,Zyaz,ywuv,xzwWvu->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,Zyaz,ywuv,xzwuWv->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,Zyaz,ywuv,xzwuvW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,Zyaz,ywuv,xzwvWu->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,Zyaz,ywuv,xzwvuW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kxa,Zyaz,zwuv,xuvWyw->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 7/24 * einsum('Kxa,yZaz,ywuv,xzwWuv->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yZaz,ywuv,xzwWvu->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yZaz,ywuv,xzwuWv->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yZaz,ywuv,xzwuvW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yZaz,ywuv,xzwvWu->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yZaz,ywuv,xzwvuW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yZaz,zwuv,xuvWwy->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 7/24 * einsum('Kxa,yZaz,zwuv,xuvWyw->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yZaz,zwuv,xuvwWy->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yZaz,zwuv,xuvwyW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yZaz,zwuv,xuvyWw->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yZaz,zwuv,xuvywW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,ya,Zzwy,Wzwx->KWZ', X_bab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kxa,ya,Zzwy,Wzxw->KWZ', X_bab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kxa,ya,Zzyw,Wzxw->KWZ', X_bab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,ya,yzwu,ZxzWuw->KWZ', X_bab, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,ya,yzwu,ZxzWwu->KWZ', X_bab, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,ya,yzwu,ZxzuWw->KWZ', X_bab, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,ya,yzwu,ZxzuwW->KWZ', X_bab, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 5/24 * einsum('Kxa,ya,yzwu,ZxzwWu->KWZ', X_bab, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,ya,yzwu,ZxzwuW->KWZ', X_bab, t1_ae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zuvy,xwvWuz->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kxa,yzaw,Zuvy,xwvWzu->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zuvy,xwvuWz->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuvy,xwvuzW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zuvy,xwvzWu->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zuvy,xwvzuW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kxa,yzaw,Zuvz,xwvWuy->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yzaw,Zuvz,xwvyuW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kxa,yzaw,Zuyv,xwvWzu->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/2 * einsum('Kxa,yzaw,Zuyz,Wuxw->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zuzv,xwvWuy->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kxa,yzaw,Zuzv,xwvWyu->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zuzv,xwvuWy->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zuzv,xwvuyW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/12 * einsum('Kxa,yzaw,Zuzv,xwvyWu->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,Zuzv,xwvyuW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yzaw,Zuzy,Wuwx->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa -= 1/3 * einsum('Kxa,yzaw,Zuzy,Wuxw->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_caa += 7/24 * einsum('Kxa,yzaw,Zwuv,xuvWyz->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,Zwuv,xuvWzy->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yzaw,Zwuv,xuvyWz->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,Zwuv,xuvyzW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,Zwuv,xuvzWy->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,Zwuv,xuvzyW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzaw,wuvs,ZxvsWuyz->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/40 * einsum('Kxa,yzaw,wuvs,ZxvsWuzy->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/60 * einsum('Kxa,yzaw,wuvs,ZxvsWyuz->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/20 * einsum('Kxa,yzaw,wuvs,ZxvsWyzu->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzaw,wuvs,ZxvsWzuy->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/40 * einsum('Kxa,yzaw,wuvs,ZxvsWzyu->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/120 * einsum('Kxa,yzaw,wuvs,ZxvsuWyz->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzaw,wuvs,ZxvsuWzy->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/30 * einsum('Kxa,yzaw,wuvs,ZxvsuyWz->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 11/120 * einsum('Kxa,yzaw,wuvs,ZxvsuyzW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/120 * einsum('Kxa,yzaw,wuvs,ZxvsuzWy->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kxa,yzaw,wuvs,ZxvsuzyW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/20 * einsum('Kxa,yzaw,wuvs,ZxvsyWuz->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/20 * einsum('Kxa,yzaw,wuvs,ZxvsyWzu->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/20 * einsum('Kxa,yzaw,wuvs,ZxvsyuWz->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/40 * einsum('Kxa,yzaw,wuvs,ZxvsyuzW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/30 * einsum('Kxa,yzaw,wuvs,ZxvsyzWu->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 7/120 * einsum('Kxa,yzaw,wuvs,ZxvsyzuW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,wuvs,ZxvszWuy->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/15 * einsum('Kxa,yzaw,wuvs,ZxvszWyu->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/12 * einsum('Kxa,yzaw,wuvs,ZxvszuWy->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/40 * einsum('Kxa,yzaw,wuvs,ZxvszuyW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzaw,wuvs,ZxvszyWu->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kxa,yzaw,wuvs,ZxvszyuW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/30 * einsum('Kxa,yzaw,yuvs,ZxwuWsvz->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kxa,yzaw,yuvs,ZxwuWszv->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/30 * einsum('Kxa,yzaw,yuvs,ZxwuWvzs->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/120 * einsum('Kxa,yzaw,yuvs,ZxwuWzsv->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/8 * einsum('Kxa,yzaw,yuvs,ZxwuWzvs->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 3/20 * einsum('Kxa,yzaw,yuvs,ZxwusWvz->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/6 * einsum('Kxa,yzaw,yuvs,ZxwusWzv->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/10 * einsum('Kxa,yzaw,yuvs,ZxwusvWz->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 7/120 * einsum('Kxa,yzaw,yuvs,ZxwusvzW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 11/120 * einsum('Kxa,yzaw,yuvs,ZxwuszWv->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/20 * einsum('Kxa,yzaw,yuvs,ZxwuszvW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/10 * einsum('Kxa,yzaw,yuvs,ZxwuvWsz->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/10 * einsum('Kxa,yzaw,yuvs,ZxwuvWzs->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 11/60 * einsum('Kxa,yzaw,yuvs,ZxwuvsWz->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/40 * einsum('Kxa,yzaw,yuvs,ZxwuvszW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/40 * einsum('Kxa,yzaw,yuvs,ZxwuvzWs->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 11/120 * einsum('Kxa,yzaw,yuvs,ZxwuzWsv->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 5/24 * einsum('Kxa,yzaw,yuvs,ZxwuzWvs->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 23/120 * einsum('Kxa,yzaw,yuvs,ZxwuzsWv->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kxa,yzaw,yuvs,ZxwuzsvW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,yuvs,ZxwuzvWs->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kxa,yzaw,yuvs,ZxwuzvsW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yzaw,yzuv,ZxwWuv->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzaw,yzuv,ZxwWvu->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 7/24 * einsum('Kxa,yzaw,yzuv,ZxwuWv->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzaw,yzuv,ZxwuvW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzaw,yzuv,ZxwvWu->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzaw,yzuv,ZxwvuW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_cccaaa, optimize = einsum_type)
            sigma_caa -= 19/120 * einsum('Kxa,yzaw,zuvs,ZxwuWsvy->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/8 * einsum('Kxa,yzaw,zuvs,ZxwuWsyv->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/120 * einsum('Kxa,yzaw,zuvs,ZxwuWvsy->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/24 * einsum('Kxa,yzaw,zuvs,ZxwuWvys->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kxa,yzaw,zuvs,ZxwuWysv->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/4 * einsum('Kxa,yzaw,zuvs,ZxwuWyvs->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/5 * einsum('Kxa,yzaw,zuvs,ZxwusWvy->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/6 * einsum('Kxa,yzaw,zuvs,ZxwusWyv->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/30 * einsum('Kxa,yzaw,zuvs,ZxwusvWy->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/30 * einsum('Kxa,yzaw,zuvs,ZxwusvyW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/40 * einsum('Kxa,yzaw,zuvs,ZxwusyWv->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/120 * einsum('Kxa,yzaw,zuvs,ZxwusyvW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 3/20 * einsum('Kxa,yzaw,zuvs,ZxwuvWsy->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 11/60 * einsum('Kxa,yzaw,zuvs,ZxwuvWys->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/15 * einsum('Kxa,yzaw,zuvs,ZxwuvsWy->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/15 * einsum('Kxa,yzaw,zuvs,ZxwuvsyW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/120 * einsum('Kxa,yzaw,zuvs,ZxwuvyWs->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/24 * einsum('Kxa,yzaw,zuvs,ZxwuvysW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/10 * einsum('Kxa,yzaw,zuvs,ZxwuyWsv->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/2 * einsum('Kxa,yzaw,zuvs,ZxwuyWvs->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/60 * einsum('Kxa,yzaw,zuvs,ZxwuysWv->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa -= 1/20 * einsum('Kxa,yzaw,zuvs,ZxwuysvW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/15 * einsum('Kxa,yzaw,zuvs,ZxwuyvWs->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma_caa += 1/10 * einsum('Kxa,yzaw,zuvs,ZxwuyvsW->KWZ', X_bab, t1_aaea, v_aaaa, rdm_ccccaaaa, optimize = einsum_type)
            sigma[s_caa__bab:f_caa__bab] += sigma_caa.reshape(-1).copy()

            # CCA <- CAE
            sigma_cca =- 1/2 * einsum('Kxa,LaWy,xy->KLW', X_aaa, v_xeaa, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Kxa,LayW,xy->KLW', X_aaa, v_xeaa, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/6 * einsum('Kxa,Layz,Wxyz->KLW', X_aaa, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/6 * einsum('Kxa,Layz,Wxzy->KLW', X_aaa, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Lxa,KaWy,xy->KLW', X_aaa, v_xeaa, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('Lxa,KayW,xy->KLW', X_aaa, v_xeaa, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/6 * einsum('Lxa,Kayz,Wxyz->KLW', X_aaa, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/6 * einsum('Lxa,Kayz,Wxzy->KLW', X_aaa, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('Kxa,LaWy,xy->KLW', X_abb, v_xeaa, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/3 * einsum('Kxa,Layz,Wxyz->KLW', X_abb, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/6 * einsum('Kxa,Layz,Wxzy->KLW', X_abb, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Lxa,KaWy,xy->KLW', X_abb, v_xeaa, rdm_ca, optimize = einsum_type)
            sigma_cca -= 1/3 * einsum('Lxa,Kayz,Wxyz->KLW', X_abb, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/6 * einsum('Lxa,Kayz,Wxzy->KLW', X_abb, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma[s_cca__aaa:f_cca__aaa] += sigma_cca[cvs_tril_ind[0], cvs_tril_ind[1]].reshape(-1).copy()

            sigma_cca =- 1/2 * einsum('Kxa,LaWy,xy->KLW', X_aaa, v_xeaa, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/3 * einsum('Kxa,Layz,Wxyz->KLW', X_aaa, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/6 * einsum('Kxa,Layz,Wxzy->KLW', X_aaa, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('Kxa,LaWy,xy->KLW', X_abb, v_xeaa, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/2 * einsum('Kxa,LayW,xy->KLW', X_abb, v_xeaa, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/6 * einsum('Kxa,Layz,Wxyz->KLW', X_abb, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/6 * einsum('Kxa,Layz,Wxzy->KLW', X_abb, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca -= 1/2 * einsum('Lxa,KayW,xy->KLW', X_bab, v_xeaa, rdm_ca, optimize = einsum_type)
            sigma_cca += 1/6 * einsum('Lxa,Kayz,Wxyz->KLW', X_bab, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma_cca += 1/3 * einsum('Lxa,Kayz,Wxzy->KLW', X_bab, v_xeaa, rdm_ccaa, optimize = einsum_type)
            sigma[s_cca__abb:f_cca__abb] += sigma_cca.reshape(-1).copy()

            # CVA <- CAE
            if nval > 0:
                sigma_cva =- 1/2 * einsum('Kxa,LaWy,xy->KLW', X_aaa, v_veaa, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('Kxa,LayW,xy->KLW', X_aaa, v_veaa, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/6 * einsum('Kxa,Layz,Wxyz->KLW', X_aaa, v_veaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/6 * einsum('Kxa,Layz,Wxzy->KLW', X_aaa, v_veaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('Kxa,LaWy,xy->KLW', X_abb, v_veaa, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/3 * einsum('Kxa,Layz,Wxyz->KLW', X_abb, v_veaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva += 1/6 * einsum('Kxa,Layz,Wxzy->KLW', X_abb, v_veaa, rdm_ccaa, optimize = einsum_type)
                sigma[s_cva__aaa:f_cva__aaa] += sigma_cva.reshape(-1).copy()

                sigma_cva =- 1/2 * einsum('Kxa,LaWy,xy->KLW', X_aaa, v_veaa, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/3 * einsum('Kxa,Layz,Wxyz->KLW', X_aaa, v_veaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva += 1/6 * einsum('Kxa,Layz,Wxzy->KLW', X_aaa, v_veaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/2 * einsum('Kxa,LaWy,xy->KLW', X_abb, v_veaa, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/2 * einsum('Kxa,LayW,xy->KLW', X_abb, v_veaa, rdm_ca, optimize = einsum_type)
                sigma_cva += 1/6 * einsum('Kxa,Layz,Wxyz->KLW', X_abb, v_veaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/6 * einsum('Kxa,Layz,Wxzy->KLW', X_abb, v_veaa, rdm_ccaa, optimize = einsum_type)
                sigma[s_cva__abb:f_cva__abb] += sigma_cva.reshape(-1).copy()

                sigma_cva  = 1/2 * einsum('Kxa,LayW,xy->KLW', X_bab, v_veaa, rdm_ca, optimize = einsum_type)
                sigma_cva -= 1/6 * einsum('Kxa,Layz,Wxyz->KLW', X_bab, v_veaa, rdm_ccaa, optimize = einsum_type)
                sigma_cva -= 1/3 * einsum('Kxa,Layz,Wxzy->KLW', X_bab, v_veaa, rdm_ccaa, optimize = einsum_type)
                sigma[s_cva__bab:f_cva__bab] += sigma_cva.reshape(-1).copy()

            # CCE <- CAE
            sigma_cce  = einsum('KxB,Lx->KLB', X_aaa, h_xa, optimize = einsum_type)
            sigma_cce -= einsum('LxB,Kx->KLB', X_aaa, h_xa, optimize = einsum_type)
            sigma_cce -= einsum('KxB,L,Lx->KLB', X_aaa, e_cvs, t1_xa, optimize = einsum_type)
            sigma_cce += einsum('LxB,K,Kx->KLB', X_aaa, e_cvs, t1_xa, optimize = einsum_type)
            sigma_cce += einsum('KxB,xy,Ly->KLB', X_aaa, h_aa, t1_xa, optimize = einsum_type)
            sigma_cce -= einsum('LxB,xy,Ky->KLB', X_aaa, h_aa, t1_xa, optimize = einsum_type)
            sigma_cce += einsum('KxB,Lyxz,yz->KLB', X_aaa, v_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KxB,Lyzx,yz->KLB', X_aaa, v_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxa,LaBy,xy->KLB', X_aaa, v_xeea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxa,LayB,xy->KLB', X_aaa, v_xeae, rdm_ca, optimize = einsum_type)
            sigma_cce -= einsum('LxB,Kyxz,yz->KLB', X_aaa, v_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LxB,Kyzx,yz->KLB', X_aaa, v_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxa,KaBy,xy->KLB', X_aaa, v_xeea, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxa,KayB,xy->KLB', X_aaa, v_xeae, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('ixB,KLiy,xy->KLB', X_aaa, v_xxxa, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('ixB,LKiy,xy->KLB', X_aaa, v_xxxa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxa,LaBy,xy->KLB', X_abb, v_xeea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Lxa,KaBy,xy->KLB', X_abb, v_xeea, rdm_ca, optimize = einsum_type)
            sigma_cce -= einsum('KxB,L,Lyxz,yz->KLB', X_aaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('KxB,L,Lyzx,yz->KLB', X_aaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += einsum('LxB,K,Kyxz,yz->KLB', X_aaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('LxB,K,Kyzx,yz->KLB', X_aaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KxB,xy,Lzwy,zw->KLB', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += einsum('KxB,xy,Lzyw,zw->KLB', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += einsum('KxB,yz,Lwxy,zw->KLB', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KxB,yz,Lwyx,zw->KLB', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('KxB,yz,Lywx,zw->KLB', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= einsum('KxB,yz,Lyxw,zw->KLB', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LxB,xy,Kzwy,zw->KLB', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= einsum('LxB,xy,Kzyw,zw->KLB', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= einsum('LxB,yz,Kwxy,zw->KLB', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LxB,yz,Kwyx,zw->KLB', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('LxB,yz,Kywx,zw->KLB', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += einsum('LxB,yz,Kyxw,zw->KLB', X_aaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KxB,Ly,xzwy,zw->KLB', X_aaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += einsum('KxB,Ly,xzyw,zw->KLB', X_aaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= einsum('KxB,Lyxz,ywuv,zwuv->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += einsum('KxB,Lyxz,zwuv,ywuv->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KxB,Lyzw,xuvw,yvuz->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KxB,Lyzw,xuvz,yvwu->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KxB,Lyzw,xuwv,yvzu->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KxB,Lyzw,xuwz,yu->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += einsum('KxB,Lyzw,xuzv,yvwu->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += einsum('KxB,Lyzw,xuzw,yu->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('KxB,Lyzw,xyuv,zwuv->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('KxB,Lyzx,ywuv,zwuv->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KxB,Lyzx,zwuv,ywuv->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LxB,Ky,xzwy,zw->KLB', X_aaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= einsum('LxB,Ky,xzyw,zw->KLB', X_aaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += einsum('LxB,Kyxz,ywuv,zwuv->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= einsum('LxB,Kyxz,zwuv,ywuv->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LxB,Kyzw,xuvw,yvuz->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LxB,Kyzw,xuvz,yvwu->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LxB,Kyzw,xuwv,yvzu->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LxB,Kyzw,xuwz,yu->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= einsum('LxB,Kyzw,xuzv,yvwu->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= einsum('LxB,Kyzw,xuzw,yu->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('LxB,Kyzw,xyuv,zwuv->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('LxB,Kyzx,ywuv,zwuv->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LxB,Kyzx,zwuv,ywuv->KLB', X_aaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma[s_cce__aaa:f_cce__aaa] += sigma_cce[cvs_tril_ind[0], cvs_tril_ind[1]].reshape(-1).copy()

            sigma_cce  = einsum('KxB,Lx->KLB', X_abb, h_xa, optimize = einsum_type)
            sigma_cce -= einsum('LxB,Kx->KLB', X_bab, h_xa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxa,LaBy,xy->KLB', X_aaa, v_xeea, rdm_ca, optimize = einsum_type)
            sigma_cce -= einsum('KxB,L,Lx->KLB', X_abb, e_cvs, t1_xa, optimize = einsum_type)
            sigma_cce += einsum('KxB,xy,Ly->KLB', X_abb, h_aa, t1_xa, optimize = einsum_type)
            sigma_cce += einsum('KxB,Lyxz,yz->KLB', X_abb, v_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KxB,Lyzx,yz->KLB', X_abb, v_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Kxa,LaBy,xy->KLB', X_abb, v_xeea, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('Kxa,LayB,xy->KLB', X_abb, v_xeae, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('ixB,KLiy,xy->KLB', X_abb, v_xxxa, rdm_ca, optimize = einsum_type)
            sigma_cce += einsum('LxB,K,Kx->KLB', X_bab, e_cvs, t1_xa, optimize = einsum_type)
            sigma_cce -= einsum('LxB,xy,Ky->KLB', X_bab, h_aa, t1_xa, optimize = einsum_type)
            sigma_cce -= einsum('LxB,Kyxz,yz->KLB', X_bab, v_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LxB,Kyzx,yz->KLB', X_bab, v_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('Lxa,KayB,xy->KLB', X_bab, v_xeae, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('ixB,LKiy,xy->KLB', X_bab, v_xxxa, rdm_ca, optimize = einsum_type)
            sigma_cce -= einsum('KxB,L,Lyxz,yz->KLB', X_abb, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('KxB,L,Lyzx,yz->KLB', X_abb, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KxB,xy,Lzwy,zw->KLB', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += einsum('KxB,xy,Lzyw,zw->KLB', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += einsum('KxB,yz,Lwxy,zw->KLB', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KxB,yz,Lwyx,zw->KLB', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('KxB,yz,Lywx,zw->KLB', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= einsum('KxB,yz,Lyxw,zw->KLB', X_abb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KxB,Ly,xzwy,zw->KLB', X_abb, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += einsum('KxB,Ly,xzyw,zw->KLB', X_abb, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= einsum('KxB,Lyxz,ywuv,zwuv->KLB', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += einsum('KxB,Lyxz,zwuv,ywuv->KLB', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KxB,Lyzw,xuvw,yvuz->KLB', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KxB,Lyzw,xuvz,yvwu->KLB', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KxB,Lyzw,xuwv,yvzu->KLB', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KxB,Lyzw,xuwz,yu->KLB', X_abb, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += einsum('KxB,Lyzw,xuzv,yvwu->KLB', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += einsum('KxB,Lyzw,xuzw,yu->KLB', X_abb, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('KxB,Lyzw,xyuv,zwuv->KLB', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('KxB,Lyzx,ywuv,zwuv->KLB', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('KxB,Lyzx,zwuv,ywuv->KLB', X_abb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += einsum('LxB,K,Kyxz,yz->KLB', X_bab, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('LxB,K,Kyzx,yz->KLB', X_bab, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LxB,xy,Kzwy,zw->KLB', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= einsum('LxB,xy,Kzyw,zw->KLB', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= einsum('LxB,yz,Kwxy,zw->KLB', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LxB,yz,Kwyx,zw->KLB', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('LxB,yz,Kywx,zw->KLB', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += einsum('LxB,yz,Kyxw,zw->KLB', X_bab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LxB,Ky,xzwy,zw->KLB', X_bab, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= einsum('LxB,Ky,xzyw,zw->KLB', X_bab, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce += einsum('LxB,Kyxz,ywuv,zwuv->KLB', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= einsum('LxB,Kyxz,zwuv,ywuv->KLB', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LxB,Kyzw,xuvw,yvuz->KLB', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LxB,Kyzw,xuvz,yvwu->KLB', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LxB,Kyzw,xuwv,yvzu->KLB', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LxB,Kyzw,xuwz,yu->KLB', X_bab, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= einsum('LxB,Kyzw,xuzv,yvwu->KLB', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= einsum('LxB,Kyzw,xuzw,yu->KLB', X_bab, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('LxB,Kyzw,xyuv,zwuv->KLB', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce -= 1/2 * einsum('LxB,Kyzx,ywuv,zwuv->KLB', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma_cce += 1/2 * einsum('LxB,Kyzx,zwuv,ywuv->KLB', X_bab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
            sigma[s_cce__abb:f_cce__abb] += sigma_cce.reshape(-1).copy()

            # CVE <- CAE
            if nval > 0:
                sigma_cve  = einsum('KxB,Lx->KLB', X_aaa, h_va, optimize = einsum_type)
                sigma_cve -= einsum('KxB,L,Lx->KLB', X_aaa, e_val, t1_va, optimize = einsum_type)
                sigma_cve += einsum('KxB,xy,Ly->KLB', X_aaa, h_aa, t1_va, optimize = einsum_type)
                sigma_cve += einsum('KxB,Lyxz,yz->KLB', X_aaa, v_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,Lyzx,yz->KLB', X_aaa, v_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxa,LaBy,xy->KLB', X_aaa, v_veea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxa,LayB,xy->KLB', X_aaa, v_veae, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('ixB,KLiy,xy->KLB', X_aaa, v_xvxa, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('ixB,LKiy,xy->KLB', X_aaa, v_vxxa, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxa,LaBy,xy->KLB', X_abb, v_veea, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KxB,L,Lyxz,yz->KLB', X_aaa, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KxB,L,Lyzx,yz->KLB', X_aaa, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,xy,Lzwy,zw->KLB', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KxB,xy,Lzyw,zw->KLB', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KxB,yz,Lwxy,zw->KLB', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,yz,Lwyx,zw->KLB', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KxB,yz,Lywx,zw->KLB', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KxB,yz,Lyxw,zw->KLB', X_aaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,Ly,xzwy,zw->KLB', X_aaa, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KxB,Ly,xzyw,zw->KLB', X_aaa, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KxB,Lyxz,ywuv,zwuv->KLB', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += einsum('KxB,Lyxz,zwuv,ywuv->KLB', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,Lyzw,xuvw,yvuz->KLB', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,Lyzw,xuvz,yvwu->KLB', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,Lyzw,xuwv,yvzu->KLB', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,Lyzw,xuwz,yu->KLB', X_aaa, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KxB,Lyzw,xuzv,yvwu->KLB', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += einsum('KxB,Lyzw,xuzw,yu->KLB', X_aaa, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KxB,Lyzw,xyuv,zwuv->KLB', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KxB,Lyzx,ywuv,zwuv->KLB', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,Lyzx,zwuv,ywuv->KLB', X_aaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma[s_cve__aaa:f_cve__aaa] += sigma_cve.reshape(-1).copy()

                sigma_cve  = einsum('KxB,Lx->KLB', X_abb, h_va, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxa,LaBy,xy->KLB', X_aaa, v_veea, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KxB,L,Lx->KLB', X_abb, e_val, t1_va, optimize = einsum_type)
                sigma_cve += einsum('KxB,xy,Ly->KLB', X_abb, h_aa, t1_va, optimize = einsum_type)
                sigma_cve += einsum('KxB,Lyxz,yz->KLB', X_abb, v_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,Lyzx,yz->KLB', X_abb, v_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('Kxa,LaBy,xy->KLB', X_abb, v_veea, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxa,LayB,xy->KLB', X_abb, v_veae, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('ixB,KLiy,xy->KLB', X_abb, v_xvxa, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('ixB,LKiy,xy->KLB', X_bab, v_vxxa, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KxB,L,Lyxz,yz->KLB', X_abb, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KxB,L,Lyzx,yz->KLB', X_abb, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,xy,Lzwy,zw->KLB', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KxB,xy,Lzyw,zw->KLB', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KxB,yz,Lwxy,zw->KLB', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,yz,Lwyx,zw->KLB', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KxB,yz,Lywx,zw->KLB', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KxB,yz,Lyxw,zw->KLB', X_abb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,Ly,xzwy,zw->KLB', X_abb, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KxB,Ly,xzyw,zw->KLB', X_abb, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KxB,Lyxz,ywuv,zwuv->KLB', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += einsum('KxB,Lyxz,zwuv,ywuv->KLB', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,Lyzw,xuvw,yvuz->KLB', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,Lyzw,xuvz,yvwu->KLB', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,Lyzw,xuwv,yvzu->KLB', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,Lyzw,xuwz,yu->KLB', X_abb, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KxB,Lyzw,xuzv,yvwu->KLB', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += einsum('KxB,Lyzw,xuzw,yu->KLB', X_abb, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KxB,Lyzw,xyuv,zwuv->KLB', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KxB,Lyzx,ywuv,zwuv->KLB', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,Lyzx,zwuv,ywuv->KLB', X_abb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma[s_cve__abb:f_cve__abb] += sigma_cve.reshape(-1).copy()

                sigma_cve  = einsum('KxB,Lx->KLB', X_bab, h_va, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('ixB,LKiy,xy->KLB', X_abb, v_vxxa, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KxB,L,Lx->KLB', X_bab, e_val, t1_va, optimize = einsum_type)
                sigma_cve += einsum('KxB,xy,Ly->KLB', X_bab, h_aa, t1_va, optimize = einsum_type)
                sigma_cve += einsum('KxB,Lyxz,yz->KLB', X_bab, v_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,Lyzx,yz->KLB', X_bab, v_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('Kxa,LayB,xy->KLB', X_bab, v_veae, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('ixB,KLiy,xy->KLB', X_bab, v_xvxa, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KxB,L,Lyxz,yz->KLB', X_bab, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KxB,L,Lyzx,yz->KLB', X_bab, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,xy,Lzwy,zw->KLB', X_bab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KxB,xy,Lzyw,zw->KLB', X_bab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KxB,yz,Lwxy,zw->KLB', X_bab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,yz,Lwyx,zw->KLB', X_bab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KxB,yz,Lywx,zw->KLB', X_bab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KxB,yz,Lyxw,zw->KLB', X_bab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,Ly,xzwy,zw->KLB', X_bab, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KxB,Ly,xzyw,zw->KLB', X_bab, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve -= einsum('KxB,Lyxz,ywuv,zwuv->KLB', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += einsum('KxB,Lyxz,zwuv,ywuv->KLB', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,Lyzw,xuvw,yvuz->KLB', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,Lyzw,xuvz,yvwu->KLB', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,Lyzw,xuwv,yvzu->KLB', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,Lyzw,xuwz,yu->KLB', X_bab, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += einsum('KxB,Lyzw,xuzv,yvwu->KLB', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += einsum('KxB,Lyzw,xuzw,yu->KLB', X_bab, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KxB,Lyzw,xyuv,zwuv->KLB', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve += 1/2 * einsum('KxB,Lyzx,ywuv,zwuv->KLB', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma_cve -= 1/2 * einsum('KxB,Lyzx,zwuv,ywuv->KLB', X_bab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
                sigma[s_cve__bab:f_cve__bab] += sigma_cve.reshape(-1).copy()

            # CAE <- CAE
            sigma_cae  = 1/6 * einsum('Kxa,yBaz,Zyxz->KZB', X_aaa, v_aeea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxa,yBaz,Zyzx->KZB', X_aaa, v_aeea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('Kxa,yBza,Zyxz->KZB', X_aaa, v_aeae, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('ixB,Kyiz,Zzxy->KZB', X_aaa, v_xaxa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('ixB,Kyzi,Zzxy->KZB', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('ixB,Kyzi,Zzyx->KZB', X_aaa, v_xaax, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('ixa,iBKa,Zx->KZB', X_aaa, v_xexe, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('ixa,iBaK,Zx->KZB', X_aaa, v_xeex, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxa,yBaz,Zyxz->KZB', X_abb, v_aeea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxa,yBaz,Zyzx->KZB', X_abb, v_aeea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('ixa,iBaK,Zx->KZB', X_bab, v_xeex, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('Kxa,yBaz,yz,Zx->KZB', X_aaa, v_aeea, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxa,yBza,yz,Zx->KZB', X_aaa, v_aeae, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('ixB,Kyiz,yz,Zx->KZB', X_aaa, v_xaxa, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('ixB,Kyzi,yz,Zx->KZB', X_aaa, v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma[s_cae__aaa:f_cae__aaa] += sigma_cae.reshape(-1).copy()

            sigma_cae =- 1/6 * einsum('Kxa,yBaz,Zyxz->KZB', X_aaa, v_aeea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('Kxa,yBaz,Zyzx->KZB', X_aaa, v_aeea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxa,yBaz,Zyxz->KZB', X_abb, v_aeea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('Kxa,yBaz,Zyzx->KZB', X_abb, v_aeea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('Kxa,yBza,Zyxz->KZB', X_abb, v_aeae, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('ixB,Kyiz,Zzxy->KZB', X_abb, v_xaxa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('ixB,Kyzi,Zzxy->KZB', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('ixB,Kyzi,Zzyx->KZB', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('ixa,iBKa,Zx->KZB', X_abb, v_xexe, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('ixB,Kyzi,Zzxy->KZB', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('ixB,Kyzi,Zzyx->KZB', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('Kxa,yBaz,yz,Zx->KZB', X_abb, v_aeea, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxa,yBza,yz,Zx->KZB', X_abb, v_aeae, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('ixB,Kyiz,yz,Zx->KZB', X_abb, v_xaxa, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('ixB,Kyzi,yz,Zx->KZB', X_abb, v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma[s_cae__abb:f_cae__abb] += sigma_cae.reshape(-1).copy()

            sigma_cae =- 1/2 * einsum('ixa,iBaK,Zx->KZB', X_aaa, v_xeex, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('ixB,Kyzi,Zzxy->KZB', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('ixB,Kyzi,Zzyx->KZB', X_abb, v_xaax, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/3 * einsum('Kxa,yBaz,Zyxz->KZB', X_bab, v_aeea, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/6 * einsum('Kxa,yBaz,Zyzx->KZB', X_bab, v_aeea, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('Kxa,yBza,Zyxz->KZB', X_bab, v_aeae, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('ixB,Kyiz,Zzxy->KZB', X_bab, v_xaxa, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/3 * einsum('ixB,Kyzi,Zzxy->KZB', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
            sigma_cae -= 1/6 * einsum('ixB,Kyzi,Zzyx->KZB', X_bab, v_xaax, rdm_ccaa, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('ixa,iBKa,Zx->KZB', X_bab, v_xexe, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('ixa,iBaK,Zx->KZB', X_bab, v_xeex, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/4 * einsum('Kxa,yBaz,yz,Zx->KZB', X_bab, v_aeea, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/2 * einsum('Kxa,yBza,yz,Zx->KZB', X_bab, v_aeae, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cae -= 1/2 * einsum('ixB,Kyiz,yz,Zx->KZB', X_bab, v_xaxa, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma_cae += 1/4 * einsum('ixB,Kyzi,yz,Zx->KZB', X_bab, v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)
            sigma[s_cae__bab:f_cae__bab] += sigma_cae.reshape(-1).copy()

    return sigma

def compute_trans_moments(mr_adc):

    # Einsum definition from kernel
    einsum = mr_adc.interface.einsum
    einsum_type = mr_adc.interface.einsum_type

    # Variables from kernel
    nmo = mr_adc.nmo
    nocc = mr_adc.nocc

    ncore = mr_adc.ncore
    ncvs = mr_adc.ncvs
    nval = mr_adc.nval
    ncas = mr_adc.ncas
    nextern = mr_adc.nextern

    ## Amplitudes
    t1_ce = mr_adc.t1.ce
    t1_caea = mr_adc.t1.caea
    t1_caae = mr_adc.t1.caae

    t1_ca = mr_adc.t1.ca
    t1_caaa = mr_adc.t1.caaa

    t1_ae   = mr_adc.t1.ae
    t1_aaea = mr_adc.t1.aaea

    t1_xe   = mr_adc.t1.xe
    t1_xaea = mr_adc.t1.xaea
    t1_xaae = mr_adc.t1.xaae
    t1_xa   = mr_adc.t1.xa
    t1_xaaa = mr_adc.t1.xaaa

    t1_ccee = mr_adc.t1.ccee
    t1_ccea = mr_adc.t1.ccea
    t1_caee = mr_adc.t1.caee
    t1_ccaa = mr_adc.t1.ccaa
    t1_aaee = mr_adc.t1.aaee

    t1_xcee = mr_adc.t1.xcee
    t1_xcea = mr_adc.t1.xcea
    t1_cxea = mr_adc.t1.cxea
    t1_xaee = mr_adc.t1.xaee
    t1_xcaa = mr_adc.t1.xcaa

    t1_xxee = mr_adc.t1.xxee
    t1_xxea = mr_adc.t1.xxea
    t1_xxaa = mr_adc.t1.xxaa

    t2_xe = mr_adc.t2.xe

    if nval > 0:
        t1_vxee = mr_adc.t1.vxee
        t1_vxea = mr_adc.t1.vxea
        t1_xvea = mr_adc.t1.xvea
        t1_xvae = mr_adc.t1.xvae

        t1_xvee = mr_adc.t1.xvee
        t1_xvaa = mr_adc.t1.xvaa

        t1_vvee = mr_adc.t1.vvee
        t1_vvaa = mr_adc.t1.vvaa
        t1_vxaa = mr_adc.t1.vxaa

        t1_va = mr_adc.t1.va
        t1_ve = mr_adc.t1.ve

        t1_vaea = mr_adc.t1.vaea
        t1_vaae = mr_adc.t1.vaae

        t1_vaaa = mr_adc.t1.vaaa
        t1_vaee = mr_adc.t1.vaee

        t1_vxea = mr_adc.t1.vxea
        t1_vxae = mr_adc.t1.vxae

        t1_vvea = mr_adc.t1.vvea

    ## Reduced density matrices
    rdm_ca = mr_adc.rdm.ca
    rdm_ccaa = mr_adc.rdm.ccaa
    rdm_cccaaa = mr_adc.rdm.cccaaa

    ## Excitation Manifolds
    s_c = mr_adc.h0.s_c
    f_c = mr_adc.h0.f_c

    s_caa__aaa = mr_adc.h1.s_caa__aaa
    f_caa__aaa = mr_adc.h1.f_caa__aaa
    s_caa__abb = mr_adc.h1.s_caa__abb
    f_caa__abb = mr_adc.h1.f_caa__abb
    s_caa__bab = mr_adc.h1.s_caa__bab
    f_caa__bab = mr_adc.h1.f_caa__bab

    s_cce__aaa = mr_adc.h1.s_cce__aaa
    f_cce__aaa = mr_adc.h1.f_cce__aaa
    s_cce__abb = mr_adc.h1.s_cce__abb
    f_cce__abb = mr_adc.h1.f_cce__abb

    s_cae__aaa = mr_adc.h1.s_cae__aaa
    f_cae__aaa = mr_adc.h1.f_cae__aaa
    s_cae__abb = mr_adc.h1.s_cae__abb
    f_cae__abb = mr_adc.h1.f_cae__abb
    s_cae__bab = mr_adc.h1.s_cae__bab
    f_cae__bab = mr_adc.h1.f_cae__bab

    s_cca__aaa = mr_adc.h1.s_cca__aaa
    f_cca__aaa = mr_adc.h1.f_cca__aaa
    s_cca__abb = mr_adc.h1.s_cca__abb
    f_cca__abb = mr_adc.h1.f_cca__abb

    if nval > 0:
        s_cve__aaa = mr_adc.h1.s_cve__aaa
        f_cve__aaa = mr_adc.h1.f_cve__aaa
        s_cve__abb = mr_adc.h1.s_cve__abb
        f_cve__abb = mr_adc.h1.f_cve__abb
        s_cve__bab = mr_adc.h1.s_cve__bab
        f_cve__bab = mr_adc.h1.f_cve__bab

        s_cva__aaa = mr_adc.h1.s_cva__aaa
        f_cva__aaa = mr_adc.h1.f_cva__aaa
        s_cva__abb = mr_adc.h1.s_cva__abb
        f_cva__abb = mr_adc.h1.f_cva__abb
        s_cva__bab = mr_adc.h1.s_cva__bab
        f_cva__bab = mr_adc.h1.f_cva__bab

    ho_dim = mr_adc.h_orth.dim

    ## Indices
    cvs_tril_ind = np.tril_indices(ncvs, k=-1)

    # MR-ADC(0) terms
    if mr_adc.method in ("mr-adc(2)", "mr-adc(2)-x"):
        dim = mr_adc.h0.dim + mr_adc.h1.dim
    else:
        dim = mr_adc.h0.dim

    T = np.zeros((nmo, dim))

    ## < [ q^(0), h^(0)^\dag ] >
    ### CORE(0) - C
    T[:ncvs, s_c:f_c] = np.identity(ncvs)

    # MR-ADC(1) terms
    ## < [ q^(1), h^(0)^\dag ] >
    if mr_adc.method in ("mr-adc(1)", "mr-adc(2)", "mr-adc(2)-x"):
        ### ACTIVE(1) - C
        T_a_c  = einsum('JX->XJ', t1_xa, optimize = einsum_type).copy()
        T_a_c += einsum('JxXy,yx->XJ', t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_c -= 1/2 * einsum('JxyX,yx->XJ', t1_xaaa, rdm_ca, optimize = einsum_type)
        T[ncore:nocc, s_c:f_c] = T_a_c.copy()

        ### EXTERNAL(1) - C
        T_e_c  = einsum('JA->AJ', t1_xe, optimize = einsum_type).copy()
        T_e_c += einsum('JxAy,yx->AJ', t1_xaea, rdm_ca, optimize = einsum_type)
        T_e_c -= 1/2 * einsum('JxyA,yx->AJ', t1_xaae, rdm_ca, optimize = einsum_type)
        T[nocc:, s_c:f_c] = T_e_c.copy()

    # MR-ADC(2) terms
    if mr_adc.method in ("mr-adc(2)", "mr-adc(2)-x"):
        ## < [ q^(0), h^(1)^\dag ] >
        ### CORE(0) - CAA
        T_c_caa  = 1/2 * einsum('IJ,YZ->IJYZ', np.identity(ncvs), rdm_ca, optimize = einsum_type)
        T[:ncvs, s_caa__aaa:f_caa__aaa] += T_c_caa.reshape(ncvs, -1)
        T[:ncvs, s_caa__abb:f_caa__abb] += T_c_caa.reshape(ncvs, -1)

        ## < [ q^(1), h^(1)^\dag ] >
        ### ACTIVE(1) - CAA
        T_a_caa  = 1/2 * einsum('JX,YZ->XJYZ', t1_xa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JxXZ,Yx->XJYZ', t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JxXy,YyZx->XJYZ', t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/2 * einsum('JxZX,Yx->XJYZ', t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('JxyX,YyZx->XJYZ', t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('JxyX,YyxZ->XJYZ', t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T[ncore:nocc, s_caa__aaa:f_caa__aaa] += T_a_caa.reshape(ncas, -1)

        T_a_caa  = 1/2 * einsum('JX,YZ->XJYZ', t1_xa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JxXZ,Yx->XJYZ', t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JxXy,YyZx->XJYZ', t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/3 * einsum('JxyX,YyZx->XJYZ', t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('JxyX,YyxZ->XJYZ', t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T[ncore:nocc, s_caa__abb:f_caa__abb] += T_a_caa.reshape(ncas, -1)

        T_a_caa =- 1/2 * einsum('JxZX,Yx->XJYZ', t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('JxyX,YyZx->XJYZ', t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/3 * einsum('JxyX,YyxZ->XJYZ', t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T[ncore:nocc, s_caa__bab:f_caa__bab] += T_a_caa.reshape(ncas, -1)

        ### VIRTUAL(1) - CAA
        if nextern > 0:
            T_e_caa  = 1/2 * einsum('JA,YZ->AJYZ', t1_xe, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JxAZ,Yx->AJYZ', t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JxAy,YyZx->AJYZ', t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/2 * einsum('JxZA,Yx->AJYZ', t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('JxyA,YyZx->AJYZ', t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('JxyA,YyxZ->AJYZ', t1_xaae, rdm_ccaa, optimize = einsum_type)
            T[nocc:, s_caa__aaa:f_caa__aaa] += T_e_caa.reshape(nextern, -1)

            T_e_caa  = 1/2 * einsum('JA,YZ->AJYZ', t1_xe, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JxAZ,Yx->AJYZ', t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JxAy,YyZx->AJYZ', t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/3 * einsum('JxyA,YyZx->AJYZ', t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('JxyA,YyxZ->AJYZ', t1_xaae, rdm_ccaa, optimize = einsum_type)
            T[nocc:, s_caa__abb:f_caa__abb] += T_e_caa.reshape(nextern, -1)

            T_e_caa =- 1/2 * einsum('JxZA,Yx->AJYZ', t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('JxyA,YyZx->AJYZ', t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/3 * einsum('JxyA,YyxZ->AJYZ', t1_xaae, rdm_ccaa, optimize = einsum_type)
            T[nocc:, s_caa__bab:f_caa__bab] += T_e_caa.reshape(nextern, -1)

        ### ACTIVE(1) - CCE
        T_a_cce =- einsum('JKBX->XJKB', t1_xxea, optimize = einsum_type).copy()
        T_a_cce += einsum('KJBX->XJKB', t1_xxea, optimize = einsum_type).copy()
        T[ncore:nocc, s_cce__aaa:f_cce__aaa] += T_a_cce[:, cvs_tril_ind[0], cvs_tril_ind[1]].reshape(ncas, -1)

        T_a_cce  = einsum('KJBX->XJKB', t1_xxea, optimize = einsum_type).copy()
        T[ncore:nocc, s_cce__abb:f_cce__abb] += T_a_cce.reshape(ncas, -1)

        ### ACTIVE(1) - CVE
        if nval > 0:
            T_a_cve =- einsum('JKBX->XJKB', t1_xvea, optimize = einsum_type).copy()
            T_a_cve += einsum('JKXB->XJKB', t1_xvae, optimize = einsum_type).copy()
            T[ncore:nocc, s_cve__aaa:f_cve__aaa] += T_a_cve.reshape(ncas, -1)

            T_a_cve  = einsum('JKXB->XJKB', t1_xvae, optimize = einsum_type).copy()
            T[ncore:nocc, s_cve__abb:f_cve__abb] += T_a_cve.reshape(ncas, -1)

            T_a_cve =- einsum('JKBX->XJKB', t1_xvea, optimize = einsum_type).copy()
            T[ncore:nocc, s_cve__bab:f_cve__bab] += T_a_cve.reshape(ncas, -1)

        ### VIRTUAL(1) - CCE
        if nextern > 0:
            T_e_cce  = einsum('JKAB->AJKB', t1_xxee, optimize = einsum_type).copy()
            T_e_cce -= einsum('KJAB->AJKB', t1_xxee, optimize = einsum_type).copy()
            T[nocc:, s_cce__aaa:f_cce__aaa] += T_e_cce[:, cvs_tril_ind[0], cvs_tril_ind[1]].reshape(nextern, -1)

            T_e_cce  = einsum('JKAB->AJKB', t1_xxee, optimize = einsum_type).copy()
            T[nocc:, s_cce__abb:f_cce__abb] += T_e_cce.reshape(nextern, -1)

        ### VIRTUAL(1) - CVE
        if nval > 0 and nextern > 0:
            T_e_cve  = einsum('JKAB->AJKB', t1_xvee, optimize = einsum_type).copy()
            T_e_cve -= einsum('JKBA->AJKB', t1_xvee, optimize = einsum_type).copy()
            T[nocc:, s_cve__aaa:f_cve__aaa] += T_e_cve.reshape(nextern, -1)

            T_e_cve  = einsum('JKAB->AJKB', t1_xvee, optimize = einsum_type).copy()
            T[nocc:, s_cve__abb:f_cve__abb] += T_e_cve.reshape(nextern, -1)

            T_e_cve =- einsum('JKBA->AJKB', t1_xvee, optimize = einsum_type).copy()
            T[nocc:, s_cve__bab:f_cve__bab] += T_e_cve.reshape(nextern, -1)

        ### ACTIVE(1) - CAE
        T_a_cae =- 1/2 * einsum('JxBX,Yx->XJYB', t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/2 * einsum('JxXB,Yx->XJYB', t1_xaae, rdm_ca, optimize = einsum_type)
        T[ncore:nocc, s_cae__aaa:f_cae__aaa] += T_a_cae.reshape(ncas, -1)

        T_a_cae  = 1/2 * einsum('JxXB,Yx->XJYB', t1_xaae, rdm_ca, optimize = einsum_type)
        T[ncore:nocc, s_cae__abb:f_cae__abb] += T_a_cae.reshape(ncas, -1)

        T_a_cae =- 1/2 * einsum('JxBX,Yx->XJYB', t1_xaea, rdm_ca, optimize = einsum_type)
        T[ncore:nocc, s_cae__bab:f_cae__bab] += T_a_cae.reshape(ncas, -1)

        ### VIRTUAL(1) - CAE
        if nextern > 0:
            T_e_cae  = 1/2 * einsum('JxAB,Yx->AJYB', t1_xaee, rdm_ca, optimize = einsum_type)
            T_e_cae -= 1/2 * einsum('JxBA,Yx->AJYB', t1_xaee, rdm_ca, optimize = einsum_type)
            T[nocc:, s_cae__aaa:f_cae__aaa] += T_e_cae.reshape(nextern, -1)

            T_e_cae  = 1/2 * einsum('JxAB,Yx->AJYB', t1_xaee, rdm_ca, optimize = einsum_type)
            T[nocc:, s_cae__abb:f_cae__abb] += T_e_cae.reshape(nextern, -1)

            T_e_cae =- 1/2 * einsum('JxBA,Yx->AJYB', t1_xaee, rdm_ca, optimize = einsum_type)
            T[nocc:, s_cae__bab:f_cae__bab] += T_e_cae.reshape(nextern, -1)

        ### ACTIVE(1) - CCA
        T_a_cca  = einsum('JKXY->XJKY', t1_xxaa, optimize = einsum_type).copy()
        T_a_cca -= einsum('JKYX->XJKY', t1_xxaa, optimize = einsum_type).copy()
        T_a_cca -= 1/2 * einsum('JKXx,xY->XJKY', t1_xxaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('JKxX,xY->XJKY', t1_xxaa, rdm_ca, optimize = einsum_type)
        T[ncore:nocc, s_cca__aaa:f_cca__aaa] += T_a_cca[:, cvs_tril_ind[0], cvs_tril_ind[1]].reshape(ncas, -1)

        T_a_cca  = einsum('JKXY->XJKY', t1_xxaa, optimize = einsum_type).copy()
        T_a_cca -= 1/2 * einsum('JKXx,xY->XJKY', t1_xxaa, rdm_ca, optimize = einsum_type)
        T[ncore:nocc, s_cca__abb:f_cca__abb] += T_a_cca.reshape(ncas, -1)

        ### ACTIVE(1) - CVA
        if nval > 0:
            T_a_cva  = einsum('JKXY->XJKY', t1_xvaa, optimize = einsum_type).copy()
            T_a_cva -= einsum('JKYX->XJKY', t1_xvaa, optimize = einsum_type).copy()
            T_a_cva -= 1/2 * einsum('JKXx,xY->XJKY', t1_xvaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JKxX,xY->XJKY', t1_xvaa, rdm_ca, optimize = einsum_type)
            T[ncore:nocc, s_cva__aaa:f_cva__aaa] += T_a_cva.reshape(ncas, -1)

            T_a_cva__a_abb  = einsum('JKXY->XJKY', t1_xvaa, optimize = einsum_type).copy()
            T_a_cva__a_abb -= 1/2 * einsum('JKXx,xY->XJKY', t1_xvaa, rdm_ca, optimize = einsum_type)
            T[ncore:nocc, s_cva__abb:f_cva__abb] += T_a_cva.reshape(ncas, -1)

            T_a_cva__a_bab =- einsum('JKYX->XJKY', t1_xvaa, optimize = einsum_type).copy()
            T_a_cva__a_bab += 1/2 * einsum('JKxX,xY->XJKY', t1_xvaa, rdm_ca, optimize = einsum_type)
            T[ncore:nocc, s_cva__bab:f_cva__bab] += T_a_cva.reshape(ncas, -1)

        ### VIRTUAL(1) - CCA
        if nextern > 0:
            T_e_cca  = einsum('JKAY->AJKY', t1_xxea, optimize = einsum_type).copy()
            T_e_cca -= einsum('KJAY->AJKY', t1_xxea, optimize = einsum_type).copy()
            T_e_cca -= 1/2 * einsum('JKAx,xY->AJKY', t1_xxea, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/2 * einsum('KJAx,xY->AJKY', t1_xxea, rdm_ca, optimize = einsum_type)
            T[nocc:, s_cca__aaa:f_cca__aaa] += T_e_cca[:, cvs_tril_ind[0], cvs_tril_ind[1]].reshape(nextern, -1)

            T_e_cca  = einsum('JKAY->AJKY', t1_xxea, optimize = einsum_type).copy()
            T_e_cca -= 1/2 * einsum('JKAx,xY->AJKY', t1_xxea, rdm_ca, optimize = einsum_type)
            T[nocc:, s_cca__abb:f_cca__abb] += T_e_cca.reshape(nextern, -1)

        ### VIRTUAL(1) - CVA
        if nval > 0 and nextern > 0:
            T_e_cva  = einsum('JKAY->AJKY', t1_xvea, optimize = einsum_type).copy()
            T_e_cva -= einsum('JKYA->AJKY', t1_xvae, optimize = einsum_type).copy()
            T_e_cva -= 1/2 * einsum('JKAx,Yx->AJKY', t1_xvea, rdm_ca, optimize = einsum_type)
            T_e_cva += 1/2 * einsum('JKxA,Yx->AJKY', t1_xvae, rdm_ca, optimize = einsum_type)
            T[nocc:, s_cva__aaa:f_cva__aaa] += T_e_cva.reshape(nextern, -1)

            T_e_cva  = einsum('JKAY->AJKY', t1_xvea, optimize = einsum_type).copy()
            T_e_cva -= 1/2 * einsum('JKAx,xY->AJKY', t1_xvea, rdm_ca, optimize = einsum_type)
            T[nocc:, s_cva__abb:f_cva__abb] += T_e_cva.reshape(nextern, -1)

            T_e_cva =- einsum('KJAY->AJKY', t1_vxea, optimize = einsum_type).copy()
            T_e_cva += 1/2 * einsum('KJAx,xY->AJKY', t1_vxea, rdm_ca, optimize = einsum_type)
            T[nocc:, s_cva__bab:f_cva__bab] += T_e_cva.reshape(nextern, -1)

        ## < [ q^(2), h^(0)^\dag ] >
        ### CORE(2) - C
        T_c_c =- 1/2 * einsum('Ix,Jx->IJ', t1_ca, t1_xa, optimize = einsum_type)
        T_c_c -= einsum('Iixy,Jixy->IJ', t1_ccaa, t1_xcaa, optimize = einsum_type)
        T_c_c += 1/2 * einsum('Iixy,Jiyx->IJ', t1_ccaa, t1_xcaa, optimize = einsum_type)
        T_c_c -= einsum('Iiax,Jiax->IJ', t1_ccea, t1_xcea, optimize = einsum_type)
        T_c_c += 1/2 * einsum('Iiax,iJax->IJ', t1_ccea, t1_cxea, optimize = einsum_type)
        T_c_c -= einsum('Iiab,Jiab->IJ', t1_ccee, t1_xcee, optimize = einsum_type)
        T_c_c += 1/2 * einsum('Iiab,Jiba->IJ', t1_ccee, t1_xcee, optimize = einsum_type)
        T_c_c -= 1/2 * einsum('Ia,Ja->IJ', t1_ce, t1_xe, optimize = einsum_type)
        T_c_c += 1/2 * einsum('Jiax,iIax->IJ', t1_xcea, t1_ccea, optimize = einsum_type)
        T_c_c -= einsum('iIax,iJax->IJ', t1_ccea, t1_cxea, optimize = einsum_type)
        T_c_c -= 1/2 * einsum('Ix,Jyxz,zy->IJ', t1_ca, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_c_c += 1/4 * einsum('Ix,Jyzx,zy->IJ', t1_ca, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_c_c -= 1/4 * einsum('Ixyz,Jxwu,yzwu->IJ', t1_caaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_c -= 1/2 * einsum('Ixyz,Jy,xz->IJ', t1_caaa, t1_xa, rdm_ca, optimize = einsum_type)
        T_c_c += 1/4 * einsum('Ixyz,Jz,xy->IJ', t1_caaa, t1_xa, rdm_ca, optimize = einsum_type)
        T_c_c -= 1/2 * einsum('Ixyz,Jwyz,xw->IJ', t1_caaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_c_c -= 1/2 * einsum('Ixyz,Jwyu,xuzw->IJ', t1_caaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_c += 1/4 * einsum('Ixyz,Jwzy,xw->IJ', t1_caaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_c_c += 1/4 * einsum('Ixyz,Jwzu,xuyw->IJ', t1_caaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_c += 1/4 * einsum('Ixyz,Jwuy,xuzw->IJ', t1_caaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_c += 1/4 * einsum('Ixyz,Jwuz,xuwy->IJ', t1_caaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_c += 1/4 * einsum('Ixya,Ja,xy->IJ', t1_caae, t1_xe, rdm_ca, optimize = einsum_type)
        T_c_c -= 1/2 * einsum('Ixya,Jzya,xz->IJ', t1_caae, t1_xaae, rdm_ca, optimize = einsum_type)
        T_c_c += 1/4 * einsum('Ixya,Jzay,xz->IJ', t1_caae, t1_xaea, rdm_ca, optimize = einsum_type)
        T_c_c += 1/4 * einsum('Ixya,Jzaw,xwyz->IJ', t1_caae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_c += 1/4 * einsum('Ixya,Jzwa,xwzy->IJ', t1_caae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_c -= 1/2 * einsum('Ixay,Ja,xy->IJ', t1_caea, t1_xe, rdm_ca, optimize = einsum_type)
        T_c_c -= 1/2 * einsum('Ixay,Jzay,xz->IJ', t1_caea, t1_xaea, rdm_ca, optimize = einsum_type)
        T_c_c -= 1/2 * einsum('Ixay,Jzaw,xwyz->IJ', t1_caea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_c += 1/4 * einsum('Ixay,Jzya,xz->IJ', t1_caea, t1_xaae, rdm_ca, optimize = einsum_type)
        T_c_c += 1/4 * einsum('Ixay,Jzwa,xwyz->IJ', t1_caea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_c -= 1/2 * einsum('Ixab,Jyab,xy->IJ', t1_caee, t1_xaee, rdm_ca, optimize = einsum_type)
        T_c_c += 1/4 * einsum('Ixab,Jyba,xy->IJ', t1_caee, t1_xaee, rdm_ca, optimize = einsum_type)
        T_c_c += 1/2 * einsum('Iixy,Jixz,zy->IJ', t1_ccaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        T_c_c -= 1/4 * einsum('Iixy,Jiyz,zx->IJ', t1_ccaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        T_c_c -= 1/4 * einsum('Iixy,Jizx,zy->IJ', t1_ccaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        T_c_c += 1/2 * einsum('Iixy,Jizy,zx->IJ', t1_ccaa, t1_xcaa, rdm_ca, optimize = einsum_type)
        T_c_c -= 1/4 * einsum('Iixy,Jizw,xyzw->IJ', t1_ccaa, t1_xcaa, rdm_ccaa, optimize = einsum_type)
        T_c_c += 1/2 * einsum('Iiax,Jiay,yx->IJ', t1_ccea, t1_xcea, rdm_ca, optimize = einsum_type)
        T_c_c -= 1/4 * einsum('Iiax,iJay,yx->IJ', t1_ccea, t1_cxea, rdm_ca, optimize = einsum_type)
        T_c_c -= 1/2 * einsum('Ia,Jxay,yx->IJ', t1_ce, t1_xaea, rdm_ca, optimize = einsum_type)
        T_c_c += 1/4 * einsum('Ia,Jxya,yx->IJ', t1_ce, t1_xaae, rdm_ca, optimize = einsum_type)
        T_c_c -= 1/4 * einsum('Jiax,iIay,xy->IJ', t1_xcea, t1_ccea, rdm_ca, optimize = einsum_type)
        T_c_c += 1/2 * einsum('iIax,iJay,yx->IJ', t1_ccea, t1_cxea, rdm_ca, optimize = einsum_type)
        T[:ncore, s_c:f_c] += T_c_c.copy()

        ### VALENCE(2) - C
        if nval > 0:
            T_v_c =- 1/2 * einsum('Ia,Ja->IJ', t1_ve, t1_xe, optimize = einsum_type)
            T_v_c -= einsum('Iiab,Jiab->IJ', t1_vxee, t1_xxee, optimize = einsum_type)
            T_v_c += 1/2 * einsum('Iiab,Jiba->IJ', t1_vxee, t1_xxee, optimize = einsum_type)
            T_v_c -= einsum('Iiax,Jiax->IJ', t1_vxea, t1_xxea, optimize = einsum_type)
            T_v_c += 1/2 * einsum('Iiax,iJax->IJ', t1_vxea, t1_xxea, optimize = einsum_type)
            T_v_c += 1/2 * einsum('Iixa,Jiax->IJ', t1_vxae, t1_xxea, optimize = einsum_type)
            T_v_c -= einsum('Iixa,iJax->IJ', t1_vxae, t1_xxea, optimize = einsum_type)
            T_v_c -= einsum('Iixy,Jixy->IJ', t1_vxaa, t1_xxaa, optimize = einsum_type)
            T_v_c += 1/2 * einsum('Iixy,Jiyx->IJ', t1_vxaa, t1_xxaa, optimize = einsum_type)
            T_v_c -= einsum('Iiab,Jiab->IJ', t1_vvee, t1_xvee, optimize = einsum_type)
            T_v_c += 1/2 * einsum('Iiab,Jiba->IJ', t1_vvee, t1_xvee, optimize = einsum_type)
            T_v_c -= einsum('Iiax,Jiax->IJ', t1_vvea, t1_xvea, optimize = einsum_type)
            T_v_c += 1/2 * einsum('Iiax,Jixa->IJ', t1_vvea, t1_xvae, optimize = einsum_type)
            T_v_c -= einsum('Iixy,Jixy->IJ', t1_vvaa, t1_xvaa, optimize = einsum_type)
            T_v_c += 1/2 * einsum('Iixy,Jiyx->IJ', t1_vvaa, t1_xvaa, optimize = einsum_type)
            T_v_c -= 1/2 * einsum('Ix,Jx->IJ', t1_va, t1_xa, optimize = einsum_type)
            T_v_c += 1/2 * einsum('Jiax,iIax->IJ', t1_xvea, t1_vvea, optimize = einsum_type)
            T_v_c -= einsum('Jixa,iIax->IJ', t1_xvae, t1_vvea, optimize = einsum_type)
            T_v_c -= 1/2 * einsum('Ia,Jxay,xy->IJ', t1_ve, t1_xaea, rdm_ca, optimize = einsum_type)
            T_v_c += 1/4 * einsum('Ia,Jxya,xy->IJ', t1_ve, t1_xaae, rdm_ca, optimize = einsum_type)
            T_v_c += 1/2 * einsum('Iiax,Jiay,xy->IJ', t1_vxea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_c -= 1/4 * einsum('Iiax,iJay,xy->IJ', t1_vxea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_c -= 1/4 * einsum('Iixa,Jiay,xy->IJ', t1_vxae, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_c += 1/2 * einsum('Iixa,iJay,xy->IJ', t1_vxae, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_c += 1/2 * einsum('Iixy,Jixz,yz->IJ', t1_vxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_c -= 1/4 * einsum('Iixy,Jiyz,xz->IJ', t1_vxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_c -= 1/4 * einsum('Iixy,Jizw,xyzw->IJ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_c -= 1/4 * einsum('Iixy,Jizx,yz->IJ', t1_vxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_c += 1/2 * einsum('Iixy,Jizy,xz->IJ', t1_vxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_c += 1/2 * einsum('Iiax,Jiay,xy->IJ', t1_vvea, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_c -= 1/4 * einsum('Iiax,Jiya,xy->IJ', t1_vvea, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_c += 1/2 * einsum('Iixy,Jixz,yz->IJ', t1_vvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_c -= 1/4 * einsum('Iixy,Jiyz,xz->IJ', t1_vvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_c -= 1/4 * einsum('Iixy,Jizw,xyzw->IJ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_c -= 1/4 * einsum('Iixy,Jizx,yz->IJ', t1_vvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_c += 1/2 * einsum('Iixy,Jizy,xz->IJ', t1_vvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_c -= 1/2 * einsum('Ix,Jyxz,yz->IJ', t1_va, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_v_c += 1/4 * einsum('Ix,Jyzx,yz->IJ', t1_va, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_v_c -= 1/2 * einsum('Ixab,Jyab,xy->IJ', t1_vaee, t1_xaee, rdm_ca, optimize = einsum_type)
            T_v_c += 1/4 * einsum('Ixab,Jyba,xy->IJ', t1_vaee, t1_xaee, rdm_ca, optimize = einsum_type)
            T_v_c -= 1/2 * einsum('Ixay,Ja,xy->IJ', t1_vaea, t1_xe, rdm_ca, optimize = einsum_type)
            T_v_c -= 1/2 * einsum('Ixay,Jzaw,xwyz->IJ', t1_vaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_c -= 1/2 * einsum('Ixay,Jzay,xz->IJ', t1_vaea, t1_xaea, rdm_ca, optimize = einsum_type)
            T_v_c += 1/4 * einsum('Ixay,Jzwa,xwyz->IJ', t1_vaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_c += 1/4 * einsum('Ixay,Jzya,xz->IJ', t1_vaea, t1_xaae, rdm_ca, optimize = einsum_type)
            T_v_c += 1/4 * einsum('Ixya,Ja,xy->IJ', t1_vaae, t1_xe, rdm_ca, optimize = einsum_type)
            T_v_c += 1/4 * einsum('Ixya,Jzaw,xwyz->IJ', t1_vaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_c += 1/4 * einsum('Ixya,Jzay,xz->IJ', t1_vaae, t1_xaea, rdm_ca, optimize = einsum_type)
            T_v_c += 1/4 * einsum('Ixya,Jzwa,xwzy->IJ', t1_vaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_c -= 1/2 * einsum('Ixya,Jzya,xz->IJ', t1_vaae, t1_xaae, rdm_ca, optimize = einsum_type)
            T_v_c += 1/4 * einsum('Ixyz,Jwuy,xuzw->IJ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_c += 1/4 * einsum('Ixyz,Jwuz,xuwy->IJ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_c -= 1/2 * einsum('Ixyz,Jwyu,xuzw->IJ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_c -= 1/2 * einsum('Ixyz,Jwyz,xw->IJ', t1_vaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_v_c += 1/4 * einsum('Ixyz,Jwzu,xuyw->IJ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_c += 1/4 * einsum('Ixyz,Jwzy,xw->IJ', t1_vaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_v_c -= 1/4 * einsum('Ixyz,Jxwu,yzwu->IJ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_c -= 1/2 * einsum('Ixyz,Jy,xz->IJ', t1_vaaa, t1_xa, rdm_ca, optimize = einsum_type)
            T_v_c += 1/4 * einsum('Ixyz,Jz,xy->IJ', t1_vaaa, t1_xa, rdm_ca, optimize = einsum_type)
            T_v_c -= 1/4 * einsum('Jiax,iIay,xy->IJ', t1_xvea, t1_vvea, rdm_ca, optimize = einsum_type)
            T_v_c += 1/2 * einsum('Jixa,iIay,xy->IJ', t1_xvae, t1_vvea, rdm_ca, optimize = einsum_type)
            T[ncvs:ncore, s_c:f_c] += T_v_c.copy()

        ### ACTIVE(2) - C
        T_a_c  = einsum('JiXx,ix->XJ', t1_xcaa, t1_ca, optimize = einsum_type)
        T_a_c -= 1/2 * einsum('JixX,ix->XJ', t1_xcaa, t1_ca, optimize = einsum_type)
        T_a_c += 1/2 * einsum('Jixy,iXxy->XJ', t1_xcaa, t1_caaa, optimize = einsum_type)
        T_a_c -= einsum('Jixy,iXyx->XJ', t1_xcaa, t1_caaa, optimize = einsum_type)
        T_a_c -= 1/2 * einsum('JiaX,ia->XJ', t1_xcea, t1_ce, optimize = einsum_type)
        T_a_c += 1/2 * einsum('Jiax,iXax->XJ', t1_xcea, t1_caea, optimize = einsum_type)
        T_a_c -= einsum('Jiax,iXxa->XJ', t1_xcea, t1_caae, optimize = einsum_type)
        T_a_c += 1/2 * einsum('Jiab,iXab->XJ', t1_xcee, t1_caee, optimize = einsum_type)
        T_a_c -= einsum('Jiab,iXba->XJ', t1_xcee, t1_caee, optimize = einsum_type)
        T_a_c -= 1/2 * einsum('Ja,Xa->XJ', t1_xe, t1_ae, optimize = einsum_type)
        T_a_c += einsum('iJaX,ia->XJ', t1_cxea, t1_ce, optimize = einsum_type)
        T_a_c -= einsum('iJax,iXax->XJ', t1_cxea, t1_caea, optimize = einsum_type)
        T_a_c += 1/2 * einsum('iJax,iXxa->XJ', t1_cxea, t1_caae, optimize = einsum_type)
        T_a_c += 1/2 * einsum('JxXa,ya,yx->XJ', t1_xaae, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_c += 1/2 * einsum('JxXa,yzaw,xwyz->XJ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_c += 1/4 * einsum('Jxya,Xa,yx->XJ', t1_xaae, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_c += 1/4 * einsum('Jxya,Xzay,zx->XJ', t1_xaae, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_c += 1/4 * einsum('Jxya,Xzaw,xwyz->XJ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_c -= 1/2 * einsum('Jxya,zXay,zx->XJ', t1_xaae, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_c += 1/4 * einsum('Jxya,zXaw,xwzy->XJ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_c -= 1/4 * einsum('JxaX,ya,yx->XJ', t1_xaea, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_c -= 1/4 * einsum('JxaX,yzaw,xwyz->XJ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_c -= 1/2 * einsum('Jxay,Xa,yx->XJ', t1_xaea, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_c -= 1/2 * einsum('Jxay,Xzay,zx->XJ', t1_xaea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_c -= 1/2 * einsum('Jxay,Xzaw,xwyz->XJ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_c += 1/4 * einsum('Jxay,zXay,zx->XJ', t1_xaea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_c += 1/4 * einsum('Jxay,zXaw,xwyz->XJ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_c -= 1/2 * einsum('Jxab,Xyab,yx->XJ', t1_xaee, t1_aaee, rdm_ca, optimize = einsum_type)
        T_a_c += 1/4 * einsum('Jxab,Xyba,yx->XJ', t1_xaee, t1_aaee, rdm_ca, optimize = einsum_type)
        T_a_c -= 1/2 * einsum('JiXx,iy,xy->XJ', t1_xcaa, t1_ca, rdm_ca, optimize = einsum_type)
        T_a_c += einsum('JiXx,iyxz,yz->XJ', t1_xcaa, t1_caaa, rdm_ca, optimize = einsum_type)
        T_a_c -= 1/2 * einsum('JiXx,iyzx,yz->XJ', t1_xcaa, t1_caaa, rdm_ca, optimize = einsum_type)
        T_a_c -= 1/2 * einsum('JiXx,iyzw,xyzw->XJ', t1_xcaa, t1_caaa, rdm_ccaa, optimize = einsum_type)
        T_a_c += 1/4 * einsum('JixX,iy,xy->XJ', t1_xcaa, t1_ca, rdm_ca, optimize = einsum_type)
        T_a_c -= 1/2 * einsum('JixX,iyxz,yz->XJ', t1_xcaa, t1_caaa, rdm_ca, optimize = einsum_type)
        T_a_c += 1/4 * einsum('JixX,iyzx,yz->XJ', t1_xcaa, t1_caaa, rdm_ca, optimize = einsum_type)
        T_a_c += 1/4 * einsum('JixX,iyzw,xyzw->XJ', t1_xcaa, t1_caaa, rdm_ccaa, optimize = einsum_type)
        T_a_c -= 1/4 * einsum('Jixy,iXxz,yz->XJ', t1_xcaa, t1_caaa, rdm_ca, optimize = einsum_type)
        T_a_c += 1/2 * einsum('Jixy,iXyz,xz->XJ', t1_xcaa, t1_caaa, rdm_ca, optimize = einsum_type)
        T_a_c += 1/2 * einsum('Jixy,iXzx,yz->XJ', t1_xcaa, t1_caaa, rdm_ca, optimize = einsum_type)
        T_a_c -= 1/4 * einsum('Jixy,iXzy,xz->XJ', t1_xcaa, t1_caaa, rdm_ca, optimize = einsum_type)
        T_a_c -= 1/4 * einsum('Jixy,iXzw,xywz->XJ', t1_xcaa, t1_caaa, rdm_ccaa, optimize = einsum_type)
        T_a_c -= 1/2 * einsum('JiaX,ixay,xy->XJ', t1_xcea, t1_caea, rdm_ca, optimize = einsum_type)
        T_a_c += 1/4 * einsum('JiaX,ixya,xy->XJ', t1_xcea, t1_caae, rdm_ca, optimize = einsum_type)
        T_a_c -= 1/4 * einsum('Jiax,iXay,xy->XJ', t1_xcea, t1_caea, rdm_ca, optimize = einsum_type)
        T_a_c += 1/2 * einsum('Jiax,iXya,xy->XJ', t1_xcea, t1_caae, rdm_ca, optimize = einsum_type)
        T_a_c -= 1/2 * einsum('Ja,Xxay,xy->XJ', t1_xe, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_c += 1/4 * einsum('Ja,xXay,xy->XJ', t1_xe, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_c += einsum('iJaX,ixay,xy->XJ', t1_cxea, t1_caea, rdm_ca, optimize = einsum_type)
        T_a_c -= 1/2 * einsum('iJaX,ixya,xy->XJ', t1_cxea, t1_caae, rdm_ca, optimize = einsum_type)
        T_a_c += 1/2 * einsum('iJax,iXay,xy->XJ', t1_cxea, t1_caea, rdm_ca, optimize = einsum_type)
        T_a_c -= 1/4 * einsum('iJax,iXya,xy->XJ', t1_cxea, t1_caae, rdm_ca, optimize = einsum_type)
        T[ncore:nocc, s_c:f_c] += T_a_c.copy()

        ### EXTERNAL(2) - C
        T_e_c  = einsum('JA->AJ', t2_xe, optimize = einsum_type).copy()
        T_e_c += 1/2 * einsum('xA,Jx->AJ', t1_ae, t1_xa, optimize = einsum_type)
        T_e_c += einsum('JiAx,ix->AJ', t1_xcea, t1_ca, optimize = einsum_type)
        T_e_c -= 1/2 * einsum('iJAx,ix->AJ', t1_cxea, t1_ca, optimize = einsum_type)
        T_e_c += einsum('JiAa,ia->AJ', t1_xcee, t1_ce, optimize = einsum_type)
        T_e_c += 1/2 * einsum('xA,Jyxz,zy->AJ', t1_ae, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_e_c -= 1/4 * einsum('xA,Jyzx,zy->AJ', t1_ae, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_e_c += einsum('JiAx,iyxz,yz->AJ', t1_xcea, t1_caaa, rdm_ca, optimize = einsum_type)
        T_e_c -= 1/2 * einsum('JiAx,iy,xy->AJ', t1_xcea, t1_ca, rdm_ca, optimize = einsum_type)
        T_e_c -= 1/2 * einsum('JiAx,iyzx,yz->AJ', t1_xcea, t1_caaa, rdm_ca, optimize = einsum_type)
        T_e_c -= 1/2 * einsum('JiAx,iyzw,xyzw->AJ', t1_xcea, t1_caaa, rdm_ccaa, optimize = einsum_type)
        T_e_c += 1/4 * einsum('xyAz,Jzwu,xywu->AJ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_e_c += 1/2 * einsum('xyAz,Jx,zy->AJ', t1_aaea, t1_xa, rdm_ca, optimize = einsum_type)
        T_e_c -= 1/4 * einsum('xyAz,Jy,zx->AJ', t1_aaea, t1_xa, rdm_ca, optimize = einsum_type)
        T_e_c += 1/2 * einsum('xyAz,Jwxy,zw->AJ', t1_aaea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_e_c += 1/2 * einsum('xyAz,Jwxu,zuyw->AJ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_e_c -= 1/4 * einsum('xyAz,Jwyx,zw->AJ', t1_aaea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_e_c -= 1/4 * einsum('xyAz,Jwyu,zuxw->AJ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_e_c -= 1/4 * einsum('xyAz,Jwux,zuyw->AJ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_e_c -= 1/4 * einsum('xyAz,Jwuy,zuwx->AJ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_e_c -= 1/2 * einsum('iJAx,iyxz,yz->AJ', t1_cxea, t1_caaa, rdm_ca, optimize = einsum_type)
        T_e_c += 1/4 * einsum('iJAx,iy,xy->AJ', t1_cxea, t1_ca, rdm_ca, optimize = einsum_type)
        T_e_c += 1/4 * einsum('iJAx,iyzx,yz->AJ', t1_cxea, t1_caaa, rdm_ca, optimize = einsum_type)
        T_e_c += 1/4 * einsum('iJAx,iyzw,xyzw->AJ', t1_cxea, t1_caaa, rdm_ccaa, optimize = einsum_type)
        T_e_c += 1/2 * einsum('JxAa,ya,yx->AJ', t1_xaee, t1_ae, rdm_ca, optimize = einsum_type)
        T_e_c += 1/2 * einsum('JxAa,yzaw,xwyz->AJ', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_e_c -= 1/4 * einsum('JxaA,ya,yx->AJ', t1_xaee, t1_ae, rdm_ca, optimize = einsum_type)
        T_e_c -= 1/4 * einsum('JxaA,yzaw,xwyz->AJ', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_e_c += einsum('JiAa,ixay,xy->AJ', t1_xcee, t1_caea, rdm_ca, optimize = einsum_type)
        T_e_c -= 1/2 * einsum('JiAa,ixya,xy->AJ', t1_xcee, t1_caae, rdm_ca, optimize = einsum_type)
        T_e_c -= 1/2 * einsum('JiaA,ixay,xy->AJ', t1_xcee, t1_caea, rdm_ca, optimize = einsum_type)
        T_e_c += 1/4 * einsum('JiaA,ixya,xy->AJ', t1_xcee, t1_caae, rdm_ca, optimize = einsum_type)
        T[nocc:, s_c:f_c] += T_e_c.copy()

    # MR-ADC(2)-X terms
    # {q^(2)| h^(1)^dag}
    if mr_adc.method == "mr-adc(2)-x":
        # New variables to load
        t1_xvae = mr_adc.t1.xvae
        t1_vxae = mr_adc.t1.vxae
        t1_xxae = mr_adc.t1.xxae

        t1_vxaa = mr_adc.t1.vxaa
        t1_vvaa = mr_adc.t1.vvaa

        t1_vvee = mr_adc.t1.vvee
        t1_vvea = mr_adc.t1.vvea
        t1_vvae = mr_adc.t1.vvae

        t2_xa = mr_adc.t2.xa

        t2_xaaa = mr_adc.t2.xaaa
        t2_xxee = mr_adc.t2.xxee
        t2_xxea = mr_adc.t2.xxea
        t2_xaee = mr_adc.t2.xaee
        t2_xxaa = mr_adc.t2.xxaa

        if nval > 0:
            t1_va = mr_adc.t1.va
            t1_ve = mr_adc.t1.ve

            t1_vaea = mr_adc.t1.vaea
            t1_vaae = mr_adc.t1.vaae

            t1_vaaa = mr_adc.t1.vaaa
            t1_vaee = mr_adc.t1.vaee

            t2_xvea = mr_adc.t2.xvea
            t2_xvae = mr_adc.t2.xvae

            t2_xaea = mr_adc.t2.xaea
            t2_xaae = mr_adc.t2.xaae

            t2_xvaa = mr_adc.t2.xvaa

            t2_xvee = mr_adc.t2.xvee

        # CORE(2) - CAA
        T_c_caa =- 1/4 * einsum('IZab,Jxab,Yx->IJYZ', t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('IZab,Jxba,Yx->IJYZ', t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('IZax,Ja,Yx->IJYZ', t1_xaea, t1_xe, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('IZax,Jyax,Yy->IJYZ', t1_xaea, t1_xaea, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('IZax,Jyaz,Yzxy->IJYZ', t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('IZax,Jyxa,Yy->IJYZ', t1_xaea, t1_xaae, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('IZax,Jyza,Yzxy->IJYZ', t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('IZax,Jyza,Yzyx->IJYZ', t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('IZxa,Ja,Yx->IJYZ', t1_xaae, t1_xe, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('IZxa,Jyax,Yy->IJYZ', t1_xaae, t1_xaea, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('IZxa,Jyaz,Yzxy->IJYZ', t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('IZxa,Jyxa,Yy->IJYZ', t1_xaae, t1_xaae, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('IZxa,Jyza,Yzxy->IJYZ', t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('IZxa,Jyza,Yzyx->IJYZ', t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('IZxy,Jx,Yy->IJYZ', t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('IZxy,Jy,Yx->IJYZ', t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('IZxy,Jzwx,Ywyz->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('IZxy,Jzwx,Ywzy->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('IZxy,Jzwy,Ywxz->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('IZxy,Jzwy,Ywzx->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('IZxy,Jzxw,Ywyz->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('IZxy,Jzxy,Yz->IJYZ', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('IZxy,Jzyw,Ywxz->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('IZxy,Jzyx,Yz->IJYZ', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ia,Ja,YZ->IJYZ', t1_xe, t1_xe, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Ia,JxZa,Yx->IJYZ', t1_xe, t1_xaae, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ia,JxaZ,Yx->IJYZ', t1_xe, t1_xaea, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ia,Jxay,YyZx->IJYZ', t1_xe, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ia,Jxya,YyZx->IJYZ', t1_xe, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ia,Jxya,YyxZ->IJYZ', t1_xe, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/2 * einsum('Iiab,Jiab,YZ->IJYZ', t1_xxee, t1_xxee, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iiab,Jiba,YZ->IJYZ', t1_xxee, t1_xxee, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iiax,JiaZ,Yx->IJYZ', t1_xxea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/2 * einsum('Iiax,Jiax,YZ->IJYZ', t1_xxea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iiax,Jiay,YyZx->IJYZ', t1_xxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Iiax,iJaZ,Yx->IJYZ', t1_xxea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iiax,iJax,YZ->IJYZ', t1_xxea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Iiax,iJay,YyZx->IJYZ', t1_xxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Iiax,iJay,YyxZ->IJYZ', t1_xxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Iixy,JiZx,Yy->IJYZ', t1_xxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/2 * einsum('Iixy,JiZy,Yx->IJYZ', t1_xxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Iixy,JiZz,Yzxy->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iixy,JixZ,Yy->IJYZ', t1_xxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/2 * einsum('Iixy,Jixy,YZ->IJYZ', t1_xxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iixy,Jixz,YzZy->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Iixy,JiyZ,Yx->IJYZ', t1_xxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iixy,Jiyx,YZ->IJYZ', t1_xxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Iixy,Jiyz,YzZx->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Iixy,Jiyz,YzxZ->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Iixy,JizZ,Yzxy->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Iixy,JizZ,Yzyx->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Iixy,Jizw,YzwZxy->IJYZ', t1_xxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Iixy,Jizw,YzwxZy->IJYZ', t1_xxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Iixy,Jizx,YzZy->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Iixy,Jizx,YzyZ->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Iixy,Jizy,YzZx->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Iixy,Jizy,YzxZ->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/2 * einsum('Iiab,Jiab,YZ->IJYZ', t1_xvee, t1_xvee, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iiab,Jiba,YZ->IJYZ', t1_xvee, t1_xvee, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Iiax,JiZa,Yx->IJYZ', t1_xvea, t1_xvae, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iiax,JiaZ,Yx->IJYZ', t1_xvea, t1_xvea, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/2 * einsum('Iiax,Jiax,YZ->IJYZ', t1_xvea, t1_xvea, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iiax,Jiay,YyZx->IJYZ', t1_xvea, t1_xvea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iiax,Jixa,YZ->IJYZ', t1_xvea, t1_xvae, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Iiax,Jiya,YyZx->IJYZ', t1_xvea, t1_xvae, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Iiax,Jiya,YyxZ->IJYZ', t1_xvea, t1_xvae, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/2 * einsum('Iixa,JiZa,Yx->IJYZ', t1_xvae, t1_xvae, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Iixa,JiaZ,Yx->IJYZ', t1_xvae, t1_xvea, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iixa,Jiax,YZ->IJYZ', t1_xvae, t1_xvea, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Iixa,Jiay,YyZx->IJYZ', t1_xvae, t1_xvea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Iixa,Jiay,YyxZ->IJYZ', t1_xvae, t1_xvea, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/2 * einsum('Iixa,Jixa,YZ->IJYZ', t1_xvae, t1_xvae, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Iixa,Jiya,YyZx->IJYZ', t1_xvae, t1_xvae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Iixa,Jiya,YyxZ->IJYZ', t1_xvae, t1_xvae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Iixy,JiZx,Yy->IJYZ', t1_xvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/2 * einsum('Iixy,JiZy,Yx->IJYZ', t1_xvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Iixy,JiZz,Yzxy->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iixy,JixZ,Yy->IJYZ', t1_xvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/2 * einsum('Iixy,Jixy,YZ->IJYZ', t1_xvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iixy,Jixz,YzZy->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Iixy,JiyZ,Yx->IJYZ', t1_xvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iixy,Jiyx,YZ->IJYZ', t1_xvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Iixy,Jiyz,YzZx->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Iixy,Jiyz,YzxZ->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Iixy,JizZ,Yzxy->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Iixy,JizZ,Yzyx->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Iixy,Jizw,YzwZxy->IJYZ', t1_xvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Iixy,Jizw,YzwxZy->IJYZ', t1_xvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Iixy,Jizx,YzZy->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Iixy,Jizx,YzyZ->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Iixy,Jizy,YzZx->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Iixy,Jizy,YzxZ->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ix,Jx,YZ->IJYZ', t1_xa, t1_xa, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Ix,JyZx,Yy->IJYZ', t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ix,JyxZ,Yy->IJYZ', t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ix,Jyxz,YzZy->IJYZ', t1_xa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ix,Jyzx,YzZy->IJYZ', t1_xa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ix,Jyzx,YzyZ->IJYZ', t1_xa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixab,Jyab,YxZy->IJYZ', t1_xaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixab,Jyba,YxZy->IJYZ', t1_xaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixab,Jyba,YxyZ->IJYZ', t1_xaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixay,Ja,YxZy->IJYZ', t1_xaea, t1_xe, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Ixay,JzZa,Yxzy->IJYZ', t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixay,JzaZ,Yxzy->IJYZ', t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixay,Jzaw,YxwZyz->IJYZ', t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixay,Jzay,YxZz->IJYZ', t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixay,Jzwa,YxwZyz->IJYZ', t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixay,Jzwa,YxwzyZ->IJYZ', t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixay,Jzya,YxZz->IJYZ', t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixay,Jzya,YxzZ->IJYZ', t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixya,Ja,YxZy->IJYZ', t1_xaae, t1_xe, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixya,Ja,YxyZ->IJYZ', t1_xaae, t1_xe, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Ixya,JzZa,Yxyz->IJYZ', t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixya,JzaZ,Yxyz->IJYZ', t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixya,JzaZ,Yxzy->IJYZ', t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixya,Jzaw,YxwZyz->IJYZ', t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixya,Jzaw,YxwyZz->IJYZ', t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixya,Jzay,YxZz->IJYZ', t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixya,Jzay,YxzZ->IJYZ', t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixya,Jzwa,YxwZzy->IJYZ', t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixya,Jzwa,YxwyzZ->IJYZ', t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixya,Jzya,YxZz->IJYZ', t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Ixyz,JwZy,Yxwz->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Ixyz,JwZz,Yxyw->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,Jwuy,YxuZzw->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixyz,Jwuy,YxuwzZ->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,Jwuz,YxuZwy->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixyz,Jwuz,YxuywZ->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixyz,JwyZ,Yxwz->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixyz,Jwyu,YxuZzw->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixyz,Jwyz,YxZw->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,JwzZ,Yxwy->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixyz,JwzZ,Yxyw->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,Jwzu,YxuZyw->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixyz,Jwzu,YxuyZw->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,Jwzy,YxZw->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixyz,Jwzy,YxwZ->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixyz,JxZw,Ywyz->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,JxwZ,Ywyz->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixyz,JxwZ,Ywzy->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixyz,Jxwu,YwuZyz->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,Jxwu,YwuyZz->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixyz,Jy,YxZz->IJYZ', t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,Jz,YxZy->IJYZ', t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixyz,Jz,YxyZ->IJYZ', t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('JiaZ,iIax,Yx->IJYZ', t1_xxea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Jiax,iIax,YZ->IJYZ', t1_xxea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Jiax,iIay,YxZy->IJYZ', t1_xxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Jiax,iIay,YxyZ->IJYZ', t1_xxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/2 * einsum('iIax,iJaZ,Yx->IJYZ', t1_xxea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/2 * einsum('iIax,iJax,YZ->IJYZ', t1_xxea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('iIax,iJay,YyZx->IJYZ', t1_xxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('iIax,iJay,YyxZ->IJYZ', t1_xxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T[:ncvs, s_caa__aaa:f_caa__aaa] += T_c_caa.reshape(ncvs, -1)

        T_c_caa =- 1/4 * einsum('IZab,Jxab,Yx->IJYZ', t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('IZax,Ja,Yx->IJYZ', t1_xaea, t1_xe, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('IZax,Jyax,Yy->IJYZ', t1_xaea, t1_xaea, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('IZax,Jyaz,Yzxy->IJYZ', t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('IZax,Jyza,Yzxy->IJYZ', t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('IZax,Jyza,Yzyx->IJYZ', t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('IZxa,Jyxa,Yy->IJYZ', t1_xaae, t1_xaae, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('IZxa,Jyza,Yzxy->IJYZ', t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('IZxa,Jyza,Yzyx->IJYZ', t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('IZxy,Jx,Yy->IJYZ', t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('IZxy,Jzwx,Ywyz->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('IZxy,Jzwx,Ywzy->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('IZxy,Jzwy,Ywxz->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('IZxy,Jzwy,Ywzx->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('IZxy,Jzxw,Ywyz->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('IZxy,Jzxy,Yz->IJYZ', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ia,Ja,YZ->IJYZ', t1_xe, t1_xe, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ia,JxaZ,Yx->IJYZ', t1_xe, t1_xaea, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ia,Jxay,YyZx->IJYZ', t1_xe, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Ia,Jxya,YyZx->IJYZ', t1_xe, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ia,Jxya,YyxZ->IJYZ', t1_xe, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/2 * einsum('Iiab,Jiab,YZ->IJYZ', t1_xxee, t1_xxee, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iiab,Jiba,YZ->IJYZ', t1_xxee, t1_xxee, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iiax,JiaZ,Yx->IJYZ', t1_xxea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/2 * einsum('Iiax,Jiax,YZ->IJYZ', t1_xxea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iiax,Jiay,YyZx->IJYZ', t1_xxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iiax,iJax,YZ->IJYZ', t1_xxea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Iiax,iJay,YyZx->IJYZ', t1_xxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Iiax,iJay,YyxZ->IJYZ', t1_xxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iixy,JixZ,Yy->IJYZ', t1_xxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/2 * einsum('Iixy,Jixy,YZ->IJYZ', t1_xxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iixy,Jixz,YzZy->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iixy,Jiyx,YZ->IJYZ', t1_xxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Iixy,Jiyz,YzZx->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Iixy,Jiyz,YzxZ->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Iixy,JizZ,Yzxy->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Iixy,JizZ,Yzyx->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/8 * einsum('Iixy,Jizw,YzwZxy->IJYZ', t1_xxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/24 * einsum('Iixy,Jizw,YzwZyx->IJYZ', t1_xxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/24 * einsum('Iixy,Jizw,YzwxZy->IJYZ', t1_xxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/24 * einsum('Iixy,Jizw,YzwxyZ->IJYZ', t1_xxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/24 * einsum('Iixy,Jizw,YzwyZx->IJYZ', t1_xxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/24 * einsum('Iixy,Jizw,YzwyxZ->IJYZ', t1_xxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Iixy,Jizx,YzZy->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Iixy,Jizx,YzyZ->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/3 * einsum('Iixy,Jizy,YzZx->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Iixy,Jizy,YzxZ->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/2 * einsum('Iiab,Jiab,YZ->IJYZ', t1_xvee, t1_xvee, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iiab,Jiba,YZ->IJYZ', t1_xvee, t1_xvee, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iiax,JiaZ,Yx->IJYZ', t1_xvea, t1_xvea, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/2 * einsum('Iiax,Jiax,YZ->IJYZ', t1_xvea, t1_xvea, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iiax,Jiay,YyZx->IJYZ', t1_xvea, t1_xvea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iiax,Jixa,YZ->IJYZ', t1_xvea, t1_xvae, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Iiax,Jiya,YyZx->IJYZ', t1_xvea, t1_xvae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Iiax,Jiya,YyxZ->IJYZ', t1_xvea, t1_xvae, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iixa,Jiax,YZ->IJYZ', t1_xvae, t1_xvea, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Iixa,Jiay,YyZx->IJYZ', t1_xvae, t1_xvea, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Iixa,Jiay,YyxZ->IJYZ', t1_xvae, t1_xvea, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/2 * einsum('Iixa,Jixa,YZ->IJYZ', t1_xvae, t1_xvae, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/3 * einsum('Iixa,Jiya,YyZx->IJYZ', t1_xvae, t1_xvae, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Iixa,Jiya,YyxZ->IJYZ', t1_xvae, t1_xvae, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iixy,JixZ,Yy->IJYZ', t1_xvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/2 * einsum('Iixy,Jixy,YZ->IJYZ', t1_xvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iixy,Jixz,YzZy->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Iixy,Jiyx,YZ->IJYZ', t1_xvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Iixy,Jiyz,YzZx->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Iixy,Jiyz,YzxZ->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Iixy,JizZ,Yzxy->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Iixy,JizZ,Yzyx->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/8 * einsum('Iixy,Jizw,YzwZxy->IJYZ', t1_xvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/24 * einsum('Iixy,Jizw,YzwZyx->IJYZ', t1_xvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/24 * einsum('Iixy,Jizw,YzwxZy->IJYZ', t1_xvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/24 * einsum('Iixy,Jizw,YzwxyZ->IJYZ', t1_xvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/24 * einsum('Iixy,Jizw,YzwyZx->IJYZ', t1_xvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/24 * einsum('Iixy,Jizw,YzwyxZ->IJYZ', t1_xvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Iixy,Jizx,YzZy->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Iixy,Jizx,YzyZ->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/3 * einsum('Iixy,Jizy,YzZx->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Iixy,Jizy,YzxZ->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ix,Jx,YZ->IJYZ', t1_xa, t1_xa, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ix,JyxZ,Yy->IJYZ', t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ix,Jyxz,YzZy->IJYZ', t1_xa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Ix,Jyzx,YzZy->IJYZ', t1_xa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ix,Jyzx,YzyZ->IJYZ', t1_xa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixab,Jyab,YxZy->IJYZ', t1_xaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Ixab,Jyba,YxZy->IJYZ', t1_xaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixab,Jyba,YxyZ->IJYZ', t1_xaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixay,Ja,YxZy->IJYZ', t1_xaea, t1_xe, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixay,JzaZ,Yxzy->IJYZ', t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixay,Jzaw,YxwZyz->IJYZ', t1_xaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixay,Jzay,YxZz->IJYZ', t1_xaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Ixay,Jzwa,YxwZyz->IJYZ', t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixay,Jzwa,YxwzyZ->IJYZ', t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Ixay,Jzya,YxZz->IJYZ', t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixay,Jzya,YxzZ->IJYZ', t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Ixya,Ja,YxZy->IJYZ', t1_xaae, t1_xe, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixya,Ja,YxyZ->IJYZ', t1_xaae, t1_xe, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixya,JzaZ,Yxyz->IJYZ', t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Ixya,JzaZ,Yxzy->IJYZ', t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Ixya,Jzaw,YxwZyz->IJYZ', t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixya,Jzaw,YxwyZz->IJYZ', t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Ixya,Jzay,YxZz->IJYZ', t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixya,Jzay,YxzZ->IJYZ', t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixya,Jzwa,YxwZyz->IJYZ', t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixya,Jzwa,YxwZzy->IJYZ', t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixya,Jzwa,YxwyZz->IJYZ', t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixya,Jzwa,YxwzZy->IJYZ', t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixya,Jzwa,YxwzyZ->IJYZ', t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixya,Jzya,YxZz->IJYZ', t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Ixyz,Jwuy,YxuZzw->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,Jwuy,YxuwzZ->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,Jwuz,YxuZwy->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixyz,Jwuz,YxuZyw->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixyz,Jwuz,YxuwZy->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixyz,Jwuz,YxuwyZ->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixyz,Jwuz,YxuyZw->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixyz,JwyZ,Yxwz->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixyz,Jwyu,YxuZzw->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixyz,Jwyz,YxZw->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Ixyz,JwzZ,Yxwy->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,JwzZ,Yxyw->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Ixyz,Jwzu,YxuZyw->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,Jwzu,YxuyZw->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Ixyz,Jwzy,YxZw->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,Jwzy,YxwZ->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixyz,JxwZ,Ywyz->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Ixyz,JxwZ,Ywzy->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/8 * einsum('Ixyz,Jxwu,YwuZyz->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/24 * einsum('Ixyz,Jxwu,YwuZzy->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/24 * einsum('Ixyz,Jxwu,YwuyZz->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/24 * einsum('Ixyz,Jxwu,YwuyzZ->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/24 * einsum('Ixyz,Jxwu,YwuzZy->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/24 * einsum('Ixyz,Jxwu,YwuzyZ->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixyz,Jy,YxZz->IJYZ', t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Ixyz,Jz,YxZy->IJYZ', t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,Jz,YxyZ->IJYZ', t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Jiax,iIax,YZ->IJYZ', t1_xxea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Jiax,iIay,YxZy->IJYZ', t1_xxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Jiax,iIay,YxyZ->IJYZ', t1_xxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/2 * einsum('iIax,iJax,YZ->IJYZ', t1_xxea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/3 * einsum('iIax,iJay,YyZx->IJYZ', t1_xxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('iIax,iJay,YyxZ->IJYZ', t1_xxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T[:ncvs, s_caa__abb:f_caa__abb] += T_c_caa.reshape(ncvs, -1)

        T_c_caa  = 1/4 * einsum('IZab,Jxba,Yx->IJYZ', t1_xaee, t1_xaee, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('IZax,Jyxa,Yy->IJYZ', t1_xaea, t1_xaae, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('IZax,Jyza,Yzxy->IJYZ', t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('IZax,Jyza,Yzyx->IJYZ', t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('IZxa,Ja,Yx->IJYZ', t1_xaae, t1_xe, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('IZxa,Jyax,Yy->IJYZ', t1_xaae, t1_xaea, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('IZxa,Jyaz,Yzxy->IJYZ', t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('IZxa,Jyza,Yzxy->IJYZ', t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('IZxa,Jyza,Yzyx->IJYZ', t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('IZxy,Jy,Yx->IJYZ', t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('IZxy,Jzwx,Ywyz->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('IZxy,Jzwx,Ywzy->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('IZxy,Jzwy,Ywxz->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('IZxy,Jzwy,Ywzx->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('IZxy,Jzyw,Ywxz->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('IZxy,Jzyx,Yz->IJYZ', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Ia,JxZa,Yx->IJYZ', t1_xe, t1_xaae, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ia,Jxya,YyZx->IJYZ', t1_xe, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Ia,Jxya,YyxZ->IJYZ', t1_xe, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Iiax,iJaZ,Yx->IJYZ', t1_xxea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Iiax,iJay,YyZx->IJYZ', t1_xxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Iiax,iJay,YyxZ->IJYZ', t1_xxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Iixy,JiZx,Yy->IJYZ', t1_xxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/2 * einsum('Iixy,JiZy,Yx->IJYZ', t1_xxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Iixy,JiZz,Yzxy->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Iixy,JiyZ,Yx->IJYZ', t1_xxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Iixy,Jiyz,YzZx->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Iixy,Jiyz,YzxZ->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Iixy,JizZ,Yzxy->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Iixy,JizZ,Yzyx->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/24 * einsum('Iixy,Jizw,YzwZxy->IJYZ', t1_xxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/24 * einsum('Iixy,Jizw,YzwZyx->IJYZ', t1_xxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/8 * einsum('Iixy,Jizw,YzwxZy->IJYZ', t1_xxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/24 * einsum('Iixy,Jizw,YzwxyZ->IJYZ', t1_xxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/24 * einsum('Iixy,Jizw,YzwyZx->IJYZ', t1_xxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/24 * einsum('Iixy,Jizw,YzwyxZ->IJYZ', t1_xxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Iixy,Jizx,YzZy->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Iixy,Jizx,YzyZ->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Iixy,Jizy,YzZx->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/3 * einsum('Iixy,Jizy,YzxZ->IJYZ', t1_xxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Iiax,JiZa,Yx->IJYZ', t1_xvea, t1_xvae, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Iiax,Jiya,YyZx->IJYZ', t1_xvea, t1_xvae, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Iiax,Jiya,YyxZ->IJYZ', t1_xvea, t1_xvae, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 3/8 * einsum('Iixa,JiZa,Yx->IJYZ', t1_xvae, t1_xvae, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/8 * einsum('Iixa,JiaZ,Yx->IJYZ', t1_xvae, t1_xvea, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/24 * einsum('Iixa,Jiay,YyZx->IJYZ', t1_xvae, t1_xvea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Iixa,Jiay,YyxZ->IJYZ', t1_xvae, t1_xvea, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/8 * einsum('Iixa,Jiya,YyZx->IJYZ', t1_xvae, t1_xvae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Iixa,Jiya,YyxZ->IJYZ', t1_xvae, t1_xvae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Iixy,JiZx,Yy->IJYZ', t1_xvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/2 * einsum('Iixy,JiZy,Yx->IJYZ', t1_xvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Iixy,JiZz,Yzxy->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Iixy,JiyZ,Yx->IJYZ', t1_xvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Iixy,Jiyz,YzZx->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Iixy,Jiyz,YzxZ->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Iixy,JizZ,Yzxy->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Iixy,JizZ,Yzyx->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/24 * einsum('Iixy,Jizw,YzwZxy->IJYZ', t1_xvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/24 * einsum('Iixy,Jizw,YzwZyx->IJYZ', t1_xvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/8 * einsum('Iixy,Jizw,YzwxZy->IJYZ', t1_xvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/24 * einsum('Iixy,Jizw,YzwxyZ->IJYZ', t1_xvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/24 * einsum('Iixy,Jizw,YzwyZx->IJYZ', t1_xvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/24 * einsum('Iixy,Jizw,YzwyxZ->IJYZ', t1_xvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Iixy,Jizx,YzZy->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Iixy,Jizx,YzyZ->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Iixy,Jizy,YzZx->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/3 * einsum('Iixy,Jizy,YzxZ->IJYZ', t1_xvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Ix,JyZx,Yy->IJYZ', t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ix,Jyzx,YzZy->IJYZ', t1_xa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Ix,Jyzx,YzyZ->IJYZ', t1_xa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixab,Jyba,YxZy->IJYZ', t1_xaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Ixab,Jyba,YxyZ->IJYZ', t1_xaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Ixay,JzZa,Yxzy->IJYZ', t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixay,Jzwa,YxwZzy->IJYZ', t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixay,Jzwa,YxwyZz->IJYZ', t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixay,Jzwa,YxwyzZ->IJYZ', t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixay,Jzwa,YxwzZy->IJYZ', t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixay,Jzwa,YxwzyZ->IJYZ', t1_xaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixay,Jzya,YxZz->IJYZ', t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Ixay,Jzya,YxzZ->IJYZ', t1_xaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixya,Ja,YxZy->IJYZ', t1_xaae, t1_xe, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Ixya,Ja,YxyZ->IJYZ', t1_xaae, t1_xe, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Ixya,JzZa,Yxyz->IJYZ', t1_xaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Ixya,JzaZ,Yxyz->IJYZ', t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixya,JzaZ,Yxzy->IJYZ', t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixya,Jzaw,YxwZzy->IJYZ', t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixya,Jzaw,YxwyZz->IJYZ', t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixya,Jzaw,YxwyzZ->IJYZ', t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixya,Jzaw,YxwzZy->IJYZ', t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixya,Jzaw,YxwzyZ->IJYZ', t1_xaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixya,Jzay,YxZz->IJYZ', t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Ixya,Jzay,YxzZ->IJYZ', t1_xaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixya,Jzwa,YxwZzy->IJYZ', t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Ixya,Jzwa,YxwyzZ->IJYZ', t1_xaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Ixyz,JwZy,Yxwz->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/4 * einsum('Ixyz,JwZz,Yxyw->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,Jwuy,YxuZwz->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,Jwuy,YxuwZz->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixyz,Jwuy,YxuwzZ->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,Jwuy,YxuzZw->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,Jwuy,YxuzwZ->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixyz,Jwuz,YxuZwy->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Ixyz,Jwuz,YxuywZ->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixyz,JwzZ,Yxwy->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Ixyz,JwzZ,Yxyw->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,Jwzu,YxuZwy->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,Jwzu,YxuwZy->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,Jwzu,YxuwyZ->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixyz,Jwzu,YxuyZw->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,Jwzu,YxuywZ->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixyz,Jwzy,YxZw->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Ixyz,Jwzy,YxwZ->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('Ixyz,JxZw,Ywyz->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Ixyz,JxwZ,Ywyz->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Ixyz,JxwZ,Ywzy->IJYZ', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/24 * einsum('Ixyz,Jxwu,YwuZyz->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/24 * einsum('Ixyz,Jxwu,YwuZzy->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa += 1/8 * einsum('Ixyz,Jxwu,YwuyZz->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/24 * einsum('Ixyz,Jxwu,YwuyzZ->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/24 * einsum('Ixyz,Jxwu,YwuzZy->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/24 * einsum('Ixyz,Jxwu,YwuzyZ->IJYZ', t1_xaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_c_caa -= 1/12 * einsum('Ixyz,Jz,YxZy->IJYZ', t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('Ixyz,Jz,YxyZ->IJYZ', t1_xaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/4 * einsum('JiaZ,iIax,Yx->IJYZ', t1_xxea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_caa += 1/12 * einsum('Jiax,iIay,YxZy->IJYZ', t1_xxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/6 * einsum('Jiax,iIay,YxyZ->IJYZ', t1_xxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_caa += 1/2 * einsum('iIax,iJaZ,Yx->IJYZ', t1_xxea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_caa -= 1/6 * einsum('iIax,iJay,YyZx->IJYZ', t1_xxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_caa -= 1/3 * einsum('iIax,iJay,YyxZ->IJYZ', t1_xxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T[:ncvs, s_caa__bab:f_caa__bab] += T_c_caa.reshape(ncvs, -1)

        # VALENCE(2) - CAA
        if nval > 0:
            T_v_caa =- 1/4 * einsum('IZab,Jxab,Yx->IJYZ', t1_vaee, t1_xaee, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('IZab,Jxba,Yx->IJYZ', t1_vaee, t1_xaee, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('IZax,Ja,Yx->IJYZ', t1_vaea, t1_xe, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('IZax,Jyax,Yy->IJYZ', t1_vaea, t1_xaea, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('IZax,Jyaz,Yzxy->IJYZ', t1_vaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('IZax,Jyxa,Yy->IJYZ', t1_vaea, t1_xaae, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('IZax,Jyza,Yzxy->IJYZ', t1_vaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('IZax,Jyza,Yzyx->IJYZ', t1_vaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('IZxa,Ja,Yx->IJYZ', t1_vaae, t1_xe, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('IZxa,Jyax,Yy->IJYZ', t1_vaae, t1_xaea, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('IZxa,Jyaz,Yzxy->IJYZ', t1_vaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('IZxa,Jyxa,Yy->IJYZ', t1_vaae, t1_xaae, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('IZxa,Jyza,Yzxy->IJYZ', t1_vaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('IZxa,Jyza,Yzyx->IJYZ', t1_vaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('IZxy,Jx,Yy->IJYZ', t1_vaaa, t1_xa, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('IZxy,Jy,Yx->IJYZ', t1_vaaa, t1_xa, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('IZxy,Jzwx,Ywyz->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('IZxy,Jzwx,Ywzy->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('IZxy,Jzwy,Ywxz->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('IZxy,Jzwy,Ywzx->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('IZxy,Jzxw,Ywyz->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('IZxy,Jzxy,Yz->IJYZ', t1_vaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('IZxy,Jzyw,Ywxz->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('IZxy,Jzyx,Yz->IJYZ', t1_vaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ia,Ja,YZ->IJYZ', t1_ve, t1_xe, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Ia,JxZa,Yx->IJYZ', t1_ve, t1_xaae, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ia,JxaZ,Yx->IJYZ', t1_ve, t1_xaea, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ia,Jxay,YyZx->IJYZ', t1_ve, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ia,Jxya,YyZx->IJYZ', t1_ve, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ia,Jxya,YyxZ->IJYZ', t1_ve, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/2 * einsum('Iiab,Jiab,YZ->IJYZ', t1_vxee, t1_xxee, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iiab,Jiba,YZ->IJYZ', t1_vxee, t1_xxee, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iiax,JiaZ,Yx->IJYZ', t1_vxea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/2 * einsum('Iiax,Jiax,YZ->IJYZ', t1_vxea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iiax,Jiay,YyZx->IJYZ', t1_vxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Iiax,iJaZ,Yx->IJYZ', t1_vxea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iiax,iJax,YZ->IJYZ', t1_vxea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Iiax,iJay,YyZx->IJYZ', t1_vxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Iiax,iJay,YyxZ->IJYZ', t1_vxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Iixa,JiaZ,Yx->IJYZ', t1_vxae, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iixa,Jiax,YZ->IJYZ', t1_vxae, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Iixa,Jiay,YyZx->IJYZ', t1_vxae, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Iixa,Jiay,YyxZ->IJYZ', t1_vxae, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/2 * einsum('Iixa,iJaZ,Yx->IJYZ', t1_vxae, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/2 * einsum('Iixa,iJax,YZ->IJYZ', t1_vxae, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Iixa,iJay,YyZx->IJYZ', t1_vxae, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Iixa,iJay,YyxZ->IJYZ', t1_vxae, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Iixy,JiZx,Yy->IJYZ', t1_vxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/2 * einsum('Iixy,JiZy,Yx->IJYZ', t1_vxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Iixy,JiZz,Yzxy->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iixy,JixZ,Yy->IJYZ', t1_vxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/2 * einsum('Iixy,Jixy,YZ->IJYZ', t1_vxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iixy,Jixz,YzZy->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Iixy,JiyZ,Yx->IJYZ', t1_vxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iixy,Jiyx,YZ->IJYZ', t1_vxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Iixy,Jiyz,YzZx->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Iixy,Jiyz,YzxZ->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Iixy,JizZ,Yzxy->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Iixy,JizZ,Yzyx->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Iixy,Jizw,YzwZxy->IJYZ', t1_vxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Iixy,Jizw,YzwxZy->IJYZ', t1_vxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Iixy,Jizx,YzZy->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Iixy,Jizx,YzyZ->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Iixy,Jizy,YzZx->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Iixy,Jizy,YzxZ->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/2 * einsum('Iiab,Jiab,YZ->IJYZ', t1_vvee, t1_xvee, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iiab,Jiba,YZ->IJYZ', t1_vvee, t1_xvee, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Iiax,JiZa,Yx->IJYZ', t1_vvea, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iiax,JiaZ,Yx->IJYZ', t1_vvea, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/2 * einsum('Iiax,Jiax,YZ->IJYZ', t1_vvea, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iiax,Jiay,YyZx->IJYZ', t1_vvea, t1_xvea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iiax,Jixa,YZ->IJYZ', t1_vvea, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Iiax,Jiya,YyZx->IJYZ', t1_vvea, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Iiax,Jiya,YyxZ->IJYZ', t1_vvea, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Iixy,JiZx,Yy->IJYZ', t1_vvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/2 * einsum('Iixy,JiZy,Yx->IJYZ', t1_vvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Iixy,JiZz,Yzxy->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iixy,JixZ,Yy->IJYZ', t1_vvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/2 * einsum('Iixy,Jixy,YZ->IJYZ', t1_vvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iixy,Jixz,YzZy->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Iixy,JiyZ,Yx->IJYZ', t1_vvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iixy,Jiyx,YZ->IJYZ', t1_vvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Iixy,Jiyz,YzZx->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Iixy,Jiyz,YzxZ->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Iixy,JizZ,Yzxy->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Iixy,JizZ,Yzyx->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Iixy,Jizw,YzwZxy->IJYZ', t1_vvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Iixy,Jizw,YzwxZy->IJYZ', t1_vvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Iixy,Jizx,YzZy->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Iixy,Jizx,YzyZ->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Iixy,Jizy,YzZx->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Iixy,Jizy,YzxZ->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ix,Jx,YZ->IJYZ', t1_va, t1_xa, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Ix,JyZx,Yy->IJYZ', t1_va, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ix,JyxZ,Yy->IJYZ', t1_va, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ix,Jyxz,YzZy->IJYZ', t1_va, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ix,Jyzx,YzZy->IJYZ', t1_va, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ix,Jyzx,YzyZ->IJYZ', t1_va, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixab,Jyab,YxZy->IJYZ', t1_vaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixab,Jyba,YxZy->IJYZ', t1_vaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixab,Jyba,YxyZ->IJYZ', t1_vaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixay,Ja,YxZy->IJYZ', t1_vaea, t1_xe, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Ixay,JzZa,Yxzy->IJYZ', t1_vaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixay,JzaZ,Yxzy->IJYZ', t1_vaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixay,Jzaw,YxwZyz->IJYZ', t1_vaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixay,Jzay,YxZz->IJYZ', t1_vaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixay,Jzwa,YxwZyz->IJYZ', t1_vaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixay,Jzwa,YxwzyZ->IJYZ', t1_vaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixay,Jzya,YxZz->IJYZ', t1_vaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixay,Jzya,YxzZ->IJYZ', t1_vaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixya,Ja,YxZy->IJYZ', t1_vaae, t1_xe, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixya,Ja,YxyZ->IJYZ', t1_vaae, t1_xe, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Ixya,JzZa,Yxyz->IJYZ', t1_vaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixya,JzaZ,Yxyz->IJYZ', t1_vaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixya,JzaZ,Yxzy->IJYZ', t1_vaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixya,Jzaw,YxwZyz->IJYZ', t1_vaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixya,Jzaw,YxwyZz->IJYZ', t1_vaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixya,Jzay,YxZz->IJYZ', t1_vaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixya,Jzay,YxzZ->IJYZ', t1_vaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixya,Jzwa,YxwZzy->IJYZ', t1_vaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixya,Jzwa,YxwyzZ->IJYZ', t1_vaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixya,Jzya,YxZz->IJYZ', t1_vaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Ixyz,JwZy,Yxwz->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Ixyz,JwZz,Yxyw->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,Jwuy,YxuZzw->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixyz,Jwuy,YxuwzZ->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,Jwuz,YxuZwy->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixyz,Jwuz,YxuywZ->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixyz,JwyZ,Yxwz->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixyz,Jwyu,YxuZzw->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixyz,Jwyz,YxZw->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,JwzZ,Yxwy->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixyz,JwzZ,Yxyw->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,Jwzu,YxuZyw->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixyz,Jwzu,YxuyZw->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,Jwzy,YxZw->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixyz,Jwzy,YxwZ->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixyz,JxZw,Ywyz->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,JxwZ,Ywyz->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixyz,JxwZ,Ywzy->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixyz,Jxwu,YwuZyz->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,Jxwu,YwuyZz->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixyz,Jy,YxZz->IJYZ', t1_vaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,Jz,YxZy->IJYZ', t1_vaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixyz,Jz,YxyZ->IJYZ', t1_vaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/2 * einsum('JiZa,iIax,Yx->IJYZ', t1_xvae, t1_vvea, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('JiaZ,iIax,Yx->IJYZ', t1_xvea, t1_vvea, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Jiax,iIax,YZ->IJYZ', t1_xvea, t1_vvea, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Jiax,iIay,YxZy->IJYZ', t1_xvea, t1_vvea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Jiax,iIay,YxyZ->IJYZ', t1_xvea, t1_vvea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/2 * einsum('Jixa,iIax,YZ->IJYZ', t1_xvae, t1_vvea, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Jixa,iIay,YxZy->IJYZ', t1_xvae, t1_vvea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Jixa,iIay,YxyZ->IJYZ', t1_xvae, t1_vvea, rdm_ccaa, optimize = einsum_type)
            T[ncvs:ncore, s_caa__aaa:f_caa__aaa] += T_v_caa.reshape(nval, -1)

            T_v_caa =- 1/4 * einsum('IZab,Jxab,Yx->IJYZ', t1_vaee, t1_xaee, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('IZax,Ja,Yx->IJYZ', t1_vaea, t1_xe, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('IZax,Jyax,Yy->IJYZ', t1_vaea, t1_xaea, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('IZax,Jyaz,Yzxy->IJYZ', t1_vaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('IZax,Jyza,Yzxy->IJYZ', t1_vaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('IZax,Jyza,Yzyx->IJYZ', t1_vaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('IZxa,Jyxa,Yy->IJYZ', t1_vaae, t1_xaae, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('IZxa,Jyza,Yzxy->IJYZ', t1_vaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('IZxa,Jyza,Yzyx->IJYZ', t1_vaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('IZxy,Jx,Yy->IJYZ', t1_vaaa, t1_xa, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('IZxy,Jzwx,Ywyz->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('IZxy,Jzwx,Ywzy->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('IZxy,Jzwy,Ywxz->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('IZxy,Jzwy,Ywzx->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('IZxy,Jzxw,Ywyz->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('IZxy,Jzxy,Yz->IJYZ', t1_vaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ia,Ja,YZ->IJYZ', t1_ve, t1_xe, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ia,JxaZ,Yx->IJYZ', t1_ve, t1_xaea, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ia,Jxay,YyZx->IJYZ', t1_ve, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Ia,Jxya,YyZx->IJYZ', t1_ve, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ia,Jxya,YyxZ->IJYZ', t1_ve, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/2 * einsum('Iiab,Jiab,YZ->IJYZ', t1_vxee, t1_xxee, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iiab,Jiba,YZ->IJYZ', t1_vxee, t1_xxee, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iiax,JiaZ,Yx->IJYZ', t1_vxea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/2 * einsum('Iiax,Jiax,YZ->IJYZ', t1_vxea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iiax,Jiay,YyZx->IJYZ', t1_vxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iiax,iJax,YZ->IJYZ', t1_vxea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Iiax,iJay,YyZx->IJYZ', t1_vxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Iiax,iJay,YyxZ->IJYZ', t1_vxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iixa,Jiax,YZ->IJYZ', t1_vxae, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Iixa,Jiay,YyZx->IJYZ', t1_vxae, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Iixa,Jiay,YyxZ->IJYZ', t1_vxae, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/2 * einsum('Iixa,iJax,YZ->IJYZ', t1_vxae, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/3 * einsum('Iixa,iJay,YyZx->IJYZ', t1_vxae, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Iixa,iJay,YyxZ->IJYZ', t1_vxae, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iixy,JixZ,Yy->IJYZ', t1_vxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/2 * einsum('Iixy,Jixy,YZ->IJYZ', t1_vxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iixy,Jixz,YzZy->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iixy,Jiyx,YZ->IJYZ', t1_vxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Iixy,Jiyz,YzZx->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Iixy,Jiyz,YzxZ->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Iixy,JizZ,Yzxy->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Iixy,JizZ,Yzyx->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/8 * einsum('Iixy,Jizw,YzwZxy->IJYZ', t1_vxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/24 * einsum('Iixy,Jizw,YzwZyx->IJYZ', t1_vxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/24 * einsum('Iixy,Jizw,YzwxZy->IJYZ', t1_vxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/24 * einsum('Iixy,Jizw,YzwxyZ->IJYZ', t1_vxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/24 * einsum('Iixy,Jizw,YzwyZx->IJYZ', t1_vxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/24 * einsum('Iixy,Jizw,YzwyxZ->IJYZ', t1_vxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Iixy,Jizx,YzZy->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Iixy,Jizx,YzyZ->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/3 * einsum('Iixy,Jizy,YzZx->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Iixy,Jizy,YzxZ->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/2 * einsum('Iiab,Jiab,YZ->IJYZ', t1_vvee, t1_xvee, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iiab,Jiba,YZ->IJYZ', t1_vvee, t1_xvee, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iiax,JiaZ,Yx->IJYZ', t1_vvea, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/2 * einsum('Iiax,Jiax,YZ->IJYZ', t1_vvea, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iiax,Jiay,YyZx->IJYZ', t1_vvea, t1_xvea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iiax,Jixa,YZ->IJYZ', t1_vvea, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Iiax,Jiya,YyZx->IJYZ', t1_vvea, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Iiax,Jiya,YyxZ->IJYZ', t1_vvea, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iixy,JixZ,Yy->IJYZ', t1_vvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/2 * einsum('Iixy,Jixy,YZ->IJYZ', t1_vvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iixy,Jixz,YzZy->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Iixy,Jiyx,YZ->IJYZ', t1_vvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Iixy,Jiyz,YzZx->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Iixy,Jiyz,YzxZ->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Iixy,JizZ,Yzxy->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Iixy,JizZ,Yzyx->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/8 * einsum('Iixy,Jizw,YzwZxy->IJYZ', t1_vvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/24 * einsum('Iixy,Jizw,YzwZyx->IJYZ', t1_vvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/24 * einsum('Iixy,Jizw,YzwxZy->IJYZ', t1_vvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/24 * einsum('Iixy,Jizw,YzwxyZ->IJYZ', t1_vvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/24 * einsum('Iixy,Jizw,YzwyZx->IJYZ', t1_vvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/24 * einsum('Iixy,Jizw,YzwyxZ->IJYZ', t1_vvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Iixy,Jizx,YzZy->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Iixy,Jizx,YzyZ->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/3 * einsum('Iixy,Jizy,YzZx->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Iixy,Jizy,YzxZ->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ix,Jx,YZ->IJYZ', t1_va, t1_xa, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ix,JyxZ,Yy->IJYZ', t1_va, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ix,Jyxz,YzZy->IJYZ', t1_va, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Ix,Jyzx,YzZy->IJYZ', t1_va, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ix,Jyzx,YzyZ->IJYZ', t1_va, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixab,Jyab,YxZy->IJYZ', t1_vaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Ixab,Jyba,YxZy->IJYZ', t1_vaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixab,Jyba,YxyZ->IJYZ', t1_vaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixay,Ja,YxZy->IJYZ', t1_vaea, t1_xe, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixay,JzaZ,Yxzy->IJYZ', t1_vaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixay,Jzaw,YxwZyz->IJYZ', t1_vaea, t1_xaea, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixay,Jzay,YxZz->IJYZ', t1_vaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Ixay,Jzwa,YxwZyz->IJYZ', t1_vaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixay,Jzwa,YxwzyZ->IJYZ', t1_vaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Ixay,Jzya,YxZz->IJYZ', t1_vaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixay,Jzya,YxzZ->IJYZ', t1_vaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Ixya,Ja,YxZy->IJYZ', t1_vaae, t1_xe, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixya,Ja,YxyZ->IJYZ', t1_vaae, t1_xe, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixya,JzaZ,Yxyz->IJYZ', t1_vaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Ixya,JzaZ,Yxzy->IJYZ', t1_vaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Ixya,Jzaw,YxwZyz->IJYZ', t1_vaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixya,Jzaw,YxwyZz->IJYZ', t1_vaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Ixya,Jzay,YxZz->IJYZ', t1_vaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixya,Jzay,YxzZ->IJYZ', t1_vaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixya,Jzwa,YxwZyz->IJYZ', t1_vaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixya,Jzwa,YxwZzy->IJYZ', t1_vaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixya,Jzwa,YxwyZz->IJYZ', t1_vaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixya,Jzwa,YxwzZy->IJYZ', t1_vaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixya,Jzwa,YxwzyZ->IJYZ', t1_vaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixya,Jzya,YxZz->IJYZ', t1_vaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Ixyz,Jwuy,YxuZzw->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,Jwuy,YxuwzZ->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,Jwuz,YxuZwy->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixyz,Jwuz,YxuZyw->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixyz,Jwuz,YxuwZy->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixyz,Jwuz,YxuwyZ->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixyz,Jwuz,YxuyZw->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixyz,JwyZ,Yxwz->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixyz,Jwyu,YxuZzw->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixyz,Jwyz,YxZw->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Ixyz,JwzZ,Yxwy->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,JwzZ,Yxyw->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Ixyz,Jwzu,YxuZyw->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,Jwzu,YxuyZw->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Ixyz,Jwzy,YxZw->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,Jwzy,YxwZ->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixyz,JxwZ,Ywyz->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Ixyz,JxwZ,Ywzy->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/8 * einsum('Ixyz,Jxwu,YwuZyz->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/24 * einsum('Ixyz,Jxwu,YwuZzy->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/24 * einsum('Ixyz,Jxwu,YwuyZz->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/24 * einsum('Ixyz,Jxwu,YwuyzZ->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/24 * einsum('Ixyz,Jxwu,YwuzZy->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/24 * einsum('Ixyz,Jxwu,YwuzyZ->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixyz,Jy,YxZz->IJYZ', t1_vaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Ixyz,Jz,YxZy->IJYZ', t1_vaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,Jz,YxyZ->IJYZ', t1_vaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Jiax,iIax,YZ->IJYZ', t1_xvea, t1_vvea, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Jiax,iIay,YxZy->IJYZ', t1_xvea, t1_vvea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Jiax,iIay,YxyZ->IJYZ', t1_xvea, t1_vvea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/2 * einsum('Jixa,iIax,YZ->IJYZ', t1_xvae, t1_vvea, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/3 * einsum('Jixa,iIay,YxZy->IJYZ', t1_xvae, t1_vvea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Jixa,iIay,YxyZ->IJYZ', t1_xvae, t1_vvea, rdm_ccaa, optimize = einsum_type)
            T[ncvs:ncore, s_caa__abb:f_caa__abb] += T_v_caa.reshape(nval, -1)

            T_v_caa  = 1/4 * einsum('IZab,Jxba,Yx->IJYZ', t1_vaee, t1_xaee, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('IZax,Jyxa,Yy->IJYZ', t1_vaea, t1_xaae, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('IZax,Jyza,Yzxy->IJYZ', t1_vaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('IZax,Jyza,Yzyx->IJYZ', t1_vaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('IZxa,Ja,Yx->IJYZ', t1_vaae, t1_xe, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('IZxa,Jyax,Yy->IJYZ', t1_vaae, t1_xaea, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('IZxa,Jyaz,Yzxy->IJYZ', t1_vaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('IZxa,Jyza,Yzxy->IJYZ', t1_vaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('IZxa,Jyza,Yzyx->IJYZ', t1_vaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('IZxy,Jy,Yx->IJYZ', t1_vaaa, t1_xa, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('IZxy,Jzwx,Ywyz->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('IZxy,Jzwx,Ywzy->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('IZxy,Jzwy,Ywxz->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('IZxy,Jzwy,Ywzx->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('IZxy,Jzyw,Ywxz->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('IZxy,Jzyx,Yz->IJYZ', t1_vaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Ia,JxZa,Yx->IJYZ', t1_ve, t1_xaae, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ia,Jxya,YyZx->IJYZ', t1_ve, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Ia,Jxya,YyxZ->IJYZ', t1_ve, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Iiax,iJaZ,Yx->IJYZ', t1_vxea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Iiax,iJay,YyZx->IJYZ', t1_vxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Iiax,iJay,YyxZ->IJYZ', t1_vxea, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Iixa,JiaZ,Yx->IJYZ', t1_vxae, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Iixa,Jiay,YyZx->IJYZ', t1_vxae, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Iixa,Jiay,YyxZ->IJYZ', t1_vxae, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/2 * einsum('Iixa,iJaZ,Yx->IJYZ', t1_vxae, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Iixa,iJay,YyZx->IJYZ', t1_vxae, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/3 * einsum('Iixa,iJay,YyxZ->IJYZ', t1_vxae, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Iixy,JiZx,Yy->IJYZ', t1_vxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/2 * einsum('Iixy,JiZy,Yx->IJYZ', t1_vxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Iixy,JiZz,Yzxy->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Iixy,JiyZ,Yx->IJYZ', t1_vxaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Iixy,Jiyz,YzZx->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Iixy,Jiyz,YzxZ->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Iixy,JizZ,Yzxy->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Iixy,JizZ,Yzyx->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/24 * einsum('Iixy,Jizw,YzwZxy->IJYZ', t1_vxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/24 * einsum('Iixy,Jizw,YzwZyx->IJYZ', t1_vxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/8 * einsum('Iixy,Jizw,YzwxZy->IJYZ', t1_vxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/24 * einsum('Iixy,Jizw,YzwxyZ->IJYZ', t1_vxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/24 * einsum('Iixy,Jizw,YzwyZx->IJYZ', t1_vxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/24 * einsum('Iixy,Jizw,YzwyxZ->IJYZ', t1_vxaa, t1_xxaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Iixy,Jizx,YzZy->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Iixy,Jizx,YzyZ->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Iixy,Jizy,YzZx->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/3 * einsum('Iixy,Jizy,YzxZ->IJYZ', t1_vxaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Iiax,JiZa,Yx->IJYZ', t1_vvea, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Iiax,Jiya,YyZx->IJYZ', t1_vvea, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Iiax,Jiya,YyxZ->IJYZ', t1_vvea, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Iixy,JiZx,Yy->IJYZ', t1_vvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/2 * einsum('Iixy,JiZy,Yx->IJYZ', t1_vvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Iixy,JiZz,Yzxy->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Iixy,JiyZ,Yx->IJYZ', t1_vvaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Iixy,Jiyz,YzZx->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Iixy,Jiyz,YzxZ->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Iixy,JizZ,Yzxy->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Iixy,JizZ,Yzyx->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/24 * einsum('Iixy,Jizw,YzwZxy->IJYZ', t1_vvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/24 * einsum('Iixy,Jizw,YzwZyx->IJYZ', t1_vvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/8 * einsum('Iixy,Jizw,YzwxZy->IJYZ', t1_vvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/24 * einsum('Iixy,Jizw,YzwxyZ->IJYZ', t1_vvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/24 * einsum('Iixy,Jizw,YzwyZx->IJYZ', t1_vvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/24 * einsum('Iixy,Jizw,YzwyxZ->IJYZ', t1_vvaa, t1_xvaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Iixy,Jizx,YzZy->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Iixy,Jizx,YzyZ->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Iixy,Jizy,YzZx->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/3 * einsum('Iixy,Jizy,YzxZ->IJYZ', t1_vvaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Ix,JyZx,Yy->IJYZ', t1_va, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ix,Jyzx,YzZy->IJYZ', t1_va, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Ix,Jyzx,YzyZ->IJYZ', t1_va, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixab,Jyba,YxZy->IJYZ', t1_vaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Ixab,Jyba,YxyZ->IJYZ', t1_vaee, t1_xaee, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Ixay,JzZa,Yxzy->IJYZ', t1_vaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixay,Jzwa,YxwZzy->IJYZ', t1_vaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixay,Jzwa,YxwyZz->IJYZ', t1_vaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixay,Jzwa,YxwyzZ->IJYZ', t1_vaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixay,Jzwa,YxwzZy->IJYZ', t1_vaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixay,Jzwa,YxwzyZ->IJYZ', t1_vaea, t1_xaae, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixay,Jzya,YxZz->IJYZ', t1_vaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Ixay,Jzya,YxzZ->IJYZ', t1_vaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixya,Ja,YxZy->IJYZ', t1_vaae, t1_xe, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Ixya,Ja,YxyZ->IJYZ', t1_vaae, t1_xe, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Ixya,JzZa,Yxyz->IJYZ', t1_vaae, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Ixya,JzaZ,Yxyz->IJYZ', t1_vaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixya,JzaZ,Yxzy->IJYZ', t1_vaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixya,Jzaw,YxwZzy->IJYZ', t1_vaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixya,Jzaw,YxwyZz->IJYZ', t1_vaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixya,Jzaw,YxwyzZ->IJYZ', t1_vaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixya,Jzaw,YxwzZy->IJYZ', t1_vaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixya,Jzaw,YxwzyZ->IJYZ', t1_vaae, t1_xaea, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixya,Jzay,YxZz->IJYZ', t1_vaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Ixya,Jzay,YxzZ->IJYZ', t1_vaae, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixya,Jzwa,YxwZzy->IJYZ', t1_vaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Ixya,Jzwa,YxwyzZ->IJYZ', t1_vaae, t1_xaae, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Ixyz,JwZy,Yxwz->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/4 * einsum('Ixyz,JwZz,Yxyw->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,Jwuy,YxuZwz->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,Jwuy,YxuwZz->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixyz,Jwuy,YxuwzZ->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,Jwuy,YxuzZw->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,Jwuy,YxuzwZ->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixyz,Jwuz,YxuZwy->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Ixyz,Jwuz,YxuywZ->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixyz,JwzZ,Yxwy->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Ixyz,JwzZ,Yxyw->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,Jwzu,YxuZwy->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,Jwzu,YxuwZy->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,Jwzu,YxuwyZ->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixyz,Jwzu,YxuyZw->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,Jwzu,YxuywZ->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixyz,Jwzy,YxZw->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Ixyz,Jwzy,YxwZ->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Ixyz,JxZw,Ywyz->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/6 * einsum('Ixyz,JxwZ,Ywyz->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Ixyz,JxwZ,Ywzy->IJYZ', t1_vaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/24 * einsum('Ixyz,Jxwu,YwuZyz->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/24 * einsum('Ixyz,Jxwu,YwuZzy->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa += 1/8 * einsum('Ixyz,Jxwu,YwuyZz->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/24 * einsum('Ixyz,Jxwu,YwuyzZ->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/24 * einsum('Ixyz,Jxwu,YwuzZy->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/24 * einsum('Ixyz,Jxwu,YwuzyZ->IJYZ', t1_vaaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_v_caa -= 1/12 * einsum('Ixyz,Jz,YxZy->IJYZ', t1_vaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/6 * einsum('Ixyz,Jz,YxyZ->IJYZ', t1_vaaa, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 3/8 * einsum('JiZa,iIax,Yx->IJYZ', t1_xvae, t1_vvea, rdm_ca, optimize = einsum_type)
            T_v_caa -= 1/8 * einsum('JiaZ,iIax,Yx->IJYZ', t1_xvea, t1_vvea, rdm_ca, optimize = einsum_type)
            T_v_caa += 1/24 * einsum('Jiax,iIay,YxZy->IJYZ', t1_xvea, t1_vvea, rdm_ccaa, optimize = einsum_type)
            T_v_caa += 1/12 * einsum('Jiax,iIay,YxyZ->IJYZ', t1_xvea, t1_vvea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/8 * einsum('Jixa,iIay,YxZy->IJYZ', t1_xvae, t1_vvea, rdm_ccaa, optimize = einsum_type)
            T_v_caa -= 1/4 * einsum('Jixa,iIay,YxyZ->IJYZ', t1_xvae, t1_vvea, rdm_ccaa, optimize = einsum_type)
            T[ncvs:ncore, s_caa__bab:f_caa__bab] += T_v_caa.reshape(nval, -1)

        # CORE(2) - CCE
        T_c_cce  = 1/2 * einsum('JKBa,Ia->IJKB', t1_xxee, t1_xe, optimize = einsum_type)
        T_c_cce += 1/2 * einsum('JKBx,Ix->IJKB', t1_xxea, t1_xa, optimize = einsum_type)
        T_c_cce -= 1/2 * einsum('KJBa,Ia->IJKB', t1_xxee, t1_xe, optimize = einsum_type)
        T_c_cce -= 1/2 * einsum('KJBx,Ix->IJKB', t1_xxea, t1_xa, optimize = einsum_type)
        T_c_cce += 1/2 * einsum('JKBa,Ixay,xy->IJKB', t1_xxee, t1_xaea, rdm_ca, optimize = einsum_type)
        T_c_cce -= 1/4 * einsum('JKBa,Ixya,xy->IJKB', t1_xxee, t1_xaae, rdm_ca, optimize = einsum_type)
        T_c_cce += 1/2 * einsum('JKBx,Iyxz,yz->IJKB', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_c_cce -= 1/4 * einsum('JKBx,Iyzx,yz->IJKB', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_c_cce -= 1/2 * einsum('KJBa,Ixay,xy->IJKB', t1_xxee, t1_xaea, rdm_ca, optimize = einsum_type)
        T_c_cce += 1/4 * einsum('KJBa,Ixya,xy->IJKB', t1_xxee, t1_xaae, rdm_ca, optimize = einsum_type)
        T_c_cce -= 1/2 * einsum('KJBx,Iyxz,yz->IJKB', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_c_cce += 1/4 * einsum('KJBx,Iyzx,yz->IJKB', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T[:ncvs, s_cce__aaa:f_cce__aaa] += T_c_cce[:, cvs_tril_ind[0], cvs_tril_ind[1]].reshape(ncvs, -1)

        T_c_cce =- 1/2 * einsum('KJBa,Ia->IJKB', t1_xxee, t1_xe, optimize = einsum_type)
        T_c_cce -= 1/2 * einsum('KJBx,Ix->IJKB', t1_xxea, t1_xa, optimize = einsum_type)
        T_c_cce -= 1/2 * einsum('KJBa,Ixay,xy->IJKB', t1_xxee, t1_xaea, rdm_ca, optimize = einsum_type)
        T_c_cce += 1/4 * einsum('KJBa,Ixya,xy->IJKB', t1_xxee, t1_xaae, rdm_ca, optimize = einsum_type)
        T_c_cce -= 1/2 * einsum('KJBx,Iyxz,yz->IJKB', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_c_cce += 1/4 * einsum('KJBx,Iyzx,yz->IJKB', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T[:ncvs, s_cce__abb:f_cce__abb] += T_c_cce.reshape(ncvs, -1)

        # VALENCE(2) - CCE
        if nval > 0:
            T_v_cce  = 1/2 * einsum('JKBa,Ia->IJKB', t1_xxee, t1_ve, optimize = einsum_type)
            T_v_cce += 1/2 * einsum('JKBx,Ix->IJKB', t1_xxea, t1_va, optimize = einsum_type)
            T_v_cce -= 1/2 * einsum('KJBa,Ia->IJKB', t1_xxee, t1_ve, optimize = einsum_type)
            T_v_cce -= 1/2 * einsum('KJBx,Ix->IJKB', t1_xxea, t1_va, optimize = einsum_type)
            T_v_cce += 1/2 * einsum('JKBa,Ixay,xy->IJKB', t1_xxee, t1_vaea, rdm_ca, optimize = einsum_type)
            T_v_cce -= 1/4 * einsum('JKBa,Ixya,xy->IJKB', t1_xxee, t1_vaae, rdm_ca, optimize = einsum_type)
            T_v_cce += 1/2 * einsum('JKBx,Iyxz,yz->IJKB', t1_xxea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_v_cce -= 1/4 * einsum('JKBx,Iyzx,yz->IJKB', t1_xxea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_v_cce -= 1/2 * einsum('KJBa,Ixay,xy->IJKB', t1_xxee, t1_vaea, rdm_ca, optimize = einsum_type)
            T_v_cce += 1/4 * einsum('KJBa,Ixya,xy->IJKB', t1_xxee, t1_vaae, rdm_ca, optimize = einsum_type)
            T_v_cce -= 1/2 * einsum('KJBx,Iyxz,yz->IJKB', t1_xxea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_v_cce += 1/4 * einsum('KJBx,Iyzx,yz->IJKB', t1_xxea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T[ncvs:ncore, s_cce__aaa:f_cce__aaa] += T_v_cce[:, cvs_tril_ind[0], cvs_tril_ind[1]].reshape(nval, -1)

            T_v_cce =- 1/2 * einsum('KJBa,Ia->IJKB', t1_xxee, t1_ve, optimize = einsum_type)
            T_v_cce -= 1/2 * einsum('KJBx,Ix->IJKB', t1_xxea, t1_va, optimize = einsum_type)
            T_v_cce -= 1/2 * einsum('KJBa,Ixay,xy->IJKB', t1_xxee, t1_vaea, rdm_ca, optimize = einsum_type)
            T_v_cce += 1/4 * einsum('KJBa,Ixya,xy->IJKB', t1_xxee, t1_vaae, rdm_ca, optimize = einsum_type)
            T_v_cce -= 1/2 * einsum('KJBx,Iyxz,yz->IJKB', t1_xxea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_v_cce += 1/4 * einsum('KJBx,Iyzx,yz->IJKB', t1_xxea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T[ncvs:ncore, s_cce__abb:f_cce__abb] += T_v_cce.reshape(nval, -1)

        # CORE(2) - CVE
        if nval > 0:
            T_c_cve =- 1/2 * einsum('Ia,JKaB->IJKB', t1_xe, t1_xvee, optimize = einsum_type)
            T_c_cve += 1/2 * einsum('Ix,JKBx->IJKB', t1_xa, t1_xvea, optimize = einsum_type)
            T_c_cve -= 1/2 * einsum('Ix,JKxB->IJKB', t1_xa, t1_xvae, optimize = einsum_type)
            T_c_cve += 1/2 * einsum('JKBa,Ia->IJKB', t1_xvee, t1_xe, optimize = einsum_type)
            T_c_cve -= 1/2 * einsum('Ixay,JKaB,xy->IJKB', t1_xaea, t1_xvee, rdm_ca, optimize = einsum_type)
            T_c_cve += 1/4 * einsum('Ixya,JKaB,xy->IJKB', t1_xaae, t1_xvee, rdm_ca, optimize = einsum_type)
            T_c_cve += 1/2 * einsum('Ixyz,JKBy,xz->IJKB', t1_xaaa, t1_xvea, rdm_ca, optimize = einsum_type)
            T_c_cve -= 1/4 * einsum('Ixyz,JKBz,xy->IJKB', t1_xaaa, t1_xvea, rdm_ca, optimize = einsum_type)
            T_c_cve -= 1/2 * einsum('Ixyz,JKyB,xz->IJKB', t1_xaaa, t1_xvae, rdm_ca, optimize = einsum_type)
            T_c_cve += 1/4 * einsum('Ixyz,JKzB,xy->IJKB', t1_xaaa, t1_xvae, rdm_ca, optimize = einsum_type)
            T_c_cve += 1/2 * einsum('JKBa,Ixay,xy->IJKB', t1_xvee, t1_xaea, rdm_ca, optimize = einsum_type)
            T_c_cve -= 1/4 * einsum('JKBa,Ixya,xy->IJKB', t1_xvee, t1_xaae, rdm_ca, optimize = einsum_type)
            T[:ncvs, s_cve__aaa:f_cve__aaa] += T_c_cve.reshape(ncvs, -1)

            T_c_cve =- 1/2 * einsum('Ia,JKaB->IJKB', t1_xe, t1_xvee, optimize = einsum_type)
            T_c_cve -= 1/2 * einsum('Ix,JKxB->IJKB', t1_xa, t1_xvae, optimize = einsum_type)
            T_c_cve -= 1/2 * einsum('Ixay,JKaB,xy->IJKB', t1_xaea, t1_xvee, rdm_ca, optimize = einsum_type)
            T_c_cve += 1/4 * einsum('Ixya,JKaB,xy->IJKB', t1_xaae, t1_xvee, rdm_ca, optimize = einsum_type)
            T_c_cve -= 1/2 * einsum('Ixyz,JKyB,xz->IJKB', t1_xaaa, t1_xvae, rdm_ca, optimize = einsum_type)
            T_c_cve += 1/4 * einsum('Ixyz,JKzB,xy->IJKB', t1_xaaa, t1_xvae, rdm_ca, optimize = einsum_type)
            T[:ncvs, s_cve__abb:f_cve__abb] += T_c_cve.reshape(ncvs, -1)

            T_c_cve  = 1/2 * einsum('Ix,JKBx->IJKB', t1_xa, t1_xvea, optimize = einsum_type)
            T_c_cve += 1/2 * einsum('JKBa,Ia->IJKB', t1_xvee, t1_xe, optimize = einsum_type)
            T_c_cve += 1/2 * einsum('Ixyz,JKBy,xz->IJKB', t1_xaaa, t1_xvea, rdm_ca, optimize = einsum_type)
            T_c_cve -= 1/4 * einsum('Ixyz,JKBz,xy->IJKB', t1_xaaa, t1_xvea, rdm_ca, optimize = einsum_type)
            T_c_cve += 1/2 * einsum('JKBa,Ixay,xy->IJKB', t1_xvee, t1_xaea, rdm_ca, optimize = einsum_type)
            T_c_cve -= 1/4 * einsum('JKBa,Ixya,xy->IJKB', t1_xvee, t1_xaae, rdm_ca, optimize = einsum_type)
            T[:ncvs, s_cve__bab:f_cve__bab] += T_c_cve.reshape(ncvs, -1)

        # VALENCE(2) - CVE
        if nval > 0:
            T_v_cve =- 1/2 * einsum('Ia,JKaB->IJKB', t1_ve, t1_xvee, optimize = einsum_type)
            T_v_cve += 1/2 * einsum('Ix,JKBx->IJKB', t1_va, t1_xvea, optimize = einsum_type)
            T_v_cve -= 1/2 * einsum('Ix,JKxB->IJKB', t1_va, t1_xvae, optimize = einsum_type)
            T_v_cve += 1/2 * einsum('JKBa,Ia->IJKB', t1_xvee, t1_ve, optimize = einsum_type)
            T_v_cve -= 1/2 * einsum('Ixay,JKaB,xy->IJKB', t1_vaea, t1_xvee, rdm_ca, optimize = einsum_type)
            T_v_cve += 1/4 * einsum('Ixya,JKaB,xy->IJKB', t1_vaae, t1_xvee, rdm_ca, optimize = einsum_type)
            T_v_cve += 1/2 * einsum('Ixyz,JKBy,xz->IJKB', t1_vaaa, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cve -= 1/4 * einsum('Ixyz,JKBz,xy->IJKB', t1_vaaa, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cve -= 1/2 * einsum('Ixyz,JKyB,xz->IJKB', t1_vaaa, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cve += 1/4 * einsum('Ixyz,JKzB,xy->IJKB', t1_vaaa, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cve += 1/2 * einsum('JKBa,Ixay,xy->IJKB', t1_xvee, t1_vaea, rdm_ca, optimize = einsum_type)
            T_v_cve -= 1/4 * einsum('JKBa,Ixya,xy->IJKB', t1_xvee, t1_vaae, rdm_ca, optimize = einsum_type)
            T[ncvs:ncore, s_cve__aaa:f_cve__aaa] += T_v_cve.reshape(nval, -1)

            T_v_cve =- 1/2 * einsum('Ia,JKaB->IJKB', t1_ve, t1_xvee, optimize = einsum_type)
            T_v_cve -= 1/2 * einsum('Ix,JKxB->IJKB', t1_va, t1_xvae, optimize = einsum_type)
            T_v_cve -= 1/2 * einsum('Ixay,JKaB,xy->IJKB', t1_vaea, t1_xvee, rdm_ca, optimize = einsum_type)
            T_v_cve += 1/4 * einsum('Ixya,JKaB,xy->IJKB', t1_vaae, t1_xvee, rdm_ca, optimize = einsum_type)
            T_v_cve -= 1/2 * einsum('Ixyz,JKyB,xz->IJKB', t1_vaaa, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cve += 1/4 * einsum('Ixyz,JKzB,xy->IJKB', t1_vaaa, t1_xvae, rdm_ca, optimize = einsum_type)
            T[ncvs:ncore, s_cve__abb:f_cve__abb] += T_v_cve.reshape(nval, -1)

            T_v_cve  = 1/2 * einsum('Ix,JKBx->IJKB', t1_va, t1_xvea, optimize = einsum_type)
            T_v_cve += 1/2 * einsum('JKBa,Ia->IJKB', t1_xvee, t1_ve, optimize = einsum_type)
            T_v_cve += 1/2 * einsum('Ixyz,JKBy,xz->IJKB', t1_vaaa, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cve -= 1/4 * einsum('Ixyz,JKBz,xy->IJKB', t1_vaaa, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cve += 1/2 * einsum('JKBa,Ixay,xy->IJKB', t1_xvee, t1_vaea, rdm_ca, optimize = einsum_type)
            T_v_cve -= 1/4 * einsum('JKBa,Ixya,xy->IJKB', t1_xvee, t1_vaae, rdm_ca, optimize = einsum_type)
            T[ncvs:ncore, s_cve__bab:f_cve__bab] += T_v_cve.reshape(nval, -1)

        # CORE(2) - CAE
        T_c_cae =- 1/4 * einsum('Ia,JxaB,Yx->IJYB', t1_xe, t1_xaee, rdm_ca, optimize = einsum_type)
        T_c_cae += 1/4 * einsum('Iiax,JiaB,Yx->IJYB', t1_xvea, t1_xvee, rdm_ca, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('Iixa,JiaB,Yx->IJYB', t1_xvae, t1_xvee, rdm_ca, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('Iixy,JiBx,Yy->IJYB', t1_xvaa, t1_xvea, rdm_ca, optimize = einsum_type)
        T_c_cae += 1/2 * einsum('Iixy,JiBy,Yx->IJYB', t1_xvaa, t1_xvea, rdm_ca, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('Iixy,JiBz,Yzxy->IJYB', t1_xvaa, t1_xvea, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/4 * einsum('Iixy,JixB,Yy->IJYB', t1_xvaa, t1_xvae, rdm_ca, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('Iixy,JiyB,Yx->IJYB', t1_xvaa, t1_xvae, rdm_ca, optimize = einsum_type)
        T_c_cae += 1/12 * einsum('Iixy,JizB,Yzxy->IJYB', t1_xvaa, t1_xvae, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/12 * einsum('Iixy,JizB,Yzyx->IJYB', t1_xvaa, t1_xvae, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/4 * einsum('Ix,JyBx,Yy->IJYB', t1_xa, t1_xaea, rdm_ca, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('Ix,JyxB,Yy->IJYB', t1_xa, t1_xaae, rdm_ca, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('Ixay,JzaB,Yxzy->IJYB', t1_xaea, t1_xaee, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/12 * einsum('Ixya,JzaB,Yxyz->IJYB', t1_xaae, t1_xaee, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/12 * einsum('Ixya,JzaB,Yxzy->IJYB', t1_xaae, t1_xaee, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/4 * einsum('Ixyz,JwBy,Yxwz->IJYB', t1_xaaa, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/4 * einsum('Ixyz,JwBz,Yxyw->IJYB', t1_xaaa, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('Ixyz,JwyB,Yxwz->IJYB', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/12 * einsum('Ixyz,JwzB,Yxwy->IJYB', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/12 * einsum('Ixyz,JwzB,Yxyw->IJYB', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('Ixyz,JxBw,Ywyz->IJYB', t1_xaaa, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/12 * einsum('Ixyz,JxwB,Ywyz->IJYB', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/12 * einsum('Ixyz,JxwB,Ywzy->IJYB', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/2 * einsum('JiBa,Iixa,Yx->IJYB', t1_xxee, t1_xxae, rdm_ca, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('JiBa,iIxa,Yx->IJYB', t1_xxee, t1_xxae, rdm_ca, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('JiBx,Iixy,Yy->IJYB', t1_xxea, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cae += 1/2 * einsum('JiBx,Iiyx,Yy->IJYB', t1_xxea, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('JiBx,Iiyz,Yxyz->IJYB', t1_xxea, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('JiBa,Iiax,Yx->IJYB', t1_xvee, t1_xvea, rdm_ca, optimize = einsum_type)
        T_c_cae += 1/2 * einsum('JiBa,Iixa,Yx->IJYB', t1_xvee, t1_xvae, rdm_ca, optimize = einsum_type)
        T_c_cae += 1/4 * einsum('JxBa,Ia,Yx->IJYB', t1_xaee, t1_xe, rdm_ca, optimize = einsum_type)
        T_c_cae += 1/4 * einsum('JxBa,Iyaz,Yyxz->IJYB', t1_xaee, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/4 * einsum('JxBa,Iyza,Yyzx->IJYB', t1_xaee, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('iJBa,Iixa,Yx->IJYB', t1_xxee, t1_xxae, rdm_ca, optimize = einsum_type)
        T_c_cae += 1/4 * einsum('iJBa,iIxa,Yx->IJYB', t1_xxee, t1_xxae, rdm_ca, optimize = einsum_type)
        T_c_cae += 1/4 * einsum('iJBx,Iixy,Yy->IJYB', t1_xxea, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('iJBx,Iiyx,Yy->IJYB', t1_xxea, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cae += 1/12 * einsum('iJBx,Iiyz,Yxyz->IJYB', t1_xxea, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/12 * einsum('iJBx,Iiyz,Yxzy->IJYB', t1_xxea, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T[:ncvs, s_cae__aaa:f_cae__aaa] += T_c_cae.reshape(ncvs, -1)

        T_c_cae =- 1/4 * einsum('Ia,JxaB,Yx->IJYB', t1_xe, t1_xaee, rdm_ca, optimize = einsum_type)
        T_c_cae += 1/4 * einsum('Iiax,JiaB,Yx->IJYB', t1_xvea, t1_xvee, rdm_ca, optimize = einsum_type)
        T_c_cae += 1/4 * einsum('Iixy,JixB,Yy->IJYB', t1_xvaa, t1_xvae, rdm_ca, optimize = einsum_type)
        T_c_cae -= 1/12 * einsum('Iixy,JizB,Yzxy->IJYB', t1_xvaa, t1_xvae, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/6 * einsum('Iixy,JizB,Yzyx->IJYB', t1_xvaa, t1_xvae, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('Ix,JyxB,Yy->IJYB', t1_xa, t1_xaae, rdm_ca, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('Ixay,JzaB,Yxzy->IJYB', t1_xaea, t1_xaee, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/12 * einsum('Ixya,JzaB,Yxyz->IJYB', t1_xaae, t1_xaee, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/6 * einsum('Ixya,JzaB,Yxzy->IJYB', t1_xaae, t1_xaee, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('Ixyz,JwyB,Yxwz->IJYB', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/6 * einsum('Ixyz,JwzB,Yxwy->IJYB', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/12 * einsum('Ixyz,JwzB,Yxyw->IJYB', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/12 * einsum('Ixyz,JxwB,Ywyz->IJYB', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/6 * einsum('Ixyz,JxwB,Ywzy->IJYB', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/4 * einsum('iJBa,iIxa,Yx->IJYB', t1_xxee, t1_xxae, rdm_ca, optimize = einsum_type)
        T_c_cae += 1/4 * einsum('iJBx,Iixy,Yy->IJYB', t1_xxea, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cae -= 1/12 * einsum('iJBx,Iiyz,Yxyz->IJYB', t1_xxea, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/6 * einsum('iJBx,Iiyz,Yxzy->IJYB', t1_xxea, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T[:ncvs, s_cae__abb:f_cae__abb] += T_c_cae.reshape(ncvs, -1)

        T_c_cae =- 1/4 * einsum('Iixa,JiaB,Yx->IJYB', t1_xvae, t1_xvee, rdm_ca, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('Iixy,JiBx,Yy->IJYB', t1_xvaa, t1_xvea, rdm_ca, optimize = einsum_type)
        T_c_cae += 3/8 * einsum('Iixy,JiBy,Yx->IJYB', t1_xvaa, t1_xvea, rdm_ca, optimize = einsum_type)
        T_c_cae -= 1/6 * einsum('Iixy,JiBz,Yzxy->IJYB', t1_xvaa, t1_xvea, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/24 * einsum('Iixy,JiBz,Yzyx->IJYB', t1_xvaa, t1_xvea, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/8 * einsum('Iixy,JiyB,Yx->IJYB', t1_xvaa, t1_xvae, rdm_ca, optimize = einsum_type)
        T_c_cae += 1/12 * einsum('Iixy,JizB,Yzxy->IJYB', t1_xvaa, t1_xvae, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/24 * einsum('Iixy,JizB,Yzyx->IJYB', t1_xvaa, t1_xvae, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/4 * einsum('Ix,JyBx,Yy->IJYB', t1_xa, t1_xaea, rdm_ca, optimize = einsum_type)
        T_c_cae -= 1/6 * einsum('Ixya,JzaB,Yxyz->IJYB', t1_xaae, t1_xaee, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/12 * einsum('Ixya,JzaB,Yxzy->IJYB', t1_xaae, t1_xaee, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/4 * einsum('Ixyz,JwBy,Yxwz->IJYB', t1_xaaa, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/4 * einsum('Ixyz,JwBz,Yxyw->IJYB', t1_xaaa, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/12 * einsum('Ixyz,JwzB,Yxwy->IJYB', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/6 * einsum('Ixyz,JwzB,Yxyw->IJYB', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('Ixyz,JxBw,Ywyz->IJYB', t1_xaaa, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/6 * einsum('Ixyz,JxwB,Ywyz->IJYB', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/12 * einsum('Ixyz,JxwB,Ywzy->IJYB', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/2 * einsum('JiBa,Iixa,Yx->IJYB', t1_xxee, t1_xxae, rdm_ca, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('JiBa,iIxa,Yx->IJYB', t1_xxee, t1_xxae, rdm_ca, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('JiBx,Iixy,Yy->IJYB', t1_xxea, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cae += 1/2 * einsum('JiBx,Iiyx,Yy->IJYB', t1_xxea, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('JiBx,Iiyz,Yxyz->IJYB', t1_xxea, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('JiBa,Iiax,Yx->IJYB', t1_xvee, t1_xvea, rdm_ca, optimize = einsum_type)
        T_c_cae += 1/2 * einsum('JiBa,Iixa,Yx->IJYB', t1_xvee, t1_xvae, rdm_ca, optimize = einsum_type)
        T_c_cae += 1/4 * einsum('JxBa,Ia,Yx->IJYB', t1_xaee, t1_xe, rdm_ca, optimize = einsum_type)
        T_c_cae += 1/4 * einsum('JxBa,Iyaz,Yyxz->IJYB', t1_xaee, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/4 * einsum('JxBa,Iyza,Yyzx->IJYB', t1_xaee, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('iJBa,Iixa,Yx->IJYB', t1_xxee, t1_xxae, rdm_ca, optimize = einsum_type)
        T_c_cae -= 1/4 * einsum('iJBx,Iiyx,Yy->IJYB', t1_xxea, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cae += 1/6 * einsum('iJBx,Iiyz,Yxyz->IJYB', t1_xxea, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_cae += 1/12 * einsum('iJBx,Iiyz,Yxzy->IJYB', t1_xxea, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T[:ncvs, s_cae__bab:f_cae__bab] += T_c_cae.reshape(ncvs, -1)

        # VALENCE(2) - CAE
        if nval > 0:
            T_v_cae =- 1/4 * einsum('Ia,JxaB,Yx->IJYB', t1_ve, t1_xaee, rdm_ca, optimize = einsum_type)
            T_v_cae += 1/4 * einsum('Iiax,JiaB,Yx->IJYB', t1_vvea, t1_xvee, rdm_ca, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('Iixy,JiBx,Yy->IJYB', t1_vvaa, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cae += 1/2 * einsum('Iixy,JiBy,Yx->IJYB', t1_vvaa, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('Iixy,JiBz,Yzxy->IJYB', t1_vvaa, t1_xvea, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/4 * einsum('Iixy,JixB,Yy->IJYB', t1_vvaa, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('Iixy,JiyB,Yx->IJYB', t1_vvaa, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cae += 1/12 * einsum('Iixy,JizB,Yzxy->IJYB', t1_vvaa, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/12 * einsum('Iixy,JizB,Yzyx->IJYB', t1_vvaa, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/4 * einsum('Ix,JyBx,Yy->IJYB', t1_va, t1_xaea, rdm_ca, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('Ix,JyxB,Yy->IJYB', t1_va, t1_xaae, rdm_ca, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('Ixay,JzaB,Yxzy->IJYB', t1_vaea, t1_xaee, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/12 * einsum('Ixya,JzaB,Yxyz->IJYB', t1_vaae, t1_xaee, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/12 * einsum('Ixya,JzaB,Yxzy->IJYB', t1_vaae, t1_xaee, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/4 * einsum('Ixyz,JwBy,Yxwz->IJYB', t1_vaaa, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/4 * einsum('Ixyz,JwBz,Yxyw->IJYB', t1_vaaa, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('Ixyz,JwyB,Yxwz->IJYB', t1_vaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/12 * einsum('Ixyz,JwzB,Yxwy->IJYB', t1_vaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/12 * einsum('Ixyz,JwzB,Yxyw->IJYB', t1_vaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('Ixyz,JxBw,Ywyz->IJYB', t1_vaaa, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/12 * einsum('Ixyz,JxwB,Ywyz->IJYB', t1_vaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/12 * einsum('Ixyz,JxwB,Ywzy->IJYB', t1_vaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/2 * einsum('JiBa,Iixa,Yx->IJYB', t1_xxee, t1_vxae, rdm_ca, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('JiBa,iIxa,Yx->IJYB', t1_xxee, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('JiBx,Iixy,Yy->IJYB', t1_xxea, t1_vxaa, rdm_ca, optimize = einsum_type)
            T_v_cae += 1/2 * einsum('JiBx,Iiyx,Yy->IJYB', t1_xxea, t1_vxaa, rdm_ca, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('JiBx,Iiyz,Yxyz->IJYB', t1_xxea, t1_vxaa, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('JiBa,Iiax,Yx->IJYB', t1_xvee, t1_vvea, rdm_ca, optimize = einsum_type)
            T_v_cae += 1/2 * einsum('JiBa,iIax,Yx->IJYB', t1_xvee, t1_vvea, rdm_ca, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('JiaB,iIax,Yx->IJYB', t1_xvee, t1_vvea, rdm_ca, optimize = einsum_type)
            T_v_cae += 1/4 * einsum('JxBa,Ia,Yx->IJYB', t1_xaee, t1_ve, rdm_ca, optimize = einsum_type)
            T_v_cae += 1/4 * einsum('JxBa,Iyaz,Yyxz->IJYB', t1_xaee, t1_vaea, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/4 * einsum('JxBa,Iyza,Yyzx->IJYB', t1_xaee, t1_vaae, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('iJBa,Iixa,Yx->IJYB', t1_xxee, t1_vxae, rdm_ca, optimize = einsum_type)
            T_v_cae += 1/4 * einsum('iJBa,iIxa,Yx->IJYB', t1_xxee, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cae += 1/4 * einsum('iJBx,Iixy,Yy->IJYB', t1_xxea, t1_vxaa, rdm_ca, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('iJBx,Iiyx,Yy->IJYB', t1_xxea, t1_vxaa, rdm_ca, optimize = einsum_type)
            T_v_cae += 1/12 * einsum('iJBx,Iiyz,Yxyz->IJYB', t1_xxea, t1_vxaa, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/12 * einsum('iJBx,Iiyz,Yxzy->IJYB', t1_xxea, t1_vxaa, rdm_ccaa, optimize = einsum_type)
            T[ncvs:ncore, s_cae__aaa:f_cae__aaa] += T_v_cae.reshape(nval, -1)

            T_v_cae =- 1/4 * einsum('Ia,JxaB,Yx->IJYB', t1_ve, t1_xaee, rdm_ca, optimize = einsum_type)
            T_v_cae += 1/4 * einsum('Iiax,JiaB,Yx->IJYB', t1_vvea, t1_xvee, rdm_ca, optimize = einsum_type)
            T_v_cae += 1/4 * einsum('Iixy,JixB,Yy->IJYB', t1_vvaa, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cae -= 1/12 * einsum('Iixy,JizB,Yzxy->IJYB', t1_vvaa, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/6 * einsum('Iixy,JizB,Yzyx->IJYB', t1_vvaa, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('Ix,JyxB,Yy->IJYB', t1_va, t1_xaae, rdm_ca, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('Ixay,JzaB,Yxzy->IJYB', t1_vaea, t1_xaee, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/12 * einsum('Ixya,JzaB,Yxyz->IJYB', t1_vaae, t1_xaee, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/6 * einsum('Ixya,JzaB,Yxzy->IJYB', t1_vaae, t1_xaee, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('Ixyz,JwyB,Yxwz->IJYB', t1_vaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/6 * einsum('Ixyz,JwzB,Yxwy->IJYB', t1_vaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/12 * einsum('Ixyz,JwzB,Yxyw->IJYB', t1_vaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/12 * einsum('Ixyz,JxwB,Ywyz->IJYB', t1_vaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/6 * einsum('Ixyz,JxwB,Ywzy->IJYB', t1_vaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/4 * einsum('iJBa,iIxa,Yx->IJYB', t1_xxee, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cae += 1/4 * einsum('iJBx,Iixy,Yy->IJYB', t1_xxea, t1_vxaa, rdm_ca, optimize = einsum_type)
            T_v_cae -= 1/12 * einsum('iJBx,Iiyz,Yxyz->IJYB', t1_xxea, t1_vxaa, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/6 * einsum('iJBx,Iiyz,Yxzy->IJYB', t1_xxea, t1_vxaa, rdm_ccaa, optimize = einsum_type)
            T[ncvs:ncore, s_cae__abb:f_cae__abb] += T_v_cae.reshape(nval, -1)

            T_v_cae =- 1/4 * einsum('Iixy,JiBx,Yy->IJYB', t1_vvaa, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cae += 3/8 * einsum('Iixy,JiBy,Yx->IJYB', t1_vvaa, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cae -= 1/6 * einsum('Iixy,JiBz,Yzxy->IJYB', t1_vvaa, t1_xvea, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/24 * einsum('Iixy,JiBz,Yzyx->IJYB', t1_vvaa, t1_xvea, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/8 * einsum('Iixy,JiyB,Yx->IJYB', t1_vvaa, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cae += 1/12 * einsum('Iixy,JizB,Yzxy->IJYB', t1_vvaa, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/24 * einsum('Iixy,JizB,Yzyx->IJYB', t1_vvaa, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/4 * einsum('Ix,JyBx,Yy->IJYB', t1_va, t1_xaea, rdm_ca, optimize = einsum_type)
            T_v_cae -= 1/6 * einsum('Ixya,JzaB,Yxyz->IJYB', t1_vaae, t1_xaee, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/12 * einsum('Ixya,JzaB,Yxzy->IJYB', t1_vaae, t1_xaee, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/4 * einsum('Ixyz,JwBy,Yxwz->IJYB', t1_vaaa, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/4 * einsum('Ixyz,JwBz,Yxyw->IJYB', t1_vaaa, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/12 * einsum('Ixyz,JwzB,Yxwy->IJYB', t1_vaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/6 * einsum('Ixyz,JwzB,Yxyw->IJYB', t1_vaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('Ixyz,JxBw,Ywyz->IJYB', t1_vaaa, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/6 * einsum('Ixyz,JxwB,Ywyz->IJYB', t1_vaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/12 * einsum('Ixyz,JxwB,Ywzy->IJYB', t1_vaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/2 * einsum('JiBa,Iixa,Yx->IJYB', t1_xxee, t1_vxae, rdm_ca, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('JiBa,iIxa,Yx->IJYB', t1_xxee, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('JiBx,Iixy,Yy->IJYB', t1_xxea, t1_vxaa, rdm_ca, optimize = einsum_type)
            T_v_cae += 1/2 * einsum('JiBx,Iiyx,Yy->IJYB', t1_xxea, t1_vxaa, rdm_ca, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('JiBx,Iiyz,Yxyz->IJYB', t1_xxea, t1_vxaa, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('JiBa,Iiax,Yx->IJYB', t1_xvee, t1_vvea, rdm_ca, optimize = einsum_type)
            T_v_cae += 1/2 * einsum('JiBa,iIax,Yx->IJYB', t1_xvee, t1_vvea, rdm_ca, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('JiaB,iIax,Yx->IJYB', t1_xvee, t1_vvea, rdm_ca, optimize = einsum_type)
            T_v_cae += 1/4 * einsum('JxBa,Ia,Yx->IJYB', t1_xaee, t1_ve, rdm_ca, optimize = einsum_type)
            T_v_cae += 1/4 * einsum('JxBa,Iyaz,Yyxz->IJYB', t1_xaee, t1_vaea, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/4 * einsum('JxBa,Iyza,Yyzx->IJYB', t1_xaee, t1_vaae, rdm_ccaa, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('iJBa,Iixa,Yx->IJYB', t1_xxee, t1_vxae, rdm_ca, optimize = einsum_type)
            T_v_cae -= 1/4 * einsum('iJBx,Iiyx,Yy->IJYB', t1_xxea, t1_vxaa, rdm_ca, optimize = einsum_type)
            T_v_cae += 1/6 * einsum('iJBx,Iiyz,Yxyz->IJYB', t1_xxea, t1_vxaa, rdm_ccaa, optimize = einsum_type)
            T_v_cae += 1/12 * einsum('iJBx,Iiyz,Yxzy->IJYB', t1_xxea, t1_vxaa, rdm_ccaa, optimize = einsum_type)
            T[ncvs:ncore, s_cae__bab:f_cae__bab] += T_v_cae.reshape(nval, -1)

        # CORE(2) - CCA
        T_c_cca =- 1/2 * einsum('IYab,JKab->IJKY', t1_xaee, t1_xxee, optimize = einsum_type)
        T_c_cca += 1/2 * einsum('IYab,JKba->IJKY', t1_xaee, t1_xxee, optimize = einsum_type)
        T_c_cca -= 1/2 * einsum('IYax,JKax->IJKY', t1_xaea, t1_xxea, optimize = einsum_type)
        T_c_cca += 1/2 * einsum('IYax,KJax->IJKY', t1_xaea, t1_xxea, optimize = einsum_type)
        T_c_cca += 1/2 * einsum('IYxa,JKax->IJKY', t1_xaae, t1_xxea, optimize = einsum_type)
        T_c_cca -= 1/2 * einsum('IYxa,KJax->IJKY', t1_xaae, t1_xxea, optimize = einsum_type)
        T_c_cca -= 1/2 * einsum('IYxy,JKxy->IJKY', t1_xaaa, t1_xxaa, optimize = einsum_type)
        T_c_cca += 1/2 * einsum('IYxy,JKyx->IJKY', t1_xaaa, t1_xxaa, optimize = einsum_type)
        T_c_cca -= 1/2 * einsum('Ia,JKaY->IJKY', t1_xe, t1_xxea, optimize = einsum_type)
        T_c_cca += 1/2 * einsum('Ia,KJaY->IJKY', t1_xe, t1_xxea, optimize = einsum_type)
        T_c_cca += 1/2 * einsum('Ix,JKYx->IJKY', t1_xa, t1_xxaa, optimize = einsum_type)
        T_c_cca -= 1/2 * einsum('Ix,JKxY->IJKY', t1_xa, t1_xxaa, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('IYax,JKay,xy->IJKY', t1_xaea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_cca -= 1/4 * einsum('IYax,KJay,xy->IJKY', t1_xaea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_cca -= 1/4 * einsum('IYxa,JKay,xy->IJKY', t1_xaae, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('IYxa,KJay,xy->IJKY', t1_xaae, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('IYxy,JKxz,yz->IJKY', t1_xaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cca -= 1/4 * einsum('IYxy,JKyz,xz->IJKY', t1_xaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cca -= 1/4 * einsum('IYxy,JKzx,yz->IJKY', t1_xaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('IYxy,JKzy,xz->IJKY', t1_xaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('Ia,JKax,Yx->IJKY', t1_xe, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_cca -= 1/4 * einsum('Ia,KJax,Yx->IJKY', t1_xe, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('Ix,JKxy,Yy->IJKY', t1_xa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cca -= 1/4 * einsum('Ix,JKyx,Yy->IJKY', t1_xa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('Ixab,JKab,Yx->IJKY', t1_xaee, t1_xxee, rdm_ca, optimize = einsum_type)
        T_c_cca -= 1/4 * einsum('Ixab,JKba,Yx->IJKY', t1_xaee, t1_xxee, rdm_ca, optimize = einsum_type)
        T_c_cca -= 1/2 * einsum('Ixay,JKaY,xy->IJKY', t1_xaea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('Ixay,JKay,Yx->IJKY', t1_xaea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('Ixay,JKaz,Yyzx->IJKY', t1_xaea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_cca += 1/2 * einsum('Ixay,KJaY,xy->IJKY', t1_xaea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_cca -= 1/4 * einsum('Ixay,KJay,Yx->IJKY', t1_xaea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_cca -= 1/4 * einsum('Ixay,KJaz,Yyzx->IJKY', t1_xaea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('Ixya,JKaY,xy->IJKY', t1_xaae, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_cca -= 1/4 * einsum('Ixya,JKay,Yx->IJKY', t1_xaae, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/12 * einsum('Ixya,JKaz,Yyxz->IJKY', t1_xaae, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_cca -= 1/12 * einsum('Ixya,JKaz,Yyzx->IJKY', t1_xaae, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_cca -= 1/4 * einsum('Ixya,KJaY,xy->IJKY', t1_xaae, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('Ixya,KJay,Yx->IJKY', t1_xaae, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_cca -= 1/12 * einsum('Ixya,KJaz,Yyxz->IJKY', t1_xaae, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_cca += 1/12 * einsum('Ixya,KJaz,Yyzx->IJKY', t1_xaae, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_cca += 1/2 * einsum('Ixyz,JKYy,xz->IJKY', t1_xaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cca -= 1/4 * einsum('Ixyz,JKYz,xy->IJKY', t1_xaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cca -= 1/4 * einsum('Ixyz,JKwy,Yzwx->IJKY', t1_xaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_cca += 1/12 * einsum('Ixyz,JKwz,Yywx->IJKY', t1_xaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_cca -= 1/12 * einsum('Ixyz,JKwz,Yyxw->IJKY', t1_xaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_cca -= 1/2 * einsum('Ixyz,JKyY,xz->IJKY', t1_xaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('Ixyz,JKyw,Yzwx->IJKY', t1_xaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('Ixyz,JKyz,Yx->IJKY', t1_xaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('Ixyz,JKzY,xy->IJKY', t1_xaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cca -= 1/12 * einsum('Ixyz,JKzw,Yywx->IJKY', t1_xaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_cca += 1/12 * einsum('Ixyz,JKzw,Yyxw->IJKY', t1_xaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_cca -= 1/4 * einsum('Ixyz,JKzy,Yx->IJKY', t1_xaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T[:ncvs, s_cca__aaa:f_cca__aaa] += T_c_cca[:, cvs_tril_ind[0], cvs_tril_ind[1]].reshape(ncvs, -1)

        T_c_cca =- 1/2 * einsum('IYab,JKab->IJKY', t1_xaee, t1_xxee, optimize = einsum_type)
        T_c_cca -= 1/2 * einsum('IYax,JKax->IJKY', t1_xaea, t1_xxea, optimize = einsum_type)
        T_c_cca -= 1/2 * einsum('IYxa,KJax->IJKY', t1_xaae, t1_xxea, optimize = einsum_type)
        T_c_cca -= 1/2 * einsum('IYxy,JKxy->IJKY', t1_xaaa, t1_xxaa, optimize = einsum_type)
        T_c_cca -= 1/2 * einsum('Ia,JKaY->IJKY', t1_xe, t1_xxea, optimize = einsum_type)
        T_c_cca -= 1/2 * einsum('Ix,JKxY->IJKY', t1_xa, t1_xxaa, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('IYax,JKay,xy->IJKY', t1_xaea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('IYxa,KJay,xy->IJKY', t1_xaae, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('IYxy,JKxz,yz->IJKY', t1_xaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('IYxy,JKzy,xz->IJKY', t1_xaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('Ia,JKax,Yx->IJKY', t1_xe, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('Ix,JKxy,Yy->IJKY', t1_xa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('Ixab,JKab,Yx->IJKY', t1_xaee, t1_xxee, rdm_ca, optimize = einsum_type)
        T_c_cca -= 1/2 * einsum('Ixay,JKaY,xy->IJKY', t1_xaea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('Ixay,JKay,Yx->IJKY', t1_xaea, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('Ixay,JKaz,Yyzx->IJKY', t1_xaea, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('Ixya,JKaY,xy->IJKY', t1_xaae, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_cca -= 1/12 * einsum('Ixya,JKaz,Yyxz->IJKY', t1_xaae, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_cca -= 1/6 * einsum('Ixya,JKaz,Yyzx->IJKY', t1_xaae, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('Ixya,KJay,Yx->IJKY', t1_xaae, t1_xxea, rdm_ca, optimize = einsum_type)
        T_c_cca -= 1/6 * einsum('Ixya,KJaz,Yyxz->IJKY', t1_xaae, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_cca -= 1/12 * einsum('Ixya,KJaz,Yyzx->IJKY', t1_xaae, t1_xxea, rdm_ccaa, optimize = einsum_type)
        T_c_cca -= 1/12 * einsum('Ixyz,JKwz,Yywx->IJKY', t1_xaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_cca -= 1/6 * einsum('Ixyz,JKwz,Yyxw->IJKY', t1_xaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_cca -= 1/2 * einsum('Ixyz,JKyY,xz->IJKY', t1_xaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('Ixyz,JKyw,Yzwx->IJKY', t1_xaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('Ixyz,JKyz,Yx->IJKY', t1_xaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cca += 1/4 * einsum('Ixyz,JKzY,xy->IJKY', t1_xaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_c_cca -= 1/6 * einsum('Ixyz,JKzw,Yywx->IJKY', t1_xaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T_c_cca -= 1/12 * einsum('Ixyz,JKzw,Yyxw->IJKY', t1_xaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
        T[:ncvs, s_cca__abb:f_cca__abb] += T_c_cca.reshape(ncvs, -1)

        # VALENCE(2) - CCA
        if nval > 0:
            T_v_cca =- 1/2 * einsum('IYab,JKab->IJKY', t1_vaee, t1_xxee, optimize = einsum_type)
            T_v_cca += 1/2 * einsum('IYab,JKba->IJKY', t1_vaee, t1_xxee, optimize = einsum_type)
            T_v_cca -= 1/2 * einsum('IYax,JKax->IJKY', t1_vaea, t1_xxea, optimize = einsum_type)
            T_v_cca += 1/2 * einsum('IYax,KJax->IJKY', t1_vaea, t1_xxea, optimize = einsum_type)
            T_v_cca += 1/2 * einsum('IYxa,JKax->IJKY', t1_vaae, t1_xxea, optimize = einsum_type)
            T_v_cca -= 1/2 * einsum('IYxa,KJax->IJKY', t1_vaae, t1_xxea, optimize = einsum_type)
            T_v_cca -= 1/2 * einsum('IYxy,JKxy->IJKY', t1_vaaa, t1_xxaa, optimize = einsum_type)
            T_v_cca += 1/2 * einsum('IYxy,JKyx->IJKY', t1_vaaa, t1_xxaa, optimize = einsum_type)
            T_v_cca -= 1/2 * einsum('Ia,JKaY->IJKY', t1_ve, t1_xxea, optimize = einsum_type)
            T_v_cca += 1/2 * einsum('Ia,KJaY->IJKY', t1_ve, t1_xxea, optimize = einsum_type)
            T_v_cca += 1/2 * einsum('Ix,JKYx->IJKY', t1_va, t1_xxaa, optimize = einsum_type)
            T_v_cca -= 1/2 * einsum('Ix,JKxY->IJKY', t1_va, t1_xxaa, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('IYax,JKay,xy->IJKY', t1_vaea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_cca -= 1/4 * einsum('IYax,KJay,xy->IJKY', t1_vaea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_cca -= 1/4 * einsum('IYxa,JKay,xy->IJKY', t1_vaae, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('IYxa,KJay,xy->IJKY', t1_vaae, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('IYxy,JKxz,yz->IJKY', t1_vaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_cca -= 1/4 * einsum('IYxy,JKyz,xz->IJKY', t1_vaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_cca -= 1/4 * einsum('IYxy,JKzx,yz->IJKY', t1_vaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('IYxy,JKzy,xz->IJKY', t1_vaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('Ia,JKax,Yx->IJKY', t1_ve, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_cca -= 1/4 * einsum('Ia,KJax,Yx->IJKY', t1_ve, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('Ix,JKxy,Yy->IJKY', t1_va, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_cca -= 1/4 * einsum('Ix,JKyx,Yy->IJKY', t1_va, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('Ixab,JKab,Yx->IJKY', t1_vaee, t1_xxee, rdm_ca, optimize = einsum_type)
            T_v_cca -= 1/4 * einsum('Ixab,JKba,Yx->IJKY', t1_vaee, t1_xxee, rdm_ca, optimize = einsum_type)
            T_v_cca -= 1/2 * einsum('Ixay,JKaY,xy->IJKY', t1_vaea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('Ixay,JKay,Yx->IJKY', t1_vaea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('Ixay,JKaz,Yyzx->IJKY', t1_vaea, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_cca += 1/2 * einsum('Ixay,KJaY,xy->IJKY', t1_vaea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_cca -= 1/4 * einsum('Ixay,KJay,Yx->IJKY', t1_vaea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_cca -= 1/4 * einsum('Ixay,KJaz,Yyzx->IJKY', t1_vaea, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('Ixya,JKaY,xy->IJKY', t1_vaae, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_cca -= 1/4 * einsum('Ixya,JKay,Yx->IJKY', t1_vaae, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/12 * einsum('Ixya,JKaz,Yyxz->IJKY', t1_vaae, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_cca -= 1/12 * einsum('Ixya,JKaz,Yyzx->IJKY', t1_vaae, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_cca -= 1/4 * einsum('Ixya,KJaY,xy->IJKY', t1_vaae, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('Ixya,KJay,Yx->IJKY', t1_vaae, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_cca -= 1/12 * einsum('Ixya,KJaz,Yyxz->IJKY', t1_vaae, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_cca += 1/12 * einsum('Ixya,KJaz,Yyzx->IJKY', t1_vaae, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_cca += 1/2 * einsum('Ixyz,JKYy,xz->IJKY', t1_vaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_cca -= 1/4 * einsum('Ixyz,JKYz,xy->IJKY', t1_vaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_cca -= 1/4 * einsum('Ixyz,JKwy,Yzwx->IJKY', t1_vaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_cca += 1/12 * einsum('Ixyz,JKwz,Yywx->IJKY', t1_vaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_cca -= 1/12 * einsum('Ixyz,JKwz,Yyxw->IJKY', t1_vaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_cca -= 1/2 * einsum('Ixyz,JKyY,xz->IJKY', t1_vaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('Ixyz,JKyw,Yzwx->IJKY', t1_vaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('Ixyz,JKyz,Yx->IJKY', t1_vaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('Ixyz,JKzY,xy->IJKY', t1_vaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_cca -= 1/12 * einsum('Ixyz,JKzw,Yywx->IJKY', t1_vaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_cca += 1/12 * einsum('Ixyz,JKzw,Yyxw->IJKY', t1_vaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_cca -= 1/4 * einsum('Ixyz,JKzy,Yx->IJKY', t1_vaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T[ncvs:ncore, s_cca__aaa:f_cca__aaa] += T_v_cca[:, cvs_tril_ind[0], cvs_tril_ind[1]].reshape(nval, -1)

            T_v_cca =- 1/2 * einsum('IYab,JKab->IJKY', t1_vaee, t1_xxee, optimize = einsum_type)
            T_v_cca -= 1/2 * einsum('IYax,JKax->IJKY', t1_vaea, t1_xxea, optimize = einsum_type)
            T_v_cca -= 1/2 * einsum('IYxa,KJax->IJKY', t1_vaae, t1_xxea, optimize = einsum_type)
            T_v_cca -= 1/2 * einsum('IYxy,JKxy->IJKY', t1_vaaa, t1_xxaa, optimize = einsum_type)
            T_v_cca -= 1/2 * einsum('Ia,JKaY->IJKY', t1_ve, t1_xxea, optimize = einsum_type)
            T_v_cca -= 1/2 * einsum('Ix,JKxY->IJKY', t1_va, t1_xxaa, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('IYax,JKay,xy->IJKY', t1_vaea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('IYxa,KJay,xy->IJKY', t1_vaae, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('IYxy,JKxz,yz->IJKY', t1_vaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('IYxy,JKzy,xz->IJKY', t1_vaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('Ia,JKax,Yx->IJKY', t1_ve, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('Ix,JKxy,Yy->IJKY', t1_va, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('Ixab,JKab,Yx->IJKY', t1_vaee, t1_xxee, rdm_ca, optimize = einsum_type)
            T_v_cca -= 1/2 * einsum('Ixay,JKaY,xy->IJKY', t1_vaea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('Ixay,JKay,Yx->IJKY', t1_vaea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('Ixay,JKaz,Yyzx->IJKY', t1_vaea, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('Ixya,JKaY,xy->IJKY', t1_vaae, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_cca -= 1/12 * einsum('Ixya,JKaz,Yyxz->IJKY', t1_vaae, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_cca -= 1/6 * einsum('Ixya,JKaz,Yyzx->IJKY', t1_vaae, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('Ixya,KJay,Yx->IJKY', t1_vaae, t1_xxea, rdm_ca, optimize = einsum_type)
            T_v_cca -= 1/6 * einsum('Ixya,KJaz,Yyxz->IJKY', t1_vaae, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_cca -= 1/12 * einsum('Ixya,KJaz,Yyzx->IJKY', t1_vaae, t1_xxea, rdm_ccaa, optimize = einsum_type)
            T_v_cca -= 1/12 * einsum('Ixyz,JKwz,Yywx->IJKY', t1_vaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_cca -= 1/6 * einsum('Ixyz,JKwz,Yyxw->IJKY', t1_vaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_cca -= 1/2 * einsum('Ixyz,JKyY,xz->IJKY', t1_vaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('Ixyz,JKyw,Yzwx->IJKY', t1_vaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('Ixyz,JKyz,Yx->IJKY', t1_vaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_cca += 1/4 * einsum('Ixyz,JKzY,xy->IJKY', t1_vaaa, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_v_cca -= 1/6 * einsum('Ixyz,JKzw,Yywx->IJKY', t1_vaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_v_cca -= 1/12 * einsum('Ixyz,JKzw,Yyxw->IJKY', t1_vaaa, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T[ncvs:ncore, s_cca__abb:f_cca__abb] += T_v_cca.reshape(nval, -1)

        # CORE(2) - CVA
        if nval > 0:
            T_c_cva =- 1/2 * einsum('IYab,JKab->IJKY', t1_xaee, t1_xvee, optimize = einsum_type)
            T_c_cva += 1/2 * einsum('IYab,JKba->IJKY', t1_xaee, t1_xvee, optimize = einsum_type)
            T_c_cva -= 1/2 * einsum('IYax,JKax->IJKY', t1_xaea, t1_xvea, optimize = einsum_type)
            T_c_cva += 1/2 * einsum('IYax,JKxa->IJKY', t1_xaea, t1_xvae, optimize = einsum_type)
            T_c_cva += 1/2 * einsum('IYxa,JKax->IJKY', t1_xaae, t1_xvea, optimize = einsum_type)
            T_c_cva -= 1/2 * einsum('IYxa,JKxa->IJKY', t1_xaae, t1_xvae, optimize = einsum_type)
            T_c_cva -= 1/2 * einsum('IYxy,JKxy->IJKY', t1_xaaa, t1_xvaa, optimize = einsum_type)
            T_c_cva += 1/2 * einsum('IYxy,JKyx->IJKY', t1_xaaa, t1_xvaa, optimize = einsum_type)
            T_c_cva += 1/2 * einsum('Ia,JKYa->IJKY', t1_xe, t1_xvae, optimize = einsum_type)
            T_c_cva -= 1/2 * einsum('Ia,JKaY->IJKY', t1_xe, t1_xvea, optimize = einsum_type)
            T_c_cva += 1/2 * einsum('Ix,JKYx->IJKY', t1_xa, t1_xvaa, optimize = einsum_type)
            T_c_cva -= 1/2 * einsum('Ix,JKxY->IJKY', t1_xa, t1_xvaa, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('IYax,JKay,xy->IJKY', t1_xaea, t1_xvea, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('IYax,JKya,xy->IJKY', t1_xaea, t1_xvae, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('IYxa,JKay,xy->IJKY', t1_xaae, t1_xvea, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('IYxa,JKya,xy->IJKY', t1_xaae, t1_xvae, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('IYxy,JKxz,yz->IJKY', t1_xaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('IYxy,JKyz,xz->IJKY', t1_xaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('IYxy,JKzx,yz->IJKY', t1_xaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('IYxy,JKzy,xz->IJKY', t1_xaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('Ia,JKax,Yx->IJKY', t1_xe, t1_xvea, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('Ia,JKxa,Yx->IJKY', t1_xe, t1_xvae, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('Ix,JKxy,Yy->IJKY', t1_xa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('Ix,JKyx,Yy->IJKY', t1_xa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('Ixab,JKab,Yx->IJKY', t1_xaee, t1_xvee, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('Ixab,JKba,Yx->IJKY', t1_xaee, t1_xvee, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/2 * einsum('Ixay,JKYa,xy->IJKY', t1_xaea, t1_xvae, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/2 * einsum('Ixay,JKaY,xy->IJKY', t1_xaea, t1_xvea, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('Ixay,JKay,Yx->IJKY', t1_xaea, t1_xvea, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('Ixay,JKaz,Yyzx->IJKY', t1_xaea, t1_xvea, rdm_ccaa, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('Ixay,JKya,Yx->IJKY', t1_xaea, t1_xvae, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('Ixay,JKza,Yyzx->IJKY', t1_xaea, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('Ixya,JKYa,xy->IJKY', t1_xaae, t1_xvae, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('Ixya,JKaY,xy->IJKY', t1_xaae, t1_xvea, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('Ixya,JKay,Yx->IJKY', t1_xaae, t1_xvea, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/12 * einsum('Ixya,JKaz,Yyxz->IJKY', t1_xaae, t1_xvea, rdm_ccaa, optimize = einsum_type)
            T_c_cva -= 1/12 * einsum('Ixya,JKaz,Yyzx->IJKY', t1_xaae, t1_xvea, rdm_ccaa, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('Ixya,JKya,Yx->IJKY', t1_xaae, t1_xvae, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/12 * einsum('Ixya,JKza,Yyxz->IJKY', t1_xaae, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_c_cva += 1/12 * einsum('Ixya,JKza,Yyzx->IJKY', t1_xaae, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_c_cva += 1/2 * einsum('Ixyz,JKYy,xz->IJKY', t1_xaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('Ixyz,JKYz,xy->IJKY', t1_xaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('Ixyz,JKwy,Yzwx->IJKY', t1_xaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_c_cva += 1/12 * einsum('Ixyz,JKwz,Yywx->IJKY', t1_xaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_c_cva -= 1/12 * einsum('Ixyz,JKwz,Yyxw->IJKY', t1_xaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_c_cva -= 1/2 * einsum('Ixyz,JKyY,xz->IJKY', t1_xaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('Ixyz,JKyw,Yzwx->IJKY', t1_xaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('Ixyz,JKyz,Yx->IJKY', t1_xaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('Ixyz,JKzY,xy->IJKY', t1_xaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/12 * einsum('Ixyz,JKzw,Yywx->IJKY', t1_xaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_c_cva += 1/12 * einsum('Ixyz,JKzw,Yyxw->IJKY', t1_xaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('Ixyz,JKzy,Yx->IJKY', t1_xaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T[:ncvs, s_cva__aaa:f_cva__aaa] += T_c_cva.reshape(ncvs, -1)

            T_c_cva =- 1/2 * einsum('IYab,JKab->IJKY', t1_xaee, t1_xvee, optimize = einsum_type)
            T_c_cva -= 1/2 * einsum('IYax,JKax->IJKY', t1_xaea, t1_xvea, optimize = einsum_type)
            T_c_cva -= 1/2 * einsum('IYxa,JKxa->IJKY', t1_xaae, t1_xvae, optimize = einsum_type)
            T_c_cva -= 1/2 * einsum('IYxy,JKxy->IJKY', t1_xaaa, t1_xvaa, optimize = einsum_type)
            T_c_cva -= 1/2 * einsum('Ia,JKaY->IJKY', t1_xe, t1_xvea, optimize = einsum_type)
            T_c_cva -= 1/2 * einsum('Ix,JKxY->IJKY', t1_xa, t1_xvaa, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('IYax,JKay,xy->IJKY', t1_xaea, t1_xvea, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('IYxa,JKya,xy->IJKY', t1_xaae, t1_xvae, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('IYxy,JKxz,yz->IJKY', t1_xaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('IYxy,JKzy,xz->IJKY', t1_xaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('Ia,JKax,Yx->IJKY', t1_xe, t1_xvea, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('Ix,JKxy,Yy->IJKY', t1_xa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('Ixab,JKab,Yx->IJKY', t1_xaee, t1_xvee, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/2 * einsum('Ixay,JKaY,xy->IJKY', t1_xaea, t1_xvea, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('Ixay,JKay,Yx->IJKY', t1_xaea, t1_xvea, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('Ixay,JKaz,Yyzx->IJKY', t1_xaea, t1_xvea, rdm_ccaa, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('Ixya,JKaY,xy->IJKY', t1_xaae, t1_xvea, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/12 * einsum('Ixya,JKaz,Yyxz->IJKY', t1_xaae, t1_xvea, rdm_ccaa, optimize = einsum_type)
            T_c_cva -= 1/6 * einsum('Ixya,JKaz,Yyzx->IJKY', t1_xaae, t1_xvea, rdm_ccaa, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('Ixya,JKya,Yx->IJKY', t1_xaae, t1_xvae, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/6 * einsum('Ixya,JKza,Yyxz->IJKY', t1_xaae, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_c_cva -= 1/12 * einsum('Ixya,JKza,Yyzx->IJKY', t1_xaae, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_c_cva -= 1/12 * einsum('Ixyz,JKwz,Yywx->IJKY', t1_xaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_c_cva -= 1/6 * einsum('Ixyz,JKwz,Yyxw->IJKY', t1_xaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_c_cva -= 1/2 * einsum('Ixyz,JKyY,xz->IJKY', t1_xaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('Ixyz,JKyw,Yzwx->IJKY', t1_xaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('Ixyz,JKyz,Yx->IJKY', t1_xaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/4 * einsum('Ixyz,JKzY,xy->IJKY', t1_xaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/6 * einsum('Ixyz,JKzw,Yywx->IJKY', t1_xaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_c_cva -= 1/12 * einsum('Ixyz,JKzw,Yyxw->IJKY', t1_xaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T[:ncvs, s_cva__abb:f_cva__abb] += T_c_cva.reshape(ncvs, -1)

            T_c_cva  = 1/2 * einsum('IYab,JKba->IJKY', t1_xaee, t1_xvee, optimize = einsum_type)
            T_c_cva += 1/2 * einsum('IYax,JKxa->IJKY', t1_xaea, t1_xvae, optimize = einsum_type)
            T_c_cva += 1/2 * einsum('IYxa,JKax->IJKY', t1_xaae, t1_xvea, optimize = einsum_type)
            T_c_cva += 1/2 * einsum('IYxy,JKyx->IJKY', t1_xaaa, t1_xvaa, optimize = einsum_type)
            T_c_cva += 1/2 * einsum('Ia,JKYa->IJKY', t1_xe, t1_xvae, optimize = einsum_type)
            T_c_cva += 1/2 * einsum('Ix,JKYx->IJKY', t1_xa, t1_xvaa, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('IYax,JKya,xy->IJKY', t1_xaea, t1_xvae, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('IYxa,JKay,xy->IJKY', t1_xaae, t1_xvea, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('IYxy,JKyz,xz->IJKY', t1_xaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('IYxy,JKzx,yz->IJKY', t1_xaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('Ia,JKxa,Yx->IJKY', t1_xe, t1_xvae, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('Ix,JKyx,Yy->IJKY', t1_xa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('Ixab,JKba,Yx->IJKY', t1_xaee, t1_xvee, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/2 * einsum('Ixay,JKYa,xy->IJKY', t1_xaea, t1_xvae, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('Ixay,JKya,Yx->IJKY', t1_xaea, t1_xvae, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('Ixay,JKza,Yyzx->IJKY', t1_xaea, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('Ixya,JKYa,xy->IJKY', t1_xaae, t1_xvae, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('Ixya,JKay,Yx->IJKY', t1_xaae, t1_xvea, rdm_ca, optimize = einsum_type)
            T_c_cva += 1/6 * einsum('Ixya,JKaz,Yyxz->IJKY', t1_xaae, t1_xvea, rdm_ccaa, optimize = einsum_type)
            T_c_cva += 1/12 * einsum('Ixya,JKaz,Yyzx->IJKY', t1_xaae, t1_xvea, rdm_ccaa, optimize = einsum_type)
            T_c_cva += 1/12 * einsum('Ixya,JKza,Yyxz->IJKY', t1_xaae, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_c_cva += 1/6 * einsum('Ixya,JKza,Yyzx->IJKY', t1_xaae, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_c_cva += 1/2 * einsum('Ixyz,JKYy,xz->IJKY', t1_xaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('Ixyz,JKYz,xy->IJKY', t1_xaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('Ixyz,JKwy,Yzwx->IJKY', t1_xaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_c_cva += 1/6 * einsum('Ixyz,JKwz,Yywx->IJKY', t1_xaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_c_cva += 1/12 * einsum('Ixyz,JKwz,Yyxw->IJKY', t1_xaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_c_cva += 1/12 * einsum('Ixyz,JKzw,Yywx->IJKY', t1_xaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_c_cva += 1/6 * einsum('Ixyz,JKzw,Yyxw->IJKY', t1_xaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_c_cva -= 1/4 * einsum('Ixyz,JKzy,Yx->IJKY', t1_xaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T[:ncvs, s_cva__bab:f_cva__bab] += T_c_cva.reshape(ncvs, -1)

        # VALENCE(2) - CVA
        if nval > 0:
            T_v_cva =- 1/2 * einsum('IYab,JKab->IJKY', t1_vaee, t1_xvee, optimize = einsum_type)
            T_v_cva += 1/2 * einsum('IYab,JKba->IJKY', t1_vaee, t1_xvee, optimize = einsum_type)
            T_v_cva -= 1/2 * einsum('IYax,JKax->IJKY', t1_vaea, t1_xvea, optimize = einsum_type)
            T_v_cva += 1/2 * einsum('IYax,JKxa->IJKY', t1_vaea, t1_xvae, optimize = einsum_type)
            T_v_cva += 1/2 * einsum('IYxa,JKax->IJKY', t1_vaae, t1_xvea, optimize = einsum_type)
            T_v_cva -= 1/2 * einsum('IYxa,JKxa->IJKY', t1_vaae, t1_xvae, optimize = einsum_type)
            T_v_cva -= 1/2 * einsum('IYxy,JKxy->IJKY', t1_vaaa, t1_xvaa, optimize = einsum_type)
            T_v_cva += 1/2 * einsum('IYxy,JKyx->IJKY', t1_vaaa, t1_xvaa, optimize = einsum_type)
            T_v_cva += 1/2 * einsum('Ia,JKYa->IJKY', t1_ve, t1_xvae, optimize = einsum_type)
            T_v_cva -= 1/2 * einsum('Ia,JKaY->IJKY', t1_ve, t1_xvea, optimize = einsum_type)
            T_v_cva += 1/2 * einsum('Ix,JKYx->IJKY', t1_va, t1_xvaa, optimize = einsum_type)
            T_v_cva -= 1/2 * einsum('Ix,JKxY->IJKY', t1_va, t1_xvaa, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('IYax,JKay,xy->IJKY', t1_vaea, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('IYax,JKya,xy->IJKY', t1_vaea, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('IYxa,JKay,xy->IJKY', t1_vaae, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('IYxa,JKya,xy->IJKY', t1_vaae, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('IYxy,JKxz,yz->IJKY', t1_vaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('IYxy,JKyz,xz->IJKY', t1_vaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('IYxy,JKzx,yz->IJKY', t1_vaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('IYxy,JKzy,xz->IJKY', t1_vaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('Ia,JKax,Yx->IJKY', t1_ve, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('Ia,JKxa,Yx->IJKY', t1_ve, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('Ix,JKxy,Yy->IJKY', t1_va, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('Ix,JKyx,Yy->IJKY', t1_va, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('Ixab,JKab,Yx->IJKY', t1_vaee, t1_xvee, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('Ixab,JKba,Yx->IJKY', t1_vaee, t1_xvee, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/2 * einsum('Ixay,JKYa,xy->IJKY', t1_vaea, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/2 * einsum('Ixay,JKaY,xy->IJKY', t1_vaea, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('Ixay,JKay,Yx->IJKY', t1_vaea, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('Ixay,JKaz,Yyzx->IJKY', t1_vaea, t1_xvea, rdm_ccaa, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('Ixay,JKya,Yx->IJKY', t1_vaea, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('Ixay,JKza,Yyzx->IJKY', t1_vaea, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('Ixya,JKYa,xy->IJKY', t1_vaae, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('Ixya,JKaY,xy->IJKY', t1_vaae, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('Ixya,JKay,Yx->IJKY', t1_vaae, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/12 * einsum('Ixya,JKaz,Yyxz->IJKY', t1_vaae, t1_xvea, rdm_ccaa, optimize = einsum_type)
            T_v_cva -= 1/12 * einsum('Ixya,JKaz,Yyzx->IJKY', t1_vaae, t1_xvea, rdm_ccaa, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('Ixya,JKya,Yx->IJKY', t1_vaae, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/12 * einsum('Ixya,JKza,Yyxz->IJKY', t1_vaae, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_v_cva += 1/12 * einsum('Ixya,JKza,Yyzx->IJKY', t1_vaae, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_v_cva += 1/2 * einsum('Ixyz,JKYy,xz->IJKY', t1_vaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('Ixyz,JKYz,xy->IJKY', t1_vaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('Ixyz,JKwy,Yzwx->IJKY', t1_vaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_cva += 1/12 * einsum('Ixyz,JKwz,Yywx->IJKY', t1_vaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_cva -= 1/12 * einsum('Ixyz,JKwz,Yyxw->IJKY', t1_vaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_cva -= 1/2 * einsum('Ixyz,JKyY,xz->IJKY', t1_vaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('Ixyz,JKyw,Yzwx->IJKY', t1_vaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('Ixyz,JKyz,Yx->IJKY', t1_vaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('Ixyz,JKzY,xy->IJKY', t1_vaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/12 * einsum('Ixyz,JKzw,Yywx->IJKY', t1_vaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_cva += 1/12 * einsum('Ixyz,JKzw,Yyxw->IJKY', t1_vaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('Ixyz,JKzy,Yx->IJKY', t1_vaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T[ncvs:ncore, s_cva__aaa:f_cva__aaa] += T_v_cva.reshape(nval, -1)

            T_v_cva =- 1/2 * einsum('IYab,JKab->IJKY', t1_vaee, t1_xvee, optimize = einsum_type)
            T_v_cva -= 1/2 * einsum('IYax,JKax->IJKY', t1_vaea, t1_xvea, optimize = einsum_type)
            T_v_cva -= 1/2 * einsum('IYxa,JKxa->IJKY', t1_vaae, t1_xvae, optimize = einsum_type)
            T_v_cva -= 1/2 * einsum('IYxy,JKxy->IJKY', t1_vaaa, t1_xvaa, optimize = einsum_type)
            T_v_cva -= 1/2 * einsum('Ia,JKaY->IJKY', t1_ve, t1_xvea, optimize = einsum_type)
            T_v_cva -= 1/2 * einsum('Ix,JKxY->IJKY', t1_va, t1_xvaa, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('IYax,JKay,xy->IJKY', t1_vaea, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('IYxa,JKya,xy->IJKY', t1_vaae, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('IYxy,JKxz,yz->IJKY', t1_vaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('IYxy,JKzy,xz->IJKY', t1_vaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('Ia,JKax,Yx->IJKY', t1_ve, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('Ix,JKxy,Yy->IJKY', t1_va, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('Ixab,JKab,Yx->IJKY', t1_vaee, t1_xvee, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/2 * einsum('Ixay,JKaY,xy->IJKY', t1_vaea, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('Ixay,JKay,Yx->IJKY', t1_vaea, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('Ixay,JKaz,Yyzx->IJKY', t1_vaea, t1_xvea, rdm_ccaa, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('Ixya,JKaY,xy->IJKY', t1_vaae, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/12 * einsum('Ixya,JKaz,Yyxz->IJKY', t1_vaae, t1_xvea, rdm_ccaa, optimize = einsum_type)
            T_v_cva -= 1/6 * einsum('Ixya,JKaz,Yyzx->IJKY', t1_vaae, t1_xvea, rdm_ccaa, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('Ixya,JKya,Yx->IJKY', t1_vaae, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/6 * einsum('Ixya,JKza,Yyxz->IJKY', t1_vaae, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_v_cva -= 1/12 * einsum('Ixya,JKza,Yyzx->IJKY', t1_vaae, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_v_cva -= 1/12 * einsum('Ixyz,JKwz,Yywx->IJKY', t1_vaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_cva -= 1/6 * einsum('Ixyz,JKwz,Yyxw->IJKY', t1_vaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_cva -= 1/2 * einsum('Ixyz,JKyY,xz->IJKY', t1_vaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('Ixyz,JKyw,Yzwx->IJKY', t1_vaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('Ixyz,JKyz,Yx->IJKY', t1_vaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/4 * einsum('Ixyz,JKzY,xy->IJKY', t1_vaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/6 * einsum('Ixyz,JKzw,Yywx->IJKY', t1_vaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_cva -= 1/12 * einsum('Ixyz,JKzw,Yyxw->IJKY', t1_vaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T[ncvs:ncore, s_cva__abb:f_cva__abb] += T_v_cva.reshape(nval, -1)

            T_v_cva  = 1/2 * einsum('IYab,JKba->IJKY', t1_vaee, t1_xvee, optimize = einsum_type)
            T_v_cva += 1/2 * einsum('IYax,JKxa->IJKY', t1_vaea, t1_xvae, optimize = einsum_type)
            T_v_cva += 1/2 * einsum('IYxa,JKax->IJKY', t1_vaae, t1_xvea, optimize = einsum_type)
            T_v_cva += 1/2 * einsum('IYxy,JKyx->IJKY', t1_vaaa, t1_xvaa, optimize = einsum_type)
            T_v_cva += 1/2 * einsum('Ia,JKYa->IJKY', t1_ve, t1_xvae, optimize = einsum_type)
            T_v_cva += 1/2 * einsum('Ix,JKYx->IJKY', t1_va, t1_xvaa, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('IYax,JKya,xy->IJKY', t1_vaea, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('IYxa,JKay,xy->IJKY', t1_vaae, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('IYxy,JKyz,xz->IJKY', t1_vaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('IYxy,JKzx,yz->IJKY', t1_vaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('Ia,JKxa,Yx->IJKY', t1_ve, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('Ix,JKyx,Yy->IJKY', t1_va, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('Ixab,JKba,Yx->IJKY', t1_vaee, t1_xvee, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/2 * einsum('Ixay,JKYa,xy->IJKY', t1_vaea, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('Ixay,JKya,Yx->IJKY', t1_vaea, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('Ixay,JKza,Yyzx->IJKY', t1_vaea, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('Ixya,JKYa,xy->IJKY', t1_vaae, t1_xvae, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('Ixya,JKay,Yx->IJKY', t1_vaae, t1_xvea, rdm_ca, optimize = einsum_type)
            T_v_cva += 1/6 * einsum('Ixya,JKaz,Yyxz->IJKY', t1_vaae, t1_xvea, rdm_ccaa, optimize = einsum_type)
            T_v_cva += 1/12 * einsum('Ixya,JKaz,Yyzx->IJKY', t1_vaae, t1_xvea, rdm_ccaa, optimize = einsum_type)
            T_v_cva += 1/12 * einsum('Ixya,JKza,Yyxz->IJKY', t1_vaae, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_v_cva += 1/6 * einsum('Ixya,JKza,Yyzx->IJKY', t1_vaae, t1_xvae, rdm_ccaa, optimize = einsum_type)
            T_v_cva += 1/2 * einsum('Ixyz,JKYy,xz->IJKY', t1_vaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('Ixyz,JKYz,xy->IJKY', t1_vaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('Ixyz,JKwy,Yzwx->IJKY', t1_vaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_cva += 1/6 * einsum('Ixyz,JKwz,Yywx->IJKY', t1_vaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_cva += 1/12 * einsum('Ixyz,JKwz,Yyxw->IJKY', t1_vaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_cva += 1/12 * einsum('Ixyz,JKzw,Yywx->IJKY', t1_vaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_cva += 1/6 * einsum('Ixyz,JKzw,Yyxw->IJKY', t1_vaaa, t1_xvaa, rdm_ccaa, optimize = einsum_type)
            T_v_cva -= 1/4 * einsum('Ixyz,JKzy,Yx->IJKY', t1_vaaa, t1_xvaa, rdm_ca, optimize = einsum_type)
            T[ncvs:ncore, s_cva__bab:f_cva__bab] += T_v_cva.reshape(nval, -1)

        # ACTIVE(2) - CAA
        T_a_caa  = 1/2 * einsum('JX,YZ->XJYZ', t2_xa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JxXZ,Yx->XJYZ', t2_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JxXy,YyZx->XJYZ', t2_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/2 * einsum('JxZX,Yx->XJYZ', t2_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('JxyX,YyZx->XJYZ', t2_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('JxyX,YyxZ->XJYZ', t2_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Ja,XZax,Yx->XJYZ', t1_xe, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Ja,Xa,YZ->XJYZ', t1_xe, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Ja,Xxay,YxZy->XJYZ', t1_xe, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Ja,ZXax,Yx->XJYZ', t1_xe, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Ja,xXay,YxZy->XJYZ', t1_xe, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Ja,xXay,YxyZ->XJYZ', t1_xe, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXZ,ix,Yx->XJYZ', t1_xxaa, t1_xa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXZ,ixyz,Yxyz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiXx,ix,YZ->XJYZ', t1_xxaa, t1_xa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXx,iy,YxZy->XJYZ', t1_xxaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiXx,iZxy,Yy->XJYZ', t1_xxaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXx,iZyx,Yy->XJYZ', t1_xxaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXx,iZyz,Yxzy->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiXx,iyxz,YyZz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JiXx,iyzw,YxyZwz->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 5/24 * einsum('JiXx,iyzw,YxyZzw->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JiXx,iyzw,YxywZz->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JiXx,iyzw,YxywzZ->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JiXx,iyzw,YxyzZw->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JiXx,iyzw,YxyzwZ->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXx,iyzx,YyZz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JiZX,ix,Yx->XJYZ', t1_xxaa, t1_xa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JiZX,ixyz,Yxyz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiZx,iXxy,Yy->XJYZ', t1_xxaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiZx,iXyx,Yy->XJYZ', t1_xxaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiZx,iXyz,Yxzy->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiaX,iZax,Yx->XJYZ', t1_xxea, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JiaX,iZxa,Yx->XJYZ', t1_xxea, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiaX,ixay,YxZy->XJYZ', t1_xxea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JiaX,ixya,YxZy->XJYZ', t1_xxea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JiaX,ixya,YxyZ->XJYZ', t1_xxea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiaX,ia,YZ->XJYZ', t1_xxea, t1_xe, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiaZ,iXax,Yx->XJYZ', t1_xxea, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JiaZ,iXxa,Yx->XJYZ', t1_xxea, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jiab,iXab,YZ->XJYZ', t1_xxee, t1_xaee, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/2 * einsum('Jiab,iXba,YZ->XJYZ', t1_xxee, t1_xaee, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jiax,iXax,YZ->XJYZ', t1_xxea, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jiax,iXay,YxZy->XJYZ', t1_xxea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jiax,iXay,YxyZ->XJYZ', t1_xxea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/2 * einsum('Jiax,iXxa,YZ->XJYZ', t1_xxea, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jiax,iXya,YxZy->XJYZ', t1_xxea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JixX,ix,YZ->XJYZ', t1_xxaa, t1_xa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JixX,iy,YxZy->XJYZ', t1_xxaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JixX,iy,YxyZ->XJYZ', t1_xxaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JixX,iZxy,Yy->XJYZ', t1_xxaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JixX,iZyx,Yy->XJYZ', t1_xxaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JixX,iZyz,Yxyz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JixX,iZyz,Yxzy->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JixX,iyxz,YyZz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JixX,iyzw,YxyZzw->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JixX,iyzw,YxyzZw->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JixX,iyzx,YyZz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JixX,iyzx,YyzZ->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JixZ,iXxy,Yy->XJYZ', t1_xxaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JixZ,iXyx,Yy->XJYZ', t1_xxaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JixZ,iXyz,Yxyz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JixZ,iXyz,Yxzy->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jixy,iXxy,YZ->XJYZ', t1_xxaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jixy,iXxz,YyZz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jixy,iXxz,YyzZ->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/2 * einsum('Jixy,iXyx,YZ->XJYZ', t1_xxaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('Jixy,iXyz,YxZz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('Jixy,iXyz,YxzZ->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jixy,iXzw,YxyZwz->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jixy,iXzw,YxywZz->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jixy,iXzx,YyZz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jixy,iXzy,YxZz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jixy,iXzy,YxzZ->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXZ,ix,Yx->XJYZ', t1_xvaa, t1_va, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXZ,ixyz,Yxyz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiXa,iZax,Yx->XJYZ', t1_xvae, t1_vaea, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXa,iZxa,Yx->XJYZ', t1_xvae, t1_vaae, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiXa,ia,YZ->XJYZ', t1_xvae, t1_ve, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiXa,ixay,YxZy->XJYZ', t1_xvae, t1_vaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXa,ixya,YxZy->XJYZ', t1_xvae, t1_vaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiXx,iZxy,Yy->XJYZ', t1_xvaa, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXx,iZyx,Yy->XJYZ', t1_xvaa, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXx,iZyz,Yxzy->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiXx,ix,YZ->XJYZ', t1_xvaa, t1_va, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXx,iy,YxZy->XJYZ', t1_xvaa, t1_va, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiXx,iyxz,YyZz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JiXx,iyzw,YxyZwz->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 5/24 * einsum('JiXx,iyzw,YxyZzw->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JiXx,iyzw,YxywZz->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JiXx,iyzw,YxywzZ->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JiXx,iyzw,YxyzZw->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JiXx,iyzw,YxyzwZ->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXx,iyzx,YyZz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JiZX,ix,Yx->XJYZ', t1_xvaa, t1_va, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JiZX,ixyz,Yxyz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiZa,iXax,Yx->XJYZ', t1_xvae, t1_vaea, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiZa,iXxa,Yx->XJYZ', t1_xvae, t1_vaae, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiZx,iXxy,Yy->XJYZ', t1_xvaa, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiZx,iXyx,Yy->XJYZ', t1_xvaa, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiZx,iXyz,Yxzy->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiaX,iZax,Yx->XJYZ', t1_xvea, t1_vaea, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JiaX,iZxa,Yx->XJYZ', t1_xvea, t1_vaae, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiaX,ia,YZ->XJYZ', t1_xvea, t1_ve, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiaX,ixay,YxZy->XJYZ', t1_xvea, t1_vaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JiaX,ixya,YxZy->XJYZ', t1_xvea, t1_vaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JiaX,ixya,YxyZ->XJYZ', t1_xvea, t1_vaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiaZ,iXax,Yx->XJYZ', t1_xvea, t1_vaea, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JiaZ,iXxa,Yx->XJYZ', t1_xvea, t1_vaae, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jiab,iXab,YZ->XJYZ', t1_xvee, t1_vaee, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/2 * einsum('Jiab,iXba,YZ->XJYZ', t1_xvee, t1_vaee, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jiax,iXax,YZ->XJYZ', t1_xvea, t1_vaea, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jiax,iXay,YxZy->XJYZ', t1_xvea, t1_vaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jiax,iXay,YxyZ->XJYZ', t1_xvea, t1_vaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/2 * einsum('Jiax,iXxa,YZ->XJYZ', t1_xvea, t1_vaae, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jiax,iXya,YxZy->XJYZ', t1_xvea, t1_vaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JixX,iZxy,Yy->XJYZ', t1_xvaa, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JixX,iZyx,Yy->XJYZ', t1_xvaa, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JixX,iZyz,Yxyz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JixX,iZyz,Yxzy->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JixX,ix,YZ->XJYZ', t1_xvaa, t1_va, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JixX,iy,YxZy->XJYZ', t1_xvaa, t1_va, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JixX,iy,YxyZ->XJYZ', t1_xvaa, t1_va, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JixX,iyxz,YyZz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JixX,iyzw,YxyZzw->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JixX,iyzw,YxyzZw->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JixX,iyzx,YyZz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JixX,iyzx,YyzZ->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JixZ,iXxy,Yy->XJYZ', t1_xvaa, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JixZ,iXyx,Yy->XJYZ', t1_xvaa, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JixZ,iXyz,Yxyz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JixZ,iXyz,Yxzy->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/2 * einsum('Jixa,iXax,YZ->XJYZ', t1_xvae, t1_vaea, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('Jixa,iXay,YxZy->XJYZ', t1_xvae, t1_vaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('Jixa,iXay,YxyZ->XJYZ', t1_xvae, t1_vaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jixa,iXxa,YZ->XJYZ', t1_xvae, t1_vaae, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jixa,iXya,YxZy->XJYZ', t1_xvae, t1_vaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jixa,iXya,YxyZ->XJYZ', t1_xvae, t1_vaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jixy,iXxy,YZ->XJYZ', t1_xvaa, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jixy,iXxz,YyZz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jixy,iXxz,YyzZ->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/2 * einsum('Jixy,iXyx,YZ->XJYZ', t1_xvaa, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('Jixy,iXyz,YxZz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('Jixy,iXyz,YxzZ->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jixy,iXzw,YxyZwz->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jixy,iXzw,YxywZz->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jixy,iXzx,YyZz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jixy,iXzy,YxZz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jixy,iXzy,YxzZ->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JxXa,Za,Yx->XJYZ', t1_xaae, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JxXa,ya,YyZx->XJYZ', t1_xaae, t1_ae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JxXa,Zyaz,Yyxz->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JxXa,yZaz,Yyzx->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JxXa,yzaw,YyzZwx->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 5/24 * einsum('JxXa,yzaw,YyzZxw->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JxXa,yzaw,YyzwZx->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JxXa,yzaw,YyzwxZ->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JxXa,yzaw,YyzxZw->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JxXa,yzaw,YyzxwZ->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JxZa,Xa,Yx->XJYZ', t1_xaae, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JxZa,Xyaz,Yyxz->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JxZa,yXaz,Yyzx->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JxaX,Za,Yx->XJYZ', t1_xaea, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JxaX,ya,YyZx->XJYZ', t1_xaea, t1_ae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JxaX,ya,YyxZ->XJYZ', t1_xaea, t1_ae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JxaX,Zyaz,Yyxz->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JxaX,yZaz,Yyxz->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JxaX,yZaz,Yyzx->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JxaX,yzaw,YyzZxw->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JxaX,yzaw,YyzxZw->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JxaZ,Xa,Yx->XJYZ', t1_xaea, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JxaZ,Xyaz,Yyxz->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JxaZ,yXaz,Yyxz->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JxaZ,yXaz,Yyzx->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Jxab,XZab,Yx->XJYZ', t1_xaee, t1_aaee, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jxab,XZba,Yx->XJYZ', t1_xaee, t1_aaee, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Jxab,Xyab,YyZx->XJYZ', t1_xaee, t1_aaee, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxab,Xyba,YyZx->XJYZ', t1_xaee, t1_aaee, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxab,Xyba,YyxZ->XJYZ', t1_xaee, t1_aaee, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Jxay,Xa,YyZx->XJYZ', t1_xaea, t1_ae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Jxay,XZay,Yx->XJYZ', t1_xaea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Jxay,XZaz,Yyzx->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Jxay,Xzaw,YyzZxw->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Jxay,Xzay,YzZx->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jxay,ZXay,Yx->XJYZ', t1_xaea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jxay,ZXaz,Yyzx->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxay,zXaw,YyzZxw->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxay,zXaw,YyzwxZ->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxay,zXay,YzZx->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxay,zXay,YzxZ->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxya,Xa,YyZx->XJYZ', t1_xaae, t1_ae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxya,Xa,YyxZ->XJYZ', t1_xaae, t1_ae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jxya,XZay,Yx->XJYZ', t1_xaae, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxya,XZaz,Yyxz->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxya,XZaz,Yyzx->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxya,Xzaw,YyzZxw->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxya,Xzaw,YyzxZw->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxya,Xzay,YzZx->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxya,Xzay,YzxZ->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Jxya,ZXay,Yx->XJYZ', t1_xaae, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxya,ZXaz,Yyxz->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxya,ZXaz,Yyzx->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxya,zXaw,YyzZwx->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxya,zXaw,YyzwZx->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Jxya,zXay,YzZx->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('iJaX,iZax,Yx->XJYZ', t1_xxea, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('iJaX,iZxa,Yx->XJYZ', t1_xxea, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('iJaX,ixay,YxZy->XJYZ', t1_xxea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('iJaX,ixya,YxZy->XJYZ', t1_xxea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('iJaX,ia,YZ->XJYZ', t1_xxea, t1_xe, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('iJaZ,iXax,Yx->XJYZ', t1_xxea, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('iJaZ,iXxa,Yx->XJYZ', t1_xxea, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/2 * einsum('iJax,iXax,YZ->XJYZ', t1_xxea, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('iJax,iXay,YxZy->XJYZ', t1_xxea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('iJax,iXay,YxyZ->XJYZ', t1_xxea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('iJax,iXxa,YZ->XJYZ', t1_xxea, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('iJax,iXya,YxZy->XJYZ', t1_xxea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('iJax,iXya,YxyZ->XJYZ', t1_xxea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T[ncore:nocc, s_caa__aaa:f_caa__aaa] += T_a_caa.reshape(ncas, -1)

        T_a_caa  = 1/2 * einsum('JX,YZ->XJYZ', t2_xa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JxXZ,Yx->XJYZ', t2_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JxXy,YyZx->XJYZ', t2_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/3 * einsum('JxyX,YyZx->XJYZ', t2_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('JxyX,YyxZ->XJYZ', t2_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Ja,XZax,Yx->XJYZ', t1_xe, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Ja,Xa,YZ->XJYZ', t1_xe, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Ja,Xxay,YxZy->XJYZ', t1_xe, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('Ja,xXay,YxZy->XJYZ', t1_xe, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Ja,xXay,YxyZ->XJYZ', t1_xe, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXZ,ix,Yx->XJYZ', t1_xxaa, t1_xa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXZ,ixyz,Yxyz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiXx,ix,YZ->XJYZ', t1_xxaa, t1_xa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXx,iy,YxZy->XJYZ', t1_xxaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiXx,iZxy,Yy->XJYZ', t1_xxaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXx,iZyx,Yy->XJYZ', t1_xxaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXx,iZyz,Yxzy->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiXx,iyxz,YyZz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JiXx,iyzw,YxyZwz->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 5/24 * einsum('JiXx,iyzw,YxyZzw->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JiXx,iyzw,YxywZz->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JiXx,iyzw,YxywzZ->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JiXx,iyzw,YxyzZw->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JiXx,iyzw,YxyzwZ->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXx,iyzx,YyZz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiaX,iZax,Yx->XJYZ', t1_xxea, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiaX,ixay,YxZy->XJYZ', t1_xxea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('JiaX,ixya,YxZy->XJYZ', t1_xxea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JiaX,ixya,YxyZ->XJYZ', t1_xxea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiaX,ia,YZ->XJYZ', t1_xxea, t1_xe, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JiaZ,iXxa,Yx->XJYZ', t1_xxea, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jiab,iXab,YZ->XJYZ', t1_xxee, t1_xaee, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/2 * einsum('Jiab,iXba,YZ->XJYZ', t1_xxee, t1_xaee, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jiax,iXax,YZ->XJYZ', t1_xxea, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('Jiax,iXay,YxZy->XJYZ', t1_xxea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jiax,iXay,YxyZ->XJYZ', t1_xxea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/2 * einsum('Jiax,iXxa,YZ->XJYZ', t1_xxea, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jiax,iXya,YxZy->XJYZ', t1_xxea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JixX,ix,YZ->XJYZ', t1_xxaa, t1_xa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('JixX,iy,YxZy->XJYZ', t1_xxaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JixX,iy,YxyZ->XJYZ', t1_xxaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JixX,iZxy,Yy->XJYZ', t1_xxaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JixX,iZyz,Yxyz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('JixX,iZyz,Yxzy->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JixX,iyxz,YyZz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JixX,iyzw,YxyZwz->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/8 * einsum('JixX,iyzw,YxyZzw->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JixX,iyzw,YxywZz->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JixX,iyzw,YxywzZ->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JixX,iyzw,YxyzZw->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JixX,iyzw,YxyzwZ->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('JixX,iyzx,YyZz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JixX,iyzx,YyzZ->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JixZ,iXyx,Yy->XJYZ', t1_xxaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('JixZ,iXyz,Yxyz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JixZ,iXyz,Yxzy->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jixy,iXxy,YZ->XJYZ', t1_xxaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('Jixy,iXxz,YyZz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jixy,iXxz,YyzZ->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/2 * einsum('Jixy,iXyx,YZ->XJYZ', t1_xxaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/3 * einsum('Jixy,iXyz,YxZz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('Jixy,iXyz,YxzZ->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/8 * einsum('Jixy,iXzw,YxyZwz->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('Jixy,iXzw,YxyZzw->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('Jixy,iXzw,YxywZz->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('Jixy,iXzw,YxywzZ->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('Jixy,iXzw,YxyzZw->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('Jixy,iXzw,YxyzwZ->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jixy,iXzx,YyZz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('Jixy,iXzy,YxZz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jixy,iXzy,YxzZ->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXZ,ix,Yx->XJYZ', t1_xvaa, t1_va, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXZ,ixyz,Yxyz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiXa,iZax,Yx->XJYZ', t1_xvae, t1_vaea, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXa,iZxa,Yx->XJYZ', t1_xvae, t1_vaae, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiXa,ia,YZ->XJYZ', t1_xvae, t1_ve, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiXa,ixay,YxZy->XJYZ', t1_xvae, t1_vaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXa,ixya,YxZy->XJYZ', t1_xvae, t1_vaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiXx,iZxy,Yy->XJYZ', t1_xvaa, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXx,iZyx,Yy->XJYZ', t1_xvaa, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXx,iZyz,Yxzy->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiXx,ix,YZ->XJYZ', t1_xvaa, t1_va, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXx,iy,YxZy->XJYZ', t1_xvaa, t1_va, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiXx,iyxz,YyZz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JiXx,iyzw,YxyZwz->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 5/24 * einsum('JiXx,iyzw,YxyZzw->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JiXx,iyzw,YxywZz->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JiXx,iyzw,YxywzZ->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JiXx,iyzw,YxyzZw->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JiXx,iyzw,YxyzwZ->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiXx,iyzx,YyZz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiaX,iZax,Yx->XJYZ', t1_xvea, t1_vaea, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiaX,ia,YZ->XJYZ', t1_xvea, t1_ve, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiaX,ixay,YxZy->XJYZ', t1_xvea, t1_vaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('JiaX,ixya,YxZy->XJYZ', t1_xvea, t1_vaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JiaX,ixya,YxyZ->XJYZ', t1_xvea, t1_vaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JiaZ,iXxa,Yx->XJYZ', t1_xvea, t1_vaae, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jiab,iXab,YZ->XJYZ', t1_xvee, t1_vaee, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/2 * einsum('Jiab,iXba,YZ->XJYZ', t1_xvee, t1_vaee, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jiax,iXax,YZ->XJYZ', t1_xvea, t1_vaea, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('Jiax,iXay,YxZy->XJYZ', t1_xvea, t1_vaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jiax,iXay,YxyZ->XJYZ', t1_xvea, t1_vaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/2 * einsum('Jiax,iXxa,YZ->XJYZ', t1_xvea, t1_vaae, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jiax,iXya,YxZy->XJYZ', t1_xvea, t1_vaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JixX,iZxy,Yy->XJYZ', t1_xvaa, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JixX,iZyz,Yxyz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('JixX,iZyz,Yxzy->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JixX,ix,YZ->XJYZ', t1_xvaa, t1_va, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('JixX,iy,YxZy->XJYZ', t1_xvaa, t1_va, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JixX,iy,YxyZ->XJYZ', t1_xvaa, t1_va, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JixX,iyxz,YyZz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JixX,iyzw,YxyZwz->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/8 * einsum('JixX,iyzw,YxyZzw->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JixX,iyzw,YxywZz->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JixX,iyzw,YxywzZ->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JixX,iyzw,YxyzZw->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JixX,iyzw,YxyzwZ->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('JixX,iyzx,YyZz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JixX,iyzx,YyzZ->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JixZ,iXyx,Yy->XJYZ', t1_xvaa, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('JixZ,iXyz,Yxyz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JixZ,iXyz,Yxzy->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/2 * einsum('Jixa,iXax,YZ->XJYZ', t1_xvae, t1_vaea, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/3 * einsum('Jixa,iXay,YxZy->XJYZ', t1_xvae, t1_vaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('Jixa,iXay,YxyZ->XJYZ', t1_xvae, t1_vaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jixa,iXxa,YZ->XJYZ', t1_xvae, t1_vaae, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('Jixa,iXya,YxZy->XJYZ', t1_xvae, t1_vaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jixa,iXya,YxyZ->XJYZ', t1_xvae, t1_vaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jixy,iXxy,YZ->XJYZ', t1_xvaa, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('Jixy,iXxz,YyZz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jixy,iXxz,YyzZ->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/2 * einsum('Jixy,iXyx,YZ->XJYZ', t1_xvaa, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/3 * einsum('Jixy,iXyz,YxZz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('Jixy,iXyz,YxzZ->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/8 * einsum('Jixy,iXzw,YxyZwz->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('Jixy,iXzw,YxyZzw->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('Jixy,iXzw,YxywZz->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('Jixy,iXzw,YxywzZ->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('Jixy,iXzw,YxyzZw->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('Jixy,iXzw,YxyzwZ->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jixy,iXzx,YyZz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('Jixy,iXzy,YxZz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jixy,iXzy,YxzZ->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JxXa,Za,Yx->XJYZ', t1_xaae, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JxXa,ya,YyZx->XJYZ', t1_xaae, t1_ae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JxXa,Zyaz,Yyxz->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JxXa,yZaz,Yyzx->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JxXa,yzaw,YyzZwx->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 5/24 * einsum('JxXa,yzaw,YyzZxw->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JxXa,yzaw,YyzwZx->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JxXa,yzaw,YyzwxZ->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JxXa,yzaw,YyzxZw->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JxXa,yzaw,YyzxwZ->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('JxaX,ya,YyZx->XJYZ', t1_xaea, t1_ae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JxaX,ya,YyxZ->XJYZ', t1_xaea, t1_ae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JxaX,yZaz,Yyxz->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('JxaX,yZaz,Yyzx->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JxaX,yzaw,YyzZwx->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/8 * einsum('JxaX,yzaw,YyzZxw->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JxaX,yzaw,YyzwZx->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JxaX,yzaw,YyzwxZ->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JxaX,yzaw,YyzxZw->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JxaX,yzaw,YyzxwZ->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JxaZ,Xa,Yx->XJYZ', t1_xaea, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JxaZ,Xyaz,Yyxz->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('JxaZ,yXaz,Yyxz->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JxaZ,yXaz,Yyzx->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Jxab,XZab,Yx->XJYZ', t1_xaee, t1_aaee, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Jxab,Xyab,YyZx->XJYZ', t1_xaee, t1_aaee, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('Jxab,Xyba,YyZx->XJYZ', t1_xaee, t1_aaee, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxab,Xyba,YyxZ->XJYZ', t1_xaee, t1_aaee, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Jxay,Xa,YyZx->XJYZ', t1_xaea, t1_ae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Jxay,XZay,Yx->XJYZ', t1_xaea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Jxay,XZaz,Yyzx->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Jxay,Xzaw,YyzZxw->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Jxay,Xzay,YzZx->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('Jxay,zXaw,YyzZxw->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxay,zXaw,YyzwxZ->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('Jxay,zXay,YzZx->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxay,zXay,YzxZ->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('Jxya,Xa,YyZx->XJYZ', t1_xaae, t1_ae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxya,Xa,YyxZ->XJYZ', t1_xaae, t1_ae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxya,XZaz,Yyxz->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('Jxya,XZaz,Yyzx->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('Jxya,Xzaw,YyzZxw->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxya,Xzaw,YyzxZw->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('Jxya,Xzay,YzZx->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxya,Xzay,YzxZ->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Jxya,ZXay,Yx->XJYZ', t1_xaae, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('Jxya,ZXaz,Yyxz->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxya,ZXaz,Yyzx->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxya,zXaw,YyzZwx->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxya,zXaw,YyzZxw->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxya,zXaw,YyzwxZ->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxya,zXaw,YyzxZw->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxya,zXaw,YyzxwZ->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Jxya,zXay,YzZx->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('iJaX,iZax,Yx->XJYZ', t1_xxea, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('iJaX,iZxa,Yx->XJYZ', t1_xxea, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('iJaX,ixay,YxZy->XJYZ', t1_xxea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('iJaX,ixya,YxZy->XJYZ', t1_xxea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('iJaX,ia,YZ->XJYZ', t1_xxea, t1_xe, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/2 * einsum('iJax,iXax,YZ->XJYZ', t1_xxea, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/3 * einsum('iJax,iXay,YxZy->XJYZ', t1_xxea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('iJax,iXay,YxyZ->XJYZ', t1_xxea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('iJax,iXxa,YZ->XJYZ', t1_xxea, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('iJax,iXya,YxZy->XJYZ', t1_xxea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('iJax,iXya,YxyZ->XJYZ', t1_xxea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T[ncore:nocc, s_caa__abb:f_caa__abb] += T_a_caa.reshape(ncas, -1)

        T_a_caa =- 1/2 * einsum('JxZX,Yx->XJYZ', t2_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('JxyX,YyZx->XJYZ', t2_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/3 * einsum('JxyX,YyxZ->XJYZ', t2_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Ja,ZXax,Yx->XJYZ', t1_xe, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Ja,xXay,YxZy->XJYZ', t1_xe, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('Ja,xXay,YxyZ->XJYZ', t1_xe, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JiZX,ix,Yx->XJYZ', t1_xxaa, t1_xa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JiZX,ixyz,Yxyz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiZx,iXxy,Yy->XJYZ', t1_xxaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiZx,iXyx,Yy->XJYZ', t1_xxaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiZx,iXyz,Yxzy->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JiaX,iZxa,Yx->XJYZ', t1_xxea, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JiaX,ixya,YxZy->XJYZ', t1_xxea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('JiaX,ixya,YxyZ->XJYZ', t1_xxea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiaZ,iXax,Yx->XJYZ', t1_xxea, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jiax,iXay,YxZy->XJYZ', t1_xxea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('Jiax,iXay,YxyZ->XJYZ', t1_xxea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JixX,iy,YxZy->XJYZ', t1_xxaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('JixX,iy,YxyZ->XJYZ', t1_xxaa, t1_xa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JixX,iZyx,Yy->XJYZ', t1_xxaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('JixX,iZyz,Yxyz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JixX,iZyz,Yxzy->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JixX,iyzw,YxyZwz->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JixX,iyzw,YxyZzw->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JixX,iyzw,YxywZz->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JixX,iyzw,YxywzZ->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/8 * einsum('JixX,iyzw,YxyzZw->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JixX,iyzw,YxyzwZ->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JixX,iyzx,YyZz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('JixX,iyzx,YyzZ->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JixZ,iXxy,Yy->XJYZ', t1_xxaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JixZ,iXyz,Yxyz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('JixZ,iXyz,Yxzy->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jixy,iXxz,YyZz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('Jixy,iXxz,YyzZ->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('Jixy,iXyz,YxZz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/3 * einsum('Jixy,iXyz,YxzZ->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('Jixy,iXzw,YxyZwz->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('Jixy,iXzw,YxyZzw->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/8 * einsum('Jixy,iXzw,YxywZz->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('Jixy,iXzw,YxywzZ->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('Jixy,iXzw,YxyzZw->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('Jixy,iXzw,YxyzwZ->XJYZ', t1_xxaa, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jixy,iXzy,YxZz->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('Jixy,iXzy,YxzZ->XJYZ', t1_xxaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JiZX,ix,Yx->XJYZ', t1_xvaa, t1_va, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JiZX,ixyz,Yxyz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 3/8 * einsum('JiZa,iXax,Yx->XJYZ', t1_xvae, t1_vaea, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiZa,iXxa,Yx->XJYZ', t1_xvae, t1_vaae, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('JiZx,iXxy,Yy->XJYZ', t1_xvaa, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiZx,iXyx,Yy->XJYZ', t1_xvaa, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JiZx,iXyz,Yxzy->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JiaX,iZxa,Yx->XJYZ', t1_xvea, t1_vaae, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JiaX,ixya,YxZy->XJYZ', t1_xvea, t1_vaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('JiaX,ixya,YxyZ->XJYZ', t1_xvea, t1_vaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/8 * einsum('JiaZ,iXax,Yx->XJYZ', t1_xvea, t1_vaea, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('Jiax,iXay,YxZy->XJYZ', t1_xvea, t1_vaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jiax,iXay,YxyZ->XJYZ', t1_xvea, t1_vaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JixX,iZyx,Yy->XJYZ', t1_xvaa, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('JixX,iZyz,Yxyz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JixX,iZyz,Yxzy->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JixX,iy,YxZy->XJYZ', t1_xvaa, t1_va, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('JixX,iy,YxyZ->XJYZ', t1_xvaa, t1_va, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JixX,iyzw,YxyZwz->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JixX,iyzw,YxyZzw->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JixX,iyzw,YxywZz->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JixX,iyzw,YxywzZ->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/8 * einsum('JixX,iyzw,YxyzZw->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JixX,iyzw,YxyzwZ->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JixX,iyzx,YyZz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('JixX,iyzx,YyzZ->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JixZ,iXxy,Yy->XJYZ', t1_xvaa, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JixZ,iXyz,Yxyz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('JixZ,iXyz,Yxzy->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/8 * einsum('Jixa,iXay,YxZy->XJYZ', t1_xvae, t1_vaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('Jixa,iXay,YxyZ->XJYZ', t1_xvae, t1_vaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jixa,iXya,YxZy->XJYZ', t1_xvae, t1_vaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('Jixa,iXya,YxyZ->XJYZ', t1_xvae, t1_vaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jixy,iXxz,YyZz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('Jixy,iXxz,YyzZ->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('Jixy,iXyz,YxZz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/3 * einsum('Jixy,iXyz,YxzZ->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('Jixy,iXzw,YxyZwz->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('Jixy,iXzw,YxyZzw->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/8 * einsum('Jixy,iXzw,YxywZz->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('Jixy,iXzw,YxywzZ->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('Jixy,iXzw,YxyzZw->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('Jixy,iXzw,YxyzwZ->XJYZ', t1_xvaa, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jixy,iXzy,YxZz->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('Jixy,iXzy,YxzZ->XJYZ', t1_xvaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JxZa,Xa,Yx->XJYZ', t1_xaae, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JxZa,Xyaz,Yyxz->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('JxZa,yXaz,Yyzx->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JxaX,Za,Yx->XJYZ', t1_xaea, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JxaX,ya,YyZx->XJYZ', t1_xaea, t1_ae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('JxaX,ya,YyxZ->XJYZ', t1_xaea, t1_ae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('JxaX,Zyaz,Yyxz->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('JxaX,yZaz,Yyxz->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('JxaX,yZaz,Yyzx->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JxaX,yzaw,YyzZwx->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/24 * einsum('JxaX,yzaw,YyzZxw->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JxaX,yzaw,YyzwZx->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JxaX,yzaw,YyzwxZ->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/8 * einsum('JxaX,yzaw,YyzxZw->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/24 * einsum('JxaX,yzaw,YyzxwZ->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('JxaZ,yXaz,Yyxz->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('JxaZ,yXaz,Yyzx->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jxab,XZba,Yx->XJYZ', t1_xaee, t1_aaee, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxab,Xyba,YyZx->XJYZ', t1_xaee, t1_aaee, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('Jxab,Xyba,YyxZ->XJYZ', t1_xaee, t1_aaee, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jxay,ZXay,Yx->XJYZ', t1_xaea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jxay,ZXaz,Yyzx->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxay,zXaw,YyzZwx->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxay,zXaw,YyzwZx->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxay,zXaw,YyzwxZ->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxay,zXaw,YyzxZw->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxay,zXaw,YyzxwZ->XJYZ', t1_xaea, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxay,zXay,YzZx->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('Jxay,zXay,YzxZ->XJYZ', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxya,Xa,YyZx->XJYZ', t1_xaae, t1_ae, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('Jxya,Xa,YyxZ->XJYZ', t1_xaae, t1_ae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/4 * einsum('Jxya,XZay,Yx->XJYZ', t1_xaae, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('Jxya,XZaz,Yyxz->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxya,XZaz,Yyzx->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxya,Xzaw,YyzZwx->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxya,Xzaw,YyzwZx->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxya,Xzaw,YyzwxZ->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxya,Xzaw,YyzxZw->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('Jxya,Xzaw,YyzxwZ->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxya,Xzay,YzZx->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('Jxya,Xzay,YzxZ->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxya,ZXaz,Yyxz->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('Jxya,ZXaz,Yyzx->XJYZ', t1_xaae, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/12 * einsum('Jxya,zXaw,YyzZwx->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('Jxya,zXaw,YyzwZx->XJYZ', t1_xaae, t1_aaea, rdm_cccaaa, optimize = einsum_type)
        T_a_caa += 1/2 * einsum('iJaZ,iXax,Yx->XJYZ', t1_xxea, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/4 * einsum('iJaZ,iXxa,Yx->XJYZ', t1_xxea, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_caa -= 1/6 * einsum('iJax,iXay,YxZy->XJYZ', t1_xxea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa -= 1/3 * einsum('iJax,iXay,YxyZ->XJYZ', t1_xxea, t1_xaea, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/12 * einsum('iJax,iXya,YxZy->XJYZ', t1_xxea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T_a_caa += 1/6 * einsum('iJax,iXya,YxyZ->XJYZ', t1_xxea, t1_xaae, rdm_ccaa, optimize = einsum_type)
        T[ncore:nocc, s_caa__bab:f_caa__bab] += T_a_caa.reshape(ncas, -1)

        # ACTIVE(2) - CCE
        T_a_cce =- einsum('JKBX->XJKB', t2_xxea, optimize = einsum_type).copy()
        T_a_cce += einsum('KJBX->XJKB', t2_xxea, optimize = einsum_type).copy()
        T_a_cce += 1/2 * einsum('JKBa,Xa->XJKB', t1_xxee, t1_ae, optimize = einsum_type)
        T_a_cce += 1/2 * einsum('Jx,KxBX->XJKB', t1_xa, t1_xaea, optimize = einsum_type)
        T_a_cce -= 1/2 * einsum('Jx,KxXB->XJKB', t1_xa, t1_xaae, optimize = einsum_type)
        T_a_cce -= 1/2 * einsum('JxBX,Kx->XJKB', t1_xaea, t1_xa, optimize = einsum_type)
        T_a_cce += 1/2 * einsum('JxXB,Kx->XJKB', t1_xaae, t1_xa, optimize = einsum_type)
        T_a_cce -= 1/2 * einsum('KJBa,Xa->XJKB', t1_xxee, t1_ae, optimize = einsum_type)
        T_a_cce -= 1/2 * einsum('xB,JKXx->XJKB', t1_ae, t1_xxaa, optimize = einsum_type)
        T_a_cce += 1/2 * einsum('xB,JKxX->XJKB', t1_ae, t1_xxaa, optimize = einsum_type)
        T_a_cce -= 1/2 * einsum('xyBX,JKxy->XJKB', t1_aaea, t1_xxaa, optimize = einsum_type)
        T_a_cce += 1/2 * einsum('xyBX,JKyx->XJKB', t1_aaea, t1_xxaa, optimize = einsum_type)
        T_a_cce += 1/2 * einsum('JKBa,Xxay,xy->XJKB', t1_xxee, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/4 * einsum('JKBa,xXay,yx->XJKB', t1_xxee, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/2 * einsum('JKaB,Xxay,xy->XJKB', t1_xxee, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/4 * einsum('JKaB,xXay,yx->XJKB', t1_xxee, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/2 * einsum('JxBX,Kyxz,yz->XJKB', t1_xaea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/4 * einsum('JxBX,Kyzx,yz->XJKB', t1_xaea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/2 * einsum('JxBy,KyXz,xz->XJKB', t1_xaea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/4 * einsum('JxBy,KyzX,xz->XJKB', t1_xaea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/2 * einsum('JxBy,KzXx,yz->XJKB', t1_xaea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/4 * einsum('JxBy,KzxX,yz->XJKB', t1_xaea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/2 * einsum('JxXB,Kyxz,yz->XJKB', t1_xaae, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/4 * einsum('JxXB,Kyzx,yz->XJKB', t1_xaae, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/2 * einsum('JxXy,KyBz,xz->XJKB', t1_xaaa, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/4 * einsum('JxXy,KyzB,xz->XJKB', t1_xaaa, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/2 * einsum('JxXy,KzBx,yz->XJKB', t1_xaaa, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/4 * einsum('JxXy,KzxB,yz->XJKB', t1_xaaa, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/4 * einsum('JxyB,KyXz,xz->XJKB', t1_xaae, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/4 * einsum('JxyB,KyzX,xz->XJKB', t1_xaae, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/4 * einsum('JxyB,KzXx,yz->XJKB', t1_xaae, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/4 * einsum('JxyB,KzxX,yz->XJKB', t1_xaae, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/4 * einsum('JxyX,KyBz,xz->XJKB', t1_xaaa, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/4 * einsum('JxyX,KyzB,xz->XJKB', t1_xaaa, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/4 * einsum('JxyX,KzBx,yz->XJKB', t1_xaaa, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/4 * einsum('JxyX,KzxB,yz->XJKB', t1_xaaa, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/2 * einsum('Jxyz,KyBX,xz->XJKB', t1_xaaa, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/2 * einsum('Jxyz,KyXB,xz->XJKB', t1_xaaa, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/4 * einsum('Jxyz,KzBX,xy->XJKB', t1_xaaa, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/4 * einsum('Jxyz,KzXB,xy->XJKB', t1_xaaa, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/4 * einsum('xyBX,JKxz,yz->XJKB', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/4 * einsum('xyBX,JKyz,xz->XJKB', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/4 * einsum('xyBX,JKzx,yz->XJKB', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/4 * einsum('xyBX,JKzy,xz->XJKB', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/2 * einsum('xyBz,JKXx,zy->XJKB', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/4 * einsum('xyBz,JKXy,zx->XJKB', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/2 * einsum('xyBz,JKxX,zy->XJKB', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/4 * einsum('xyBz,JKyX,zx->XJKB', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
        T[ncore:nocc, s_cce__aaa:f_cce__aaa] += T_a_cce[:, cvs_tril_ind[0], cvs_tril_ind[1]].reshape(ncas, -1)

        T_a_cce  = einsum('KJBX->XJKB', t2_xxea, optimize = einsum_type).copy()
        T_a_cce += 1/2 * einsum('Jx,KxBX->XJKB', t1_xa, t1_xaea, optimize = einsum_type)
        T_a_cce += 1/2 * einsum('JxXB,Kx->XJKB', t1_xaae, t1_xa, optimize = einsum_type)
        T_a_cce -= 1/2 * einsum('KJBa,Xa->XJKB', t1_xxee, t1_ae, optimize = einsum_type)
        T_a_cce -= 1/2 * einsum('xB,JKXx->XJKB', t1_ae, t1_xxaa, optimize = einsum_type)
        T_a_cce += 1/2 * einsum('xyBX,JKyx->XJKB', t1_aaea, t1_xxaa, optimize = einsum_type)
        T_a_cce -= 1/2 * einsum('JKaB,Xxay,xy->XJKB', t1_xxee, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/4 * einsum('JKaB,xXay,yx->XJKB', t1_xxee, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/2 * einsum('JxXB,Kyxz,yz->XJKB', t1_xaae, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/4 * einsum('JxXB,Kyzx,yz->XJKB', t1_xaae, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/2 * einsum('JxXy,KyBz,xz->XJKB', t1_xaaa, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/4 * einsum('JxXy,KyzB,xz->XJKB', t1_xaaa, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/2 * einsum('JxXy,KzBx,yz->XJKB', t1_xaaa, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/4 * einsum('JxXy,KzxB,yz->XJKB', t1_xaaa, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/4 * einsum('JxyB,KyzX,xz->XJKB', t1_xaae, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/4 * einsum('JxyB,KzxX,yz->XJKB', t1_xaae, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/4 * einsum('JxyX,KyBz,xz->XJKB', t1_xaaa, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/4 * einsum('JxyX,KzBx,yz->XJKB', t1_xaaa, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/2 * einsum('Jxyz,KyBX,xz->XJKB', t1_xaaa, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/4 * einsum('Jxyz,KzBX,xy->XJKB', t1_xaaa, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/4 * einsum('xyBX,JKyz,xz->XJKB', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/4 * einsum('xyBX,JKzx,yz->XJKB', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_a_cce -= 1/2 * einsum('xyBz,JKXx,zy->XJKB', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
        T_a_cce += 1/4 * einsum('xyBz,JKXy,zx->XJKB', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
        T[ncore:nocc, s_cce__abb:f_cce__abb] += T_a_cce.reshape(ncas, -1)

        # ACTIVE(2) - CVE
        if nval > 0:
            T_a_cve =- einsum('JKBX->XJKB', t2_xvea, optimize = einsum_type).copy()
            T_a_cve += einsum('JKXB->XJKB', t2_xvae, optimize = einsum_type).copy()
            T_a_cve += 1/2 * einsum('JKBa,Xa->XJKB', t1_xvee, t1_ae, optimize = einsum_type)
            T_a_cve -= 1/2 * einsum('JKaB,Xa->XJKB', t1_xvee, t1_ae, optimize = einsum_type)
            T_a_cve += 1/2 * einsum('Jx,KxBX->XJKB', t1_xa, t1_vaea, optimize = einsum_type)
            T_a_cve -= 1/2 * einsum('Jx,KxXB->XJKB', t1_xa, t1_vaae, optimize = einsum_type)
            T_a_cve -= 1/2 * einsum('JxBX,Kx->XJKB', t1_xaea, t1_va, optimize = einsum_type)
            T_a_cve += 1/2 * einsum('JxXB,Kx->XJKB', t1_xaae, t1_va, optimize = einsum_type)
            T_a_cve -= 1/2 * einsum('xB,JKXx->XJKB', t1_ae, t1_xvaa, optimize = einsum_type)
            T_a_cve += 1/2 * einsum('xB,JKxX->XJKB', t1_ae, t1_xvaa, optimize = einsum_type)
            T_a_cve -= 1/2 * einsum('xyBX,JKxy->XJKB', t1_aaea, t1_xvaa, optimize = einsum_type)
            T_a_cve += 1/2 * einsum('xyBX,JKyx->XJKB', t1_aaea, t1_xvaa, optimize = einsum_type)
            T_a_cve += 1/2 * einsum('JKBa,Xxay,xy->XJKB', t1_xvee, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('JKBa,xXay,yx->XJKB', t1_xvee, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/2 * einsum('JKaB,Xxay,xy->XJKB', t1_xvee, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('JKaB,xXay,yx->XJKB', t1_xvee, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/2 * einsum('JxBX,Kyxz,yz->XJKB', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('JxBX,Kyzx,yz->XJKB', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/2 * einsum('JxBy,KyXz,xz->XJKB', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('JxBy,KyzX,xz->XJKB', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/2 * einsum('JxBy,KzXx,yz->XJKB', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('JxBy,KzxX,yz->XJKB', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/2 * einsum('JxXB,Kyxz,yz->XJKB', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('JxXB,Kyzx,yz->XJKB', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/2 * einsum('JxXy,KyBz,xz->XJKB', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('JxXy,KyzB,xz->XJKB', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/2 * einsum('JxXy,KzBx,yz->XJKB', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('JxXy,KzxB,yz->XJKB', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('JxyB,KyXz,xz->XJKB', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('JxyB,KyzX,xz->XJKB', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('JxyB,KzXx,yz->XJKB', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('JxyB,KzxX,yz->XJKB', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('JxyX,KyBz,xz->XJKB', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('JxyX,KyzB,xz->XJKB', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('JxyX,KzBx,yz->XJKB', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('JxyX,KzxB,yz->XJKB', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/2 * einsum('Jxyz,KyBX,xz->XJKB', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/2 * einsum('Jxyz,KyXB,xz->XJKB', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('Jxyz,KzBX,xy->XJKB', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('Jxyz,KzXB,xy->XJKB', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('xyBX,JKxz,yz->XJKB', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('xyBX,JKyz,xz->XJKB', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('xyBX,JKzx,yz->XJKB', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('xyBX,JKzy,xz->XJKB', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/2 * einsum('xyBz,JKXx,zy->XJKB', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('xyBz,JKXy,zx->XJKB', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/2 * einsum('xyBz,JKxX,zy->XJKB', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('xyBz,JKyX,zx->XJKB', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
            T[ncore:nocc, s_cve__aaa:f_cve__aaa] += T_a_cve.reshape(ncas, -1)

            T_a_cve  = einsum('JKXB->XJKB', t2_xvae, optimize = einsum_type).copy()
            T_a_cve -= 1/2 * einsum('JKaB,Xa->XJKB', t1_xvee, t1_ae, optimize = einsum_type)
            T_a_cve += 1/2 * einsum('Jx,KxBX->XJKB', t1_xa, t1_vaea, optimize = einsum_type)
            T_a_cve += 1/2 * einsum('JxXB,Kx->XJKB', t1_xaae, t1_va, optimize = einsum_type)
            T_a_cve -= 1/2 * einsum('xB,JKXx->XJKB', t1_ae, t1_xvaa, optimize = einsum_type)
            T_a_cve += 1/2 * einsum('xyBX,JKyx->XJKB', t1_aaea, t1_xvaa, optimize = einsum_type)
            T_a_cve -= 1/2 * einsum('JKaB,Xxay,xy->XJKB', t1_xvee, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('JKaB,xXay,yx->XJKB', t1_xvee, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/2 * einsum('JxXB,Kyxz,yz->XJKB', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('JxXB,Kyzx,yz->XJKB', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/2 * einsum('JxXy,KyBz,xz->XJKB', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('JxXy,KyzB,xz->XJKB', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/2 * einsum('JxXy,KzBx,yz->XJKB', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('JxXy,KzxB,yz->XJKB', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('JxyB,KyzX,xz->XJKB', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('JxyB,KzxX,yz->XJKB', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('JxyX,KyBz,xz->XJKB', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('JxyX,KzBx,yz->XJKB', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/2 * einsum('Jxyz,KyBX,xz->XJKB', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('Jxyz,KzBX,xy->XJKB', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('xyBX,JKyz,xz->XJKB', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('xyBX,JKzx,yz->XJKB', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/2 * einsum('xyBz,JKXx,zy->XJKB', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('xyBz,JKXy,zx->XJKB', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
            T[ncore:nocc, s_cve__abb:f_cve__abb] += T_a_cve.reshape(ncas, -1)

            T_a_cve =- einsum('JKBX->XJKB', t2_xvea, optimize = einsum_type).copy()
            T_a_cve += 1/2 * einsum('JKBa,Xa->XJKB', t1_xvee, t1_ae, optimize = einsum_type)
            T_a_cve -= 1/2 * einsum('Jx,KxXB->XJKB', t1_xa, t1_vaae, optimize = einsum_type)
            T_a_cve -= 1/2 * einsum('JxBX,Kx->XJKB', t1_xaea, t1_va, optimize = einsum_type)
            T_a_cve += 1/2 * einsum('xB,JKxX->XJKB', t1_ae, t1_xvaa, optimize = einsum_type)
            T_a_cve -= 1/2 * einsum('xyBX,JKxy->XJKB', t1_aaea, t1_xvaa, optimize = einsum_type)
            T_a_cve += 1/2 * einsum('JKBa,Xxay,xy->XJKB', t1_xvee, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('JKBa,xXay,yx->XJKB', t1_xvee, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/2 * einsum('JxBX,Kyxz,yz->XJKB', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('JxBX,Kyzx,yz->XJKB', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/2 * einsum('JxBy,KyXz,xz->XJKB', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('JxBy,KyzX,xz->XJKB', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/2 * einsum('JxBy,KzXx,yz->XJKB', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('JxBy,KzxX,yz->XJKB', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('JxyB,KyXz,xz->XJKB', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('JxyB,KzXx,yz->XJKB', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('JxyX,KyzB,xz->XJKB', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('JxyX,KzxB,yz->XJKB', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/2 * einsum('Jxyz,KyXB,xz->XJKB', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('Jxyz,KzXB,xy->XJKB', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('xyBX,JKxz,yz->XJKB', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/4 * einsum('xyBX,JKzy,xz->XJKB', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_a_cve += 1/2 * einsum('xyBz,JKxX,zy->XJKB', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
            T_a_cve -= 1/4 * einsum('xyBz,JKyX,zx->XJKB', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
            T[ncore:nocc, s_cve__bab:f_cve__bab] += T_a_cve.reshape(ncas, -1)

        # ACTIVE(2) - CAE
        T_a_cae =- 1/2 * einsum('JxBX,Yx->XJYB', t2_xaea, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/2 * einsum('JxXB,Yx->XJYB', t2_xaae, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('JiBX,ix,Yx->XJYB', t1_xxea, t1_xa, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('JiBX,ixyz,Yxyz->XJYB', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/2 * einsum('JiBa,iXax,Yx->XJYB', t1_xxee, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JiBa,iXxa,Yx->XJYB', t1_xxee, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/2 * einsum('JiBx,iXxy,Yy->XJYB', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JiBx,iXyx,Yy->XJYB', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JiBx,iXyz,Yxzy->XJYB', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JiaB,iXax,Yx->XJYB', t1_xxee, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('JiaB,iXxa,Yx->XJYB', t1_xxee, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('JiBX,ix,Yx->XJYB', t1_xvea, t1_va, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('JiBX,ixyz,Yxyz->XJYB', t1_xvea, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/2 * einsum('JiBa,iXax,Yx->XJYB', t1_xvee, t1_vaea, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JiBa,iXxa,Yx->XJYB', t1_xvee, t1_vaae, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/2 * einsum('JiBx,iXxy,Yy->XJYB', t1_xvea, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JiBx,iXyx,Yy->XJYB', t1_xvea, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JiBx,iXyz,Yxzy->XJYB', t1_xvea, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JiXB,ix,Yx->XJYB', t1_xvae, t1_va, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JiXB,ixyz,Yxyz->XJYB', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JiaB,iXax,Yx->XJYB', t1_xvee, t1_vaea, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('JiaB,iXxa,Yx->XJYB', t1_xvee, t1_vaae, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JixB,iXxy,Yy->XJYB', t1_xvae, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('JixB,iXyx,Yy->XJYB', t1_xvae, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/12 * einsum('JixB,iXyz,Yxyz->XJYB', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/12 * einsum('JixB,iXyz,Yxzy->XJYB', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('JxBa,Xa,Yx->XJYB', t1_xaee, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('JxBa,Xyaz,Yyxz->XJYB', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('JxBa,yXaz,Yyzx->XJYB', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JxaB,Xa,Yx->XJYB', t1_xaee, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JxaB,Xyaz,Yyxz->XJYB', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/12 * einsum('JxaB,yXaz,Yyxz->XJYB', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/12 * einsum('JxaB,yXaz,Yyzx->XJYB', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('iJBX,ix,Yx->XJYB', t1_xxea, t1_xa, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('iJBX,ixyz,Yxyz->XJYB', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('iJBx,iXxy,Yy->XJYB', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('iJBx,iXyx,Yy->XJYB', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/12 * einsum('iJBx,iXyz,Yxyz->XJYB', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/12 * einsum('iJBx,iXyz,Yxzy->XJYB', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('xB,JyXx,Yy->XJYB', t1_ae, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('xB,JyxX,Yy->XJYB', t1_ae, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('xyBX,Jx,Yy->XJYB', t1_aaea, t1_xa, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('xyBX,Jy,Yx->XJYB', t1_aaea, t1_xa, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/12 * einsum('xyBX,Jzwx,Ywyz->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/12 * einsum('xyBX,Jzwx,Ywzy->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/12 * einsum('xyBX,Jzwy,Ywxz->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/12 * einsum('xyBX,Jzwy,Ywzx->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('xyBX,Jzxw,Ywyz->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('xyBX,Jzxy,Yz->XJYB', t1_aaea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('xyBX,Jzyw,Ywxz->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('xyBX,Jzyx,Yz->XJYB', t1_aaea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('xyBz,JwXx,Yzwy->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('xyBz,JwXy,Yzxw->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('xyBz,JwxX,Yzwy->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/12 * einsum('xyBz,JwyX,Yzwx->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/12 * einsum('xyBz,JwyX,Yzxw->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('xyBz,JzXw,Ywxy->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/12 * einsum('xyBz,JzwX,Ywxy->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/12 * einsum('xyBz,JzwX,Ywyx->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T[ncore:nocc, s_cae__aaa:f_cae__aaa] += T_a_cae.reshape(ncas, -1)

        T_a_cae  = 1/2 * einsum('JxXB,Yx->XJYB', t2_xaae, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('JiaB,iXxa,Yx->XJYB', t1_xxee, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JiXB,ix,Yx->XJYB', t1_xvae, t1_va, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JiXB,ixyz,Yxyz->XJYB', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('JiaB,iXxa,Yx->XJYB', t1_xvee, t1_vaae, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('JixB,iXyx,Yy->XJYB', t1_xvae, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/6 * einsum('JixB,iXyz,Yxyz->XJYB', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/12 * einsum('JixB,iXyz,Yxzy->XJYB', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JxaB,Xa,Yx->XJYB', t1_xaee, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JxaB,Xyaz,Yyxz->XJYB', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/6 * einsum('JxaB,yXaz,Yyxz->XJYB', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/12 * einsum('JxaB,yXaz,Yyzx->XJYB', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('iJBX,ix,Yx->XJYB', t1_xxea, t1_xa, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('iJBX,ixyz,Yxyz->XJYB', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('iJBx,iXyx,Yy->XJYB', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/6 * einsum('iJBx,iXyz,Yxyz->XJYB', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/12 * einsum('iJBx,iXyz,Yxzy->XJYB', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('xB,JyXx,Yy->XJYB', t1_ae, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('xyBX,Jy,Yx->XJYB', t1_aaea, t1_xa, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/12 * einsum('xyBX,Jzwx,Ywyz->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/6 * einsum('xyBX,Jzwx,Ywzy->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/6 * einsum('xyBX,Jzwy,Ywxz->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/12 * einsum('xyBX,Jzwy,Ywzx->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('xyBX,Jzyw,Ywxz->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('xyBX,Jzyx,Yz->XJYB', t1_aaea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('xyBz,JwXx,Yzwy->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('xyBz,JwXy,Yzxw->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/12 * einsum('xyBz,JwyX,Yzwx->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/6 * einsum('xyBz,JwyX,Yzxw->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('xyBz,JzXw,Ywxy->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/6 * einsum('xyBz,JzwX,Ywxy->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/12 * einsum('xyBz,JzwX,Ywyx->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T[ncore:nocc, s_cae__abb:f_cae__abb] += T_a_cae.reshape(ncas, -1)

        T_a_cae =- 1/2 * einsum('JxBX,Yx->XJYB', t2_xaea, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('JiBX,ix,Yx->XJYB', t1_xxea, t1_xa, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('JiBX,ixyz,Yxyz->XJYB', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/2 * einsum('JiBa,iXax,Yx->XJYB', t1_xxee, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JiBa,iXxa,Yx->XJYB', t1_xxee, t1_xaae, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/2 * einsum('JiBx,iXxy,Yy->XJYB', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JiBx,iXyx,Yy->XJYB', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JiBx,iXyz,Yxzy->XJYB', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JiaB,iXax,Yx->XJYB', t1_xxee, t1_xaea, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('JiBX,ix,Yx->XJYB', t1_xvea, t1_va, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('JiBX,ixyz,Yxyz->XJYB', t1_xvea, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/2 * einsum('JiBa,iXax,Yx->XJYB', t1_xvee, t1_vaea, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JiBa,iXxa,Yx->XJYB', t1_xvee, t1_vaae, rdm_ca, optimize = einsum_type)
        T_a_cae += 3/8 * einsum('JiBx,iXxy,Yy->XJYB', t1_xvea, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JiBx,iXyx,Yy->XJYB', t1_xvea, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/24 * einsum('JiBx,iXyz,Yxyz->XJYB', t1_xvea, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/6 * einsum('JiBx,iXyz,Yxzy->XJYB', t1_xvea, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('JiaB,iXax,Yx->XJYB', t1_xvee, t1_vaea, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/8 * einsum('JixB,iXxy,Yy->XJYB', t1_xvae, t1_vaaa, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/24 * einsum('JixB,iXyz,Yxyz->XJYB', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/12 * einsum('JixB,iXyz,Yxzy->XJYB', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('JxBa,Xa,Yx->XJYB', t1_xaee, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('JxBa,Xyaz,Yyxz->XJYB', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('JxBa,yXaz,Yyzx->XJYB', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/12 * einsum('JxaB,yXaz,Yyxz->XJYB', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/6 * einsum('JxaB,yXaz,Yyzx->XJYB', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('iJBx,iXxy,Yy->XJYB', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/12 * einsum('iJBx,iXyz,Yxyz->XJYB', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/6 * einsum('iJBx,iXyz,Yxzy->XJYB', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('xB,JyxX,Yy->XJYB', t1_ae, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('xyBX,Jx,Yy->XJYB', t1_aaea, t1_xa, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/6 * einsum('xyBX,Jzwx,Ywyz->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/12 * einsum('xyBX,Jzwx,Ywzy->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/12 * einsum('xyBX,Jzwy,Ywxz->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/6 * einsum('xyBX,Jzwy,Ywzx->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('xyBX,Jzxw,Ywyz->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/4 * einsum('xyBX,Jzxy,Yz->XJYB', t1_aaea, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cae += 1/4 * einsum('xyBz,JwxX,Yzwy->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/6 * einsum('xyBz,JwyX,Yzwx->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae -= 1/12 * einsum('xyBz,JwyX,Yzxw->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/12 * einsum('xyBz,JzwX,Ywxy->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cae += 1/6 * einsum('xyBz,JzwX,Ywyx->XJYB', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T[ncore:nocc, s_cae__bab:f_cae__bab] += T_a_cae.reshape(ncas, -1)

        # ACTIVE(2) - CCA
        T_a_cca  = einsum('JKXY->XJKY', t2_xxaa, optimize = einsum_type).copy()
        T_a_cca -= einsum('JKYX->XJKY', t2_xxaa, optimize = einsum_type).copy()
        T_a_cca -= 1/2 * einsum('JKaX,Ya->XJKY', t1_xxea, t1_ae, optimize = einsum_type)
        T_a_cca -= 1/2 * einsum('JKaY,Xa->XJKY', t1_xxea, t1_ae, optimize = einsum_type)
        T_a_cca -= 1/2 * einsum('JKab,XYab->XJKY', t1_xxee, t1_aaee, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('JKab,XYba->XJKY', t1_xxee, t1_aaee, optimize = einsum_type)
        T_a_cca -= 1/2 * einsum('JKax,XYax->XJKY', t1_xxea, t1_aaea, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('JKax,YXax->XJKY', t1_xxea, t1_aaea, optimize = einsum_type)
        T_a_cca -= 1/2 * einsum('Jx,KxXY->XJKY', t1_xa, t1_xaaa, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('Jx,KxYX->XJKY', t1_xa, t1_xaaa, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('JxXY,Kx->XJKY', t1_xaaa, t1_xa, optimize = einsum_type)
        T_a_cca -= 1/2 * einsum('JxYX,Kx->XJKY', t1_xaaa, t1_xa, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('KJaX,Ya->XJKY', t1_xxea, t1_ae, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('KJaY,Xa->XJKY', t1_xxea, t1_ae, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('KJax,XYax->XJKY', t1_xxea, t1_aaea, optimize = einsum_type)
        T_a_cca -= 1/2 * einsum('KJax,YXax->XJKY', t1_xxea, t1_aaea, optimize = einsum_type)
        T_a_cca -= 1/2 * einsum('JKXx,Yx->XJKY', t2_xxaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('JKxX,Yx->XJKY', t2_xxaa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/2 * einsum('JKaX,Yxay,xy->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JKaX,xYay,yx->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JKaX,xa,Yx->XJKY', t1_xxea, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JKaX,xyaz,Yzxy->XJKY', t1_xxea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/2 * einsum('JKaY,Xxay,xy->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JKaY,xXay,yx->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JKab,Xxab,Yx->XJKY', t1_xxee, t1_aaee, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('JKab,Xxba,Yx->XJKY', t1_xxee, t1_aaee, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JKax,XYay,xy->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JKax,Xa,Yx->XJKY', t1_xxea, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JKax,Xyax,Yy->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JKax,Xyaz,Yzxy->XJKY', t1_xxea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('JKax,YXay,xy->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('JKax,yXax,Yy->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/12 * einsum('JKax,yXaz,Yzxy->XJKY', t1_xxea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cca += 1/12 * einsum('JKax,yXaz,Yzyx->XJKY', t1_xxea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('Jx,KxXy,Yy->XJKY', t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('Jx,KxyX,Yy->XJKY', t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('JxXY,Kyxz,yz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('JxXY,Kyzx,yz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('JxXy,Kx,Yy->XJKY', t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/2 * einsum('JxXy,KyYz,xz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JxXy,KyzY,xz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JxXy,Kyzw,Yxzw->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('JxXy,KzYx,yz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('JxXy,Kzwx,Yzwy->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('JxXy,KzxY,yz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('JxXy,Kzxw,Yzyw->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/2 * einsum('JxYX,Kyxz,yz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JxYX,Kyzx,yz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/2 * einsum('JxYy,KyXz,xz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JxYy,KyzX,xz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('JxYy,KzXx,yz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('JxYy,KzxX,yz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JxyX,Kx,Yy->XJKY', t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JxyX,KyYz,xz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('JxyX,KyzY,xz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/12 * einsum('JxyX,Kyzw,Yxwz->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/12 * einsum('JxyX,Kyzw,Yxzw->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('JxyX,KzYx,yz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/12 * einsum('JxyX,Kzwx,Yzwy->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/12 * einsum('JxyX,Kzwx,Yzyw->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JxyX,KzxY,yz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JxyX,Kzxw,Yzyw->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JxyY,KyXz,xz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('JxyY,KyzX,xz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('JxyY,KzXx,yz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JxyY,KzxX,yz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('Jxyz,KwXx,Ywyz->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca += 1/12 * einsum('Jxyz,KwxX,Ywyz->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/12 * einsum('Jxyz,KwxX,Ywzy->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/2 * einsum('Jxyz,KyXY,xz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('Jxyz,KyXw,Yxwz->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('Jxyz,KyYX,xz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('Jxyz,KywX,Yxwz->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('Jxyz,KzXY,xy->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('Jxyz,KzXw,Yxyw->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('Jxyz,KzYX,xy->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/12 * einsum('Jxyz,KzwX,Yxwy->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/12 * einsum('Jxyz,KzwX,Yxyw->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('KJaX,Yxay,xy->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('KJaX,xYay,yx->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('KJaX,xa,Yx->XJKY', t1_xxea, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('KJaX,xyaz,Yzxy->XJKY', t1_xxea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('KJaY,Xxay,xy->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('KJaY,xXay,yx->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('KJax,XYay,xy->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('KJax,Xa,Yx->XJKY', t1_xxea, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('KJax,Xyax,Yy->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('KJax,Xyaz,Yzxy->XJKY', t1_xxea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('KJax,YXay,xy->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('KJax,yXax,Yy->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/12 * einsum('KJax,yXaz,Yzxy->XJKY', t1_xxea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/12 * einsum('KJax,yXaz,Yzyx->XJKY', t1_xxea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T[ncore:nocc, s_cca__aaa:f_cca__aaa] += T_a_cca[:, cvs_tril_ind[0], cvs_tril_ind[1]].reshape(ncas, -1)

        T_a_cca  = einsum('JKXY->XJKY', t2_xxaa, optimize = einsum_type).copy()
        T_a_cca -= 1/2 * einsum('JKaY,Xa->XJKY', t1_xxea, t1_ae, optimize = einsum_type)
        T_a_cca -= 1/2 * einsum('JKab,XYab->XJKY', t1_xxee, t1_aaee, optimize = einsum_type)
        T_a_cca -= 1/2 * einsum('JKax,XYax->XJKY', t1_xxea, t1_aaea, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('Jx,KxYX->XJKY', t1_xa, t1_xaaa, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('JxXY,Kx->XJKY', t1_xaaa, t1_xa, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('KJaX,Ya->XJKY', t1_xxea, t1_ae, optimize = einsum_type)
        T_a_cca -= 1/2 * einsum('KJax,YXax->XJKY', t1_xxea, t1_aaea, optimize = einsum_type)
        T_a_cca -= 1/2 * einsum('JKXx,Yx->XJKY', t2_xxaa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/2 * einsum('JKaY,Xxay,xy->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JKaY,xXay,yx->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JKab,Xxab,Yx->XJKY', t1_xxee, t1_aaee, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JKax,XYay,xy->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JKax,Xa,Yx->XJKY', t1_xxea, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JKax,Xyax,Yy->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JKax,Xyaz,Yzxy->XJKY', t1_xxea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/6 * einsum('JKax,yXaz,Yzxy->XJKY', t1_xxea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/12 * einsum('JKax,yXaz,Yzyx->XJKY', t1_xxea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('Jx,KxyX,Yy->XJKY', t1_xa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('JxXY,Kyxz,yz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('JxXY,Kyzx,yz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('JxXy,Kx,Yy->XJKY', t1_xaaa, t1_xa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/2 * einsum('JxXy,KyYz,xz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JxXy,KyzY,xz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JxXy,Kyzw,Yxzw->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('JxXy,KzYx,yz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('JxXy,Kzwx,Yzwy->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('JxXy,KzxY,yz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('JxXy,Kzxw,Yzyw->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JxyX,KyYz,xz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/12 * einsum('JxyX,Kyzw,Yxwz->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/6 * einsum('JxyX,Kyzw,Yxzw->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('JxyX,KzYx,yz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/6 * einsum('JxyX,Kzwx,Yzwy->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca += 1/12 * einsum('JxyX,Kzwx,Yzyw->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('JxyY,KyzX,xz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('JxyY,KzxX,yz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/12 * einsum('Jxyz,KwxX,Ywyz->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/6 * einsum('Jxyz,KwxX,Ywzy->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('Jxyz,KyYX,xz->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('Jxyz,KywX,Yxwz->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('Jxyz,KzYX,xy->XJKY', t1_xaaa, t1_xaaa, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/6 * einsum('Jxyz,KzwX,Yxwy->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca += 1/12 * einsum('Jxyz,KzwX,Yxyw->XJKY', t1_xaaa, t1_xaaa, rdm_ccaa, optimize = einsum_type)
        T_a_cca += 1/2 * einsum('KJaX,Yxay,xy->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('KJaX,xYay,yx->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('KJaX,xa,Yx->XJKY', t1_xxea, t1_ae, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/4 * einsum('KJaX,xyaz,Yzxy->XJKY', t1_xxea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('KJax,YXay,xy->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca += 1/4 * einsum('KJax,yXax,Yy->XJKY', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
        T_a_cca -= 1/12 * einsum('KJax,yXaz,Yzxy->XJKY', t1_xxea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T_a_cca -= 1/6 * einsum('KJax,yXaz,Yzyx->XJKY', t1_xxea, t1_aaea, rdm_ccaa, optimize = einsum_type)
        T[ncore:nocc, s_cca__abb:f_cca__abb] += T_a_cca.reshape(ncas, -1)

        # ACTIVE(2) - CVA
        if nval > 0:
            T_a_cva  = einsum('JKXY->XJKY', t2_xvaa, optimize = einsum_type).copy()
            T_a_cva -= einsum('JKYX->XJKY', t2_xvaa, optimize = einsum_type).copy()
            T_a_cva += 1/2 * einsum('JKXa,Ya->XJKY', t1_xvae, t1_ae, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JKYa,Xa->XJKY', t1_xvae, t1_ae, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JKaX,Ya->XJKY', t1_xvea, t1_ae, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JKaY,Xa->XJKY', t1_xvea, t1_ae, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JKab,XYab->XJKY', t1_xvee, t1_aaee, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JKab,XYba->XJKY', t1_xvee, t1_aaee, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JKax,XYax->XJKY', t1_xvea, t1_aaea, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JKax,YXax->XJKY', t1_xvea, t1_aaea, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JKxa,XYax->XJKY', t1_xvae, t1_aaea, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JKxa,YXax->XJKY', t1_xvae, t1_aaea, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('Jx,KxXY->XJKY', t1_xa, t1_vaaa, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('Jx,KxYX->XJKY', t1_xa, t1_vaaa, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JxXY,Kx->XJKY', t1_xaaa, t1_va, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JxYX,Kx->XJKY', t1_xaaa, t1_va, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JKXx,Yx->XJKY', t2_xvaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JKxX,Yx->XJKY', t2_xvaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKXa,xa,Yx->XJKY', t1_xvae, t1_ae, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JKXa,Yxay,xy->XJKY', t1_xvae, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKXa,xYay,yx->XJKY', t1_xvae, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKXa,xyaz,Yzxy->XJKY', t1_xvae, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JKYa,Xxay,xy->XJKY', t1_xvae, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKYa,xXay,yx->XJKY', t1_xvae, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKaX,xa,Yx->XJKY', t1_xvea, t1_ae, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JKaX,Yxay,xy->XJKY', t1_xvea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKaX,xYay,yx->XJKY', t1_xvea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKaX,xyaz,Yzxy->XJKY', t1_xvea, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JKaY,Xxay,xy->XJKY', t1_xvea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKaY,xXay,yx->XJKY', t1_xvea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKab,Xxab,Yx->XJKY', t1_xvee, t1_aaee, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKab,Xxba,Yx->XJKY', t1_xvee, t1_aaee, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKax,Xa,Yx->XJKY', t1_xvea, t1_ae, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKax,XYay,xy->XJKY', t1_xvea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKax,Xyax,Yy->XJKY', t1_xvea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKax,Xyaz,Yzxy->XJKY', t1_xvea, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKax,YXay,xy->XJKY', t1_xvea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKax,yXax,Yy->XJKY', t1_xvea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/12 * einsum('JKax,yXaz,Yzxy->XJKY', t1_xvea, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/12 * einsum('JKax,yXaz,Yzyx->XJKY', t1_xvea, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKxa,Xa,Yx->XJKY', t1_xvae, t1_ae, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKxa,XYay,xy->XJKY', t1_xvae, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKxa,Xyax,Yy->XJKY', t1_xvae, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKxa,Xyaz,Yzxy->XJKY', t1_xvae, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKxa,YXay,xy->XJKY', t1_xvae, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKxa,yXax,Yy->XJKY', t1_xvae, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/12 * einsum('JKxa,yXaz,Yzxy->XJKY', t1_xvae, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/12 * einsum('JKxa,yXaz,Yzyx->XJKY', t1_xvae, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('Jx,KxXy,Yy->XJKY', t1_xa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('Jx,KxyX,Yy->XJKY', t1_xa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JxXY,Kyxz,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JxXY,Kyzx,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JxXy,Kx,Yy->XJKY', t1_xaaa, t1_va, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JxXy,KyYz,xz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JxXy,KyzY,xz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JxXy,Kyzw,Yxzw->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JxXy,KzYx,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JxXy,Kzwx,Yzwy->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JxXy,KzxY,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JxXy,Kzxw,Yzyw->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JxYX,Kyxz,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JxYX,Kyzx,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JxYy,KyXz,xz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JxYy,KyzX,xz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JxYy,KzXx,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JxYy,KzxX,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JxyX,Kx,Yy->XJKY', t1_xaaa, t1_va, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JxyX,KyYz,xz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JxyX,KyzY,xz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/12 * einsum('JxyX,Kyzw,Yxwz->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/12 * einsum('JxyX,Kyzw,Yxzw->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JxyX,KzYx,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/12 * einsum('JxyX,Kzwx,Yzwy->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/12 * einsum('JxyX,Kzwx,Yzyw->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JxyX,KzxY,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JxyX,Kzxw,Yzyw->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JxyY,KyXz,xz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JxyY,KyzX,xz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JxyY,KzXx,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JxyY,KzxX,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('Jxyz,KwXx,Ywyz->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/12 * einsum('Jxyz,KwxX,Ywyz->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/12 * einsum('Jxyz,KwxX,Ywzy->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('Jxyz,KyXY,xz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('Jxyz,KyXw,Yxwz->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('Jxyz,KyYX,xz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('Jxyz,KywX,Yxwz->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('Jxyz,KzXY,xy->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('Jxyz,KzXw,Yxyw->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('Jxyz,KzYX,xy->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/12 * einsum('Jxyz,KzwX,Yxwy->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/12 * einsum('Jxyz,KzwX,Yxyw->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T[ncore:nocc, s_cva__aaa:f_cva__aaa] += T_a_cva.reshape(ncas, -1)

            T_a_cva  = einsum('JKXY->XJKY', t2_xvaa, optimize = einsum_type).copy()
            T_a_cva += 1/2 * einsum('JKXa,Ya->XJKY', t1_xvae, t1_ae, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JKaY,Xa->XJKY', t1_xvea, t1_ae, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JKab,XYab->XJKY', t1_xvee, t1_aaee, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JKax,XYax->XJKY', t1_xvea, t1_aaea, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JKxa,YXax->XJKY', t1_xvae, t1_aaea, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('Jx,KxYX->XJKY', t1_xa, t1_vaaa, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JxXY,Kx->XJKY', t1_xaaa, t1_va, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JKXx,Yx->XJKY', t2_xvaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKXa,xa,Yx->XJKY', t1_xvae, t1_ae, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JKXa,Yxay,xy->XJKY', t1_xvae, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKXa,xYay,yx->XJKY', t1_xvae, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKXa,xyaz,Yzxy->XJKY', t1_xvae, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JKaY,Xxay,xy->XJKY', t1_xvea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKaY,xXay,yx->XJKY', t1_xvea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKab,Xxab,Yx->XJKY', t1_xvee, t1_aaee, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKax,Xa,Yx->XJKY', t1_xvea, t1_ae, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKax,XYay,xy->XJKY', t1_xvea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKax,Xyax,Yy->XJKY', t1_xvea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKax,Xyaz,Yzxy->XJKY', t1_xvea, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/6 * einsum('JKax,yXaz,Yzxy->XJKY', t1_xvea, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/12 * einsum('JKax,yXaz,Yzyx->XJKY', t1_xvea, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKxa,YXay,xy->XJKY', t1_xvae, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKxa,yXax,Yy->XJKY', t1_xvae, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/12 * einsum('JKxa,yXaz,Yzxy->XJKY', t1_xvae, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/6 * einsum('JKxa,yXaz,Yzyx->XJKY', t1_xvae, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('Jx,KxyX,Yy->XJKY', t1_xa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JxXY,Kyxz,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JxXY,Kyzx,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JxXy,Kx,Yy->XJKY', t1_xaaa, t1_va, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JxXy,KyYz,xz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JxXy,KyzY,xz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JxXy,Kyzw,Yxzw->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JxXy,KzYx,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JxXy,Kzwx,Yzwy->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JxXy,KzxY,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JxXy,Kzxw,Yzyw->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JxyX,KyYz,xz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/12 * einsum('JxyX,Kyzw,Yxwz->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/6 * einsum('JxyX,Kyzw,Yxzw->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JxyX,KzYx,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/6 * einsum('JxyX,Kzwx,Yzwy->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/12 * einsum('JxyX,Kzwx,Yzyw->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JxyY,KyzX,xz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JxyY,KzxX,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/12 * einsum('Jxyz,KwxX,Ywyz->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/6 * einsum('Jxyz,KwxX,Ywzy->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('Jxyz,KyYX,xz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('Jxyz,KywX,Yxwz->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('Jxyz,KzYX,xy->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/6 * einsum('Jxyz,KzwX,Yxwy->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/12 * einsum('Jxyz,KzwX,Yxyw->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T[ncore:nocc, s_cva__abb:f_cva__abb] += T_a_cva.reshape(ncas, -1)

            T_a_cva =- einsum('JKYX->XJKY', t2_xvaa, optimize = einsum_type).copy()
            T_a_cva += 1/2 * einsum('JKYa,Xa->XJKY', t1_xvae, t1_ae, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JKaX,Ya->XJKY', t1_xvea, t1_ae, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JKab,XYba->XJKY', t1_xvee, t1_aaee, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JKax,YXax->XJKY', t1_xvea, t1_aaea, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JKxa,XYax->XJKY', t1_xvae, t1_aaea, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('Jx,KxXY->XJKY', t1_xa, t1_vaaa, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JxYX,Kx->XJKY', t1_xaaa, t1_va, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JKxX,Yx->XJKY', t2_xvaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JKYa,Xxay,xy->XJKY', t1_xvae, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKYa,xXay,yx->XJKY', t1_xvae, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKaX,xa,Yx->XJKY', t1_xvea, t1_ae, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JKaX,Yxay,xy->XJKY', t1_xvea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKaX,xYay,yx->XJKY', t1_xvea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JKaX,xyaz,Yzxy->XJKY', t1_xvea, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKab,Xxba,Yx->XJKY', t1_xvee, t1_aaee, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKax,YXay,xy->XJKY', t1_xvea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKax,yXax,Yy->XJKY', t1_xvea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/12 * einsum('JKax,yXaz,Yzxy->XJKY', t1_xvea, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/6 * einsum('JKax,yXaz,Yzyx->XJKY', t1_xvea, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKxa,Xa,Yx->XJKY', t1_xvae, t1_ae, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKxa,XYay,xy->XJKY', t1_xvae, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKxa,Xyax,Yy->XJKY', t1_xvae, t1_aaea, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JKxa,Xyaz,Yzxy->XJKY', t1_xvae, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/6 * einsum('JKxa,yXaz,Yzxy->XJKY', t1_xvae, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/12 * einsum('JKxa,yXaz,Yzyx->XJKY', t1_xvae, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('Jx,KxXy,Yy->XJKY', t1_xa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JxYX,Kyxz,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JxYX,Kyzx,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('JxYy,KyXz,xz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JxYy,KyzX,xz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/2 * einsum('JxYy,KzXx,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JxYy,KzxX,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JxyX,Kx,Yy->XJKY', t1_xaaa, t1_va, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JxyX,KyzY,xz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/6 * einsum('JxyX,Kyzw,Yxwz->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/12 * einsum('JxyX,Kyzw,Yxzw->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/12 * einsum('JxyX,Kzwx,Yzwy->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/6 * einsum('JxyX,Kzwx,Yzyw->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JxyX,KzxY,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JxyX,Kzxw,Yzyw->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('JxyY,KyXz,xz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('JxyY,KzXx,yz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva -= 1/4 * einsum('Jxyz,KwXx,Ywyz->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/6 * einsum('Jxyz,KwxX,Ywyz->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/12 * einsum('Jxyz,KwxX,Ywzy->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/2 * einsum('Jxyz,KyXY,xz->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('Jxyz,KyXw,Yxwz->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('Jxyz,KzXY,xy->XJKY', t1_xaaa, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_a_cva += 1/4 * einsum('Jxyz,KzXw,Yxyw->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/12 * einsum('Jxyz,KzwX,Yxwy->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_a_cva -= 1/6 * einsum('Jxyz,KzwX,Yxyw->XJKY', t1_xaaa, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T[ncore:nocc, s_cva__bab:f_cva__bab] += T_a_cva.reshape(ncas, -1)

        if nextern > 0:
            # VIRTUAL(2) - CAA
            T_e_caa  = 1/2 * einsum('JA,YZ->AJYZ', t2_xe, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JxAZ,Yx->AJYZ', t2_xaea, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JxAy,YyZx->AJYZ', t2_xaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/2 * einsum('JxZA,Yx->AJYZ', t2_xaae, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('JxyA,YyZx->AJYZ', t2_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('JxyA,YyxZ->AJYZ', t2_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAZ,ix,Yx->AJYZ', t1_xxea, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAZ,ixyz,Yxyz->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAa,iZax,Yx->AJYZ', t1_xxee, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAa,iZxa,Yx->AJYZ', t1_xxee, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAa,ixay,YxZy->AJYZ', t1_xxee, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAa,ixya,YxZy->AJYZ', t1_xxee, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAa,ia,YZ->AJYZ', t1_xxee, t1_xe, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAx,iZxy,Yy->AJYZ', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAx,iZyx,Yy->AJYZ', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAx,iZyz,Yxzy->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAx,ix,YZ->AJYZ', t1_xxea, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAx,iy,YxZy->AJYZ', t1_xxea, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAx,iyxz,YyZz->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JiAx,iyzw,YxyZwz->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 5/24 * einsum('JiAx,iyzw,YxyZzw->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JiAx,iyzw,YxywZz->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JiAx,iyzw,YxywzZ->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JiAx,iyzw,YxyzZw->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JiAx,iyzw,YxyzwZ->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAx,iyzx,YyZz->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiaA,iZax,Yx->AJYZ', t1_xxee, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('JiaA,iZxa,Yx->AJYZ', t1_xxee, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiaA,ixay,YxZy->AJYZ', t1_xxee, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('JiaA,ixya,YxZy->AJYZ', t1_xxee, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('JiaA,ixya,YxyZ->AJYZ', t1_xxee, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAZ,ix,Yx->AJYZ', t1_xvea, t1_va, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAZ,ixyz,Yxyz->AJYZ', t1_xvea, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAa,iZax,Yx->AJYZ', t1_xvee, t1_vaea, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAa,iZxa,Yx->AJYZ', t1_xvee, t1_vaae, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAa,ixay,YxZy->AJYZ', t1_xvee, t1_vaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAa,ixya,YxZy->AJYZ', t1_xvee, t1_vaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAa,ia,YZ->AJYZ', t1_xvee, t1_ve, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAx,ix,YZ->AJYZ', t1_xvea, t1_va, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAx,iy,YxZy->AJYZ', t1_xvea, t1_va, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAx,iZxy,Yy->AJYZ', t1_xvea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAx,iZyx,Yy->AJYZ', t1_xvea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAx,iZyz,Yxzy->AJYZ', t1_xvea, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAx,iyxz,YyZz->AJYZ', t1_xvea, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JiAx,iyzw,YxyZwz->AJYZ', t1_xvea, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 5/24 * einsum('JiAx,iyzw,YxyZzw->AJYZ', t1_xvea, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JiAx,iyzw,YxywZz->AJYZ', t1_xvea, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JiAx,iyzw,YxywzZ->AJYZ', t1_xvea, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JiAx,iyzw,YxyzZw->AJYZ', t1_xvea, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JiAx,iyzw,YxyzwZ->AJYZ', t1_xvea, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAx,iyzx,YyZz->AJYZ', t1_xvea, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('JiZA,ix,Yx->AJYZ', t1_xvae, t1_va, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('JiZA,ixyz,Yxyz->AJYZ', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiaA,iZax,Yx->AJYZ', t1_xvee, t1_vaea, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('JiaA,iZxa,Yx->AJYZ', t1_xvee, t1_vaae, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiaA,ixay,YxZy->AJYZ', t1_xvee, t1_vaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('JiaA,ixya,YxZy->AJYZ', t1_xvee, t1_vaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('JiaA,ixya,YxyZ->AJYZ', t1_xvee, t1_vaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiaA,ia,YZ->AJYZ', t1_xvee, t1_ve, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JixA,ix,YZ->AJYZ', t1_xvae, t1_va, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('JixA,iy,YxZy->AJYZ', t1_xvae, t1_va, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('JixA,iy,YxyZ->AJYZ', t1_xvae, t1_va, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JixA,iZxy,Yy->AJYZ', t1_xvae, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('JixA,iZyx,Yy->AJYZ', t1_xvae, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('JixA,iZyz,Yxyz->AJYZ', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('JixA,iZyz,Yxzy->AJYZ', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JixA,iyxz,YyZz->AJYZ', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('JixA,iyzw,YxyZzw->AJYZ', t1_xvae, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('JixA,iyzw,YxyzZw->AJYZ', t1_xvae, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('JixA,iyzx,YyZz->AJYZ', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('JixA,iyzx,YyzZ->AJYZ', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('JxAa,Za,Yx->AJYZ', t1_xaee, t1_ae, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('JxAa,Zyaz,Yyxz->AJYZ', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('JxAa,yZaz,Yyzx->AJYZ', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('JxAa,ya,YyZx->AJYZ', t1_xaee, t1_ae, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('JxAa,yzaw,YyzZwx->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 5/24 * einsum('JxAa,yzaw,YyzZxw->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('JxAa,yzaw,YyzwZx->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('JxAa,yzaw,YyzwxZ->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('JxAa,yzaw,YyzxZw->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('JxAa,yzaw,YyzxwZ->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JxaA,Za,Yx->AJYZ', t1_xaee, t1_ae, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JxaA,Zyaz,Yyxz->AJYZ', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('JxaA,yZaz,Yyxz->AJYZ', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('JxaA,yZaz,Yyzx->AJYZ', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('JxaA,ya,YyZx->AJYZ', t1_xaee, t1_ae, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('JxaA,ya,YyxZ->AJYZ', t1_xaee, t1_ae, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('JxaA,yzaw,YyzZxw->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('JxaA,yzaw,YyzxZw->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('iJAZ,ix,Yx->AJYZ', t1_xxea, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('iJAZ,ixyz,Yxyz->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('iJAa,ia,YZ->AJYZ', t1_xxee, t1_xe, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('iJAx,iZxy,Yy->AJYZ', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('iJAx,iZyx,Yy->AJYZ', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('iJAx,iZyz,Yxyz->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('iJAx,iZyz,Yxzy->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('iJAx,ix,YZ->AJYZ', t1_xxea, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('iJAx,iy,YxZy->AJYZ', t1_xxea, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('iJAx,iy,YxyZ->AJYZ', t1_xxea, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('iJAx,iyxz,YyZz->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('iJAx,iyzw,YxyZzw->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('iJAx,iyzw,YxyzZw->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('iJAx,iyzx,YyZz->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('iJAx,iyzx,YyzZ->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xA,Jx,YZ->AJYZ', t1_ae, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('xA,JyZx,Yy->AJYZ', t1_ae, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xA,JyxZ,Yy->AJYZ', t1_ae, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xA,Jyxz,YzZy->AJYZ', t1_ae, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xA,Jyzx,YzZy->AJYZ', t1_ae, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xA,Jyzx,YzyZ->AJYZ', t1_ae, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xyAZ,Jx,Yy->AJYZ', t1_aaea, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('xyAZ,Jy,Yx->AJYZ', t1_aaea, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAZ,Jzwx,Ywyz->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAZ,Jzwx,Ywzy->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAZ,Jzwy,Ywxz->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAZ,Jzwy,Ywzx->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xyAZ,Jzxw,Ywyz->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xyAZ,Jzxy,Yz->AJYZ', t1_aaea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('xyAZ,Jzyw,Ywxz->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('xyAZ,Jzyx,Yz->AJYZ', t1_aaea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('xyAz,JwZx,Yzwy->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('xyAz,JwZy,Yzxw->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,Jwux,YzuZyw->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAz,Jwux,YzuwyZ->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,Jwuy,YzuZwx->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAz,Jwuy,YzuxwZ->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xyAz,JwxZ,Yzwy->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xyAz,Jwxu,YzuZyw->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xyAz,Jwxy,YzZw->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,JwyZ,Yzwx->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAz,JwyZ,Yzxw->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,Jwyu,YzuZxw->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAz,Jwyu,YzuxZw->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,Jwyx,YzZw->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAz,Jwyx,YzwZ->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xyAz,Jx,YzZy->AJYZ', t1_aaea, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,Jy,YzZx->AJYZ', t1_aaea, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAz,Jy,YzxZ->AJYZ', t1_aaea, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xyAz,JzZw,Ywxy->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,JzwZ,Ywxy->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAz,JzwZ,Ywyx->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAz,Jzwu,YwuZxy->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,Jzwu,YwuxZy->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T[nocc:, s_caa__aaa:f_caa__aaa] += T_e_caa.reshape(nextern, -1)

            T_e_caa  = 1/2 * einsum('JA,YZ->AJYZ', t2_xe, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JxAZ,Yx->AJYZ', t2_xaea, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JxAy,YyZx->AJYZ', t2_xaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/3 * einsum('JxyA,YyZx->AJYZ', t2_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('JxyA,YyxZ->AJYZ', t2_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAZ,ix,Yx->AJYZ', t1_xxea, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAZ,ixyz,Yxyz->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAa,iZax,Yx->AJYZ', t1_xxee, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAa,iZxa,Yx->AJYZ', t1_xxee, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAa,ixay,YxZy->AJYZ', t1_xxee, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAa,ixya,YxZy->AJYZ', t1_xxee, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAa,ia,YZ->AJYZ', t1_xxee, t1_xe, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAx,iZxy,Yy->AJYZ', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAx,iZyx,Yy->AJYZ', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAx,iZyz,Yxzy->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAx,ix,YZ->AJYZ', t1_xxea, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAx,iy,YxZy->AJYZ', t1_xxea, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAx,iyxz,YyZz->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JiAx,iyzw,YxyZwz->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 5/24 * einsum('JiAx,iyzw,YxyZzw->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JiAx,iyzw,YxywZz->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JiAx,iyzw,YxywzZ->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JiAx,iyzw,YxyzZw->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JiAx,iyzw,YxyzwZ->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAx,iyzx,YyZz->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiaA,iZax,Yx->AJYZ', t1_xxee, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiaA,ixay,YxZy->AJYZ', t1_xxee, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('JiaA,ixya,YxZy->AJYZ', t1_xxee, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('JiaA,ixya,YxyZ->AJYZ', t1_xxee, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAZ,ix,Yx->AJYZ', t1_xvea, t1_va, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAZ,ixyz,Yxyz->AJYZ', t1_xvea, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAa,iZax,Yx->AJYZ', t1_xvee, t1_vaea, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAa,iZxa,Yx->AJYZ', t1_xvee, t1_vaae, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAa,ixay,YxZy->AJYZ', t1_xvee, t1_vaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAa,ixya,YxZy->AJYZ', t1_xvee, t1_vaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAa,ia,YZ->AJYZ', t1_xvee, t1_ve, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAx,ix,YZ->AJYZ', t1_xvea, t1_va, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAx,iy,YxZy->AJYZ', t1_xvea, t1_va, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAx,iZxy,Yy->AJYZ', t1_xvea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAx,iZyx,Yy->AJYZ', t1_xvea, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAx,iZyz,Yxzy->AJYZ', t1_xvea, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/2 * einsum('JiAx,iyxz,YyZz->AJYZ', t1_xvea, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JiAx,iyzw,YxyZwz->AJYZ', t1_xvea, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 5/24 * einsum('JiAx,iyzw,YxyZzw->AJYZ', t1_xvea, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JiAx,iyzw,YxywZz->AJYZ', t1_xvea, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JiAx,iyzw,YxywzZ->AJYZ', t1_xvea, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JiAx,iyzw,YxyzZw->AJYZ', t1_xvea, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JiAx,iyzw,YxyzwZ->AJYZ', t1_xvea, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiAx,iyzx,YyZz->AJYZ', t1_xvea, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiaA,iZax,Yx->AJYZ', t1_xvee, t1_vaea, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiaA,ixay,YxZy->AJYZ', t1_xvee, t1_vaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('JiaA,ixya,YxZy->AJYZ', t1_xvee, t1_vaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('JiaA,ixya,YxyZ->AJYZ', t1_xvee, t1_vaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JiaA,ia,YZ->AJYZ', t1_xvee, t1_ve, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JixA,ix,YZ->AJYZ', t1_xvae, t1_va, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('JixA,iy,YxZy->AJYZ', t1_xvae, t1_va, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('JixA,iy,YxyZ->AJYZ', t1_xvae, t1_va, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JixA,iZxy,Yy->AJYZ', t1_xvae, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('JixA,iZyz,Yxyz->AJYZ', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('JixA,iZyz,Yxzy->AJYZ', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JixA,iyxz,YyZz->AJYZ', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('JixA,iyzw,YxyZwz->AJYZ', t1_xvae, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/8 * einsum('JixA,iyzw,YxyZzw->AJYZ', t1_xvae, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('JixA,iyzw,YxywZz->AJYZ', t1_xvae, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('JixA,iyzw,YxywzZ->AJYZ', t1_xvae, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JixA,iyzw,YxyzZw->AJYZ', t1_xvae, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('JixA,iyzw,YxyzwZ->AJYZ', t1_xvae, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('JixA,iyzx,YyZz->AJYZ', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('JixA,iyzx,YyzZ->AJYZ', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('JxAa,Za,Yx->AJYZ', t1_xaee, t1_ae, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('JxAa,Zyaz,Yyxz->AJYZ', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('JxAa,yZaz,Yyzx->AJYZ', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('JxAa,ya,YyZx->AJYZ', t1_xaee, t1_ae, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('JxAa,yzaw,YyzZwx->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 5/24 * einsum('JxAa,yzaw,YyzZxw->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('JxAa,yzaw,YyzwZx->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('JxAa,yzaw,YyzwxZ->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('JxAa,yzaw,YyzxZw->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('JxAa,yzaw,YyzxwZ->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('JxaA,yZaz,Yyxz->AJYZ', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('JxaA,yZaz,Yyzx->AJYZ', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('JxaA,ya,YyZx->AJYZ', t1_xaee, t1_ae, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('JxaA,ya,YyxZ->AJYZ', t1_xaee, t1_ae, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JxaA,yzaw,YyzZwx->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/8 * einsum('JxaA,yzaw,YyzZxw->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JxaA,yzaw,YyzwZx->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JxaA,yzaw,YyzwxZ->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('JxaA,yzaw,YyzxZw->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JxaA,yzaw,YyzxwZ->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('iJAa,ia,YZ->AJYZ', t1_xxee, t1_xe, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('iJAx,iZxy,Yy->AJYZ', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('iJAx,iZyz,Yxyz->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('iJAx,iZyz,Yxzy->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('iJAx,ix,YZ->AJYZ', t1_xxea, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('iJAx,iy,YxZy->AJYZ', t1_xxea, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('iJAx,iy,YxyZ->AJYZ', t1_xxea, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('iJAx,iyxz,YyZz->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('iJAx,iyzw,YxyZwz->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/8 * einsum('iJAx,iyzw,YxyZzw->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('iJAx,iyzw,YxywZz->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('iJAx,iyzw,YxywzZ->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('iJAx,iyzw,YxyzZw->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('iJAx,iyzw,YxyzwZ->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('iJAx,iyzx,YyZz->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('iJAx,iyzx,YyzZ->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xA,Jx,YZ->AJYZ', t1_ae, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xA,JyxZ,Yy->AJYZ', t1_ae, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xA,Jyxz,YzZy->AJYZ', t1_ae, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('xA,Jyzx,YzZy->AJYZ', t1_ae, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xA,Jyzx,YzyZ->AJYZ', t1_ae, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xyAZ,Jx,Yy->AJYZ', t1_aaea, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('xyAZ,Jzwx,Ywyz->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAZ,Jzwx,Ywzy->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAZ,Jzwy,Ywxz->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('xyAZ,Jzwy,Ywzx->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xyAZ,Jzxw,Ywyz->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xyAZ,Jzxy,Yz->AJYZ', t1_aaea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('xyAz,Jwux,YzuZyw->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,Jwux,YzuwyZ->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,Jwuy,YzuZwx->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAz,Jwuy,YzuZxw->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAz,Jwuy,YzuwZx->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAz,Jwuy,YzuwxZ->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAz,Jwuy,YzuxZw->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xyAz,JwxZ,Yzwy->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xyAz,Jwxu,YzuZyw->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xyAz,Jwxy,YzZw->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('xyAz,JwyZ,Yzwx->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,JwyZ,Yzxw->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('xyAz,Jwyu,YzuZxw->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,Jwyu,YzuxZw->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('xyAz,Jwyx,YzZw->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,Jwyx,YzwZ->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xyAz,Jx,YzZy->AJYZ', t1_aaea, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('xyAz,Jy,YzZx->AJYZ', t1_aaea, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,Jy,YzxZ->AJYZ', t1_aaea, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAz,JzwZ,Ywxy->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('xyAz,JzwZ,Ywyx->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/8 * einsum('xyAz,Jzwu,YwuZxy->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('xyAz,Jzwu,YwuZyx->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('xyAz,Jzwu,YwuxZy->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('xyAz,Jzwu,YwuxyZ->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('xyAz,Jzwu,YwuyZx->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('xyAz,Jzwu,YwuyxZ->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T[nocc:, s_caa__abb:f_caa__abb] += T_e_caa.reshape(nextern, -1)

            T_e_caa =- 1/2 * einsum('JxZA,Yx->AJYZ', t2_xaae, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('JxyA,YyZx->AJYZ', t2_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/3 * einsum('JxyA,YyxZ->AJYZ', t2_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('JiaA,iZxa,Yx->AJYZ', t1_xxee, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('JiaA,ixya,YxZy->AJYZ', t1_xxee, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('JiaA,ixya,YxyZ->AJYZ', t1_xxee, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('JiZA,ix,Yx->AJYZ', t1_xvae, t1_va, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('JiZA,ixyz,Yxyz->AJYZ', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('JiaA,iZxa,Yx->AJYZ', t1_xvee, t1_vaae, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('JiaA,ixya,YxZy->AJYZ', t1_xvee, t1_vaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('JiaA,ixya,YxyZ->AJYZ', t1_xvee, t1_vaae, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('JixA,iy,YxZy->AJYZ', t1_xvae, t1_va, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('JixA,iy,YxyZ->AJYZ', t1_xvae, t1_va, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('JixA,iZyx,Yy->AJYZ', t1_xvae, t1_vaaa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('JixA,iZyz,Yxyz->AJYZ', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('JixA,iZyz,Yxzy->AJYZ', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JixA,iyzw,YxyZwz->AJYZ', t1_xvae, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('JixA,iyzw,YxyZzw->AJYZ', t1_xvae, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JixA,iyzw,YxywZz->AJYZ', t1_xvae, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JixA,iyzw,YxywzZ->AJYZ', t1_xvae, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/8 * einsum('JixA,iyzw,YxyzZw->AJYZ', t1_xvae, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JixA,iyzw,YxyzwZ->AJYZ', t1_xvae, t1_vaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('JixA,iyzx,YyZz->AJYZ', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('JixA,iyzx,YyzZ->AJYZ', t1_xvae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JxaA,Za,Yx->AJYZ', t1_xaee, t1_ae, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('JxaA,Zyaz,Yyxz->AJYZ', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('JxaA,yZaz,Yyxz->AJYZ', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('JxaA,yZaz,Yyzx->AJYZ', t1_xaee, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('JxaA,ya,YyZx->AJYZ', t1_xaee, t1_ae, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('JxaA,ya,YyxZ->AJYZ', t1_xaee, t1_ae, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('JxaA,yzaw,YyzZwx->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('JxaA,yzaw,YyzZxw->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('JxaA,yzaw,YyzwZx->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('JxaA,yzaw,YyzwxZ->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/8 * einsum('JxaA,yzaw,YyzxZw->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('JxaA,yzaw,YyzxwZ->AJYZ', t1_xaee, t1_aaea, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('iJAZ,ix,Yx->AJYZ', t1_xxea, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('iJAZ,ixyz,Yxyz->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('iJAx,iZyx,Yy->AJYZ', t1_xxea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('iJAx,iZyz,Yxyz->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('iJAx,iZyz,Yxzy->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('iJAx,iy,YxZy->AJYZ', t1_xxea, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('iJAx,iy,YxyZ->AJYZ', t1_xxea, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('iJAx,iyzw,YxyZwz->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('iJAx,iyzw,YxyZzw->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('iJAx,iyzw,YxywZz->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('iJAx,iyzw,YxywzZ->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/8 * einsum('iJAx,iyzw,YxyzZw->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('iJAx,iyzw,YxyzwZ->AJYZ', t1_xxea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('iJAx,iyzx,YyZz->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('iJAx,iyzx,YyzZ->AJYZ', t1_xxea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('xA,JyZx,Yy->AJYZ', t1_ae, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xA,Jyzx,YzZy->AJYZ', t1_ae, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('xA,Jyzx,YzyZ->AJYZ', t1_ae, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('xyAZ,Jy,Yx->AJYZ', t1_aaea, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAZ,Jzwx,Ywyz->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('xyAZ,Jzwx,Ywzy->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('xyAZ,Jzwy,Ywxz->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAZ,Jzwy,Ywzx->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('xyAZ,Jzyw,Ywxz->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('xyAZ,Jzyx,Yz->AJYZ', t1_aaea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('xyAz,JwZx,Yzwy->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/4 * einsum('xyAz,JwZy,Yzxw->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,Jwux,YzuZwy->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,Jwux,YzuwZy->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAz,Jwux,YzuwyZ->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,Jwux,YzuyZw->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,Jwux,YzuywZ->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAz,Jwuy,YzuZwx->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('xyAz,Jwuy,YzuxwZ->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAz,JwyZ,Yzwx->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('xyAz,JwyZ,Yzxw->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,Jwyu,YzuZwx->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,Jwyu,YzuwZx->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,Jwyu,YzuwxZ->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAz,Jwyu,YzuxZw->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,Jwyu,YzuxwZ->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAz,Jwyx,YzZw->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('xyAz,Jwyx,YzwZ->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/12 * einsum('xyAz,Jy,YzZx->AJYZ', t1_aaea, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/6 * einsum('xyAz,Jy,YzxZ->AJYZ', t1_aaea, t1_xa, rdm_ccaa, optimize = einsum_type)
            T_e_caa += 1/4 * einsum('xyAz,JzZw,Ywxy->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/6 * einsum('xyAz,JzwZ,Ywxy->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/12 * einsum('xyAz,JzwZ,Ywyx->AJYZ', t1_aaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_caa -= 1/24 * einsum('xyAz,Jzwu,YwuZxy->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('xyAz,Jzwu,YwuZyx->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa -= 1/8 * einsum('xyAz,Jzwu,YwuxZy->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('xyAz,Jzwu,YwuxyZ->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('xyAz,Jzwu,YwuyZx->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T_e_caa += 1/24 * einsum('xyAz,Jzwu,YwuyxZ->AJYZ', t1_aaea, t1_xaaa, rdm_cccaaa, optimize = einsum_type)
            T[nocc:, s_caa__bab:f_caa__bab] += T_e_caa.reshape(nextern, -1)

            # VIRTUAL(2) - CCE
            T_e_cce  = einsum('JKAB->AJKB', t2_xxee, optimize = einsum_type).copy()
            T_e_cce -= einsum('KJAB->AJKB', t2_xxee, optimize = einsum_type).copy()
            T_e_cce -= 1/2 * einsum('JKAx,xB->AJKB', t1_xxea, t1_ae, optimize = einsum_type)
            T_e_cce += 1/2 * einsum('JxAB,Kx->AJKB', t1_xaee, t1_xa, optimize = einsum_type)
            T_e_cce -= 1/2 * einsum('JxBA,Kx->AJKB', t1_xaee, t1_xa, optimize = einsum_type)
            T_e_cce += 1/2 * einsum('KJAx,xB->AJKB', t1_xxea, t1_ae, optimize = einsum_type)
            T_e_cce -= 1/2 * einsum('KxAB,Jx->AJKB', t1_xaee, t1_xa, optimize = einsum_type)
            T_e_cce += 1/2 * einsum('KxBA,Jx->AJKB', t1_xaee, t1_xa, optimize = einsum_type)
            T_e_cce -= 1/2 * einsum('xA,JKBx->AJKB', t1_ae, t1_xxea, optimize = einsum_type)
            T_e_cce += 1/2 * einsum('xA,KJBx->AJKB', t1_ae, t1_xxea, optimize = einsum_type)
            T_e_cce += 1/2 * einsum('xyAB,JKxy->AJKB', t1_aaee, t1_xxaa, optimize = einsum_type)
            T_e_cce -= 1/2 * einsum('xyAB,JKyx->AJKB', t1_aaee, t1_xxaa, optimize = einsum_type)
            T_e_cce -= 1/2 * einsum('JKAx,xyBz,zy->AJKB', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/4 * einsum('JKAx,yxBz,zy->AJKB', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/2 * einsum('JxAB,Kyxz,yz->AJKB', t1_xaee, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/4 * einsum('JxAB,Kyzx,yz->AJKB', t1_xaee, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/2 * einsum('JxAy,KyBz,xz->AJKB', t1_xaea, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/4 * einsum('JxAy,KyzB,xz->AJKB', t1_xaea, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/2 * einsum('JxAy,KzBx,yz->AJKB', t1_xaea, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/4 * einsum('JxAy,KzxB,yz->AJKB', t1_xaea, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/2 * einsum('JxBA,Kyxz,yz->AJKB', t1_xaee, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/4 * einsum('JxBA,Kyzx,yz->AJKB', t1_xaee, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/2 * einsum('JxBy,KyAz,xz->AJKB', t1_xaea, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/4 * einsum('JxBy,KyzA,xz->AJKB', t1_xaea, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/2 * einsum('JxBy,KzAx,yz->AJKB', t1_xaea, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/4 * einsum('JxBy,KzxA,yz->AJKB', t1_xaea, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/4 * einsum('JxyA,KyBz,xz->AJKB', t1_xaae, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/4 * einsum('JxyA,KyzB,xz->AJKB', t1_xaae, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/4 * einsum('JxyA,KzBx,yz->AJKB', t1_xaae, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/4 * einsum('JxyA,KzxB,yz->AJKB', t1_xaae, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/4 * einsum('JxyB,KyAz,xz->AJKB', t1_xaae, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/4 * einsum('JxyB,KyzA,xz->AJKB', t1_xaae, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/4 * einsum('JxyB,KzAx,yz->AJKB', t1_xaae, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/4 * einsum('JxyB,KzxA,yz->AJKB', t1_xaae, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/2 * einsum('KJAx,xyBz,zy->AJKB', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/4 * einsum('KJAx,yxBz,zy->AJKB', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/2 * einsum('KxAB,Jyxz,yz->AJKB', t1_xaee, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/4 * einsum('KxAB,Jyzx,yz->AJKB', t1_xaee, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/2 * einsum('KxBA,Jyxz,yz->AJKB', t1_xaee, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/4 * einsum('KxBA,Jyzx,yz->AJKB', t1_xaee, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/4 * einsum('xyAB,JKxz,yz->AJKB', t1_aaee, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/4 * einsum('xyAB,JKyz,xz->AJKB', t1_aaee, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/4 * einsum('xyAB,JKzx,yz->AJKB', t1_aaee, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/4 * einsum('xyAB,JKzy,xz->AJKB', t1_aaee, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/2 * einsum('xyAz,JKBx,zy->AJKB', t1_aaea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/4 * einsum('xyAz,JKBy,zx->AJKB', t1_aaea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/2 * einsum('xyAz,KJBx,zy->AJKB', t1_aaea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/4 * einsum('xyAz,KJBy,zx->AJKB', t1_aaea, t1_xxea, rdm_ca, optimize = einsum_type)
            T[nocc:, s_cce__aaa:f_cce__aaa] += T_e_cce[:, cvs_tril_ind[0], cvs_tril_ind[1]].reshape(nextern, -1)

            T_e_cce  = einsum('JKAB->AJKB', t2_xxee, optimize = einsum_type).copy()
            T_e_cce -= 1/2 * einsum('JKAx,xB->AJKB', t1_xxea, t1_ae, optimize = einsum_type)
            T_e_cce += 1/2 * einsum('JxAB,Kx->AJKB', t1_xaee, t1_xa, optimize = einsum_type)
            T_e_cce += 1/2 * einsum('KxBA,Jx->AJKB', t1_xaee, t1_xa, optimize = einsum_type)
            T_e_cce += 1/2 * einsum('xA,KJBx->AJKB', t1_ae, t1_xxea, optimize = einsum_type)
            T_e_cce += 1/2 * einsum('xyAB,JKxy->AJKB', t1_aaee, t1_xxaa, optimize = einsum_type)
            T_e_cce -= 1/2 * einsum('JKAx,xyBz,zy->AJKB', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/4 * einsum('JKAx,yxBz,zy->AJKB', t1_xxea, t1_aaea, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/2 * einsum('JxAB,Kyxz,yz->AJKB', t1_xaee, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/4 * einsum('JxAB,Kyzx,yz->AJKB', t1_xaee, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/2 * einsum('JxAy,KyBz,xz->AJKB', t1_xaea, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/4 * einsum('JxAy,KyzB,xz->AJKB', t1_xaea, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/2 * einsum('JxAy,KzBx,yz->AJKB', t1_xaea, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/4 * einsum('JxAy,KzxB,yz->AJKB', t1_xaea, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/4 * einsum('JxyA,KyBz,xz->AJKB', t1_xaae, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/4 * einsum('JxyA,KzBx,yz->AJKB', t1_xaae, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/4 * einsum('JxyB,KyzA,xz->AJKB', t1_xaae, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/4 * einsum('JxyB,KzxA,yz->AJKB', t1_xaae, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/2 * einsum('KxBA,Jyxz,yz->AJKB', t1_xaee, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/4 * einsum('KxBA,Jyzx,yz->AJKB', t1_xaee, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/4 * einsum('xyAB,JKxz,yz->AJKB', t1_aaee, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/4 * einsum('xyAB,JKzy,xz->AJKB', t1_aaee, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cce += 1/2 * einsum('xyAz,KJBx,zy->AJKB', t1_aaea, t1_xxea, rdm_ca, optimize = einsum_type)
            T_e_cce -= 1/4 * einsum('xyAz,KJBy,zx->AJKB', t1_aaea, t1_xxea, rdm_ca, optimize = einsum_type)
            T[nocc:, s_cce__abb:f_cce__abb] += T_e_cce.reshape(nextern, -1)

            # VIRTUAL(2) - CVE
            if nval > 0:
                T_e_cve  = einsum('JKAB->AJKB', t2_xvee, optimize = einsum_type).copy()
                T_e_cve -= einsum('JKBA->AJKB', t2_xvee, optimize = einsum_type).copy()
                T_e_cve += 1/2 * einsum('JxAB,Kx->AJKB', t1_xaee, t1_va, optimize = einsum_type)
                T_e_cve -= 1/2 * einsum('JxBA,Kx->AJKB', t1_xaee, t1_va, optimize = einsum_type)
                T_e_cve -= 1/2 * einsum('KxAB,Jx->AJKB', t1_vaee, t1_xa, optimize = einsum_type)
                T_e_cve += 1/2 * einsum('KxBA,Jx->AJKB', t1_vaee, t1_xa, optimize = einsum_type)
                T_e_cve -= 1/2 * einsum('xA,JKBx->AJKB', t1_ae, t1_xvea, optimize = einsum_type)
                T_e_cve += 1/2 * einsum('xA,JKxB->AJKB', t1_ae, t1_xvae, optimize = einsum_type)
                T_e_cve -= 1/2 * einsum('xB,JKAx->AJKB', t1_ae, t1_xvea, optimize = einsum_type)
                T_e_cve += 1/2 * einsum('xB,JKxA->AJKB', t1_ae, t1_xvae, optimize = einsum_type)
                T_e_cve += 1/2 * einsum('xyAB,JKxy->AJKB', t1_aaee, t1_xvaa, optimize = einsum_type)
                T_e_cve -= 1/2 * einsum('xyAB,JKyx->AJKB', t1_aaee, t1_xvaa, optimize = einsum_type)
                T_e_cve -= 1/2 * einsum('JKAx,xyBz,zy->AJKB', t1_xvea, t1_aaea, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('JKAx,yxBz,zy->AJKB', t1_xvea, t1_aaea, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/2 * einsum('JxAB,Kyxz,yz->AJKB', t1_xaee, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('JxAB,Kyzx,yz->AJKB', t1_xaee, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/2 * einsum('JxAy,KyBz,xz->AJKB', t1_xaea, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('JxAy,KyzB,xz->AJKB', t1_xaea, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/2 * einsum('JxAy,KzBx,yz->AJKB', t1_xaea, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('JxAy,KzxB,yz->AJKB', t1_xaea, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/2 * einsum('JxBA,Kyxz,yz->AJKB', t1_xaee, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('JxBA,Kyzx,yz->AJKB', t1_xaee, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/2 * einsum('JxBy,KyAz,xz->AJKB', t1_xaea, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('JxBy,KyzA,xz->AJKB', t1_xaea, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/2 * einsum('JxBy,KzAx,yz->AJKB', t1_xaea, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('JxBy,KzxA,yz->AJKB', t1_xaea, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('JxyA,KyBz,xz->AJKB', t1_xaae, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('JxyA,KyzB,xz->AJKB', t1_xaae, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('JxyA,KzBx,yz->AJKB', t1_xaae, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('JxyA,KzxB,yz->AJKB', t1_xaae, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('JxyB,KyAz,xz->AJKB', t1_xaae, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('JxyB,KyzA,xz->AJKB', t1_xaae, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('JxyB,KzAx,yz->AJKB', t1_xaae, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('JxyB,KzxA,yz->AJKB', t1_xaae, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/2 * einsum('KxAB,Jyxz,yz->AJKB', t1_vaee, t1_xaaa, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('KxAB,Jyzx,yz->AJKB', t1_vaee, t1_xaaa, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/2 * einsum('KxBA,Jyxz,yz->AJKB', t1_vaee, t1_xaaa, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('KxBA,Jyzx,yz->AJKB', t1_vaee, t1_xaaa, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('xyAB,JKxz,yz->AJKB', t1_aaee, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('xyAB,JKyz,xz->AJKB', t1_aaee, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('xyAB,JKzx,yz->AJKB', t1_aaee, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('xyAB,JKzy,xz->AJKB', t1_aaee, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/2 * einsum('xyAz,JKBx,zy->AJKB', t1_aaea, t1_xvea, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('xyAz,JKBy,zx->AJKB', t1_aaea, t1_xvea, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/2 * einsum('xyAz,JKxB,zy->AJKB', t1_aaea, t1_xvae, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('xyAz,JKyB,zx->AJKB', t1_aaea, t1_xvae, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/2 * einsum('xyBz,JKxA,zy->AJKB', t1_aaea, t1_xvae, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('xyBz,JKyA,zx->AJKB', t1_aaea, t1_xvae, rdm_ca, optimize = einsum_type)
                T[nocc:, s_cve__aaa:f_cve__aaa] += T_e_cve.reshape(nextern, -1)

                T_e_cve  = einsum('JKAB->AJKB', t2_xvee, optimize = einsum_type).copy()
                T_e_cve += 1/2 * einsum('JxAB,Kx->AJKB', t1_xaee, t1_va, optimize = einsum_type)
                T_e_cve += 1/2 * einsum('KxBA,Jx->AJKB', t1_vaee, t1_xa, optimize = einsum_type)
                T_e_cve += 1/2 * einsum('xA,JKxB->AJKB', t1_ae, t1_xvae, optimize = einsum_type)
                T_e_cve -= 1/2 * einsum('xB,JKAx->AJKB', t1_ae, t1_xvea, optimize = einsum_type)
                T_e_cve += 1/2 * einsum('xyAB,JKxy->AJKB', t1_aaee, t1_xvaa, optimize = einsum_type)
                T_e_cve -= 1/2 * einsum('JKAx,xyBz,zy->AJKB', t1_xvea, t1_aaea, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('JKAx,yxBz,zy->AJKB', t1_xvea, t1_aaea, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/2 * einsum('JxAB,Kyxz,yz->AJKB', t1_xaee, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('JxAB,Kyzx,yz->AJKB', t1_xaee, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/2 * einsum('JxAy,KyBz,xz->AJKB', t1_xaea, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('JxAy,KyzB,xz->AJKB', t1_xaea, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/2 * einsum('JxAy,KzBx,yz->AJKB', t1_xaea, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('JxAy,KzxB,yz->AJKB', t1_xaea, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('JxyA,KyBz,xz->AJKB', t1_xaae, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('JxyA,KzBx,yz->AJKB', t1_xaae, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('JxyB,KyzA,xz->AJKB', t1_xaae, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('JxyB,KzxA,yz->AJKB', t1_xaae, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/2 * einsum('KxBA,Jyxz,yz->AJKB', t1_vaee, t1_xaaa, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('KxBA,Jyzx,yz->AJKB', t1_vaee, t1_xaaa, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('xyAB,JKxz,yz->AJKB', t1_aaee, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('xyAB,JKzy,xz->AJKB', t1_aaee, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/2 * einsum('xyAz,JKxB,zy->AJKB', t1_aaea, t1_xvae, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('xyAz,JKyB,zx->AJKB', t1_aaea, t1_xvae, rdm_ca, optimize = einsum_type)
                T[nocc:, s_cve__abb:f_cve__abb] += T_e_cve.reshape(nextern, -1)

                T_e_cve =- einsum('JKBA->AJKB', t2_xvee, optimize = einsum_type).copy()
                T_e_cve -= 1/2 * einsum('JxBA,Kx->AJKB', t1_xaee, t1_va, optimize = einsum_type)
                T_e_cve -= 1/2 * einsum('KxAB,Jx->AJKB', t1_vaee, t1_xa, optimize = einsum_type)
                T_e_cve -= 1/2 * einsum('xA,JKBx->AJKB', t1_ae, t1_xvea, optimize = einsum_type)
                T_e_cve += 1/2 * einsum('xB,JKxA->AJKB', t1_ae, t1_xvae, optimize = einsum_type)
                T_e_cve -= 1/2 * einsum('xyAB,JKyx->AJKB', t1_aaee, t1_xvaa, optimize = einsum_type)
                T_e_cve -= 1/2 * einsum('JxBA,Kyxz,yz->AJKB', t1_xaee, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('JxBA,Kyzx,yz->AJKB', t1_xaee, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/2 * einsum('JxBy,KyAz,xz->AJKB', t1_xaea, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('JxBy,KyzA,xz->AJKB', t1_xaea, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/2 * einsum('JxBy,KzAx,yz->AJKB', t1_xaea, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('JxBy,KzxA,yz->AJKB', t1_xaea, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('JxyA,KyzB,xz->AJKB', t1_xaae, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('JxyA,KzxB,yz->AJKB', t1_xaae, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('JxyB,KyAz,xz->AJKB', t1_xaae, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('JxyB,KzAx,yz->AJKB', t1_xaae, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/2 * einsum('KxAB,Jyxz,yz->AJKB', t1_vaee, t1_xaaa, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('KxAB,Jyzx,yz->AJKB', t1_vaee, t1_xaaa, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('xyAB,JKyz,xz->AJKB', t1_aaee, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('xyAB,JKzx,yz->AJKB', t1_aaee, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/2 * einsum('xyAz,JKBx,zy->AJKB', t1_aaea, t1_xvea, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/4 * einsum('xyAz,JKBy,zx->AJKB', t1_aaea, t1_xvea, rdm_ca, optimize = einsum_type)
                T_e_cve += 1/2 * einsum('xyBz,JKxA,zy->AJKB', t1_aaea, t1_xvae, rdm_ca, optimize = einsum_type)
                T_e_cve -= 1/4 * einsum('xyBz,JKyA,zx->AJKB', t1_aaea, t1_xvae, rdm_ca, optimize = einsum_type)
                T[nocc:, s_cve__bab:f_cve__bab] += T_e_cve.reshape(nextern, -1)

            # VIRTUAL(2) - CAE
            T_e_cae  = 1/2 * einsum('JxAB,Yx->AJYB', t2_xaee, rdm_ca, optimize = einsum_type)
            T_e_cae -= 1/2 * einsum('JxBA,Yx->AJYB', t2_xaee, rdm_ca, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('JiAB,ix,Yx->AJYB', t1_xxee, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('JiAB,ixyz,Yxyz->AJYB', t1_xxee, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('JiBA,ixyz,Yxyz->AJYB', t1_xxee, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('JiAB,ix,Yx->AJYB', t1_xvee, t1_va, rdm_ca, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('JiAB,ixyz,Yxyz->AJYB', t1_xvee, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('JiBA,ix,Yx->AJYB', t1_xvee, t1_va, rdm_ca, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('JiBA,ixyz,Yxyz->AJYB', t1_xvee, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('JxAy,yzBw,Ywxz->AJYB', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('JxAy,zwBx,Yyzw->AJYB', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('JxAy,zyBw,Ywzx->AJYB', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('iJAB,ix,Yx->AJYB', t1_xxee, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('xA,JyBx,Yy->AJYB', t1_ae, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('xA,JyxB,Yy->AJYB', t1_ae, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('xB,JyAx,Yy->AJYB', t1_ae, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('xB,JyxA,Yy->AJYB', t1_ae, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('xyAB,Jx,Yy->AJYB', t1_aaee, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('xyAB,Jy,Yx->AJYB', t1_aaee, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_cae -= 1/12 * einsum('xyAB,Jzwx,Ywyz->AJYB', t1_aaee, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/12 * einsum('xyAB,Jzwx,Ywzy->AJYB', t1_aaee, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/12 * einsum('xyAB,Jzwy,Ywxz->AJYB', t1_aaee, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/12 * einsum('xyAB,Jzwy,Ywzx->AJYB', t1_aaee, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('xyAB,Jzxw,Ywyz->AJYB', t1_aaee, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('xyAB,Jzxy,Yz->AJYB', t1_aaee, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('xyAB,Jzyw,Ywxz->AJYB', t1_aaee, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('xyAB,Jzyx,Yz->AJYB', t1_aaee, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('xyAz,JwBx,Yzwy->AJYB', t1_aaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('xyAz,JwBy,Yzxw->AJYB', t1_aaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('xyAz,JwxB,Yzwy->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/12 * einsum('xyAz,JwyB,Yzwx->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/12 * einsum('xyAz,JwyB,Yzxw->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('xyAz,JzBw,Ywxy->AJYB', t1_aaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/12 * einsum('xyAz,JzwB,Ywxy->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/12 * einsum('xyAz,JzwB,Ywyx->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('xyBz,JwxA,Yzwy->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/12 * einsum('xyBz,JwyA,Yzwx->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/12 * einsum('xyBz,JwyA,Yzxw->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/12 * einsum('xyBz,JzwA,Ywxy->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/12 * einsum('xyBz,JzwA,Ywyx->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T[nocc:, s_cae__aaa:f_cae__aaa] += T_e_cae.reshape(nextern, -1)

            T_e_cae  = 1/2 * einsum('JxAB,Yx->AJYB', t2_xaee, rdm_ca, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('JiAB,ix,Yx->AJYB', t1_xxee, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('JiAB,ixyz,Yxyz->AJYB', t1_xxee, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('JiAB,ix,Yx->AJYB', t1_xvee, t1_va, rdm_ca, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('JiAB,ixyz,Yxyz->AJYB', t1_xvee, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('JxAy,yzBw,Ywxz->AJYB', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('JxAy,zwBx,Yyzw->AJYB', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('JxAy,zyBw,Ywzx->AJYB', t1_xaea, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('xA,JyxB,Yy->AJYB', t1_ae, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('xB,JyAx,Yy->AJYB', t1_ae, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('xyAB,Jx,Yy->AJYB', t1_aaee, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_cae -= 1/6 * einsum('xyAB,Jzwx,Ywyz->AJYB', t1_aaee, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/12 * einsum('xyAB,Jzwx,Ywzy->AJYB', t1_aaee, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/12 * einsum('xyAB,Jzwy,Ywxz->AJYB', t1_aaee, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/6 * einsum('xyAB,Jzwy,Ywzx->AJYB', t1_aaee, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('xyAB,Jzxw,Ywyz->AJYB', t1_aaee, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('xyAB,Jzxy,Yz->AJYB', t1_aaee, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('xyAz,JwxB,Yzwy->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/6 * einsum('xyAz,JwyB,Yzwx->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/12 * einsum('xyAz,JwyB,Yzxw->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/12 * einsum('xyAz,JzwB,Ywxy->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/6 * einsum('xyAz,JzwB,Ywyx->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/12 * einsum('xyBz,JwyA,Yzwx->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/6 * einsum('xyBz,JwyA,Yzxw->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/6 * einsum('xyBz,JzwA,Ywxy->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/12 * einsum('xyBz,JzwA,Ywyx->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T[nocc:, s_cae__abb:f_cae__abb] += T_e_cae.reshape(nextern, -1)

            T_e_cae =- 1/2 * einsum('JxBA,Yx->AJYB', t2_xaee, rdm_ca, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('JiBA,ixyz,Yxyz->AJYB', t1_xxee, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('JiBA,ix,Yx->AJYB', t1_xvee, t1_va, rdm_ca, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('JiBA,ixyz,Yxyz->AJYB', t1_xvee, t1_vaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('iJAB,ix,Yx->AJYB', t1_xxee, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('xA,JyBx,Yy->AJYB', t1_ae, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('xB,JyxA,Yy->AJYB', t1_ae, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('xyAB,Jy,Yx->AJYB', t1_aaee, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_cae += 1/12 * einsum('xyAB,Jzwx,Ywyz->AJYB', t1_aaee, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/6 * einsum('xyAB,Jzwx,Ywzy->AJYB', t1_aaee, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/6 * einsum('xyAB,Jzwy,Ywxz->AJYB', t1_aaee, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/12 * einsum('xyAB,Jzwy,Ywzx->AJYB', t1_aaee, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('xyAB,Jzyw,Ywxz->AJYB', t1_aaee, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('xyAB,Jzyx,Yz->AJYB', t1_aaee, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('xyAz,JwBx,Yzwy->AJYB', t1_aaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/4 * einsum('xyAz,JwBy,Yzxw->AJYB', t1_aaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/12 * einsum('xyAz,JwyB,Yzwx->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/6 * einsum('xyAz,JwyB,Yzxw->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('xyAz,JzBw,Ywxy->AJYB', t1_aaea, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/6 * einsum('xyAz,JzwB,Ywxy->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/12 * einsum('xyAz,JzwB,Ywyx->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/4 * einsum('xyBz,JwxA,Yzwy->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/6 * einsum('xyBz,JwyA,Yzwx->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae -= 1/12 * einsum('xyBz,JwyA,Yzxw->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/12 * einsum('xyBz,JzwA,Ywxy->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cae += 1/6 * einsum('xyBz,JzwA,Ywyx->AJYB', t1_aaea, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T[nocc:, s_cae__bab:f_cae__bab] += T_e_cae.reshape(nextern, -1)

            # VIRTUAL(2) - CCA
            T_e_cca  = einsum('JKAY->AJKY', t2_xxea, optimize = einsum_type).copy()
            T_e_cca -= einsum('KJAY->AJKY', t2_xxea, optimize = einsum_type).copy()
            T_e_cca += 1/2 * einsum('JKAa,Ya->AJKY', t1_xxee, t1_ae, optimize = einsum_type)
            T_e_cca -= 1/2 * einsum('Jx,KxAY->AJKY', t1_xa, t1_xaea, optimize = einsum_type)
            T_e_cca += 1/2 * einsum('Jx,KxYA->AJKY', t1_xa, t1_xaae, optimize = einsum_type)
            T_e_cca += 1/2 * einsum('JxAY,Kx->AJKY', t1_xaea, t1_xa, optimize = einsum_type)
            T_e_cca -= 1/2 * einsum('JxYA,Kx->AJKY', t1_xaae, t1_xa, optimize = einsum_type)
            T_e_cca -= 1/2 * einsum('KJAa,Ya->AJKY', t1_xxee, t1_ae, optimize = einsum_type)
            T_e_cca -= 1/2 * einsum('xA,JKYx->AJKY', t1_ae, t1_xxaa, optimize = einsum_type)
            T_e_cca += 1/2 * einsum('xA,JKxY->AJKY', t1_ae, t1_xxaa, optimize = einsum_type)
            T_e_cca += 1/2 * einsum('xyAY,JKxy->AJKY', t1_aaea, t1_xxaa, optimize = einsum_type)
            T_e_cca -= 1/2 * einsum('xyAY,JKyx->AJKY', t1_aaea, t1_xxaa, optimize = einsum_type)
            T_e_cca -= 1/2 * einsum('JKAx,Yx->AJKY', t2_xxea, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/2 * einsum('KJAx,Yx->AJKY', t2_xxea, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JKAa,xa,Yx->AJKY', t1_xxee, t1_ae, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/2 * einsum('JKAa,Yxay,xy->AJKY', t1_xxee, t1_aaea, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JKAa,xYay,yx->AJKY', t1_xxee, t1_aaea, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JKAa,xyaz,Yzxy->AJKY', t1_xxee, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/2 * einsum('JKaA,Yxay,xy->AJKY', t1_xxee, t1_aaea, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('JKaA,xYay,yx->AJKY', t1_xxee, t1_aaea, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('JKaA,xyaz,Yzxy->AJKY', t1_xxee, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('Jx,KxAy,Yy->AJKY', t1_xa, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('Jx,KxyA,Yy->AJKY', t1_xa, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/2 * einsum('JxAY,Kyxz,yz->AJKY', t1_xaea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JxAY,Kyzx,yz->AJKY', t1_xaea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JxAy,Kx,Yy->AJKY', t1_xaea, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/2 * einsum('JxAy,KyYz,xz->AJKY', t1_xaea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('JxAy,KyzY,xz->AJKY', t1_xaea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('JxAy,Kyzw,Yxzw->AJKY', t1_xaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca += 1/2 * einsum('JxAy,KzYx,yz->AJKY', t1_xaea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JxAy,Kzwx,Yzwy->AJKY', t1_xaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JxAy,KzxY,yz->AJKY', t1_xaea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JxAy,Kzxw,Yzyw->AJKY', t1_xaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/2 * einsum('JxYA,Kyxz,yz->AJKY', t1_xaae, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('JxYA,Kyzx,yz->AJKY', t1_xaae, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/2 * einsum('JxYy,KyAz,xz->AJKY', t1_xaaa, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('JxYy,KyzA,xz->AJKY', t1_xaaa, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/2 * einsum('JxYy,KzAx,yz->AJKY', t1_xaaa, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JxYy,KzxA,yz->AJKY', t1_xaaa, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('JxyA,Kx,Yy->AJKY', t1_xaae, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('JxyA,KyYz,xz->AJKY', t1_xaae, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JxyA,KyzY,xz->AJKY', t1_xaae, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/12 * einsum('JxyA,Kyzw,Yxwz->AJKY', t1_xaae, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/12 * einsum('JxyA,Kyzw,Yxzw->AJKY', t1_xaae, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JxyA,KzYx,yz->AJKY', t1_xaae, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/12 * einsum('JxyA,Kzwx,Yzwy->AJKY', t1_xaae, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/12 * einsum('JxyA,Kzwx,Yzyw->AJKY', t1_xaae, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('JxyA,KzxY,yz->AJKY', t1_xaae, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('JxyA,Kzxw,Yzyw->AJKY', t1_xaae, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('JxyY,KyAz,xz->AJKY', t1_xaaa, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JxyY,KyzA,xz->AJKY', t1_xaaa, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JxyY,KzAx,yz->AJKY', t1_xaaa, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('JxyY,KzxA,yz->AJKY', t1_xaaa, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('Jxyz,KwAx,Ywyz->AJKY', t1_xaaa, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_e_cca += 1/12 * einsum('Jxyz,KwxA,Ywyz->AJKY', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/12 * einsum('Jxyz,KwxA,Ywzy->AJKY', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/2 * einsum('Jxyz,KyAY,xz->AJKY', t1_xaaa, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('Jxyz,KyAw,Yxwz->AJKY', t1_xaaa, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_e_cca += 1/2 * einsum('Jxyz,KyYA,xz->AJKY', t1_xaaa, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('Jxyz,KywA,Yxwz->AJKY', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('Jxyz,KzAY,xy->AJKY', t1_xaaa, t1_xaea, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('Jxyz,KzAw,Yxyw->AJKY', t1_xaaa, t1_xaea, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('Jxyz,KzYA,xy->AJKY', t1_xaaa, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/12 * einsum('Jxyz,KzwA,Yxwy->AJKY', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/12 * einsum('Jxyz,KzwA,Yxyw->AJKY', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('KJAa,xa,Yx->AJKY', t1_xxee, t1_ae, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('xA,JKxy,Yy->AJKY', t1_ae, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('xA,JKyx,Yy->AJKY', t1_ae, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('xyAY,JKxz,yz->AJKY', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('xyAY,JKyz,xz->AJKY', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('xyAY,JKzx,yz->AJKY', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('xyAY,JKzy,xz->AJKY', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/2 * einsum('xyAz,JKYx,zy->AJKY', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('xyAz,JKYy,zx->AJKY', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('xyAz,JKwx,Yywz->AJKY', t1_aaea, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/12 * einsum('xyAz,JKwy,Yxwz->AJKY', t1_aaea, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca += 1/12 * einsum('xyAz,JKwy,Yxzw->AJKY', t1_aaea, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca += 1/2 * einsum('xyAz,JKxY,zy->AJKY', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('xyAz,JKxw,Yywz->AJKY', t1_aaea, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('xyAz,JKxy,Yz->AJKY', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('xyAz,JKyY,zx->AJKY', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/12 * einsum('xyAz,JKyw,Yxwz->AJKY', t1_aaea, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/12 * einsum('xyAz,JKyw,Yxzw->AJKY', t1_aaea, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('xyAz,JKyx,Yz->AJKY', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
            T[nocc:, s_cca__aaa:f_cca__aaa] += T_e_cca[:, cvs_tril_ind[0], cvs_tril_ind[1]].reshape(nextern, -1)

            T_e_cca  = einsum('JKAY->AJKY', t2_xxea, optimize = einsum_type).copy()
            T_e_cca += 1/2 * einsum('JKAa,Ya->AJKY', t1_xxee, t1_ae, optimize = einsum_type)
            T_e_cca += 1/2 * einsum('Jx,KxYA->AJKY', t1_xa, t1_xaae, optimize = einsum_type)
            T_e_cca += 1/2 * einsum('JxAY,Kx->AJKY', t1_xaea, t1_xa, optimize = einsum_type)
            T_e_cca += 1/2 * einsum('xA,JKxY->AJKY', t1_ae, t1_xxaa, optimize = einsum_type)
            T_e_cca += 1/2 * einsum('xyAY,JKxy->AJKY', t1_aaea, t1_xxaa, optimize = einsum_type)
            T_e_cca -= 1/2 * einsum('JKAx,Yx->AJKY', t2_xxea, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JKAa,xa,Yx->AJKY', t1_xxee, t1_ae, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/2 * einsum('JKAa,Yxay,xy->AJKY', t1_xxee, t1_aaea, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JKAa,xYay,yx->AJKY', t1_xxee, t1_aaea, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JKAa,xyaz,Yzxy->AJKY', t1_xxee, t1_aaea, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('Jx,KxyA,Yy->AJKY', t1_xa, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/2 * einsum('JxAY,Kyxz,yz->AJKY', t1_xaea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JxAY,Kyzx,yz->AJKY', t1_xaea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JxAy,Kx,Yy->AJKY', t1_xaea, t1_xa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/2 * einsum('JxAy,KyYz,xz->AJKY', t1_xaea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('JxAy,KyzY,xz->AJKY', t1_xaea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('JxAy,Kyzw,Yxzw->AJKY', t1_xaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca += 1/2 * einsum('JxAy,KzYx,yz->AJKY', t1_xaea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JxAy,Kzwx,Yzwy->AJKY', t1_xaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JxAy,KzxY,yz->AJKY', t1_xaea, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JxAy,Kzxw,Yzyw->AJKY', t1_xaea, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('JxyA,KyYz,xz->AJKY', t1_xaae, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/12 * einsum('JxyA,Kyzw,Yxwz->AJKY', t1_xaae, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/6 * einsum('JxyA,Kyzw,Yxzw->AJKY', t1_xaae, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JxyA,KzYx,yz->AJKY', t1_xaae, t1_xaaa, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/6 * einsum('JxyA,Kzwx,Yzwy->AJKY', t1_xaae, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca += 1/12 * einsum('JxyA,Kzwx,Yzyw->AJKY', t1_xaae, t1_xaaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('JxyY,KyzA,xz->AJKY', t1_xaaa, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/4 * einsum('JxyY,KzxA,yz->AJKY', t1_xaaa, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/12 * einsum('Jxyz,KwxA,Ywyz->AJKY', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/6 * einsum('Jxyz,KwxA,Ywzy->AJKY', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cca += 1/2 * einsum('Jxyz,KyYA,xz->AJKY', t1_xaaa, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('Jxyz,KywA,Yxwz->AJKY', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('Jxyz,KzYA,xy->AJKY', t1_xaaa, t1_xaae, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/6 * einsum('Jxyz,KzwA,Yxwy->AJKY', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cca += 1/12 * einsum('Jxyz,KzwA,Yxyw->AJKY', t1_xaaa, t1_xaae, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('xA,JKxy,Yy->AJKY', t1_ae, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('xyAY,JKxz,yz->AJKY', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('xyAY,JKzy,xz->AJKY', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/12 * einsum('xyAz,JKwy,Yxwz->AJKY', t1_aaea, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca += 1/6 * einsum('xyAz,JKwy,Yxzw->AJKY', t1_aaea, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca += 1/2 * einsum('xyAz,JKxY,zy->AJKY', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('xyAz,JKxw,Yywz->AJKY', t1_aaea, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('xyAz,JKxy,Yz->AJKY', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cca -= 1/4 * einsum('xyAz,JKyY,zx->AJKY', t1_aaea, t1_xxaa, rdm_ca, optimize = einsum_type)
            T_e_cca += 1/6 * einsum('xyAz,JKyw,Yxwz->AJKY', t1_aaea, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T_e_cca += 1/12 * einsum('xyAz,JKyw,Yxzw->AJKY', t1_aaea, t1_xxaa, rdm_ccaa, optimize = einsum_type)
            T[nocc:, s_cca__abb:f_cca__abb] += T_e_cca.reshape(nextern, -1)

            # VIRTUAL(2) - CVA
            if nval > 0:
                T_e_cva  = einsum('JKAY->AJKY', t2_xvea, optimize = einsum_type).copy()
                T_e_cva -= einsum('JKYA->AJKY', t2_xvae, optimize = einsum_type).copy()
                T_e_cva += 1/2 * einsum('JKAa,Ya->AJKY', t1_xvee, t1_ae, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('JKaA,Ya->AJKY', t1_xvee, t1_ae, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('Jx,KxAY->AJKY', t1_xa, t1_vaea, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('Jx,KxYA->AJKY', t1_xa, t1_vaae, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('JxAY,Kx->AJKY', t1_xaea, t1_va, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('JxYA,Kx->AJKY', t1_xaae, t1_va, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('xA,JKYx->AJKY', t1_ae, t1_xvaa, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('xA,JKxY->AJKY', t1_ae, t1_xvaa, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('xyAY,JKxy->AJKY', t1_aaea, t1_xvaa, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('xyAY,JKyx->AJKY', t1_aaea, t1_xvaa, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('JKAx,Yx->AJKY', t2_xvea, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('JKxA,Yx->AJKY', t2_xvae, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('JKAa,Yxay,xy->AJKY', t1_xvee, t1_aaea, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JKAa,xYay,yx->AJKY', t1_xvee, t1_aaea, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JKAa,xa,Yx->AJKY', t1_xvee, t1_ae, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JKAa,xyaz,Yzxy->AJKY', t1_xvee, t1_aaea, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('JKaA,Yxay,xy->AJKY', t1_xvee, t1_aaea, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JKaA,xYay,yx->AJKY', t1_xvee, t1_aaea, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JKaA,xa,Yx->AJKY', t1_xvee, t1_ae, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JKaA,xyaz,Yzxy->AJKY', t1_xvee, t1_aaea, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('Jx,KxAy,Yy->AJKY', t1_xa, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('Jx,KxyA,Yy->AJKY', t1_xa, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('JxAY,Kyxz,yz->AJKY', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JxAY,Kyzx,yz->AJKY', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JxAy,Kx,Yy->AJKY', t1_xaea, t1_va, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('JxAy,KyYz,xz->AJKY', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JxAy,KyzY,xz->AJKY', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JxAy,Kyzw,Yxzw->AJKY', t1_xaea, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('JxAy,KzYx,yz->AJKY', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JxAy,Kzwx,Yzwy->AJKY', t1_xaea, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JxAy,KzxY,yz->AJKY', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JxAy,Kzxw,Yzyw->AJKY', t1_xaea, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('JxYA,Kyxz,yz->AJKY', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JxYA,Kyzx,yz->AJKY', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('JxYy,KyAz,xz->AJKY', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JxYy,KyzA,xz->AJKY', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('JxYy,KzAx,yz->AJKY', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JxYy,KzxA,yz->AJKY', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JxyA,Kx,Yy->AJKY', t1_xaae, t1_va, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JxyA,KyYz,xz->AJKY', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JxyA,KyzY,xz->AJKY', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/12 * einsum('JxyA,Kyzw,Yxwz->AJKY', t1_xaae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/12 * einsum('JxyA,Kyzw,Yxzw->AJKY', t1_xaae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JxyA,KzYx,yz->AJKY', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/12 * einsum('JxyA,Kzwx,Yzwy->AJKY', t1_xaae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/12 * einsum('JxyA,Kzwx,Yzyw->AJKY', t1_xaae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JxyA,KzxY,yz->AJKY', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JxyA,Kzxw,Yzyw->AJKY', t1_xaae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JxyY,KyAz,xz->AJKY', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JxyY,KyzA,xz->AJKY', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JxyY,KzAx,yz->AJKY', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JxyY,KzxA,yz->AJKY', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('Jxyz,KwAx,Ywyz->AJKY', t1_xaaa, t1_vaea, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/12 * einsum('Jxyz,KwxA,Ywyz->AJKY', t1_xaaa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/12 * einsum('Jxyz,KwxA,Ywzy->AJKY', t1_xaaa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('Jxyz,KyAY,xz->AJKY', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('Jxyz,KyAw,Yxwz->AJKY', t1_xaaa, t1_vaea, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('Jxyz,KyYA,xz->AJKY', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('Jxyz,KywA,Yxwz->AJKY', t1_xaaa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('Jxyz,KzAY,xy->AJKY', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('Jxyz,KzAw,Yxyw->AJKY', t1_xaaa, t1_vaea, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('Jxyz,KzYA,xy->AJKY', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/12 * einsum('Jxyz,KzwA,Yxwy->AJKY', t1_xaaa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/12 * einsum('Jxyz,KzwA,Yxyw->AJKY', t1_xaaa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('xA,JKxy,Yy->AJKY', t1_ae, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('xA,JKyx,Yy->AJKY', t1_ae, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('xyAY,JKxz,yz->AJKY', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('xyAY,JKyz,xz->AJKY', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('xyAY,JKzx,yz->AJKY', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('xyAY,JKzy,xz->AJKY', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('xyAz,JKYx,zy->AJKY', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('xyAz,JKYy,zx->AJKY', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('xyAz,JKwx,Yywz->AJKY', t1_aaea, t1_xvaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/12 * einsum('xyAz,JKwy,Yxwz->AJKY', t1_aaea, t1_xvaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/12 * einsum('xyAz,JKwy,Yxzw->AJKY', t1_aaea, t1_xvaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('xyAz,JKxY,zy->AJKY', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('xyAz,JKxw,Yywz->AJKY', t1_aaea, t1_xvaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('xyAz,JKxy,Yz->AJKY', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('xyAz,JKyY,zx->AJKY', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/12 * einsum('xyAz,JKyw,Yxwz->AJKY', t1_aaea, t1_xvaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/12 * einsum('xyAz,JKyw,Yxzw->AJKY', t1_aaea, t1_xvaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('xyAz,JKyx,Yz->AJKY', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
                T[nocc:, s_cva__aaa:f_cva__aaa] += T_e_cva.reshape(nextern, -1)

                T_e_cva  = einsum('JKAY->AJKY', t2_xvea, optimize = einsum_type).copy()
                T_e_cva += 1/2 * einsum('JKAa,Ya->AJKY', t1_xvee, t1_ae, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('Jx,KxYA->AJKY', t1_xa, t1_vaae, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('JxAY,Kx->AJKY', t1_xaea, t1_va, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('xA,JKxY->AJKY', t1_ae, t1_xvaa, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('xyAY,JKxy->AJKY', t1_aaea, t1_xvaa, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('JKAx,Yx->AJKY', t2_xvea, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('JKAa,Yxay,xy->AJKY', t1_xvee, t1_aaea, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JKAa,xYay,yx->AJKY', t1_xvee, t1_aaea, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JKAa,xa,Yx->AJKY', t1_xvee, t1_ae, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JKAa,xyaz,Yzxy->AJKY', t1_xvee, t1_aaea, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('Jx,KxyA,Yy->AJKY', t1_xa, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('JxAY,Kyxz,yz->AJKY', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JxAY,Kyzx,yz->AJKY', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JxAy,Kx,Yy->AJKY', t1_xaea, t1_va, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('JxAy,KyYz,xz->AJKY', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JxAy,KyzY,xz->AJKY', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JxAy,Kyzw,Yxzw->AJKY', t1_xaea, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('JxAy,KzYx,yz->AJKY', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JxAy,Kzwx,Yzwy->AJKY', t1_xaea, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JxAy,KzxY,yz->AJKY', t1_xaea, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JxAy,Kzxw,Yzyw->AJKY', t1_xaea, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JxyA,KyYz,xz->AJKY', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/12 * einsum('JxyA,Kyzw,Yxwz->AJKY', t1_xaae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/6 * einsum('JxyA,Kyzw,Yxzw->AJKY', t1_xaae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JxyA,KzYx,yz->AJKY', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/6 * einsum('JxyA,Kzwx,Yzwy->AJKY', t1_xaae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/12 * einsum('JxyA,Kzwx,Yzyw->AJKY', t1_xaae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JxyY,KyzA,xz->AJKY', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JxyY,KzxA,yz->AJKY', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/12 * einsum('Jxyz,KwxA,Ywyz->AJKY', t1_xaaa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/6 * einsum('Jxyz,KwxA,Ywzy->AJKY', t1_xaaa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('Jxyz,KyYA,xz->AJKY', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('Jxyz,KywA,Yxwz->AJKY', t1_xaaa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('Jxyz,KzYA,xy->AJKY', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/6 * einsum('Jxyz,KzwA,Yxwy->AJKY', t1_xaaa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/12 * einsum('Jxyz,KzwA,Yxyw->AJKY', t1_xaaa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('xA,JKxy,Yy->AJKY', t1_ae, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('xyAY,JKxz,yz->AJKY', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('xyAY,JKzy,xz->AJKY', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/12 * einsum('xyAz,JKwy,Yxwz->AJKY', t1_aaea, t1_xvaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/6 * einsum('xyAz,JKwy,Yxzw->AJKY', t1_aaea, t1_xvaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('xyAz,JKxY,zy->AJKY', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('xyAz,JKxw,Yywz->AJKY', t1_aaea, t1_xvaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('xyAz,JKxy,Yz->AJKY', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('xyAz,JKyY,zx->AJKY', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/6 * einsum('xyAz,JKyw,Yxwz->AJKY', t1_aaea, t1_xvaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/12 * einsum('xyAz,JKyw,Yxzw->AJKY', t1_aaea, t1_xvaa, rdm_ccaa, optimize = einsum_type)
                T[nocc:, s_cva__abb:f_cva__abb] += T_e_cva.reshape(nextern, -1)

                T_e_cva =- einsum('JKYA->AJKY', t2_xvae, optimize = einsum_type).copy()
                T_e_cva -= 1/2 * einsum('JKaA,Ya->AJKY', t1_xvee, t1_ae, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('Jx,KxAY->AJKY', t1_xa, t1_vaea, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('JxYA,Kx->AJKY', t1_xaae, t1_va, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('xA,JKYx->AJKY', t1_ae, t1_xvaa, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('xyAY,JKyx->AJKY', t1_aaea, t1_xvaa, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('JKxA,Yx->AJKY', t2_xvae, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('JKaA,Yxay,xy->AJKY', t1_xvee, t1_aaea, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JKaA,xYay,yx->AJKY', t1_xvee, t1_aaea, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JKaA,xa,Yx->AJKY', t1_xvee, t1_ae, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JKaA,xyaz,Yzxy->AJKY', t1_xvee, t1_aaea, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('Jx,KxAy,Yy->AJKY', t1_xa, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('JxYA,Kyxz,yz->AJKY', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JxYA,Kyzx,yz->AJKY', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('JxYy,KyAz,xz->AJKY', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JxYy,KyzA,xz->AJKY', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/2 * einsum('JxYy,KzAx,yz->AJKY', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JxYy,KzxA,yz->AJKY', t1_xaaa, t1_vaae, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JxyA,Kx,Yy->AJKY', t1_xaae, t1_va, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JxyA,KyzY,xz->AJKY', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/6 * einsum('JxyA,Kyzw,Yxwz->AJKY', t1_xaae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/12 * einsum('JxyA,Kyzw,Yxzw->AJKY', t1_xaae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/12 * einsum('JxyA,Kzwx,Yzwy->AJKY', t1_xaae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/6 * einsum('JxyA,Kzwx,Yzyw->AJKY', t1_xaae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JxyA,KzxY,yz->AJKY', t1_xaae, t1_vaaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JxyA,Kzxw,Yzyw->AJKY', t1_xaae, t1_vaaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('JxyY,KyAz,xz->AJKY', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('JxyY,KzAx,yz->AJKY', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/4 * einsum('Jxyz,KwAx,Ywyz->AJKY', t1_xaaa, t1_vaea, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/6 * einsum('Jxyz,KwxA,Ywyz->AJKY', t1_xaaa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/12 * einsum('Jxyz,KwxA,Ywzy->AJKY', t1_xaaa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('Jxyz,KyAY,xz->AJKY', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('Jxyz,KyAw,Yxwz->AJKY', t1_xaaa, t1_vaea, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('Jxyz,KzAY,xy->AJKY', t1_xaaa, t1_vaea, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('Jxyz,KzAw,Yxyw->AJKY', t1_xaaa, t1_vaea, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/12 * einsum('Jxyz,KzwA,Yxwy->AJKY', t1_xaaa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/6 * einsum('Jxyz,KzwA,Yxyw->AJKY', t1_xaaa, t1_vaae, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('xA,JKyx,Yy->AJKY', t1_ae, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('xyAY,JKyz,xz->AJKY', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('xyAY,JKzx,yz->AJKY', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva -= 1/2 * einsum('xyAz,JKYx,zy->AJKY', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('xyAz,JKYy,zx->AJKY', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('xyAz,JKwx,Yywz->AJKY', t1_aaea, t1_xvaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/6 * einsum('xyAz,JKwy,Yxwz->AJKY', t1_aaea, t1_xvaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/12 * einsum('xyAz,JKwy,Yxzw->AJKY', t1_aaea, t1_xvaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/12 * einsum('xyAz,JKyw,Yxwz->AJKY', t1_aaea, t1_xvaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva -= 1/6 * einsum('xyAz,JKyw,Yxzw->AJKY', t1_aaea, t1_xvaa, rdm_ccaa, optimize = einsum_type)
                T_e_cva += 1/4 * einsum('xyAz,JKyx,Yz->AJKY', t1_aaea, t1_xvaa, rdm_ca, optimize = einsum_type)
                T[nocc:, s_cva__bab:f_cva__bab] += T_e_cva.reshape(nextern, -1)

    # Transform to the orthogonal basis
    if mr_adc.method in ("mr-adc(2)", "mr-adc(2)-x"):
        T_ortho = np.zeros((T.shape[0], ho_dim))
        for p in range(T.shape[0]):
            T_ortho[p] = apply_S_12(mr_adc, T[p], transpose = True)
        T = T_ortho

    return T
