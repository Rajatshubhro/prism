#INFO: **** input file is /home/mazin.3/Documents/programs/prism/examples/cvs_ee_mr_adc/spin.py ****
#!/usr/bin/env python

'''
CVS-EE-MR-ADC(2) calculations for N2
'''

import pyscf.gto
import pyscf.scf
import pyscf.mcscf
import prism_beta.interface
import prism_beta.mr_adc

mol = pyscf.gto.Mole()
r = 1.098
mol.atom = [
    ['N', ( 0., 0.    , -r/2)],
    ['N', ( 0., 0.    ,  r/2)],]
mol.basis = {'N':'aug-cc-pvdz'}
mol.verbose = 4
mol.build()

# RHF calculation as guess for CASSCF
mf = pyscf.scf.RHF(mol)
mf.kernel()

# CASSCF(6e,6o) calculation
mc = pyscf.mcscf.CASSCF(mf, 6, 6)
emc = mc.mc1step()[0]

# CVS-EE-MR-ADC calculation
interface = prism_beta.interface.PYSCF(mf, mc, opt_einsum = True)
mr_adc = prism_beta.mr_adc.MRADC(interface)
mr_adc.method_type = "cvs-ee"
mr_adc.method = "mr-adc(2)"
mr_adc.s_thresh_singles = 1e-5
mr_adc.s_thresh_doubles = 1e-10
mr_adc.ncvs = 2
mr_adc.nroots = 8
e, p = mr_adc.kernel()
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='asccbc-01181202.asc.ohio-state.edu', release='4.18.0-477.13.1.el8_8.x86_64', version='#1 SMP Thu May 18 10:27:05 EDT 2023', machine='x86_64')  Threads 24
Python 3.9.13 (main, Oct 13 2022, 21:15:33) 
[GCC 11.2.0]
numpy 1.23.3  scipy 1.9.1
Date: Mon Jun 26 17:03:17 2023
PySCF version 2.2.1
PySCF path  /home/cbc-sokolov-group/python-packages/pyscf-2.2.1/pyscf

[ENV] PYSCF_TMPDIR /scratch/local/mazin.3
[ENV] PYSCF_EXT_PATH /home/cbc-sokolov-group/pyscf/intel/17.1/1.5
[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 14
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 N      0.000000000000   0.000000000000  -0.549000000000 AA    0.000000000000   0.000000000000  -1.037459642386 Bohr   0.0
[INPUT]  2 N      0.000000000000   0.000000000000   0.549000000000 AA    0.000000000000   0.000000000000   1.037459642386 Bohr   0.0

nuclear repulsion = 23.6153764436066
number of shells = 16
number of NR pGTOs = 70
number of NR cGTOs = 46
basis = {'N': 'aug-cc-pvdz'}
ecp = {}
CPU time:         1.12


******** <class 'pyscf.scf.hf.RHF'> ********
method = RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /scratch/local/mazin.3/tmprdg0t_34
max_memory 4000 MB (current use 280 MB)
Set gradient conv threshold to 3.16228e-05
init E= -108.997365976287
  HOMO = -0.383394863650674  LUMO = 0.0527605148347113
cycle= 1 E= -108.938371912803  delta_E= 0.059  |g|= 0.292  |ddm|= 1.69
  HOMO = -0.667440590652671  LUMO = 0.0959074131140566
cycle= 2 E= -108.959124150663  delta_E= -0.0208  |g|= 0.0773  |ddm|= 0.446
  HOMO = -0.614135902462245  LUMO = 0.103850078545504
cycle= 3 E= -108.96052045917  delta_E= -0.0014  |g|= 0.0147  |ddm|= 0.0743
  HOMO = -0.615371970638089  LUMO = 0.103817157893354
cycle= 4 E= -108.960607977205  delta_E= -8.75e-05  |g|= 0.00121  |ddm|= 0.0563
  HOMO = -0.61531147390926  LUMO = 0.103828098399725
cycle= 5 E= -108.960608490355  delta_E= -5.13e-07  |g|= 0.000172  |ddm|= 0.00327
  HOMO = -0.615315360390609  LUMO = 0.103822137652362
cycle= 6 E= -108.960608506598  delta_E= -1.62e-08  |g|= 3.2e-05  |ddm|= 0.000482
  HOMO = -0.615307686837608  LUMO = 0.103821253142735
cycle= 7 E= -108.960608507242  delta_E= -6.43e-10  |g|= 3.01e-06  |ddm|= 0.000174
  HOMO = -0.615307964143244  LUMO = 0.103821216566418
Extra cycle  E= -108.960608507245  delta_E= -3.13e-12  |g|= 7.72e-07  |ddm|= 1.33e-05
converged SCF energy = -108.960608507245

******** <class 'pyscf.mcscf.mc1step.CASSCF'> ********
CAS (3e+3e, 6o), ncore = 4, nvir = 36
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /scratch/local/mazin.3/tmprdg0t_34
max_memory 4000 MB (current use 308 MB)
internal_rotation = False
******** <class 'pyscf.fci.direct_spin1.FCISolver'> ********
max. cycles = 50
conv_tol = 1e-08
davidson only = False
linear dependence = 1e-12
level shift = 0.001
max iter space = 12
max_memory 4000 MB
nroots = 1
pspace_size = 400
spin = None
CASCI E = -108.978701814276  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
macro iter   1 ( 21 JK    4 micro), CASSCF E = -109.027827858081  dE = -4.91260438e-02  S^2 = 0.0000000
               |grad[o]|=0.0356  |grad[c]|=0.0498  |ddm|=0.0589  |maxRot[o]|=0.311
macro iter   2 ( 21 JK    4 micro), CASSCF E = -109.055790084591  dE = -2.79622265e-02  S^2 = 0.0000000
               |grad[o]|=0.0522  |grad[c]|=0.0327  |ddm|=0.0263  |maxRot[o]|=0.245
macro iter   3 ( 21 JK    4 micro), CASSCF E = -109.068248418604  dE = -1.24583340e-02  S^2 = 0.0000000
               |grad[o]|=0.0278  |grad[c]|=0.0415  |ddm|=0.00551  |maxRot[o]|=0.286
macro iter   4 ( 21 JK    4 micro), CASSCF E = -109.083563794658  dE = -1.53153761e-02  S^2 = 0.0000000
               |grad[o]|=0.0273  |grad[c]|=0.0393  |ddm|=0.00609  |maxRot[o]|=0.287
macro iter   5 ( 21 JK    4 micro), CASSCF E = -109.094941560507  dE = -1.13777658e-02  S^2 = 0.0000000
               |grad[o]|=0.0227  |grad[c]|=0.0312  |ddm|=0.0038  |maxRot[o]|=0.311
macro iter   6 ( 14 JK    4 micro), CASSCF E = -109.096203307391  dE = -1.26174688e-03  S^2 = 0.0000000
               |grad[o]|=0.0114  |grad[c]|=0.00191  |ddm|=0.00186  |maxRot[o]|=0.134
macro iter   7 (  3 JK    1 micro), CASSCF E = -109.096203343470  dE = -3.60789016e-08  S^2 = 0.0000000
               |grad[o]|=0.000249  |grad[c]|=4.97e-05  |ddm|=1.24e-05  |maxRot[o]|=0.000378
1-step CASSCF converged in   7 macro (122 JK  25 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.9823537  1.94163559 1.94163559 0.01782659 0.05827427 0.05827427]
CASSCF energy = -109.096203343470
CASCI E = -109.096203343470  E(CI) = -13.6477117967582  S^2 = 0.0000000

--------------------------------------------------------------
    PRISM: Open-Source implementation of ab initio methods
            for excited states and spectroscopy

                       Version 0.1

           Copyright (C) 2019  Alexander Sokolov

    This program is distributed in the hope that it will
    be useful, but WITHOUT ANY WARRANTY; without even the
    implied warranty of MERCHANTABILITY or FITNESS FOR A
    PARTICULAR PURPOSE. See the GNU General Public License
    for more details.
--------------------------------------------------------------

Importing Pyscf objects...

Initializing MR-ADC...

Transforming integrals to spin-orbital basis...

Transforming dipole moments to spin-orbital basis...

Time for transforming integrals:                  1.242295 sec

Computing ground-state RDMs in the spin-orbital basis...

Computing excited-state CASCI wavefunctions...

Requested method type cvs-ee does not require running a CASCI calculation...
Skipping the CASCI calculation...

Final number of excited CASCI states: 0

Time for computing RDMs:                          1.759953 sec

Computing MR-ADC excitation energies...

Method:                                           cvs-ee-mr-adc(2)
Maximum order of T amplitudes:                    1
Number of MR-ADC roots requested:                 8
Ground-state active-space energy:               -13.647711796758
Nuclear repulsion energy:                        23.615376443607
Number of basis functions:                        46
Number of core orbitals:                          4
Number of active orbitals:                        6
Number of external orbitals:                      36
Number of electrons:                              14
Number of active electrons:                       (3, 3)
Number of CVS orbitals:                           2
Number of valence (non-CVS) orbitals:             2
Overlap truncation parameter (singles):           1.000000e-05
Overlap truncation parameter (doubles):           1.000000e-10
Number of CASCI states:                           0

Computing T[0']^(1) amplitudes...
Dimension of the [0'] orthonormalized subspace:   140
Smallest eigenvalue of the [0'] overlap metric:   5.436111e-05
Norm of T[0']^(1):                                0.290004164426
Correlation energy [0']:                         -0.057712804659

Computing T[+1']^(1) amplitudes...
Dimension of the [+1'] orthonormalized subspace:  556
Smallest eigenvalue of the [+1'] overlap metric:  1.030180e-05
Norm of T[+1']^(1):                               0.118355057810
Correlation energy [+1']:                        -0.001966679026

Computing T[-1']^(1) amplitudes...
Dimension of the [-1'] orthonormalized subspace:  556
Smallest eigenvalue of the [-1'] overlap metric:  1.023291e-05
Norm of T[-1']^(1):                               0.480475560904
Correlation energy [-1']:                        -0.007006009141

Computing T[0]^(1) amplitudes...
Norm of T[0]^(1):                                 0.126946391075
Correlation energy [0]:                          -0.018702023998

Computing T[+1]^(1) amplitudes...
Dimension of the [+1] orthonormalized subspace:   12
Smallest eigenvalue of the [+1] overlap metric:   8.823152e-03
Norm of T[+1]^(1):                                0.065842422308
Correlation energy [+1]:                         -0.006870817400

Computing T[-1]^(1) amplitudes...
Dimension of the [-1] orthonormalized subspace:   12
Smallest eigenvalue of the [-1] overlap metric:   8.913297e-03
Norm of T[-1]^(1):                                0.154381911260
Correlation energy [-1]:                         -0.025991862002

Computing T[+2]^(1) amplitudes...
Dimension of the [+2] orthonormalized subspace:   66
Smallest eigenvalue of the [+2] overlap metric:   7.459399e-05
Norm of T[+2]^(1):                                0.123089648471
Correlation energy [+2]:                         -0.005328384077

Computing T[-2]^(1) amplitudes...
Dimension of the [-2] orthonormalized subspace:   66
Smallest eigenvalue of the [-2] overlap metric:   7.636279e-05
Norm of T[-2]^(1):                                0.295598005623
Correlation energy [-2]:                         -0.043299688883

CASSCF reference energy:                        -109.096203343470
PC-NEVPT2 correlation energy:                     -0.166878269187
Total PC-NEVPT2 energy:                         -109.263081612657

Computing T[0']^(2) amplitudes...
Norm of T[0']^(2):                               0.009422851636

Computing T[+1']^(2) amplitudes...
Dimension of the [+1] orthonormalized subspace:   12
Smallest eigenvalue of the [+1] overlap metric:   8.823152e-03
Norm of T[+1']^(2):                               0.027518291431

Computing T[-1']^(2) amplitudes...
Dimension of the [-1] orthonormalized subspace:   12
Smallest eigenvalue of the [-1] overlap metric:   8.913297e-03
Norm of T[-1']^(2):                               0.070715899164

Computing T[0'']^(2) amplitudes...
Dimension of the [0''] orthonormalized subspace:  64
Smallest eigenvalue of the [0''] overlap metric:  2.803107e-03
Norm of T[0'']^(2):                               0.000000105228

Time for computing amplitudes:                    132.319110 sec

Dimension of h0 excitation manifold:              336
Computing M(h0-h0) block...

Time for computing M(h0-h0) block:                29.170207 sec

Norm of M:                                        291.316680
Norm of M - M.T:                                  1.53809e-08

[[14.96977148]
 [14.96977158]
 [14.96977194]
 [14.96977195]
 [14.96977204]
 [14.96977205]
 [14.97280553]
 [14.97280563]
 [14.972806  ]
 [14.97280601]
 [14.9728061 ]
 [14.97280611]
 [14.9973314 ]
 [14.99733152]
 [14.99794353]
 [14.99794365]
 [15.48595221]
 [15.48595222]
 [15.48595222]
 [15.48707291]
 [15.48707291]
 [15.48707291]
 [15.50886649]
 [15.5105137 ]
 [15.54597126]
 [15.54597127]
 [15.54597128]
 [15.54597128]
 [15.54597129]
 [15.5459713 ]
 [15.54811299]
 [15.54811299]
 [15.548113  ]
 [15.54811301]
 [15.54811301]
 [15.54811302]
 [15.55403045]
 [15.55403046]
 [15.5565949 ]
 [15.5565949 ]
 [15.59194154]
 [15.59202887]
 [15.59202887]
 [15.59202887]
 [15.59254981]
 [15.59278796]
 [15.59278796]
 [15.59278796]
 [15.62193604]
 [15.62193604]
 [15.62193608]
 [15.62247609]
 [15.62247609]
 [15.62247613]
 [15.64347691]
 [15.6454092 ]
 [15.65956648]
 [15.65956648]
 [15.65956655]
 [15.66003364]
 [15.66003364]
 [15.66003372]
 [15.66479369]
 [15.66479369]
 [15.66479369]
 [15.6647937 ]
 [15.6647937 ]
 [15.6647937 ]
 [15.66539795]
 [15.66539795]
 [15.66702772]
 [15.66702773]
 [15.66702773]
 [15.66702773]
 [15.66702773]
 [15.66702774]
 [15.66766412]
 [15.66766412]
 [15.68768693]
 [15.68786655]
 [15.76028627]
 [15.76028627]
 [15.76028627]
 [15.76257951]
 [15.76257951]
 [15.76257951]
 [15.76718297]
 [15.76952473]
 [15.86426143]
 [15.86426143]
 [15.86426143]
 [15.86426145]
 [15.86426145]
 [15.86426145]
 [15.86432559]
 [15.86432561]
 [15.86670177]
 [15.86670177]
 [15.86670177]
 [15.8667018 ]
 [15.8667018 ]
 [15.8667018 ]
 [15.86677246]
 [15.86677248]
 [15.95135642]
 [15.95135648]
 [15.9513566 ]
 [15.95135667]
 [15.95135669]
 [15.95135682]
 [15.95321827]
 [15.95321832]
 [15.95321845]
 [15.95321851]
 [15.95321854]
 [15.95321867]
 [15.97183407]
 [15.97183407]
 [15.97183407]
 [15.97405116]
 [15.97405116]
 [15.97405116]
 [15.98446594]
 [15.98763193]
 [16.00893487]
 [16.00893493]
 [16.01202409]
 [16.01202415]
 [16.04851838]
 [16.0485184 ]
 [16.04851845]
 [16.04851848]
 [16.04851849]
 [16.04851854]
 [16.04963621]
 [16.04963623]
 [16.04963629]
 [16.04963631]
 [16.04963632]
 [16.04963638]
 [16.06114887]
 [16.0611489 ]
 [16.06264635]
 [16.06264638]
 [16.11551919]
 [16.11551919]
 [16.11551919]
 [16.11579131]
 [16.11579131]
 [16.11579131]
 [16.1706636 ]
 [16.17147813]
 [16.19935852]
 [16.19935852]
 [16.19935852]
 [16.19935852]
 [16.19935852]
 [16.19935852]
 [16.19937321]
 [16.19937321]
 [16.20184199]
 [16.20184199]
 [16.20184199]
 [16.20184199]
 [16.20184199]
 [16.20184199]
 [16.201857  ]
 [16.20185701]
 [16.20471108]
 [16.20471109]
 [16.20471112]
 [16.20471113]
 [16.20471114]
 [16.20471117]
 [16.20528019]
 [16.2052802 ]
 [16.20528023]
 [16.20528024]
 [16.20528025]
 [16.20528028]
 [16.22352075]
 [16.22352076]
 [16.22370038]
 [16.22370039]
 [16.30477465]
 [16.30477465]
 [16.30477466]
 [16.30706867]
 [16.30706867]
 [16.30706868]
 [16.31831802]
 [16.32016897]
 [16.39839676]
 [16.39839679]
 [16.39839686]
 [16.39839688]
 [16.3983969 ]
 [16.39839697]
 [16.39842569]
 [16.39842572]
 [16.39842579]
 [16.39842582]
 [16.39842584]
 [16.3984259 ]
 [16.41575383]
 [16.41575387]
 [16.41595232]
 [16.41595236]
 [16.43943255]
 [16.43943255]
 [16.43943258]
 [16.43958565]
 [16.43958565]
 [16.43958567]
 [16.44312106]
 [16.4437055 ]
 [16.65110732]
 [16.65110733]
 [16.65110735]
 [16.65110735]
 [16.65110736]
 [16.65110737]
 [16.65308557]
 [16.65308558]
 [16.6530856 ]
 [16.6530856 ]
 [16.6530856 ]
 [16.65308562]
 [16.65746634]
 [16.65746635]
 [16.65944363]
 [16.65944364]
 [16.90572224]
 [16.90572224]
 [16.90572249]
 [16.90715706]
 [16.90715706]
 [16.90715731]
 [17.0104638 ]
 [17.01106198]
 [17.04608931]
 [17.04608931]
 [17.04608933]
 [17.0484404 ]
 [17.0484404 ]
 [17.04844041]
 [17.06520407]
 [17.06739983]
 [17.2817476 ]
 [17.2817476 ]
 [17.2817476 ]
 [17.28174764]
 [17.28174764]
 [17.28174764]
 [17.28337504]
 [17.28337507]
 [17.28367417]
 [17.28367417]
 [17.28367417]
 [17.28367421]
 [17.28367421]
 [17.28367421]
 [17.28453739]
 [17.28453739]
 [17.2845374 ]
 [17.2845374 ]
 [17.28453741]
 [17.28453742]
 [17.28538427]
 [17.2853843 ]
 [17.28694842]
 [17.28694842]
 [17.28694843]
 [17.28694843]
 [17.28694844]
 [17.28694845]
 [17.28744469]
 [17.2874447 ]
 [17.2899347 ]
 [17.28993471]
 [17.80798811]
 [17.80798811]
 [17.80798811]
 [17.80798811]
 [17.80798811]
 [17.80798811]
 [17.80840364]
 [17.80840364]
 [17.8099711 ]
 [17.8099711 ]
 [17.8099711 ]
 [17.80997111]
 [17.80997111]
 [17.80997111]
 [17.81041071]
 [17.81041071]
 [18.00163321]
 [18.00163321]
 [18.00163323]
 [18.00349919]
 [18.00349919]
 [18.00349922]
 [18.00931265]
 [18.01140907]
 [18.1757538 ]
 [18.1757538 ]
 [18.17575381]
 [18.17796244]
 [18.17796244]
 [18.17796245]
 [18.19714571]
 [18.19914048]
 [18.228744  ]
 [18.22874401]
 [18.22874401]
 [18.22874401]
 [18.22874401]
 [18.22874401]
 [18.23125934]
 [18.23125934]
 [18.23125934]
 [18.23125934]
 [18.23125935]
 [18.23125935]
 [18.23448169]
 [18.23448169]
 [18.23692515]
 [18.23692515]
 [18.30147284]
 [18.30147284]
 [18.30147284]
 [18.30373403]
 [18.30373403]
 [18.30373403]
 [18.35114738]
 [18.35232893]]
